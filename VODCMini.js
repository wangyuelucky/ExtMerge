Ext.define("Soims.view.application.ApplicationPanel",{extend:"Ext.form.Panel",alias:"widget.applicationpanel",iconCls:"ApplicationSideList",closable:!0,initComponent:function(){this.items=[{xtype:"applicationhistorypanel"},{xtype:this.grid}],this.title=this.title,this.callParent()}});Ext.define("Soims.view.application.ApplicationHistoryPanel",{itemId:"applicationApplicationHistoryPanel",extend:"Ext.form.Panel",alias:"widget.applicationhistorypanel",title:"申请历史流程",padding:2,bodyStyle:"background-color:#dfe8f5;",height:115,autoShow:!0,bodyPadding:"15 0 0 0",initComponent:function(){this.items={xtype:"label"},this.on("afterrender",this.showDefaultHistoryState),this.callParent()},refresh:function(t,i){switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:this.showB1(t);break;case Soims.model.application.common.SampleApplicationType.B2.value:this.showB2(t);break;case Soims.model.application.common.SampleApplicationType.V1.value:this.showV1(t);break;case Soims.model.application.common.SampleApplicationType.V2.value:this.showV2(t);break;case Soims.model.application.common.SampleApplicationType.V3.value:this.showV3(t);break;case Soims.model.application.common.SampleApplicationType.V4.value:this.showV4(t)}},showB1:function(t){var i=void 0==t.VODCSubmit?"Application/common/resources/images/appState/a_0.png":t.VODCSubmit.url,e=void 0==t.VODCSubmit?"":t.VODCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>航次组织实施单位审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showB2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showV1:function(t){var i=void 0==t.VRCSubmit?"Application/common/resources/images/appState/a_0.png":t.VRCSubmit.url,e=void 0==t.VRCSubmit?"":t.VRCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>任务牵头负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV3:function(t){var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showV4:function(t){console.log(t);var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showBeginHtml:function(t){var i=void 0==t.UnSubmit?"Application/common/resources/images/appState/a_1.png":t.UnSubmit.url,e=void 0==t.UnSubmit?"":t.UnSubmit.tip,o=void 0==t.Submit?"Application/common/resources/images/appState/a_2.png":t.Submit.url,a=void 0==t.Submit?"":t.Submit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>新建申请</div>';return l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>提交</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>'},showEndHtml:function(t){var i=void 0==t.AdminAccept?"Application/common/resources/images/appState/a_3.png":t.AdminAccept.url,e=void 0==t.AdminAccept?"":t.AdminAccept.tip,o=void 0==t.AdminAllot?"Application/common/resources/images/appState/a_4.png":t.AdminAllot.url,a=void 0==t.AdminAllot?"":t.AdminAllot.tip,l=void 0==t.SMESubmit?"Application/common/resources/images/appState/a_5.png":t.SMESubmit.url,n=void 0==t.SMESubmit?"":t.SMESubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,s='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>申请受理</div>';return s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>分配方案编制</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+n+'" src="'+l+'" height="24" width="24"><br>申请审议</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+p+'" src="'+m+'" height="24" width="24"><br>申请审批</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s+='<div style="text-align:center; width: 80px; float:left;"><img title="" src= "Application/common/resources/images/appState/a_7.png" " height="24" width="24"><br>样品清点与出库</div>'},showDefaultHistoryState:function(){var t={},i='<div style="text-align:center; width: 80px; float:left;"><img title="" src="Application/common/resources/images/appState/a_0.png" height="24" width="24"><br>申请审核</div>';i+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var e=this.showBeginHtml(t)+i+this.showEndHtml(t);this.down("label").setText(e,!1)}});Ext.define("Soims.model.application.common.SampleApplicationType",{statics:{B1:{value:"B1",name:"b1申请书"},B2:{value:"B2",name:"b2申请书"},V1:{value:"V1",name:"v1申请书"},V2:{value:"V2",name:"v2申请书"},V3:{value:"V3",name:"v3申请书"},V4:{value:"V4",name:"v4申请书"}}});Ext.define("Soims.controller.application.ApplicationHistoryPanel",{extend:"Ext.app.Controller",views:["application.ApplicationHistoryPanel"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationhistorypanel",selector:"applicationhistorypanel",autoCreate:!0,xtype:"applicationhistorypanel"}],init:function(){this.control({})},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.controller.application.ApplicationPanel",{extend:"Ext.app.Controller",views:["application.ApplicationPanel"],refs:[{ref:"applicationpanel",selector:"applicationpanel",autoCreate:!0,xtype:"applicationpanel"}],init:function(){this.control({applicationpanel:{resize:function(i,t,a){var n=i.down("grid");n.setHeight(a-120)}}})},showTab:function(i,t,a,n,e,o){var p=this.getCon("mainFrame.Main"),l=p.existInstance(i);if(l)return l;var r=Ext.create(a,{id:i,title:t,application:this.application,applicationID:n,isShow:e,isEdit:o});return p.addTab(r),r},show:function(i,t){this.getCon(i),this.getController("application.ApplicationHistoryPanel");var a=i.split(".")[1].toLowerCase(),n=this.getView("application.ApplicationPanel"),e=Ext.create(n,{id:a,grid:a,title:t}),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.model.application.common.ApplicationState",{statics:{Unknown:{value:"Unknown",name:"未知类型"},Cancel:{value:"Cancel",name:"已撤回"},Deleted:{value:"Deleted",name:"已删除"},UnSubmit:{value:"UnSubmit",name:"未提交"},Submit:{value:"Submit",name:"已提交"},VODCAudit:{value:"VODCAudit",name:"航次组织实施单位审核"},VODCSubmit:{value:"VODCSubmit",name:"组织实施单位已审核"},LSAudit:{value:"LSAudit",name:"航段首席科学家审核"},LSSubmit:{value:"LSSubmit",name:"航段首席科学家已审核"},VSAudit:{value:"VSAudit",name:"航次首席科学家审核"},VSSubmit:{value:"VSSubmit",name:"航次首席科学家已审核"},PCAudit:{value:"PCAudit",name:"项目负责人审核"},PCSubmit:{value:"PCSubmit",name:"项目负责人已审核"},VRCAudit:{value:"VRCAudit",name:"航次报告牵头负责人审核"},VRCSubmit:{value:"VRCSubmit",name:"航次报告牵头负责人已审核"},AdminAccept:{value:"AdminAccept",name:"大洋馆受理"},AdminAllot:{value:"AdminAllot",name:"大洋馆已分配"},AdminReject:{value:"AdminReject",name:"大洋馆驳回"},AdminDeny:{value:"AdminDeny",name:"大洋馆否决"},SMEAudit:{value:"SMEAudit",name:"样品管理专家委员会审议"},SMESubmit:{value:"SMESubmit",name:"样品管理专家委员会已审议"},OIAudit:{value:"OIAudit",name:"大洋协会联系人审批"},OISubmit:{value:"OISubmit",name:"大洋协会联系人已审批"},OIReject:{value:"OIReject",name:"大洋协会联系人驳回"}}});Ext.define("Soims.view.applicationAuditing.AuditApplicationGrid",{extend:"Ext.grid.Panel",requires:"Soims.model.application.common.ApplicationState",alias:"widget.auditapplicationgrid",title:"待审核申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAuditing.AuditApplication"),this.store.load(),this.columns=[{header:"申请书编号",dataIndex:"applicationNumber",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"提交日期",dataIndex:"applyTime",flex:1}],this.tbar=[{text:"审核",xtype:"button",action:"audit",name:"audit",itemId:"audit",disabled:!0,tooltip:"审核申请书",iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",tooltip:"刷新列表",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.model.application.SamplePanelType",{statics:{AuditShow:{value:"AuditShow",name:"显示审核意见"},AuditEdit:{value:"AuditEdit",name:"编辑审核意见"},AllocationIndoorShow:{value:"AllocationIndoorShow",name:"显示到入馆分配建议"},AllocationIndoorEdit:{value:"AllocationIndoorEdit",name:"编辑入馆分配建议"},AllocationOutdoorShow:{value:"AllocationOutdoorShow",name:"显示到现场分配建议"},AllocationOutdoorEdit:{value:"AllocationOutdoorEdit",name:"编辑现场分配建议"},DiscussionIndoorShow:{value:"DiscussionIndoorShow",name:"显示到入馆审议意见"},DiscussionIndoorEdit:{value:"DiscussionIndoorEdit",name:"编辑入馆审议意见"},DiscussionOutShow:{value:"DiscussionOutShow",name:"显示到现场审议意见"},DiscussionOutEdit:{value:"DiscussionOutEdit",name:"编辑现场审议意见"},getByAppType:function(o,i,t){var n,s=/^b[12]$/gi;return n=s.test(o)?t?i?this.DiscussionOutEdit.value:this.DiscussionOutShow.value:i?this.AllocationOutdoorEdit.value:this.AllocationOutdoorShow.value:t?i?this.DiscussionIndoorEdit.value:this.DiscussionIndoorShow.value:i?this.AllocationIndoorEdit.value:this.AllocationIndoorShow.value}}});Ext.define("Soims.controller.applicationAuditing.AuditApplicationGrid",{extend:"Ext.app.Controller",views:["applicationAuditing.AuditApplicationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"auditapplicationgrid",selector:"auditapplicationgrid",autoCreate:!0,xtype:"auditapplicationgrid"}],init:function(){this.control({"auditapplicationgrid  button[action=audit]":{click:this.onClickAppAuditBtn},auditapplicationgrid:{itemclick:function(i,t){this.showHistoryState(t)},selectionchange:function(i,t){var e=this.getAuditapplicationgrid();e.down("#audit").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(i){var t=i.get("id"),e=this.getAuditapplicationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var a=Ext.JSON.decode(t.responseText);e.refresh(a,i.get("type"))}})},showTab:function(i,t,e,a,o){var n=this.getCon("mainFrame.Main"),p=n.existInstance(i);if(p)return p;var l=Ext.create(e,{id:i,title:t,applicationID:a,isShow:!0,isAudit:!0,appType:o,panelType:Soims.model.application.SamplePanelType.AuditEdit.value});return n.addTab(l),l},show:function(){var i=this.getAuditapplicationgrid(),t=this.getCon("mainFrame.Main");t.addTab(i)},refreshGrid:function(){this.show(),this.getAuditapplicationgrid().getStore().reload(),this.getAuditapplicationgrid().getSelectionModel().deselectAll()},getCon:function(i){var t=this.application;return t.getController(i)},onClickAppAuditBtn:function(i){{var t=i.up("grid"),e=t.getSelectionModel().getSelection()[0],a=e.get("type"),o=this.getViewFnByApp("applicationAuditing",a,"Tab");this.showTab("Audit"+a+e.get("id"),"审核"+e.get("name"),o,e.get("id"),e.get("type"))}},getViewFnByApp:function(i,t,e){var a=null,o=this.getCon(i+"."+t+e);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:a=o.getApplicationAuditingB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:a=o.getApplicationAuditingB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:a=o.getApplicationAuditingV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:a=o.getApplicationAuditingV2TabView()}return a}});Ext.define("Soims.model.applicationAuditing.ContentType",{statics:{Agree:{value:"Agree",name:"同意"},Reject:{value:"Reject",name:"不同意"},Doubt:{value:"Doubt",name:"拟同意"}}});Ext.define("Soims.view.applicationAuditing.AuditApplicationCompleteGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.application.common.ApplicationState","Soims.model.applicationAuditing.ContentType"],alias:"widget.auditapplicationcompletegrid",title:"已审核申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAuditing.AuditApplicationComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"id",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"审核状态",dataIndex:"contentType",renderer:function(e){return Soims.model.applicationAuditing.ContentType[e].name},flex:1},{header:"审核日期",dataIndex:"auditTime",renderer:Ext.util.Format.dateRenderer("Y年m月d日"),flex:1}],this.tbar=[{text:"查看",xtype:"button",itemId:"show",action:"show",disabled:!0,iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.applicationAuditing.AuditApplicationCompleteGrid",{extend:"Ext.app.Controller",views:["applicationAuditing.AuditApplicationCompleteGrid"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"auditapplicationcompletegrid",selector:"auditapplicationcompletegrid",autoCreate:!0,xtype:"auditapplicationcompletegrid"}],init:function(){this.control({"auditapplicationcompletegrid  button[action=show]":{click:this.onClickAppShowBtn},auditapplicationcompletegrid:{itemclick:function(i,t){this.showHistoryState(t)},selectionchange:function(i,t){var e=this.getAuditapplicationcompletegrid();e.down("#show").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(i){var t=i.get("applicationID"),e=this.getAuditapplicationcompletegrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var o=Ext.JSON.decode(t.responseText);e.refresh(o,i.get("type"))}})},showTab:function(i,t,e,o,a){var p=this.getCon("mainFrame.Main"),n=p.existInstance(i);if(n)return n;var l=Ext.create(e,{id:i,title:t,applicationID:o,isShow:!0,isAudit:!1,appType:a,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return p.addTab(l),l},show:function(){var i=this.getAuditapplicationcompletegrid(),t=this.getCon("mainFrame.Main");t.addTab(i)},getCon:function(i){var t=this.application;return t.getController(i)},onClickAppShowBtn:function(i){{var t=i.up("grid"),e=t.getSelectionModel().getSelection()[0],o=e.get("type"),a=this.getViewFnByApp("applicationAuditing",o,"Tab");this.showTab("ShowAudit"+o+e.get("id"),"查看"+e.get("name"),a,e.get("applicationID"),e.get("type"))}},getViewFnByApp:function(i,t,e){var o=null,a=this.getCon(i+"."+t+e);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:o=a.getApplicationAuditingB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:o=a.getApplicationAuditingB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:o=a.getApplicationAuditingV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:o=a.getApplicationAuditingV2TabView()}return o}});Ext.define("Soims.model.project.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"departmentName",type:"string",mapping:"Department"},{name:"address",type:"string",mapping:"Address"},{name:"cellphone",type:"string",mapping:"Cellphone"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"zipCode",type:"string",mapping:"ZipCode"},{name:"fax",type:"string",mapping:"Fax"}]});Ext.define("Soims.store.project.User",{extend:"Ext.data.Store",model:"Soims.model.project.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.voyage.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"}]});Ext.define("Soims.store.voyage.Department",{extend:"Ext.data.Store",model:"Soims.model.voyage.Department",proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageBasic",{extend:"Ext.form.Panel",alias:"widget.voyagebasic",requires:["Soims.store.project.User","Soims.store.voyage.Department","Ext.ux.form.SearchComboBox"],title:"航次基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User"),t=Ext.create("Soims.store.voyage.Department");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,padding:"10 0 10 10",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"textfield",name:"name",forbidBlankAndShowStar:!0,readOnly:this.isShow,itemId:"name",fieldLabel:"航次名称"},{xtype:"textfield",name:"number",itemId:"number",forbidBlankAndShowStar:!0,regex:1==Soims.component.voyageBasicStartTimeHidden?void 0:/DY(\d*)-\d\d$/,regexText:"请输入正确格式，例如：DY125-05",readOnly:this.isShow,allowBlank:!1,fieldLabel:"航次代码"},{xtype:"searchcombo",name:"chargerId",itemId:"chargerId",showStar:!0,fieldLabel:"航次首席科学家",readOnly:this.isShow,store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationDepartId",readOnly:this.isShow,showStar:!0,itemId:"organizationDepartId",readOnly:this.isShow,fieldLabel:"实施单位",store:t,valueField:"id",displayField:"name"},{xtype:"datefield",name:"beginTime",itemId:"beginTime",forbidBlankAndShowStar:!0,fieldLabel:"开始时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#stopTime");a.setMinValue(t)}}},{xtype:"datefield",name:"stopTime",itemId:"stopTime",forbidBlankAndShowStar:!0,fieldLabel:"结束时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#beginTime");a.setMaxValue(t)}}}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationId",readOnly:this.isShow,showStar:!0,itemId:"organizationId",fieldLabel:"实施单位联系人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},{xtype:"datefield",name:"startTime",itemId:"startTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"开放申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicStartTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),i=e.up("panel").down("#endTime");i.setMinValue(t);for(var o=0;o<a.getCount();o++){var n=a.getAt(o);n.set("startApplyTime",t)}}}},{xtype:"datefield",name:"endTime",itemId:"endTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"结束申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicEndTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").down("#startTime");a.setMaxValue(t);for(var i=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),o=0;o<i.getCount();o++){var n=i.getAt(o);n.set("endApplyTime",t)}}}}]}],this.callParent()}});Ext.define("Soims.model.voyage.Leg",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"voyageId",type:"int",mapping:"VoyageId"},{name:"name",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"sampleAreas",type:"string",mapping:"SampleAreas"},{name:"sampleAreaIds",type:"string",mapping:"SampleAreaIds"},{name:"startTime",type:"date",mapping:"StartTime"},{name:"endTime",type:"date",mapping:"EndTime"},{name:"startApplyTime",type:"date",mapping:"StartApplyTime"},{name:"endApplyTime",type:"date",mapping:"EndApplyTime"}]});Ext.define("Soims.store.voyage.Leg",{extend:"Ext.data.Store",model:"Soims.model.voyage.Leg",proxy:{type:"ajax",url:Soims.service.voyages.LegService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.LegGrid",{extend:"Ext.grid.Panel",alias:"widget.leggrid",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Ext.ux.form.TreeField"],title:"航段列表",viewConfig:{emptyText:"没有满足条件的航段"},height:400,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.Leg"),void 0!==this.voyageId&&this.initStore();var t=Ext.create("Soims.store.tree.SampleAreaAll");this.tree=t,this.store=this.vStore,this.columns=[{header:'<span>航段编号<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段代码<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"code",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段首席科学家<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,a){if(t){var o=e.findRecord("id",t);return null===o?a.get("chargerName"):o.get("name")}}},{header:'<span>采样区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAreaIds",flex:1,editor:{xtype:"treefield",pickerTitle:"航段所在采样区域",disabled:this.isShow,onlyCheckChild:!0,store:t},renderer:function(e,i,a){if(e){var o=e.split(","),d=!0,n="";return Ext.Array.each(o,function(e){if(""!==e){var i=e.split("|"),a=t.getNodeById(i[0]),o=document.getElementById("textBox"+i[0]);a?n=o?n+"["+o.value+"]":n+"["+a.get("text")+"]":d=!1}}),d?n:a.get("sampleAreas")}}},{header:'<span>开始时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"startTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>结束时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"endTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>开放申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"startApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,allowBlank:Soims.component.voyageBasicStartTimeHidden}},{header:'<span>结束申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"endApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,name:"endApplyTime",allowBlank:Soims.component.voyageBasicStartTimeHidden}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarlg",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},reloadTree:function(){this.tree.reload();var e=this.tree.getRootNode();e.eachChild(function(e){e.data.leaf||this.tree.load({node:e})},this)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageLeg",{extend:"Ext.form.Panel",alias:"widget.editvoyageleg",title:"航次航段",buttonAlign:"center",requires:["Soims.view.voyage.VoyageBasic","Soims.view.voyage.LegGrid"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagebasic",voyageId:this.voyageId,isShow:this.isShow},{xtype:"leggrid",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"保存",xtype:"button",hidden:this.isShow,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.model.voyage.VoyageTask",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"voyageTaskLegIds",type:"string",mapping:"VoyageTaskLegIds"},{name:"voyageTaskLegNames",type:"string",mapping:"VoyageTaskLegNames"}]});Ext.define("Soims.store.voyage.VoyageTask",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageTask",proxy:{type:"ajax",url:Soims.service.voyages.VoyageTaskService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.voyage.VoyageTask",{extend:"Ext.grid.Panel",alias:"widget.voyagetask",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Soims.store.voyage.VoyageTask"],viewConfig:{emptyText:"没有满足条件的航次任务"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.legStore=Ext.create("Soims.store.voyage.Leg"),this.vStore=Ext.create("Soims.store.voyage.VoyageTask"),void 0!==this.voyageId&&(this.initStore(),this.vStore.load()),this.store=this.vStore,this.columns=[{header:'<span>任务名称<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>任务负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,o,i){if(t){var a=e.findRecord("id",t);return null===a?i.get("chargerName"):a.get("name")}}},{header:'<span>所在航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"voyageTaskLegNames",flex:1,editor:{xtype:"combo",store:this.legStore,multiSelect:!0,editable:!1,disabled:this.isShow,valueField:"name",allowBlank:!1,displayField:"name"}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarEq",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.legStore.getProxy().setExtraParam("voyageId",this.voyageId),this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var o=e.getEditor(t.record,t.column);o.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageTask",{extend:"Ext.form.Panel",alias:"widget.editvoyagetask",title:"航次任务",buttonAlign:"center",requires:["Soims.view.voyage.VoyageTask"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagetask",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.VoyageReportBasic",{extend:"Ext.form.Panel",alias:"widget.voyagereportbasic",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox"],title:"航次报告基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,margin:"5 5 5 5",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"textfield",name:"name",allowBlank:!1,readOnly:this.isShow,forbidBlankAndShowStar:!0,itemId:"name",fieldLabel:"航次报告名称"}]},{xtype:"panel",border:!1,layout:"form",margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"searchcombo",name:"chargerId",readOnly:this.isShow,showStar:!0,itemId:"chargerId",fieldLabel:"报告牵头负责人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]}],this.callParent()}});Ext.define("Soims.model.voyage.VoyageReportDetail",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"discipline",type:"string",mapping:"Discipline"}]});Ext.define("Soims.store.voyage.VoyageReportDetail",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageReportDetail",proxy:{type:"ajax",url:Soims.service.voyages.VoyageReportDetailService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageReportDetail",{extend:"Ext.grid.Panel",alias:"widget.voyagereportdetail",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.VoyageReportDetail"],viewConfig:{emptyText:"没有满足条件的航次任务"},title:"航次报告分工信息",plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.VoyageReportDetail"),void 0!==this.voyageId&&this.initStore(),this.store=this.vStore,this.columns=[{header:'<span>分工负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,o){if(t){var a=e.findRecord("id",t);return null===a?o.get("chargerName"):a.get("name")}}},{header:'<span>负责学科和调查区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"discipline",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbardl",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageReport",{extend:"Ext.form.Panel",alias:"widget.editvoyagereport",title:"航次报告",buttonAlign:"center",requires:["Soims.view.voyage.VoyageReportBasic","Soims.view.voyage.VoyageReportDetail"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagereportbasic",isShow:this.isShow,voyageId:this.voyageId},{xtype:"voyagereportdetail",isShow:this.isShow,voyageId:this.voyageId}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"完成",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"complete"}],this.callParent()},lock:function(){this.down("#complete").setDisabled(!0),this.down("#save").setDisabled(!0)},unlock:function(){this.down("#complete").setDisabled(!1),this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.BoardPeoplePanel",{extend:"Ext.grid.Panel",alias:"widget.boardpeoplepanel",title:"上船人员列表",viewConfig:{emptyText:"没有满足条件的项目"},closable:!1,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.BoardPeople"),this.voyageId&&this.initStore(),this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"身份证号",dataIndex:"identityNumber",flex:1},{header:"性别",dataIndex:"sex",flex:1},{header:"单位",dataIndex:"userCompany",flex:1},{header:"职务",dataIndex:"position",flex:1},{header:"岗位职责",dataIndex:"duty",flex:1},{header:"出生日期",dataIndex:"birthday",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"地址",dataIndex:"address",flex:1},{header:"联系电话",dataIndex:"tellPhone",flex:1},{header:"移动电话",dataIndex:"cellPhone",flex:1}],this.tbar=[{text:"添加",xtype:"button",hidden:this.isShow,iconCls:"Add",itemId:"add",disabled:void 0==this.voyageId?!0:!1},{text:"修改",xtype:"button",iconCls:"Disk",hidden:this.isShow,itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",hidden:this.isShow,xtype:"button",disabled:!0},{text:"导入单位信息Excel",hidden:this.isShow,itemId:"boardingPeopleDepartment",iconCls:"Disk",xtype:"button"},{text:"导入上船人员名单Excel",hidden:this.isShow,itemId:"boardingPeople",iconCls:"Disk",xtype:"button"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){0!=t.length?this.down("#modify").setDisabled(!1):(this.down("#delete").setDisabled(!0),this.down("#modify").setDisabled(!0))},initStore:function(){this.store.getProxy().setExtraParam("voyageId",this.voyageId)},lock:function(){this.down("#add").setDisabled(!0)},unlock:function(){this.down("#add").setDisabled(!1)}});Ext.define("Soims.view.voyage.EditVoyageTag",{extend:"Ext.tab.Panel",alias:"widget.editvoyagetag",title:"航次任务样品申请",closable:!0,iconCls:"Project",requires:["Soims.view.voyage.EditVoyageLeg","Soims.view.voyage.EditVoyageTask","Soims.view.voyage.EditVoyageReport","Soims.view.voyage.BoardPeoplePanel"],initComponent:function(){this.items=[{xtype:"editvoyageleg",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagetask",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagereport",isShow:this.isShow,voyageId:this.voyageId},{xtype:"boardpeoplepanel",isShow:this.isShow,voyageId:this.voyageId}],this.callParent()}});Ext.define("Soims.controller.voyage.EditVoyageTag",{extend:"Ext.app.Controller",views:["voyage.EditVoyageTag"],refs:[{ref:"editvoyagetag",selector:"editvoyagetag",autoCreate:!0,xtype:"editvoyagetag"}],init:function(){this.getCon("voyage.EditVoyageLeg"),this.getCon("voyage.EditVoyageTask"),this.getCon("voyage.EditVoyageReport"),this.getCon("voyage.BoardPeople"),this.control({})},show:function(){{var e=this.getVoyageEditVoyageTagView(),o=this.getCon("voyage.Voyage");o.showTab("newVoyage","新建航次航段",!1,e,void 0)}},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.view.voyage.Voyage",{extend:"Ext.grid.Panel",alias:"widget.voyage",title:"航次列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Project",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.Voyage"),this.columns=[{header:"航次代码",dataIndex:"name",flex:1},{header:"航次编号",dataIndex:"number",flex:1},{header:"航次首席科学家",dataIndex:"chargerName",flex:1},{header:"航次组织实施单位联系人",dataIndex:"organizationName",flex:1},{header:"航次组织实施单位",dataIndex:"organizationDepartName",flex:1},{header:"开始申请时间",dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1},{header:"结束申请时间",dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1}],this.tbar=[{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"查看",xtype:"button",iconCls:"Information",itemId:"show",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.voyage.Voyage",{extend:"Ext.app.Controller",views:["voyage.Voyage"],refs:[{ref:"voyage",selector:"voyage",autoCreate:!0,xtype:"voyage"}],init:function(){this.control({"voyage  button[itemId=modify]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("EditVoyage"+o.get("id"),o.get("name"),!1,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},"voyage  button[itemId=show]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("ShowVoyage"+o.get("id"),o.get("name"),!0,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},voyage:{selectionchange:function(e,o){0!=o.length?(this.getVoyage().down("#modify").setDisabled(!1),this.getVoyage().down("#show").setDisabled(!1)):(this.getVoyage().down("#modify").setDisabled(!0),this.getVoyage().down("#show").setDisabled(!0))}}})},showTab:function(e,o,t,a,g){var i=this.getCon("mainFrame.Main"),n=i.existInstance(e);if(n)return n;var d=Ext.create(a,{id:e,title:o,isShow:t,voyageId:g});return i.addTab(d),d},show:function(){var e=this.getVoyage(),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.view.application.ApplicationPanel",{extend:"Ext.form.Panel",alias:"widget.applicationpanel",iconCls:"ApplicationSideList",closable:!0,initComponent:function(){this.items=[{xtype:"applicationhistorypanel"},{xtype:this.grid}],this.title=this.title,this.callParent()}});Ext.define("Soims.view.application.ApplicationHistoryPanel",{itemId:"applicationApplicationHistoryPanel",extend:"Ext.form.Panel",alias:"widget.applicationhistorypanel",title:"申请历史流程",padding:2,bodyStyle:"background-color:#dfe8f5;",height:115,autoShow:!0,bodyPadding:"15 0 0 0",initComponent:function(){this.items={xtype:"label"},this.on("afterrender",this.showDefaultHistoryState),this.callParent()},refresh:function(t,i){switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:this.showB1(t);break;case Soims.model.application.common.SampleApplicationType.B2.value:this.showB2(t);break;case Soims.model.application.common.SampleApplicationType.V1.value:this.showV1(t);break;case Soims.model.application.common.SampleApplicationType.V2.value:this.showV2(t);break;case Soims.model.application.common.SampleApplicationType.V3.value:this.showV3(t);break;case Soims.model.application.common.SampleApplicationType.V4.value:this.showV4(t)}},showB1:function(t){var i=void 0==t.VODCSubmit?"Application/common/resources/images/appState/a_0.png":t.VODCSubmit.url,e=void 0==t.VODCSubmit?"":t.VODCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>航次组织实施单位审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showB2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showV1:function(t){var i=void 0==t.VRCSubmit?"Application/common/resources/images/appState/a_0.png":t.VRCSubmit.url,e=void 0==t.VRCSubmit?"":t.VRCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>任务牵头负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV3:function(t){var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showV4:function(t){console.log(t);var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showBeginHtml:function(t){var i=void 0==t.UnSubmit?"Application/common/resources/images/appState/a_1.png":t.UnSubmit.url,e=void 0==t.UnSubmit?"":t.UnSubmit.tip,o=void 0==t.Submit?"Application/common/resources/images/appState/a_2.png":t.Submit.url,a=void 0==t.Submit?"":t.Submit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>新建申请</div>';return l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>提交</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>'},showEndHtml:function(t){var i=void 0==t.AdminAccept?"Application/common/resources/images/appState/a_3.png":t.AdminAccept.url,e=void 0==t.AdminAccept?"":t.AdminAccept.tip,o=void 0==t.AdminAllot?"Application/common/resources/images/appState/a_4.png":t.AdminAllot.url,a=void 0==t.AdminAllot?"":t.AdminAllot.tip,l=void 0==t.SMESubmit?"Application/common/resources/images/appState/a_5.png":t.SMESubmit.url,n=void 0==t.SMESubmit?"":t.SMESubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,s='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>申请受理</div>';return s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>分配方案编制</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+n+'" src="'+l+'" height="24" width="24"><br>申请审议</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+p+'" src="'+m+'" height="24" width="24"><br>申请审批</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s+='<div style="text-align:center; width: 80px; float:left;"><img title="" src= "Application/common/resources/images/appState/a_7.png" " height="24" width="24"><br>样品清点与出库</div>'},showDefaultHistoryState:function(){var t={},i='<div style="text-align:center; width: 80px; float:left;"><img title="" src="Application/common/resources/images/appState/a_0.png" height="24" width="24"><br>申请审核</div>';i+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var e=this.showBeginHtml(t)+i+this.showEndHtml(t);this.down("label").setText(e,!1)}});Ext.define("Soims.model.application.common.SampleApplicationType",{statics:{B1:{value:"B1",name:"b1申请书"},B2:{value:"B2",name:"b2申请书"},V1:{value:"V1",name:"v1申请书"},V2:{value:"V2",name:"v2申请书"},V3:{value:"V3",name:"v3申请书"},V4:{value:"V4",name:"v4申请书"}}});Ext.define("Soims.controller.application.ApplicationHistoryPanel",{extend:"Ext.app.Controller",views:["application.ApplicationHistoryPanel"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationhistorypanel",selector:"applicationhistorypanel",autoCreate:!0,xtype:"applicationhistorypanel"}],init:function(){this.control({})},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.controller.application.ApplicationPanel",{extend:"Ext.app.Controller",views:["application.ApplicationPanel"],refs:[{ref:"applicationpanel",selector:"applicationpanel",autoCreate:!0,xtype:"applicationpanel"}],init:function(){this.control({applicationpanel:{resize:function(i,t,a){var n=i.down("grid");n.setHeight(a-120)}}})},showTab:function(i,t,a,n,e,o){var p=this.getCon("mainFrame.Main"),l=p.existInstance(i);if(l)return l;var r=Ext.create(a,{id:i,title:t,application:this.application,applicationID:n,isShow:e,isEdit:o});return p.addTab(r),r},show:function(i,t){this.getCon(i),this.getController("application.ApplicationHistoryPanel");var a=i.split(".")[1].toLowerCase(),n=this.getView("application.ApplicationPanel"),e=Ext.create(n,{id:a,grid:a,title:t}),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.model.application.common.ApplicationState",{statics:{Unknown:{value:"Unknown",name:"未知类型"},Cancel:{value:"Cancel",name:"已撤回"},Deleted:{value:"Deleted",name:"已删除"},UnSubmit:{value:"UnSubmit",name:"未提交"},Submit:{value:"Submit",name:"已提交"},VODCAudit:{value:"VODCAudit",name:"航次组织实施单位审核"},VODCSubmit:{value:"VODCSubmit",name:"组织实施单位已审核"},LSAudit:{value:"LSAudit",name:"航段首席科学家审核"},LSSubmit:{value:"LSSubmit",name:"航段首席科学家已审核"},VSAudit:{value:"VSAudit",name:"航次首席科学家审核"},VSSubmit:{value:"VSSubmit",name:"航次首席科学家已审核"},PCAudit:{value:"PCAudit",name:"项目负责人审核"},PCSubmit:{value:"PCSubmit",name:"项目负责人已审核"},VRCAudit:{value:"VRCAudit",name:"航次报告牵头负责人审核"},VRCSubmit:{value:"VRCSubmit",name:"航次报告牵头负责人已审核"},AdminAccept:{value:"AdminAccept",name:"大洋馆受理"},AdminAllot:{value:"AdminAllot",name:"大洋馆已分配"},AdminReject:{value:"AdminReject",name:"大洋馆驳回"},AdminDeny:{value:"AdminDeny",name:"大洋馆否决"},SMEAudit:{value:"SMEAudit",name:"样品管理专家委员会审议"},SMESubmit:{value:"SMESubmit",name:"样品管理专家委员会已审议"},OIAudit:{value:"OIAudit",name:"大洋协会联系人审批"},OISubmit:{value:"OISubmit",name:"大洋协会联系人已审批"},OIReject:{value:"OIReject",name:"大洋协会联系人驳回"}}});Ext.define("Soims.view.applicationAuditing.AuditApplicationGrid",{extend:"Ext.grid.Panel",requires:"Soims.model.application.common.ApplicationState",alias:"widget.auditapplicationgrid",title:"待审核申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAuditing.AuditApplication"),this.store.load(),this.columns=[{header:"申请书编号",dataIndex:"applicationNumber",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"提交日期",dataIndex:"applyTime",flex:1}],this.tbar=[{text:"审核",xtype:"button",action:"audit",name:"audit",itemId:"audit",disabled:!0,tooltip:"审核申请书",iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",tooltip:"刷新列表",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.model.application.SamplePanelType",{statics:{AuditShow:{value:"AuditShow",name:"显示审核意见"},AuditEdit:{value:"AuditEdit",name:"编辑审核意见"},AllocationIndoorShow:{value:"AllocationIndoorShow",name:"显示到入馆分配建议"},AllocationIndoorEdit:{value:"AllocationIndoorEdit",name:"编辑入馆分配建议"},AllocationOutdoorShow:{value:"AllocationOutdoorShow",name:"显示到现场分配建议"},AllocationOutdoorEdit:{value:"AllocationOutdoorEdit",name:"编辑现场分配建议"},DiscussionIndoorShow:{value:"DiscussionIndoorShow",name:"显示到入馆审议意见"},DiscussionIndoorEdit:{value:"DiscussionIndoorEdit",name:"编辑入馆审议意见"},DiscussionOutShow:{value:"DiscussionOutShow",name:"显示到现场审议意见"},DiscussionOutEdit:{value:"DiscussionOutEdit",name:"编辑现场审议意见"},getByAppType:function(o,i,t){var n,s=/^b[12]$/gi;return n=s.test(o)?t?i?this.DiscussionOutEdit.value:this.DiscussionOutShow.value:i?this.AllocationOutdoorEdit.value:this.AllocationOutdoorShow.value:t?i?this.DiscussionIndoorEdit.value:this.DiscussionIndoorShow.value:i?this.AllocationIndoorEdit.value:this.AllocationIndoorShow.value}}});Ext.define("Soims.controller.applicationAuditing.AuditApplicationGrid",{extend:"Ext.app.Controller",views:["applicationAuditing.AuditApplicationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"auditapplicationgrid",selector:"auditapplicationgrid",autoCreate:!0,xtype:"auditapplicationgrid"}],init:function(){this.control({"auditapplicationgrid  button[action=audit]":{click:this.onClickAppAuditBtn},auditapplicationgrid:{itemclick:function(i,t){this.showHistoryState(t)},selectionchange:function(i,t){var e=this.getAuditapplicationgrid();e.down("#audit").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(i){var t=i.get("id"),e=this.getAuditapplicationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var a=Ext.JSON.decode(t.responseText);e.refresh(a,i.get("type"))}})},showTab:function(i,t,e,a,o){var n=this.getCon("mainFrame.Main"),p=n.existInstance(i);if(p)return p;var l=Ext.create(e,{id:i,title:t,applicationID:a,isShow:!0,isAudit:!0,appType:o,panelType:Soims.model.application.SamplePanelType.AuditEdit.value});return n.addTab(l),l},show:function(){var i=this.getAuditapplicationgrid(),t=this.getCon("mainFrame.Main");t.addTab(i)},refreshGrid:function(){this.show(),this.getAuditapplicationgrid().getStore().reload(),this.getAuditapplicationgrid().getSelectionModel().deselectAll()},getCon:function(i){var t=this.application;return t.getController(i)},onClickAppAuditBtn:function(i){{var t=i.up("grid"),e=t.getSelectionModel().getSelection()[0],a=e.get("type"),o=this.getViewFnByApp("applicationAuditing",a,"Tab");this.showTab("Audit"+a+e.get("id"),"审核"+e.get("name"),o,e.get("id"),e.get("type"))}},getViewFnByApp:function(i,t,e){var a=null,o=this.getCon(i+"."+t+e);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:a=o.getApplicationAuditingB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:a=o.getApplicationAuditingB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:a=o.getApplicationAuditingV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:a=o.getApplicationAuditingV2TabView()}return a}});Ext.define("Soims.model.applicationAuditing.ContentType",{statics:{Agree:{value:"Agree",name:"同意"},Reject:{value:"Reject",name:"不同意"},Doubt:{value:"Doubt",name:"拟同意"}}});Ext.define("Soims.view.applicationAuditing.AuditApplicationCompleteGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.application.common.ApplicationState","Soims.model.applicationAuditing.ContentType"],alias:"widget.auditapplicationcompletegrid",title:"已审核申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAuditing.AuditApplicationComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"id",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"审核状态",dataIndex:"contentType",renderer:function(e){return Soims.model.applicationAuditing.ContentType[e].name},flex:1},{header:"审核日期",dataIndex:"auditTime",renderer:Ext.util.Format.dateRenderer("Y年m月d日"),flex:1}],this.tbar=[{text:"查看",xtype:"button",itemId:"show",action:"show",disabled:!0,iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.applicationAuditing.AuditApplicationCompleteGrid",{extend:"Ext.app.Controller",views:["applicationAuditing.AuditApplicationCompleteGrid"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"auditapplicationcompletegrid",selector:"auditapplicationcompletegrid",autoCreate:!0,xtype:"auditapplicationcompletegrid"}],init:function(){this.control({"auditapplicationcompletegrid  button[action=show]":{click:this.onClickAppShowBtn},auditapplicationcompletegrid:{itemclick:function(i,t){this.showHistoryState(t)},selectionchange:function(i,t){var e=this.getAuditapplicationcompletegrid();e.down("#show").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(i){var t=i.get("applicationID"),e=this.getAuditapplicationcompletegrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var o=Ext.JSON.decode(t.responseText);e.refresh(o,i.get("type"))}})},showTab:function(i,t,e,o,a){var p=this.getCon("mainFrame.Main"),n=p.existInstance(i);if(n)return n;var l=Ext.create(e,{id:i,title:t,applicationID:o,isShow:!0,isAudit:!1,appType:a,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return p.addTab(l),l},show:function(){var i=this.getAuditapplicationcompletegrid(),t=this.getCon("mainFrame.Main");t.addTab(i)},getCon:function(i){var t=this.application;return t.getController(i)},onClickAppShowBtn:function(i){{var t=i.up("grid"),e=t.getSelectionModel().getSelection()[0],o=e.get("type"),a=this.getViewFnByApp("applicationAuditing",o,"Tab");this.showTab("ShowAudit"+o+e.get("id"),"查看"+e.get("name"),a,e.get("applicationID"),e.get("type"))}},getViewFnByApp:function(i,t,e){var o=null,a=this.getCon(i+"."+t+e);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:o=a.getApplicationAuditingB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:o=a.getApplicationAuditingB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:o=a.getApplicationAuditingV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:o=a.getApplicationAuditingV2TabView()}return o}});Ext.define("Soims.model.project.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"departmentName",type:"string",mapping:"Department"},{name:"address",type:"string",mapping:"Address"},{name:"cellphone",type:"string",mapping:"Cellphone"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"zipCode",type:"string",mapping:"ZipCode"},{name:"fax",type:"string",mapping:"Fax"}]});Ext.define("Soims.store.project.User",{extend:"Ext.data.Store",model:"Soims.model.project.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.voyage.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"}]});Ext.define("Soims.store.voyage.Department",{extend:"Ext.data.Store",model:"Soims.model.voyage.Department",proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageBasic",{extend:"Ext.form.Panel",alias:"widget.voyagebasic",requires:["Soims.store.project.User","Soims.store.voyage.Department","Ext.ux.form.SearchComboBox"],title:"航次基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User"),t=Ext.create("Soims.store.voyage.Department");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,padding:"10 0 10 10",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"textfield",name:"name",forbidBlankAndShowStar:!0,readOnly:this.isShow,itemId:"name",fieldLabel:"航次名称"},{xtype:"textfield",name:"number",itemId:"number",forbidBlankAndShowStar:!0,regex:1==Soims.component.voyageBasicStartTimeHidden?void 0:/DY(\d*)-\d\d$/,regexText:"请输入正确格式，例如：DY125-05",readOnly:this.isShow,allowBlank:!1,fieldLabel:"航次代码"},{xtype:"searchcombo",name:"chargerId",itemId:"chargerId",showStar:!0,fieldLabel:"航次首席科学家",readOnly:this.isShow,store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationDepartId",readOnly:this.isShow,showStar:!0,itemId:"organizationDepartId",readOnly:this.isShow,fieldLabel:"实施单位",store:t,valueField:"id",displayField:"name"},{xtype:"datefield",name:"beginTime",itemId:"beginTime",forbidBlankAndShowStar:!0,fieldLabel:"开始时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#stopTime");a.setMinValue(t)}}},{xtype:"datefield",name:"stopTime",itemId:"stopTime",forbidBlankAndShowStar:!0,fieldLabel:"结束时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#beginTime");a.setMaxValue(t)}}}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationId",readOnly:this.isShow,showStar:!0,itemId:"organizationId",fieldLabel:"实施单位联系人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},{xtype:"datefield",name:"startTime",itemId:"startTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"开放申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicStartTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),i=e.up("panel").down("#endTime");i.setMinValue(t);for(var o=0;o<a.getCount();o++){var n=a.getAt(o);n.set("startApplyTime",t)}}}},{xtype:"datefield",name:"endTime",itemId:"endTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"结束申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicEndTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").down("#startTime");a.setMaxValue(t);for(var i=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),o=0;o<i.getCount();o++){var n=i.getAt(o);n.set("endApplyTime",t)}}}}]}],this.callParent()}});Ext.define("Soims.model.voyage.Leg",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"voyageId",type:"int",mapping:"VoyageId"},{name:"name",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"sampleAreas",type:"string",mapping:"SampleAreas"},{name:"sampleAreaIds",type:"string",mapping:"SampleAreaIds"},{name:"startTime",type:"date",mapping:"StartTime"},{name:"endTime",type:"date",mapping:"EndTime"},{name:"startApplyTime",type:"date",mapping:"StartApplyTime"},{name:"endApplyTime",type:"date",mapping:"EndApplyTime"}]});Ext.define("Soims.store.voyage.Leg",{extend:"Ext.data.Store",model:"Soims.model.voyage.Leg",proxy:{type:"ajax",url:Soims.service.voyages.LegService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.LegGrid",{extend:"Ext.grid.Panel",alias:"widget.leggrid",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Ext.ux.form.TreeField"],title:"航段列表",viewConfig:{emptyText:"没有满足条件的航段"},height:400,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.Leg"),void 0!==this.voyageId&&this.initStore();var t=Ext.create("Soims.store.tree.SampleAreaAll");this.tree=t,this.store=this.vStore,this.columns=[{header:'<span>航段编号<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段代码<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"code",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段首席科学家<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,a){if(t){var o=e.findRecord("id",t);return null===o?a.get("chargerName"):o.get("name")}}},{header:'<span>采样区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAreaIds",flex:1,editor:{xtype:"treefield",pickerTitle:"航段所在采样区域",disabled:this.isShow,onlyCheckChild:!0,store:t},renderer:function(e,i,a){if(e){var o=e.split(","),d=!0,n="";return Ext.Array.each(o,function(e){if(""!==e){var i=e.split("|"),a=t.getNodeById(i[0]),o=document.getElementById("textBox"+i[0]);a?n=o?n+"["+o.value+"]":n+"["+a.get("text")+"]":d=!1}}),d?n:a.get("sampleAreas")}}},{header:'<span>开始时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"startTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>结束时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"endTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>开放申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"startApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,allowBlank:Soims.component.voyageBasicStartTimeHidden}},{header:'<span>结束申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"endApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,name:"endApplyTime",allowBlank:Soims.component.voyageBasicStartTimeHidden}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarlg",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},reloadTree:function(){this.tree.reload();var e=this.tree.getRootNode();e.eachChild(function(e){e.data.leaf||this.tree.load({node:e})},this)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageLeg",{extend:"Ext.form.Panel",alias:"widget.editvoyageleg",title:"航次航段",buttonAlign:"center",requires:["Soims.view.voyage.VoyageBasic","Soims.view.voyage.LegGrid"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagebasic",voyageId:this.voyageId,isShow:this.isShow},{xtype:"leggrid",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"保存",xtype:"button",hidden:this.isShow,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.model.voyage.VoyageTask",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"voyageTaskLegIds",type:"string",mapping:"VoyageTaskLegIds"},{name:"voyageTaskLegNames",type:"string",mapping:"VoyageTaskLegNames"}]});Ext.define("Soims.store.voyage.VoyageTask",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageTask",proxy:{type:"ajax",url:Soims.service.voyages.VoyageTaskService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.voyage.VoyageTask",{extend:"Ext.grid.Panel",alias:"widget.voyagetask",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Soims.store.voyage.VoyageTask"],viewConfig:{emptyText:"没有满足条件的航次任务"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.legStore=Ext.create("Soims.store.voyage.Leg"),this.vStore=Ext.create("Soims.store.voyage.VoyageTask"),void 0!==this.voyageId&&(this.initStore(),this.vStore.load()),this.store=this.vStore,this.columns=[{header:'<span>任务名称<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>任务负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,o,i){if(t){var a=e.findRecord("id",t);return null===a?i.get("chargerName"):a.get("name")}}},{header:'<span>所在航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"voyageTaskLegNames",flex:1,editor:{xtype:"combo",store:this.legStore,multiSelect:!0,editable:!1,disabled:this.isShow,valueField:"name",allowBlank:!1,displayField:"name"}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarEq",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.legStore.getProxy().setExtraParam("voyageId",this.voyageId),this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var o=e.getEditor(t.record,t.column);o.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageTask",{extend:"Ext.form.Panel",alias:"widget.editvoyagetask",title:"航次任务",buttonAlign:"center",requires:["Soims.view.voyage.VoyageTask"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagetask",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.VoyageReportBasic",{extend:"Ext.form.Panel",alias:"widget.voyagereportbasic",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox"],title:"航次报告基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,margin:"5 5 5 5",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"textfield",name:"name",allowBlank:!1,readOnly:this.isShow,forbidBlankAndShowStar:!0,itemId:"name",fieldLabel:"航次报告名称"}]},{xtype:"panel",border:!1,layout:"form",margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"searchcombo",name:"chargerId",readOnly:this.isShow,showStar:!0,itemId:"chargerId",fieldLabel:"报告牵头负责人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]}],this.callParent()}});Ext.define("Soims.model.voyage.VoyageReportDetail",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"discipline",type:"string",mapping:"Discipline"}]});Ext.define("Soims.store.voyage.VoyageReportDetail",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageReportDetail",proxy:{type:"ajax",url:Soims.service.voyages.VoyageReportDetailService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageReportDetail",{extend:"Ext.grid.Panel",alias:"widget.voyagereportdetail",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.VoyageReportDetail"],viewConfig:{emptyText:"没有满足条件的航次任务"},title:"航次报告分工信息",plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.VoyageReportDetail"),void 0!==this.voyageId&&this.initStore(),this.store=this.vStore,this.columns=[{header:'<span>分工负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,o){if(t){var a=e.findRecord("id",t);return null===a?o.get("chargerName"):a.get("name")}}},{header:'<span>负责学科和调查区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"discipline",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbardl",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageReport",{extend:"Ext.form.Panel",alias:"widget.editvoyagereport",title:"航次报告",buttonAlign:"center",requires:["Soims.view.voyage.VoyageReportBasic","Soims.view.voyage.VoyageReportDetail"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagereportbasic",isShow:this.isShow,voyageId:this.voyageId},{xtype:"voyagereportdetail",isShow:this.isShow,voyageId:this.voyageId}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"完成",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"complete"}],this.callParent()},lock:function(){this.down("#complete").setDisabled(!0),this.down("#save").setDisabled(!0)},unlock:function(){this.down("#complete").setDisabled(!1),this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.BoardPeoplePanel",{extend:"Ext.grid.Panel",alias:"widget.boardpeoplepanel",title:"上船人员列表",viewConfig:{emptyText:"没有满足条件的项目"},closable:!1,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.BoardPeople"),this.voyageId&&this.initStore(),this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"身份证号",dataIndex:"identityNumber",flex:1},{header:"性别",dataIndex:"sex",flex:1},{header:"单位",dataIndex:"userCompany",flex:1},{header:"职务",dataIndex:"position",flex:1},{header:"岗位职责",dataIndex:"duty",flex:1},{header:"出生日期",dataIndex:"birthday",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"地址",dataIndex:"address",flex:1},{header:"联系电话",dataIndex:"tellPhone",flex:1},{header:"移动电话",dataIndex:"cellPhone",flex:1}],this.tbar=[{text:"添加",xtype:"button",hidden:this.isShow,iconCls:"Add",itemId:"add",disabled:void 0==this.voyageId?!0:!1},{text:"修改",xtype:"button",iconCls:"Disk",hidden:this.isShow,itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",hidden:this.isShow,xtype:"button",disabled:!0},{text:"导入单位信息Excel",hidden:this.isShow,itemId:"boardingPeopleDepartment",iconCls:"Disk",xtype:"button"},{text:"导入上船人员名单Excel",hidden:this.isShow,itemId:"boardingPeople",iconCls:"Disk",xtype:"button"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){0!=t.length?this.down("#modify").setDisabled(!1):(this.down("#delete").setDisabled(!0),this.down("#modify").setDisabled(!0))},initStore:function(){this.store.getProxy().setExtraParam("voyageId",this.voyageId)},lock:function(){this.down("#add").setDisabled(!0)},unlock:function(){this.down("#add").setDisabled(!1)}});Ext.define("Soims.view.voyage.EditVoyageTag",{extend:"Ext.tab.Panel",alias:"widget.editvoyagetag",title:"航次任务样品申请",closable:!0,iconCls:"Project",requires:["Soims.view.voyage.EditVoyageLeg","Soims.view.voyage.EditVoyageTask","Soims.view.voyage.EditVoyageReport","Soims.view.voyage.BoardPeoplePanel"],initComponent:function(){this.items=[{xtype:"editvoyageleg",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagetask",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagereport",isShow:this.isShow,voyageId:this.voyageId},{xtype:"boardpeoplepanel",isShow:this.isShow,voyageId:this.voyageId}],this.callParent()}});Ext.define("Soims.controller.voyage.EditVoyageTag",{extend:"Ext.app.Controller",views:["voyage.EditVoyageTag"],refs:[{ref:"editvoyagetag",selector:"editvoyagetag",autoCreate:!0,xtype:"editvoyagetag"}],init:function(){this.getCon("voyage.EditVoyageLeg"),this.getCon("voyage.EditVoyageTask"),this.getCon("voyage.EditVoyageReport"),this.getCon("voyage.BoardPeople"),this.control({})},show:function(){{var e=this.getVoyageEditVoyageTagView(),o=this.getCon("voyage.Voyage");o.showTab("newVoyage","新建航次航段",!1,e,void 0)}},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.controller.voyage.Voyage",{extend:"Ext.app.Controller",views:["voyage.Voyage"],refs:[{ref:"voyage",selector:"voyage",autoCreate:!0,xtype:"voyage"}],init:function(){this.control({"voyage  button[itemId=modify]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("EditVoyage"+o.get("id"),o.get("name"),!1,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},"voyage  button[itemId=show]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("ShowVoyage"+o.get("id"),o.get("name"),!0,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},voyage:{selectionchange:function(e,o){0!=o.length?(this.getVoyage().down("#modify").setDisabled(!1),this.getVoyage().down("#show").setDisabled(!1)):(this.getVoyage().down("#modify").setDisabled(!0),this.getVoyage().down("#show").setDisabled(!0))}}})},showTab:function(e,o,t,a,g){var i=this.getCon("mainFrame.Main"),n=i.existInstance(e);if(n)return n;var d=Ext.create(a,{id:e,title:o,isShow:t,voyageId:g});return i.addTab(d),d},show:function(){var e=this.getVoyage(),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.view.voyage.Voyage",{extend:"Ext.grid.Panel",alias:"widget.voyage",title:"航次列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Project",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.Voyage"),this.columns=[{header:"航次代码",dataIndex:"name",flex:1},{header:"航次编号",dataIndex:"number",flex:1},{header:"航次首席科学家",dataIndex:"chargerName",flex:1},{header:"航次组织实施单位联系人",dataIndex:"organizationName",flex:1},{header:"航次组织实施单位",dataIndex:"organizationDepartName",flex:1},{header:"开始申请时间",dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1},{header:"结束申请时间",dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1}],this.tbar=[{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"查看",xtype:"button",iconCls:"Information",itemId:"show",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});