Ext.define("Soims.view.application.ApplicationPanel",{extend:"Ext.form.Panel",alias:"widget.applicationpanel",iconCls:"ApplicationSideList",closable:!0,initComponent:function(){this.items=[{xtype:"applicationhistorypanel"},{xtype:this.grid}],this.title=this.title,this.callParent()}});Ext.define("Soims.view.application.ApplicationHistoryPanel",{itemId:"applicationApplicationHistoryPanel",extend:"Ext.form.Panel",alias:"widget.applicationhistorypanel",title:"申请历史流程",padding:2,bodyStyle:"background-color:#dfe8f5;",height:115,autoShow:!0,bodyPadding:"15 0 0 0",initComponent:function(){this.items={xtype:"label"},this.on("afterrender",this.showDefaultHistoryState),this.callParent()},refresh:function(t,i){switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:this.showB1(t);break;case Soims.model.application.common.SampleApplicationType.B2.value:this.showB2(t);break;case Soims.model.application.common.SampleApplicationType.V1.value:this.showV1(t);break;case Soims.model.application.common.SampleApplicationType.V2.value:this.showV2(t);break;case Soims.model.application.common.SampleApplicationType.V3.value:this.showV3(t);break;case Soims.model.application.common.SampleApplicationType.V4.value:this.showV4(t)}},showB1:function(t){var i=void 0==t.VODCSubmit?"Application/common/resources/images/appState/a_0.png":t.VODCSubmit.url,e=void 0==t.VODCSubmit?"":t.VODCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>航次组织实施单位审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showB2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showV1:function(t){var i=void 0==t.VRCSubmit?"Application/common/resources/images/appState/a_0.png":t.VRCSubmit.url,e=void 0==t.VRCSubmit?"":t.VRCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>任务牵头负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV3:function(t){var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showV4:function(t){console.log(t);var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showBeginHtml:function(t){var i=void 0==t.UnSubmit?"Application/common/resources/images/appState/a_1.png":t.UnSubmit.url,e=void 0==t.UnSubmit?"":t.UnSubmit.tip,o=void 0==t.Submit?"Application/common/resources/images/appState/a_2.png":t.Submit.url,a=void 0==t.Submit?"":t.Submit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>新建申请</div>';return l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>提交</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>'},showEndHtml:function(t){var i=void 0==t.AdminAccept?"Application/common/resources/images/appState/a_3.png":t.AdminAccept.url,e=void 0==t.AdminAccept?"":t.AdminAccept.tip,o=void 0==t.AdminAllot?"Application/common/resources/images/appState/a_4.png":t.AdminAllot.url,a=void 0==t.AdminAllot?"":t.AdminAllot.tip,l=void 0==t.SMESubmit?"Application/common/resources/images/appState/a_5.png":t.SMESubmit.url,n=void 0==t.SMESubmit?"":t.SMESubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,s='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>申请受理</div>';return s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>分配方案编制</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+n+'" src="'+l+'" height="24" width="24"><br>申请审议</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+p+'" src="'+m+'" height="24" width="24"><br>申请审批</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s+='<div style="text-align:center; width: 80px; float:left;"><img title="" src= "Application/common/resources/images/appState/a_7.png" " height="24" width="24"><br>样品清点与出库</div>'},showDefaultHistoryState:function(){var t={},i='<div style="text-align:center; width: 80px; float:left;"><img title="" src="Application/common/resources/images/appState/a_0.png" height="24" width="24"><br>申请审核</div>';i+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var e=this.showBeginHtml(t)+i+this.showEndHtml(t);this.down("label").setText(e,!1)}});Ext.define("Soims.model.application.common.SampleApplicationType",{statics:{B1:{value:"B1",name:"b1申请书"},B2:{value:"B2",name:"b2申请书"},V1:{value:"V1",name:"v1申请书"},V2:{value:"V2",name:"v2申请书"},V3:{value:"V3",name:"v3申请书"},V4:{value:"V4",name:"v4申请书"}}});Ext.define("Soims.controller.application.ApplicationPanel",{extend:"Ext.app.Controller",views:["application.ApplicationPanel"],refs:[{ref:"applicationpanel",selector:"applicationpanel",autoCreate:!0,xtype:"applicationpanel"}],init:function(){this.control({applicationpanel:{resize:function(i,t,a){var n=i.down("grid");n.setHeight(a-120)}}})},showTab:function(i,t,a,n,e,o){var p=this.getCon("mainFrame.Main"),l=p.existInstance(i);if(l)return l;var r=Ext.create(a,{id:i,title:t,application:this.application,applicationID:n,isShow:e,isEdit:o});return p.addTab(r),r},show:function(i,t){this.getCon(i),this.getController("application.ApplicationHistoryPanel");var a=i.split(".")[1].toLowerCase(),n=this.getView("application.ApplicationPanel"),e=Ext.create(n,{id:a,grid:a,title:t}),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.controller.application.ApplicationHistoryPanel",{extend:"Ext.app.Controller",views:["application.ApplicationHistoryPanel"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationhistorypanel",selector:"applicationhistorypanel",autoCreate:!0,xtype:"applicationhistorypanel"}],init:function(){this.control({})},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.model.application.common.ApplicationState",{statics:{Unknown:{value:"Unknown",name:"未知类型"},Cancel:{value:"Cancel",name:"已撤回"},Deleted:{value:"Deleted",name:"已删除"},UnSubmit:{value:"UnSubmit",name:"未提交"},Submit:{value:"Submit",name:"已提交"},VODCAudit:{value:"VODCAudit",name:"航次组织实施单位审核"},VODCSubmit:{value:"VODCSubmit",name:"组织实施单位已审核"},LSAudit:{value:"LSAudit",name:"航段首席科学家审核"},LSSubmit:{value:"LSSubmit",name:"航段首席科学家已审核"},VSAudit:{value:"VSAudit",name:"航次首席科学家审核"},VSSubmit:{value:"VSSubmit",name:"航次首席科学家已审核"},PCAudit:{value:"PCAudit",name:"项目负责人审核"},PCSubmit:{value:"PCSubmit",name:"项目负责人已审核"},VRCAudit:{value:"VRCAudit",name:"航次报告牵头负责人审核"},VRCSubmit:{value:"VRCSubmit",name:"航次报告牵头负责人已审核"},AdminAccept:{value:"AdminAccept",name:"大洋馆受理"},AdminAllot:{value:"AdminAllot",name:"大洋馆已分配"},AdminReject:{value:"AdminReject",name:"大洋馆驳回"},AdminDeny:{value:"AdminDeny",name:"大洋馆否决"},SMEAudit:{value:"SMEAudit",name:"样品管理专家委员会审议"},SMESubmit:{value:"SMESubmit",name:"样品管理专家委员会已审议"},OIAudit:{value:"OIAudit",name:"大洋协会联系人审批"},OISubmit:{value:"OISubmit",name:"大洋协会联系人已审批"},OIReject:{value:"OIReject",name:"大洋协会联系人驳回"}}});Ext.define("Soims.model.application.Application",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"name",mapping:"Name"},{name:"discussionTime",mapping:"DiscussionTime"},{name:"approvalTime",mapping:"ApprovalTime"},{name:"applicantID",mapping:"ApplicantID"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"chargerID",mapping:"ChargerID"},{name:"leg",mapping:"Leg"},{name:"voyage",mapping:"Voyage"},{name:"legID",mapping:"LegID"},{name:"type",mapping:"Type"},{name:"taskName",mapping:"TaskName"},{name:"topicID",mapping:"TopicID"},{name:"bearVoyageTaskID",mapping:"BearVoyageTaskID"},{name:"voyageReportID",mapping:"VoyageReportID"},{name:"noOceanTopicID",mapping:"NoOceanTopicID"},{name:"activityID",mapping:"ActivityID"},{name:"activityStartTime",mapping:"ActivityStartTime"},{name:"activityEndTime",mapping:"ActivityEndTime"},{name:"usingNecessity",mapping:"UsingNecessity"},{name:"repatriaionNecessity",mapping:"RepatriaionNecessity"},{name:"commitResultTime",mapping:"CommitResultTime"},{name:"commitResultForm",mapping:"CommitResultForm"},{name:"commitResultAmount",mapping:"CommitResultAmount"},{name:"applyTime",mapping:"ApplyTime"},{name:"createTime",mapping:"CreateTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.store.applicationAccept.AcceptApplication",{extend:"Ext.data.Store",model:"Soims.model.application.Application",autoLoad:!1,proxy:{type:"ajax",url:Soims.service.applications.ApplicationsService+"/QueryAcceptByUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.applicationAccept.AcceptApplicationGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.application.common.ApplicationState","Soims.store.applicationAccept.AcceptApplication"],alias:"widget.acceptapplicationgrid",title:"待受理申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AcceptApplication"),this.store.load(),this.columns=[{header:"申请书编号",dataIndex:"applicationNumber",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"申请书状态",dataIndex:"state",flex:1,renderer:function(e){return Soims.model.application.common.ApplicationState[e].name}},{header:"提交日期",dataIndex:"applyTime",flex:1}],this.tbar=[{text:"受理",xtype:"button",action:"accept",name:"accept",itemId:"accept",disabled:!0,iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.model.application.SamplePanelType",{statics:{AuditShow:{value:"AuditShow",name:"显示审核意见"},AuditEdit:{value:"AuditEdit",name:"编辑审核意见"},AllocationIndoorShow:{value:"AllocationIndoorShow",name:"显示到入馆分配建议"},AllocationIndoorEdit:{value:"AllocationIndoorEdit",name:"编辑入馆分配建议"},AllocationOutdoorShow:{value:"AllocationOutdoorShow",name:"显示到现场分配建议"},AllocationOutdoorEdit:{value:"AllocationOutdoorEdit",name:"编辑现场分配建议"},DiscussionIndoorShow:{value:"DiscussionIndoorShow",name:"显示到入馆审议意见"},DiscussionIndoorEdit:{value:"DiscussionIndoorEdit",name:"编辑入馆审议意见"},DiscussionOutShow:{value:"DiscussionOutShow",name:"显示到现场审议意见"},DiscussionOutEdit:{value:"DiscussionOutEdit",name:"编辑现场审议意见"},getByAppType:function(o,i,t){var n,s=/^b[12]$/gi;return n=s.test(o)?t?i?this.DiscussionOutEdit.value:this.DiscussionOutShow.value:i?this.AllocationOutdoorEdit.value:this.AllocationOutdoorShow.value:t?i?this.DiscussionIndoorEdit.value:this.DiscussionIndoorShow.value:i?this.AllocationIndoorEdit.value:this.AllocationIndoorShow.value}}});Ext.define("Soims.view.application.common.B1BasicInfoPanel",{itemId:"applicationCommonB1BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.b1basicinfopanel",title:"航次任务基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=this,a=Ext.create("Soims.store.voyage.VoyageByTime"),t=Ext.create("Soims.store.project.User"),l=Ext.create("Soims.store.application.new.VoyageTask"),i=Ext.create("Soims.store.application.common.VoyageTaskLeg");this.items=[{xtype:"fieldset",title:"航次任务信息",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300},items:[{xtype:"combobox",itemId:"voyage",name:"voyage",fieldLabel:"航次",store:a,forbidBlankAndShowStar:!0,queryMode:"local",displayField:"name",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1,listeners:{select:function(e){this.voyage=e.getValue(),l.getProxy().setExtraParam("voyageID",this.voyage),i.getProxy().setExtraParam("voyageID",this.voyage),e.up("b1basicinfopanel").down("#legs").clearValue(),e.up("b1basicinfopanel").down("#voyageTask").clearValue()}}},{fieldLabel:"航次任务名称",xtype:"combobox",itemId:"voyageTask",name:"voyageTask",forbidBlankAndShowStar:!0,store:l,displayField:"name",valueField:"id",readOnly:1==this.isShow?!0:!1,listeners:{expand:function(){e.expendVoyageTask()},select:function(e,a){e.up("b1basicinfopanel").down("#legs").setValue(a[0].get("legs"))}}}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300},items:[{fieldLabel:"负责人姓名",itemId:"chargerName",xtype:"searchcombo",name:"chargerID",store:t,readOnly:this.isShow,valueField:"id",forbidBlankAndShowStar:!0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>"),listeners:{select:function(e,a){this.userID=e.getValue(),l.getProxy().setExtraParam("userID",this.userID),e.up("b1basicinfopanel").down("#legs").clearValue(),e.up("b1basicinfopanel").down("#voyageTask").clearValue(),e.up("b1basicinfopanel").loadRecord(a[0])}}},{fieldLabel:"航次任务所在航段",itemId:"legs",xtype:"combobox",name:"legs",forbidBlankAndShowStar:!0,multiSelect:!0,store:i,displayField:"name",queryMode:"local",valueField:"name",readOnly:1==this.isShow?!0:!1,editable:!1,listeners:{expand:function(){e.expendLegs()}}}]}]},{xtype:"fieldset",title:"负责人详细信息",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"}]}]}],this.callParent()},expendVoyageTask:function(){var e=this.down("#voyageTask").getStore();e.load()},expendLegs:function(){var e=this.down("#legs").getStore();e.load()}});Ext.define("Soims.view.application.new.B1BasicInfo",{itemId:"applicationNewB1BasicInfo",extend:"Ext.form.Panel",alias:"widget.b1basicinfo",title:"申请基本信息",requires:["Soims.view.application.common.B1BasicInfoPanel"],padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b1basicinfopanel",applicationID:this.applicationID,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleGrid",{extend:"Ext.grid.Panel",alias:"widget.samplegrid",title:"样品列表",viewConfig:{emptyText:"没有满足条件的拟申请样品"},minHeight:200,padding:"2 2 2 2",selModel:{mode:"MULTI"},hidden:1==this.isShow,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.application.common.Sample"),("V1"==this.type||"B1"==this.type||"B2"==this.type)&&(this.features=[{ftype:"grouping"}]),this.leg="",this.legID="",this.deleteid="",this.columns=[{xtype:"rownumberer"},{text:"样品类型",locked:!0,width:150,sortable:!1,dataIndex:"sampleType"},{text:"所在航段",locked:!0,width:100,sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"使用目的",lockable:!1,width:100,sortable:!0,dataIndex:"usePurpose"},{text:"涉及学科",width:100,sortable:!1,dataIndex:"involvedSubject"},{text:"岩心分取方案",width:200,sortable:!0,dataIndex:"samplingMethod"},{text:"制样方案",width:100,sortable:!0,dataIndex:"samplePreparation"},{text:"分析测试项目、指标",width:230,sortable:!0,dataIndex:"anlyseTestProject"},{text:"采样区域",width:220,sortable:!0,dataIndex:"samplingArea"},{text:"站位数",width:100,sortable:!0,dataIndex:"stationDigit"},{text:"各站样品数",width:100,sortable:!0,dataIndex:"stationSampleNumber"},{text:"总样品件数",width:100,sortable:!0,dataIndex:"sampleTotalNumber"},{text:"单件样品量",width:100,sortable:!0,dataIndex:"oneSampleAmount"},{text:"其它",width:100,sortable:!0,dataIndex:"otherRequirements"}],this.tbar={hidden:this.isShow,items:[{text:"添加样品",xtype:"button",itemId:"sampleAdd",iconCls:"Add"},{text:"修改",itemId:"sampleModify",disabled:!0,xtype:"button",iconCls:"Disk"},{text:"删除",itemId:"sampleDelete",disabled:!0,xtype:"button",iconCls:"Delete"},{text:"样品克隆",itemId:"sampleClone",xtype:"button",disabled:!0,iconCls:"Add",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"(复制选中样品到指定航段)",xtype:"label",style:"font-size:12px;color:#FF0000",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"整航段样品克隆",itemId:"sampleLegClone",xtype:"button",disabled:!1,iconCls:"Add",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1}]},this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(t,e){e.length>0?(this.down("#sampleClone").setDisabled(!1),this.down("#sampleDelete").setDisabled(!1),this.down("#sampleModify").setDisabled(!1),e.length>1&&(this.down("#sampleModify").setDisabled(!0),this.down("#sampleDelete").setDisabled(!1),this.down("#sampleClone").setDisabled(!1))):(this.down("#sampleClone").setDisabled(!0),this.down("#sampleModify").setDisabled(!0),this.down("#sampleDelete").setDisabled(!0))}});Ext.define("Soims.view.application.common.SampleGridShow",{extend:"Ext.grid.Panel",alias:"widget.samplegridshow",requires:["Ext.ux.grid.AssociationRowExpander","Soims.model.applicationDiscussion.DiscussType","Soims.model.applicationAuditing.ContentType","Soims.model.applicationAuditing.AuditType","Soims.model.application.SamplePanelType"],viewConfig:{emptyText:"没有满足条件的拟申请样品"},minHeight:200,padding:"2 2 2 2",selType:"rowmodel",plugins:[{ptype:"associationrowexpander",pluginId:"sampleGridExpander",selectRowOnExpand:!0,rowBodyTpl:new Ext.XTemplate('<tpl for=".">','<table width="700"  style="margin-left:30px;line-height:20px" frame=below>','<tr><td width="300"><b>样品类型:&nbsp;&nbsp;</b>{data.sampleType}</td><td><b>所在航段:&nbsp;&nbsp;</b>{data.leg}</td></tr>',"</table><br>",'<table width="700"  style="margin-left:30px;line-height:20px" frame=below>',"<tr><td><b>使用目的:&nbsp;&nbsp;</b>{data.usePurpose}</td></tr>","<tr><td><b>涉及学科:&nbsp;&nbsp;</b>{data.involvedSubject}</td></tr>","<tr><td><b>岩心分取方案:&nbsp;&nbsp;</b>{data.samplingMethod}</td></tr>","<tr><td><b>制样方案:&nbsp;&nbsp;</b>{data.samplePreparation}</td></tr>","<tr><td><b>分析测试项目、指标:&nbsp;&nbsp;</b>{data.sampleType}</td></tr>","</table><br>",'<table width="700"   style="padding-left:30px;line-height:20px">',"<tr><td><b>采样区域:&nbsp;&nbsp;</b>{data.samplingArea}</td></tr>",'<tr><td width="300"><b>站位数:&nbsp;&nbsp;</b>{data.stationDigit}</td><td><b>各站样品数:&nbsp;&nbsp;</b>{data.stationSampleNumber}</td></tr>','<tr><td width="300"><b>总样品件数:&nbsp;&nbsp;</b>{data.sampleTotalNumber}</td><td><b>单件样品量:&nbsp;&nbsp;</b>{data.oneSampleAmount}</td></tr>',"<tr><td><b>其它:&nbsp;&nbsp;</b>{data.otherRequirements}</td></tr>","</table><br>",'<div id="dataTest{data.id}" style="padding-left:30px;line-height:20px"><b>拟提交测试数据</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>分析测试指标</th><th>拟提交测试数据</th><th>拟提交时间</th></tr>",'<tpl for="AnlysesStore">',"<tr><td><span >{data.anlyseTestProject}</span></td><td>{data.intendCommitTestData}</td><td>{data.commitTestDataTime}</td></tr>","</tpl>","</table><br>",'<div id="auditList{data.id}" style="padding-left:30px;line-height:20px"><b>审核记录</b></div>','<tpl for="getSampleAuditsStore">','<tpl if="this.colorChange(data.auditerID,data.auditType)">','<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","<tpl else>",'<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.AuditButtonShow()">','<p style="text-align: center;"><button  id="sampleagree{data.id}">同意</button>   <button  id="sampleunagree{data.id}">拟同意</button>   <button  id="sampledisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>",'<tpl if="this.AllocationIndoorEdit()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700" id="allocationTb{data.id}"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">','<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td><b><textarea id="allocationTd{data.id}" type="text" style="height:100%;width:100%;resize:none">{data.oiSuggestion}</textarea></b></td><td></td></tr>',"</tpl>","</table><br>",'<p style="text-align: center;"><button  id="saveAllocation{data.id}">保存</button></p>',"</tpl>",'<tpl if="this.AllocationOutdoorEdit()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700" id="allocationTb{data.id}"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>取用次序</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">','<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.useOrder}</td><td><b><textarea id="allocationTd{data.id}" type="text" style="height:100%;width:100%;resize:none">{data.oiSuggestion}</textarea></b></td><td></td></tr>',"</tpl>","</table><br>",'<p style="text-align: center;"><button  id="saveAllocation{data.id}">保存</button></p>',"</tpl>",'<tpl if="this.AllocationOutdoorShow()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>取用次序</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">',"<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.useOrder}</td><td>{data.oiSuggestion}</td><td></td></tr>","</tpl>","</table><br>","</tpl>",'<tpl if="this.AllocationIndoorShow()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">',"<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.oiSuggestion}</td><td></td></tr>","</tpl>","</table><br>","</tpl>",'<tpl if="this.DiscussionsShow()">','<div id="discussionList{data.id}" style="padding-left:30px;line-height:20px"><b>审议记录</b></div>','<tpl for="DiscussionsStore">','<tpl if="this.colorChange(data.auditerID)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.discussType}" sampleID="{[values.getSample().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.discussType}" sampleID="{[values.getSample().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.DiscussionButtonsShow()">','<p style="text-align: center;"><button  id="dicussionagree{data.id}">同意</button>   <button  id="dicussionunagree{data.id}">拟同意</button>   <button  id="dicussiondisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>","</tpl>","</tpl>",{colorChange:function(t,e){var a=Soims.currentUser.id,i=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode);return t==a&&e==i.value?!1:!0},formatChange:function(t){var e=Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,a=Soims.model.applicationAuditing.AuditType.LegChargerAudit.value;return t==e||t==a?!0:!1},AllocationIndoorEdit:function(){return this.tplParam==Soims.model.application.SamplePanelType.AllocationIndoorEdit.value?!0:!1},AllocationOutdoorEdit:function(){return this.tplParam==Soims.model.application.SamplePanelType.AllocationOutdoorEdit.value?!0:!1},AllocationOutdoorShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutShow.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value||this.tplParam==Soims.model.application.SamplePanelType.AllocationOutdoorShow.value?!0:!1},AllocationIndoorShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorShow.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.AllocationIndoorShow.value?!0:!1},AuditButtonShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!0:!1},DiscussionsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditShow.value||this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!1:!0},DiscussionButtonsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value?!0:!1}})}],initComponent:function(){this.getPlugin("sampleGridExpander").setXTemplateParams(this.panelType),this.store=Ext.create("Soims.store.application.common.Sample"),this.leg="",this.legID="",this.deleteid="",this.title=this.isAudit?'<span>样品列表</span><span style="font-size:12px;color:#FF0000">[请逐条样品进行审核]</span>':"样品列表",this.columns=[{xtype:"rownumberer"},{text:"样品类型",width:100,sortable:!1,dataIndex:"sampleType"},{text:"所在航段",width:100,sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"使用目的",width:150,sortable:!0,dataIndex:"usePurpose"},{text:"分析测试项目、指标",width:290,sortable:!0,dataIndex:"anlyseTestProject"},{text:"采样区域",width:220,sortable:!0,dataIndex:"samplingArea"}],this.on("selectionchange",this.selectionChange),this.callParent()},selectionChange:function(t,e){var a=Ext.get("sampleagree"+e[0].get("id")),i=Ext.get("sampleunagree"+e[0].get("id")),n=Ext.get("sampledisagree"+e[0].get("id")),s=Ext.get("dicussionagree"+e[0].get("id")),p=Ext.get("dicussionunagree"+e[0].get("id")),d=Ext.get("dicussiondisagree"+e[0].get("id")),o=Ext.get("saveAllocation"+e[0].get("id")),l=this;void 0!=a&&(a.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Agree,e[0].get("id"))}),i.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Doubt,e[0].get("id"))}),n.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Reject,e[0].get("id"))})),void 0!=s&&(s.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Agree,e[0].get("id"))}),p.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Doubt,e[0].get("id"))}),d.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Reject,e[0].get("id"))})),void 0!=o&&o.on("click",function(){var t=arguments[1].id.toString().replace(/saveAllocation/gi,"");l.onSaveClick(t)})},onAuditClick:function(t,e,a){var i=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),a=t.get("id");Ext.Ajax.request({url:Soims.service.ApplicationAuditings.SampleAuditService+"/Auditing",params:{ContentType:e.value,AuditType:i.value,SampleID:a},scope:this,success:function(){Ext.Tools.Msg("审核完成",0),this.auditRowBodyChange(e,a)}})},onDiscussClick:function(t,e,a){var a=t.get("id"),i=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode);Ext.Ajax.request({url:Soims.service.discussion.SampleDiscussionService+"/Discussing",params:{ContentType:e.value,DiscussType:i.value,SampleID:a},scope:this,success:function(){Ext.Tools.Msg("审议完成",0),this.discussRowBodyChange(e,a)}})},onSaveClick:function(t){var e,a=document.getElementById("allocationTb"+t).getElementsByTagName("textarea")[0];void 0!=a&&(e=a.id.toString().replace(/allocationTd/gi,""),Ext.Ajax.request({url:Soims.service.samples.SampleAllocationService+"/Save",params:{id:e,suggestion:a.value},scope:this,success:function(){Ext.Tools.Msg("修改完成",0)}}))},auditRowBodyChange:function(t,e){var a=this,i=(a.getView().el,Soims.currentUser.id),n=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),s="span[auditor='"+i+"'][auditType="+n.value+"][sampleID="+e+"]",p=Ext.query(s),d=this.getAuditInfo();if(void 0==p[0]){var o=new Date,l=Ext.get("auditList"+e),r="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+i+"' auditType='"+n.value+"' sampleID='"+e+"'>"+d+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+t.name+"</span><br/>";Ext.DomHelper.insertAfter(l,r)}else{var o=new Date,u=Ext.get(p[0]),c=d+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+t.name;Ext.DomHelper.overwrite(u,c),Ext.DomHelper.applyStyles(u,"color:red;")}a.getView().refreshSize()},getAuditInfo:function(){var t=Soims.currentUser.currentRoleCode,e=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode).name+"&nbsp;&nbsp;&nbsp;&nbsp;";return e+="VS"==t||"LS"==t?Soims.currentUser.name:Soims.currentUser.department},discussRowBodyChange:function(t,e){var a=this,i=(a.getView().el,Soims.currentUser.id),n=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode),s="span[auditor='"+i+"'][auditType="+n.value+"][sampleID="+e+"]",p=Ext.query(s);if(void 0==p[0]){var d=new Date,o=Ext.get("discussionList"+e),l="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+i+"' auditType='"+n.value+"' sampleID='"+e+"'>"+n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+t.name+"</span><br/>";Ext.DomHelper.insertAfter(o,l)}else{var d=new Date,r=Ext.get(p[0]),u=n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+t.name;Ext.DomHelper.overwrite(r,u),Ext.DomHelper.applyStyles(r,"color:red;")}a.getView().refreshSize()}});Ext.define("Soims.view.application.common.SampleInfo",{itemId:"applicationCommonSampleInfo",extend:"Ext.form.Panel",alias:"widget.sampleinfo",padding:2,title:"拟申请样品信息",AutoScroll:!0,overflowY:"auto",autoShow:!0,autoHeight:!0,requires:["Soims.view.application.Common.SampleGrid","Soims.view.application.Common.SampleGridShow"],initComponent:function(){this.items=this.isShow?[{xtype:"samplegridshow",applicationID:this.applicationID,isShow:this.isShow,panelType:this.panelType,type:this.type}]:[{xtype:"samplegrid",applicationID:this.applicationID,isShow:this.isShow,isAudit:this.isAudit,type:this.type},{xtype:"testdatainfo",applicationID:this.applicationID,isShow:this.isShow,isAudit:this.isAudit,type:this.type}],this.callParent()}});Ext.define("Soims.view.application.common.BoardingUserGrid",{itemId:"applicationCommonBoardingUserGrid",extend:"Ext.grid.Panel",alias:"widget.boardinguser",requires:["Ext.ux.form.SearchComboBox"],title:"样品现场使用人",selType:"rowmodel",emptyText:"没有满足条件的人员",height:200,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){var e=this;console.log(this.applicationID),this.store=Ext.create("Soims.store.application.common.SampleSiteUser"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.application.common.BoardingUser"),a=Ext.create("Soims.store.application.common.SampleLeg");this.columns=[{xtype:"rownumberer"},{header:"ID",dataIndex:"id",hidden:!0},{header:'<span>姓名<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:1==this.isShow?null:{itemId:"boardingUserName",xtype:"searchcombo",store:t,valueField:"name",forbidBlankAndShowStar:!0,allowBlank:!1,enableKeyEvents:!0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {department}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>"),listeners:{keyup:function(t){e.searchBoardingUserName(t)}}}},{header:"所在单位",dataIndex:"department",flex:1},{header:"手机",dataIndex:"cellphone",flex:1},{header:"联系电话",dataIndex:"telphone",flex:1},{header:'<span>拟参加航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"legs",flex:1,editor:{xtype:"combobox",itemId:"legs",forbidBlankAndShowStar:!0,multiSelect:!0,store:a,displayField:"leg",queryMode:"local",valueField:"leg",disabled:1==this.isShow?!0:!1,editable:!1,listeners:{expand:function(){e.expendLegs()}}}}],this.tbar={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSiteUser",iconCls:"Add"},{text:"删除",itemId:"deleteSiteUser",xtype:"button",disabled:!0,iconCls:"Delete"}]},this.on("selectionchange",this.selectChange),this.callParent()},selectChange:function(e,t){this.down("#deleteSiteUser").setDisabled(0!=t.length?!1:!0)},expendLegs:function(){var e=this.down("#legs").getStore();e.getProxy().setExtraParam("applicationID",this.up("samplesiteuse").applicationID),e.load()},searchBoardingUserName:function(e){var t=e.getValue(),a=this.up("samplesiteuse").voyageID,i=this.down("#boardingUserName");i.getStore().getProxy().setExtraParam("value",t),i.getStore().getProxy().setExtraParam("voyageID",a),i.getStore().getProxy().setExtraParam("applicationID",this.up("samplesiteuse").applicationID)},listeners:{validateedit:function(e,t){var a=e.getEditor(t.record,t.column);a.revertInvalid=!1}}});Ext.define("Soims.view.application.common.SampleSiteUseNecessityForm",{extend:"Ext.form.Panel",alias:"widget.samplesiteusenecessityform",bodyPadding:2,title:"样品现场使用必要性说明",initComponent:function(){this.items=[{xtype:"textareafield",grow:!0,itemId:"sampleSiteUseNecessityTextArea",width:600,height:150,readOnly:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleSiteUse",{itemId:"applicationCommonSampleSiteUse",extend:"Ext.form.Panel",alias:"widget.samplesiteuse",requires:["Soims.view.application.common.BoardingUserGrid","Soims.view.application.common.SampleSiteUseNecessityForm"],padding:2,title:"样品现场使用信息",autoShow:!0,initComponent:function(){this.items=[{xtype:"boardinguser",applicationID:this.applicationID,isShow:this.isShow},{xtype:"samplesiteusenecessityform",applicationID:this.applicationID,margin:"3 0 0 0",isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleBackCountryNecessityForm",{extend:"Ext.form.Panel",alias:"widget.samplebackcountrynecessityform",bodyPadding:2,title:"样品先行运送回国必要性说明",initComponent:function(){this.items=[{xtype:"textareafield",grow:!0,itemId:"sampleBackCountryNecessityTextArea",width:600,height:150,readOnly:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleBackCountryGrid",{itemId:"applicationCommonSampleBackCountryGrid",extend:"Ext.grid.Panel",alias:"widget.samplebackcountrygrid",autoHeight:!0,title:"提前样品运送回国列表",emptyText:"没有满足条件的样品",height:200,selType:"rowmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){var e=this;console.log(this.applicationID),this.store=Ext.create("Soims.store.application.common.SampleBackCountry"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.application.common.SampleType");this.columns=[{xtype:"rownumberer"},{header:'<span>样品类型<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleType",flex:1,allowBlank:!1,editor:{itemId:"sampleType",name:"sampleType",xtype:"combobox",valueField:"sampleType",showStar:!0,queryMode:"local",store:t,editable:!1,disabled:1==this.isShow?!0:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{sampleType} - {legID}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{sampleType}","</tpl>"),listeners:{expand:function(){e.expendSampleType()}}}},{header:"所在航段",dataIndex:"sampleLeg",flex:1},{header:'<span>样品数<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleNumber",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>样品量<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAmount",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>保存条件<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"preservationCondition",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>拟运出时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"backTime",flex:1,xtype:"datecolumn",format:"Y-m-d",editor:{xtype:"datefield",disabled:1==this.isShow?!0:!1,value:new Date}},{header:"其他要求",dataIndex:"otherNeed",flex:1,editor:{xtype:"textfield",disabled:1==this.isShow?!0:!1,allowBlank:!0}}],this.tbar={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSample",iconCls:"Add"},{text:"删除",xtype:"button",itemId:"deleteSample",disabled:!0,iconCls:"Delete"}]},this.on("selectionchange",this.selectChange),this.callParent()},expendSampleType:function(){var e=this.up("samplebackcountry").applicationID;console.log(e);var t=this.down("#sampleType").getStore();t.getProxy().setExtraParam("applicationID",e),t.load()},selectChange:function(e,t){this.down("#deleteSample").setDisabled(0!=t.length?!1:!0)},listeners:{validateedit:function(e,t){var a=e.getEditor(t.record,t.column);a.revertInvalid=!1}}});Ext.define("Soims.model.applicationDiscussion.DiscussType",{statics:{SmeDiscuss:{value:"SmeDiscuss",name:"专家委员会委员审议",roleCode:"SME"},SmecDiscuss:{value:"SmecDiscuss",name:"专家委员会主任审议",roleCode:"SMEC"},getDiscussTypeByUserRole:function(s){var e={};for(var i in this)if(this[i].roleCode===s){e=this[i];break}return e}}});Ext.define("Soims.view.application.common.SampleBackCountryGridShow",{itemId:"applicationCommonSampleBackCountryGrid",extend:"Ext.grid.Panel",alias:"widget.samplebackcountrygridshow",autoHeight:!0,requires:"Soims.model.applicationDiscussion.DiscussType",emptyText:"没有满足条件的样品",minHeight:200,selType:"rowmodel",plugins:[{ptype:"associationrowexpander",pluginId:"backCountryGridExpander",selectRowOnExpand:!0,rowBodyTpl:new Ext.XTemplate('<tpl for=".">','<p style="margin-left:30px;line-height:20px"><b>样品类型:&nbsp;&nbsp;</b>{data.sampleType}</p>','<p style="margin-left:30px;line-height:20px"><b>所在航段:&nbsp;&nbsp;</b>{data.sampleLeg}</p>','<p style="margin-left:30px;line-height:20px"><b>样品数:&nbsp;&nbsp;</b>{data.sampleNumber}</p>','<p style="margin-left:30px;line-height:20px"><b>样品量:&nbsp;&nbsp;</b>{data.sampleAmount}</p>','<p style="margin-left:30px;line-height:20px"><b>保存条件:&nbsp;&nbsp;</b>{data.preservationCondition}</p>','<p style="margin-left:30px;line-height:20px"><b>拟运出时间:&nbsp;&nbsp;</b>{data.backTime:date("Y/m/d")}</p>','<p style="margin-left:30px;line-height:20px"><b>先行运送回国必要性说明:&nbsp;&nbsp;</b>{data.repatriaionNecessity}</p>','<p style="margin-left:30px;line-height:20px"><b>其他要求:&nbsp;&nbsp;</b>{data.otherNeed}</p><br>','<div id="backCountryList{data.id}" style="padding-left:30px;line-height:20px"><b>审核记录</b></div>','<tpl for="getSampleRepatriationAuditsStore">','<tpl if="this.colorChange(data.auditerID,data.auditType)">','<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:30px;line-height:20px"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:30px;line-height:20px"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","<tpl else>",'<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:30px;line-height:20px;color:red"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:30px;line-height:20px;color:red"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.AuditButtonShow()">','<p style="text-align: center;"><button  id="repatriationagree{data.id}">同意</button>   <button  id="repatriationunagree{data.id}">拟同意</button>   <button  id="repatriationdisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>",'<tpl if="this.DiscussionsShow()">','<div id="backCountryDiscussionList{data.id}" style="padding-left:30px;line-height:20px"><b>审议记录</b></div>','<tpl for="SampleRepatriationDiscussionsStore">','<tpl if="this.colorChange(data.auditerID)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.discussType}" repatriationID="{[values.getSampleBackCountry().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.discussType}" repatriationID="{[values.getSampleBackCountry().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.DiscussionButtonsShow()">','<p style="text-align: center;"><button  id="dicussionagree{data.id}">同意</button>   <button  id="dicussionunagree{data.id}">拟同意</button>   <button  id="dicussiondisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>","</tpl>","</tpl>",{colorChange:function(e,t){var i=Soims.currentUser.id,a=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode);return e==i&&t==a.value?!1:!0},formatChange:function(e){var t=Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,i=Soims.model.applicationAuditing.AuditType.LegChargerAudit.value;return e==t||e==i?!0:!1},AuditButtonShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!0:!1},DiscussionsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditShow.value||this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!1:!0},DiscussionButtonsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value?!0:!1}})}],initComponent:function(){this.getPlugin("backCountryGridExpander").setXTemplateParams(this.panelType);var e=this;this.store=Ext.create("Soims.store.application.common.SampleBackCountry"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load(function(){for(var t=e.getPlugin("backCountryGridExpander"),i=0;i<e.store.getCount();i++)t.toggleRow(i,e.store.getAt(i))})),this.title=this.isAudit?'<span>提前样品运送回国列表</span><span style="font-size:12px;color:#FF0000">[请逐条样品进行审核]</span>':"提前样品运送回国列表";Ext.create("Soims.store.application.common.SampleType");this.columns=[{xtype:"rownumberer"},{header:"样品类型",dataIndex:"sampleType",flex:1,allowBlank:!1},{header:"所在航段",dataIndex:"sampleLeg",flex:1},{header:"样品数",dataIndex:"sampleNumber",flex:1},{header:"样品量",dataIndex:"sampleAmount",flex:1},{header:"保存条件",dataIndex:"preservationCondition",flex:1},{header:"拟运出时间",dataIndex:"backTime",flex:1,xtype:"datecolumn",format:"Y-m-d"},{header:"其他要求",dataIndex:"otherNeed",flex:1}],this.on("selectionchange",this.selectChange),this.callParent()},expendSampleType:function(){var e=this.up("samplebackcountry").applicationID,t=this.down("#sampleType").getStore();t.getProxy().setExtraParam("applicationID",e),t.load()},selectChange:function(e,t){var i=Ext.get("repatriationagree"+t[0].get("id")),a=Ext.get("repatriationunagree"+t[0].get("id")),n=Ext.get("repatriationdisagree"+t[0].get("id")),p=Ext.get("dicussionagree"+t[0].get("id")),s=Ext.get("dicussionunagree"+t[0].get("id")),o=Ext.get("dicussiondisagree"+t[0].get("id")),d=this;void 0!=i&&(i.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Agree,t[0].get("id"))}),a.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Doubt,t[0].get("id"))}),n.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Reject,t[0].get("id"))})),void 0!=p&&(p.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Agree,t[0].get("id"))}),s.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Doubt,t[0].get("id"))}),o.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Reject,t[0].get("id"))}))},onAuditClick:function(e,t,i){var a=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),n=e.get("id");Ext.Ajax.request({url:Soims.service.ApplicationAuditings.SampleRepatriationAuditService+"/Auditing",params:{ContentType:t.value,AuditType:a.value,RepatriationID:n},scope:this,success:function(){Ext.Tools.Msg("审核完成",0),this.rowBodyChange(t,i)}})},onDiscussClick:function(e,t,i){var a=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode);Ext.Ajax.request({url:Soims.service.discussion.SampleRepatriationDiscussionService+"/Discussing",params:{ContentType:t.value,DiscussType:a.value,RepatriationID:i},scope:this,success:function(){Ext.Tools.Msg("审议完成",0),this.discussRowBodyChange(t,i)}})},rowBodyChange:function(e,t){var i=this,a=(i.getView().el,Soims.currentUser.id),n=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),p="span[auditor='"+a+"'][auditType="+n.value+"][repatriationID="+t+"]",s=Ext.query(p),o=this.getAuditInfo();if(void 0==s[0]){var d=new Date,r=Ext.get("backCountryList"+t),l="<span style='padding-left:30px;line-height:20px;color:red' auditor='"+a+"' auditType='"+n.value+"' repatriationID='"+t+"'>"+o+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+e.name+"</span><br/>";Ext.DomHelper.insertAfter(r,l)}else{var d=new Date,u=Ext.get(s[0]),c=o+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+e.name;Ext.DomHelper.overwrite(u,c),Ext.DomHelper.applyStyles(u,"color:red;")}i.getView().refreshSize()},getAuditInfo:function(){var e=Soims.currentUser.currentRoleCode,t=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode).name+"&nbsp;&nbsp;&nbsp;&nbsp;";return t+="VS"==e||"LS"==e?Soims.currentUser.name:Soims.currentUser.department},discussRowBodyChange:function(e,t){var i=this,a=(i.getView().el,Soims.currentUser.id),n=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode),p="span[auditor='"+a+"'][auditType="+n.value+"][repatriationID="+t+"]",s=Ext.query(p);if(void 0==s[0]){var o=new Date,d=Ext.get("backCountryDiscussionList"+t),r="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+a+"' auditType='"+n.value+"' repatriationID='"+t+"'>"+n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+e.name+"</span><br/>";Ext.DomHelper.insertAfter(d,r)}else{var o=new Date,l=Ext.get(s[0]),u=n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+e.name;Ext.DomHelper.overwrite(l,u),Ext.DomHelper.applyStyles(l,"color:red;")}i.getView().refreshSize()}});Ext.define("Soims.view.application.common.SampleBackCountry",{extend:"Ext.form.Panel",alias:"widget.samplebackcountry",requires:["Soims.view.application.common.SampleBackCountryNecessityForm","Soims.view.application.common.SampleBackCountryGrid","Soims.view.application.common.SampleBackCountryGridShow"],padding:2,title:"样品回国信息",autoShow:!0,initComponent:function(){this.items=this.isShow?[{xtype:"samplebackcountrygridshow",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow,panelType:this.panelType}]:[{xtype:"samplebackcountrygrid",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow},{xtype:"samplebackcountrynecessityform",margin:"3 0 0 0",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.ElectronicDocumentGrid",{itemId:"applicationCommonElectronicDocumentGrid",extend:"Ext.grid.Panel",title:"证明材料电子资料",alias:"widget.electronicdocumentgrid",autoHeight:!0,emptyText:"没有满足条件的电子资料",height:200,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){this.store=Ext.create("Soims.store.application.common.ElectronicDocument"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load()),this.columns=[{xtype:"rownumberer"},{header:"文档名称",dataIndex:"name",flex:1},{header:"文档大小",dataIndex:"length",flex:1},{header:"备注",dataIndex:"remark",flex:1,editor:{xtype:"textfield",disabled:1==this.isShow?!0:!1}}],this.tbar={items:[{text:"添加",xtype:"button",itemId:"add",hidden:this.isShow,iconCls:"Add"},{text:"删除",itemId:"delete",xtype:"button",hidden:this.isShow,disabled:!0,iconCls:"Delete"},{text:"下载",itemId:"download",xtype:"button",disabled:!0,iconCls:"DiskDownload"}]},this.on("selectionchange",this.selectChange),this.callParent()},selectChange:function(t,e){0!=e.length?(this.down("#delete").setDisabled(!1),this.down("#download").setDisabled(!1)):(this.down("#delete").setDisabled(!0),this.down("#download").setDisabled(!0))}});Ext.define("Soims.view.application.common.ElectronicDocument",{name:"applicationCommonElectronicDocument",extend:"Ext.form.Panel",alias:"widget.electronicdocument",requires:["Soims.view.application.common.ElectronicDocumentGrid"],padding:2,title:"电子资料提交",autoShow:!0,initComponent:function(){this.items=[{xtype:"electronicdocumentgrid",applicationID:this.applicationID,isShow:this.isShow,type:this.type}],this.callParent()}});Ext.define("Soims.model.applicationAuditing.AuditType",{statics:{OrganizeContractorAudit:{value:"OrganizeContractorAudit",name:"组织实施单位审核",roleCode:"VODC",formType:"organizecontractorauditform"},VoyageChargerAudit:{value:"VoyageChargerAudit",name:"航次首席科学家审核",roleCode:"VS",formType:"voyagechargerauditform"},LegChargerAudit:{value:"LegChargerAudit",name:"航段首席科学家审核",roleCode:"LS",formType:"legchargerauditform"},ProjectChargerAudit:{value:"ProjectChargerAudit",name:"项目负责人审核",roleCode:"PC",formType:"projectchargerauditform"},ReportManagerAudit:{value:"ReportManagerAudit",name:"航次报告牵头负责人审核",roleCode:"VRC",formType:"reportmanagerauditform"},getAuditTypeByUserRole:function(e){var r={};for(var a in this)if(this[a].roleCode===e){r=this[a];break}return r}}});Ext.define("Soims.model.applicationAuditing.ContentType",{statics:{Agree:{value:"Agree",name:"同意"},Reject:{value:"Reject",name:"不同意"},Doubt:{value:"Doubt",name:"拟同意"}}});Ext.define("Soims.view.applicationAuditing.common.OrganizeContractorAuditForm",{extend:"Ext.form.Panel",alias:"widget.organizecontractorauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次组织实施单位意见",initComponent:function(){var t=!this.isAudit||Soims.component.applicationAuditingCommonOrganizeContractorAuditFormOrganizeContractorReadOnly;this.hidden=Soims.component.applicationAuditingCommonOrganizeContractorAuditFormOrganizeContractorHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:t,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(t){var e=t.up("organizecontractorauditform").down("textareafield");e.setValue(t.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"organizeContractor",anchor:"100%",width:600,height:150,readOnly:t},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!t,height:20}],this.callParent()},listeners:{afterrender:function(){var t=this,e=t.initStore();e.load(function(){0!=e.getCount()?t.setItemValues(e.getAt(0)):"VODC"==Soims.currentUser.currentRoleCode?t.down("label").hide():t.hide()})}},initStore:function(){var t=this,e=this.isAudit&&"VODC"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),n={AuditType:Soims.model.applicationAuditing.AuditType.OrganizeContractorAudit.value,ApplicationID:t.applicationID,Action:e};return i.setExtraParams(n),i},setItemValues:function(t){this.down("textareafield").setValue(t.get("auditContent")),this.down("label").setText("负责人: "+t.get("auditerName")+" "+Ext.Date.format(t.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:t.get("contentType")})}});Ext.define("Soims.view.applicationAuditing.common.VoyageChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.voyagechargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次首席科学家意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonVoyageChargerAuditFormVoyageChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonVoyageChargerAuditFormVoyageChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("voyagechargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"voyageCharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"VS"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e=this,t=this.isAudit&&"VS"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,ApplicationID:e.applicationID,Action:t};return i.setExtraParams(a),i},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAuditing.common.LegChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.legchargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航段首席科学家意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("legchargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"legCharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"LS"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e=this,t=this.isAudit&&"LS"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.LegChargerAudit.value,ApplicationID:e.applicationID,Action:t};return i.setExtraParams(a),i},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAccept.B1Tab",{extend:"Ext.form.Panel",alias:"widget.acceptb1tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.B1BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.SampleSiteUse","Soims.view.application.common.SampleBackCountry","Soims.view.application.common.ElectronicDocument","Soims.view.applicationAuditing.common.OrganizeContractorAuditForm","Soims.view.applicationAuditing.common.VoyageChargerAuditForm","Soims.view.applicationAuditing.common.LegChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"b1basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"samplesiteuse",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"samplebackcountry",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"organizecontractorauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"voyagechargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"legchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.model.applicationAuditing.AuditState",{statics:{Save:{value:"Save",name:"保存审核意见"},Submit:{value:"Submit",name:"提交审核意见"}}});Ext.define("Soims.model.applicationAccept.AcceptAction",{statics:{Agree:{value:"Agree",name:"通过"},Reject:{value:"Reject",name:"驳回"},Veto:{value:"Veto",name:"否决"}}});Ext.define("Soims.view.application.common.TestDataGrid",{extend:"Ext.grid.Panel",alias:"widget.testdatagrid",header:!1,viewConfig:{emptyText:"没有满足条件的测试数据"},height:200,frame:!1,closable:!1,collapsible:!1,titleCollapse:!1,plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){("V1"==this.type||"B1"==this.type||"B2"==this.type)&&(this.features=[{ftype:"grouping"}]),this.store=Ext.create("Soims.store.application.common.TestData"),this.applicationID="",this.deleteid="",this.columns=[{xtype:"rownumberer"},{text:"样品类型",sortable:!1,dataIndex:"sampleType"},{text:"使用目的",lockable:!1,sortable:!0,dataIndex:"usePurpose"},{text:"航段",sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"分析测试项目、指标",sortable:!0,dataIndex:"anlyseTestProject"},{text:"拟提交测试数据",sortable:!0,dataIndex:"intendCommitTestData",editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!0}},{text:"拟提交时间",sortable:!0,renderer:Ext.util.Format.dateRenderer("Y-m-d"),dataIndex:"commitTestDataTime",editor:{allowBlank:!1,xtype:"datefield",disabled:this.isShow,format:"Y-m-d"}}],this.tbar={hidden:this.isShow,items:[{text:"删除",name:"testDelete",action:"testDelete",itemId:"testDelete",xtype:"button",iconCls:"Delete",disabled:!0}]},this.callParent()}});Ext.define("Soims.controller.application.common.SampleInfo",{extend:"Ext.app.Controller",views:["application.common.SampleInfo","application.common.TestDataGrid"],refs:[{ref:"sampleinfo",selector:"sampleinfo",autoCreate:!0,xtype:"sampleinfo"}],init:function(){this.control({"sampleinfo button[itemId=samplePage2Save]":{click:function(e){var t=e.up("#applicationCommonSampleInfo"),a=t.applicationID;return a?void this.saveAction(a,t,!0):void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this)}}}),this.getCon("application.common.SampleGrid"),this.getCon("application.common.SampleGridShow"),this.getCon("application.common.TestDataGrid")},getCon:function(e){var t=this.application;return t.getController(e)},saveAction:function(e,t,a){this.sampleDelete(t.down("samplegrid").deleteid),this.testDataDelete(t.down("testdatagrid").deleteid),this.sampleSave(e,t,a),t.down("samplegrid").deleteid="",t.down("testdatagrid").deleteid=""},commitResultSave:function(e,t){var a=t.down("testdatainfo");console.log(a);var i=a.down("textfield[name=commitResultAmount]").getValue(),s=a.down("textfield[name=commitResultForm]").getValue(),o=a.down("textfield[name=commitResultTime]").getValue(),n={applicationID:e,commitResultAmount:i,commitResultForm:s,commitResultTime:o};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/CommitResultSave",params:n,success:function(e){e.responseText}})},testDataSave:function(e,t,a,i){var s=a.down("testdatagrid"),o=s.getStore();if(o.each(function(a){a.get("legID")==e.legID&&a.get("sampleType")==e.sampleType&&(a.set("sampleID",t),Ext.Ajax.request({async:!1,url:Soims.service.samples.TestDataService+"/Save",params:a.data,success:function(e){a.set("id",e.responseText)}}))}),i){Ext.MessageBox.alert("成功","信息保存成功！",function(){},this);var n=a.applicationID,l=a.down("samplegrid"),r=l.getStore();r.getProxy().setExtraParam("applicationID",n),r.reload(),o.getProxy().setExtraParam("applicationID",n),o.reload()}},sampleDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Delete",params:t,async:!1,success:function(){}})},testDataDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.TestDataService+"/Delete",params:t,async:!1,success:function(){}})},sampleSave:function(e,t,a){var i=t.down("samplegrid"),s=i.getStore(),o=s.getCount(),n=0,l=this,r=!1;s.each(function(i){i.set("sampleApplication",e),Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Save",params:i.data,async:!1,success:function(e){var s=e.responseText.split(",");i.set("id",s[0]),i.set("sampleAreaAndCountID",s[1]),n++,o==n&&1==a&&(r=!0),l.testDataSave(i.data,s[0],t,r)}})})},showTab:function(e,t,a,i){var s=this.getCon("application.new.B1Tab"),o=s.existInstance(e);if(o)return o;var n=Ext.create(a,{id:e,isShow:t,applicationID:i});return s.addTab(n),n}});Ext.define("Soims.model.application.common.BoardingUser",{extend:"Ext.data.Model",fields:[{name:"id",mapping:"ID"},{name:"name",mapping:"Name"},{name:"department",mapping:"Department"},{name:"cellphone",mapping:"CellPhone"},{name:"telphone",mapping:"TelPhone"},{name:"legs",mapping:"Legs"},{name:"legIDs",mapping:"LegIDs"},{name:"userDetail",mapping:"UserDetail"}]});Ext.define("Soims.store.application.common.BoardingUser",{extend:"Ext.data.Store",model:"Soims.model.application.common.BoardingUser",proxy:{type:"ajax",url:Soims.service.applications.BoardingUserService+"/QueryBoardingUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"},listeners:{exception:function(e,o){console.log(o),Ext.MessageBox.alert("提示","请先保存样品信息")}}}});Ext.define("Soims.controller.application.common.BoardingUser",{extend:"Ext.app.Controller",stores:["application.common.BoardingUser"],views:["application.common.SampleSiteUse","application.common.BoardingUserGrid","application.common.SampleSiteUseNecessityForm"],refs:[{ref:"samplesiteuse",selector:"samplesiteuse",autoCreate:!0,xtype:"samplesiteuse"},{ref:"boardingUser",selector:"boardinguser",autoCreate:!0,xtype:"boardinguser"},{ref:"sampleSiteUseNecessityForm",selector:"samplesiteusenecessityform",autoCreate:!0,xtype:"samplesiteusenecessityform"}],init:function(){this.control({boardinguser:{},"boardinguser button[itemId=addSiteUser]":{click:function(e){var t=e.up("#applicationCommonBoardingUserGrid");return void 0==t.up("samplesiteuse").applicationID?void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("samplesiteuse").up("tabpanel");t.setActiveTab(0)},this):(t.getStore().insert(0,Ext.create("Soims.model.application.common.BoardingUser")),void t.getView().refresh())}},"boardinguser button[itemId=deleteSiteUser]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此人员？点击保存按钮生效。",function(t){if("yes"==t){var o=e.up("#applicationCommonBoardingUserGrid"),i=o.getSelectionModel(),n=i.getSelection();this.getBoardingUser().getStore().remove(n),this.getBoardingUser().getView().refresh()}},this)}},"boardinguser searchcombo[itemId=boardingUserName]":{select:function(e,t){var o=e.up("#applicationCommonBoardingUserGrid").getSelectionModel().getSelection()[0];o.set("id",t[0].get("id")),o.set("name",t[0].get("name")),o.set("department",t[0].get("department")),o.set("cellphone",t[0].get("cellphone")),o.set("telphone",t[0].get("telphone"))}},"boardinguser combobox[itemId=legs]":{select:function(e,t){for(var o=e.up("#applicationCommonBoardingUserGrid").getSelectionModel().getSelection()[0],i="",n=0;n<t.length;n++)i+=t[n].get("id")+",";""!=i&&(i=i.substring(0,i.length-1)),o.set("legIDs",i),console.log(i)}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,o,i){var n=this.getCon("application.new.B1Tab"),r=n.existInstance(e);if(r)return r;var s=Ext.create(o,{id:e,isShow:t,applicationID:i});return n.addTab(s),s}});Ext.define("Soims.controller.application.common.SampleBackCountry",{extend:"Ext.app.Controller",views:["application.common.SampleBackCountry","application.common.SampleBackCountryGrid","application.common.SampleBackCountryNecessityForm"],refs:[{ref:"samplebackcountry",selector:"samplebackcountry",autoCreate:!0,xtype:"samplebackcountry"},{ref:"sampleBackCountryGrid",selector:"samplebackcountrygrid",autoCreate:!0,xtype:"samplebackcountrygrid"},{ref:"sampleBackCountryNecessityform",selector:"samplebackcountrynecessityform",autoCreate:!0,xtype:"samplebackcountrynecessityform"}],init:function(){this.control({"samplebackcountrygrid combobox[itemId=sampleType]":{select:function(e,t){var a=e.up("#applicationCommonSampleBackCountryGrid").getSelectionModel().getSelection()[0];a.set("sampleLeg",t[0].get("legID")),a.set("sampleID",t[0].get("id"))}},"samplebackcountrygrid button[itemId=addSample]":{click:function(e){var t=e.up("#applicationCommonSampleBackCountryGrid");if(void 0==t.up("samplebackcountry").applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("samplebackcountry").up("tabpanel");t.setActiveTab(0)},this);var a=Ext.create("Soims.model.application.common.SampleBackCountry");t.getStore().insert(0,a),t.getView().refresh()}},"samplebackcountrygrid button[itemId=deleteSample]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此样品？点击保存按钮生效。",function(t){if("yes"==t){var a=e.up("#applicationCommonSampleBackCountryGrid"),o=a.getSelectionModel(),n=o.getSelection();a.getStore().remove(n),a.getView().refresh()}},this)}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,a,o){var n=this.getCon("application.new.B1Tab"),c=n.existInstance(e);if(c)return c;var r=Ext.create(a,{id:e,isShow:t,applicationID:o});return n.addTab(r),r}});Ext.define("Soims.model.application.common.ElectronicDocument",{extend:"Ext.data.Model",fields:[{name:"id",mapping:"ID"},{name:"resourceID",mapping:"ResourceID"},{name:"name",mapping:"Name"},{name:"length",mapping:"Length"},{name:"remark",mapping:"Remark"}]});Ext.define("Soims.store.application.common.ElectronicDocument",{extend:"Ext.data.Store",model:"Soims.model.application.common.ElectronicDocument",proxy:{type:"ajax",url:Soims.service.applications.ElectronicDocument+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.controller.application.common.ElectronicDocument",{extend:"Ext.app.Controller",stores:["application.common.ElectronicDocument"],views:["application.common.ElectronicDocument","application.common.ElectronicDocumentGrid"],refs:[{ref:"electronicDocument",selector:"electronicdocument",autoCreate:!0,xtype:"electronicdocument"},{ref:"electronicDocumentGrid",selector:"electronicdocumentgrid",autoCreate:!0,xtype:"electronicdocumentgrid"}],init:function(){this.control({electronicdocumentgrid:{itemdblclick:function(){console.log("Double Click.")}},"electronicdocumentgrid button[itemId=add]":{click:function(e){if(void 0==e.up("electronicdocument").applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("electronicdocument").up("tabpanel");t.setActiveTab(0)},this);var t=this.getCon("application.common.ElectronicDocumentWin");t.show(e.up("#applicationCommonElectronicDocumentGrid"),e.up("electronicdocument").type)}},"electronicdocumentgrid button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此文件？点击保存按钮生效。",function(t){if("yes"==t){var o=e.up("#applicationCommonElectronicDocumentGrid"),c=o.getSelectionModel(),n=c.getSelection();this.getElectronicDocumentGrid().getStore().remove(n),this.getElectronicDocumentGrid().getView().refresh()}},this)}},"electronicdocumentgrid button[itemId=download]":{click:function(e){var t=e.up("#applicationCommonElectronicDocumentGrid"),o=t.getSelectionModel(),c=o.getSelection()[0];console.log(c);var n=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ResourceService+"/DownloadByResourceID?ResourceID="+c.get("resourceID")+"&Name="+c.get("name")+"&isIE="+n}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,o,c){var n=this.getCon("application.new.B1Tab"),i=n.existInstance(e);if(i)return i;var r=Ext.create(o,{id:e,isShow:t,applicationID:c});return n.addTab(r),r}});Ext.define("Soims.controller.applicationAccept.B1Tab",{extend:"Ext.app.Controller",views:["applicationAccept.B1Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptb1tab",selector:"acceptb1tab",autoCreate:!0,xtype:"acceptb1tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.common.BoardingUser"),this.getController("application.common.SampleBackCountry"),this.getController("application.common.ElectronicDocument"),this.control({acceptb1tab:{afterrender:this.afterB1TabRender},"acceptb1tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},afterB1TabRender:function(t){var e=t.down("b1basicinfopanel"),o=(t.down("testdatainfo"),t.down("samplesiteusenecessityform").down("textareafield")),c=Ext.create("Soims.store.application.show.B1Detail");c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){0!=c.getCount()&&(e.loadRecord(c.getAt(0)),o.setValue(c.getAt(0).get("usingNecessity")))})},accept:function(t,e,o){var c=t.up("panel"),i=c.applicationID;Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Action:e,ApplicationID:i,Competence:"AcceptB1"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.B2BasicInfoPanel",{extend:"Ext.form.Panel",alias:"widget.b2basicinfopanel",title:"大洋课题基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){{var e=Ext.create("Soims.store.application.new.Subject");Ext.create("Soims.store.application.new.Voyage")}this.items={xtype:"panel",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{xtype:"combobox",itemId:"subject",name:"topicName",fieldLabel:"课题名称",store:e,queryMode:"local",displayField:"topicName",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1},{fieldLabel:"负责人姓名",xtype:"textfield",itemId:"subjectchargerName",name:"topicChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",itemId:"subjectaddress",name:"topicAddress"},{fieldLabel:"联系电话",xtype:"textfield",itemId:"subjectcellphone",name:"topicCellphone"},{fieldLabel:"手机",xtype:"textfield",itemId:"subjecttelphone",name:"topicTelphone"},{xtype:"textfield",name:"projectName",itemId:"project",fieldLabel:"项目名称",margin:"20 0 5 0"},{fieldLabel:"负责人姓名",xtype:"textfield",itemId:"projectchargerName",name:"projectChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",itemId:"projectaddress",name:"projectAddress"},{fieldLabel:"联系电话",xtype:"textfield",itemId:"projectcellphone",name:"projectCellphone"},{fieldLabel:"手机",xtype:"textfield",itemId:"projecttelphone",name:"projectTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"课题编号",xtype:"textfield",itemId:"subjectnumber",name:"topicNumber"},{fieldLabel:"所在单位",xtype:"textfield",itemId:"subjectdepartment",name:"topicDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",itemId:"subjectzipCode",name:"topicZipCode"},{fieldLabel:"传真",xtype:"textfield",itemId:"subjectfax",name:"topicFax"},{fieldLabel:"邮箱",xtype:"textfield",itemId:"subjectemail",name:"topicEmail"},{fieldLabel:"项目编号",xtype:"textfield",name:"projectNumber",itemId:"projectnumber",margin:"20 0 5 0"},{fieldLabel:"所在单位",xtype:"textfield",itemId:"projectdepartment",name:"projectDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",itemId:"projectzipCode",name:"projectZipCode"},{fieldLabel:"传真",xtype:"textfield",itemId:"projectfax",name:"projectFax"},{fieldLabel:"邮箱",xtype:"textfield",itemId:"projectemail",name:"projectEmail"}]}]},this.callParent()},searchSubject:function(e){var t=e.getStore(),i=this.up("#applicationCommonB2BasicInfoPanel");1!=i.isShow&&(t.load(),t.on({load:function(){0!=t.getCount()?i.down("#subject").select(t.getAt(0)):Ext.MessageBox.alert("提示","不存在可用于申请样品的航次任务，如有疑问请联系系统工作人员，谢谢！",function(){i.up("tabpanel").close()},this)}}))}});Ext.define("Soims.view.application.new.B2BasicInfo",{itemId:"applicationNewB2BasicInfo",extend:"Ext.form.Panel",alias:"widget.b2basicinfo",requires:["Soims.view.application.common.B2BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b2basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!1}],this.callParent()}});Ext.define("Soims.view.applicationAuditing.common.ProjectChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.projectchargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.application.common.SampleApplicationType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"项目负责人意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonProjectChargerAuditFormProjectChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonProjectChargerAuditFormProjectChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("projectchargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"projectcharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"PC"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e,t=this,i=Soims.model.applicationAuditing.AuditState.Submit.value,o=Ext.create("Soims.store.applicationAuditing.Audit");return(t.appType==Soims.model.application.common.SampleApplicationType.V2.value||t.appType==Soims.model.application.common.SampleApplicationType.B2.value&&"PC"==Soims.currentUser.currentRoleCode&&t.isAudit)&&(i=Soims.model.applicationAuditing.AuditState.Save.value),e={AuditType:Soims.model.applicationAuditing.AuditType.ProjectChargerAudit.value,ApplicationID:t.applicationID,Action:i},o.setExtraParams(e),o},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAccept.B2Tab",{extend:"Ext.form.Panel",alias:"widget.acceptb2tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.B2BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.SampleSiteUse","Soims.view.application.common.SampleBackCountry","Soims.view.application.common.ElectronicDocument","Soims.view.applicationAuditing.common.ProjectChargerAuditForm","Soims.view.applicationAuditing.common.VoyageChargerAuditForm","Soims.view.applicationAuditing.common.LegChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"b2basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"samplesiteuse",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"samplebackcountry",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"projectchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1,appType:this.appType},{xtype:"voyagechargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"legchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.B2Tab",{extend:"Ext.app.Controller",views:["applicationAccept.B2Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptb2tab",selector:"acceptb2tab",autoCreate:!0,xtype:"acceptb2tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.common.BoardingUser"),this.getController("application.common.SampleBackCountry"),this.getController("application.common.ElectronicDocument"),this.control({acceptb2tab:{afterrender:this.afterB2TabRender},"acceptb2tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},afterB2TabRender:function(t){var e=t.down("b2basicinfopanel"),o=(t.down("testdatainfo"),t.down("samplesiteusenecessityform").down("textareafield")),c=Ext.create("Soims.store.application.show.B2Detail");c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){var t=c.getAt(0);e.loadRecord(t),o.setValue(t.get("usingNecessity"))}})},accept:function(t,e,o){var c=t.up("panel"),i=c.applicationID,n=c.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V1BasicInfoPanel",{itemId:"applicationCommonV1BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v1basicinfopanel",title:"承担任务信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=this,t=Ext.create("Soims.store.application.new.Report"),i=Ext.create("Soims.store.application.new.Division");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"combobox",itemId:"report",name:"report",labelWidth:100,width:300,editable:!1,fieldLabel:"航次报告名称",padding:"10 0 0 25",store:t,queryMode:"local",displayField:"name",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1,listeners:{beforerender:e.searchReport,select:function(t,i){e.loadRecord(i[0]);var o=this.up("#applicationCommonV1BasicInfoPanel"),d=o.down("#division").getStore(),a=this.getValue();a?(d.getProxy().setExtraParam("reportID",a),d.load(),d.on({load:function(){0!=d.getCount()&&o.down("#division").select(d.getAt(0))}})):Ext.Tools.Msg("请先选择航次报告！",9)}}},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"航次报告编写牵头负责人",xtype:"textfield",name:"reportChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"reportAddress"},{fieldLabel:"联系电话",xtype:"textfield",name:"reportCellphone"},{fieldLabel:"手机",xtype:"textfield",name:"reportTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"reportDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",name:"reportZipCode"},{fieldLabel:"传真",xtype:"textfield",name:"reportFax"},{fieldLabel:"邮箱",xtype:"textfield",name:"reportEmail"}]}]},{xtype:"combobox",itemId:"division",name:"division",editable:!1,fieldLabel:"分工负责学科、调查区域",store:i,labelWidth:100,width:300,padding:"10 0 0 25",queryMode:"local",displayField:"name",valueField:"id",readOnly:1==this.isShow?!0:!1,listeners:{select:function(t,i){e.loadRecord(i[0])}}},{xtype:"fieldset",itemId:"divisionInfoForm",name:"divisionInfoForm",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",layout:"column",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"航次报告编写分工负责人",xtype:"textfield",name:"divisionChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"divisionAddress"},{fieldLabel:"联系电话",xtype:"textfield",name:"divisionCellphone"},{fieldLabel:"手机",xtype:"textfield",name:"devisionTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"divisionDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",name:"divisionZipCode"},{fieldLabel:"传真",xtype:"textfield",name:"divisionFax"},{fieldLabel:"邮箱",xtype:"textfield",name:"divisionEmail"}]}]}]},this.callParent()},searchReport:function(e){var t=e.getStore(),i=this.up("#applicationCommonV1BasicInfoPanel"),o=this.up("#applicationNewV1BasicInfo");1!=o.isEdit&&1!=o.isShow&&(t.load(),t.on({load:function(){0!=t.getCount()?(i.down("#report").select(t.getAt(0)),i.down("textfield[name=reportChargerName]").setValue(t.getAt(0).get("reportChargerName")),i.down("textfield[name=reportAddress]").setValue(t.getAt(0).get("reportAddress")),i.down("textfield[name=reportCellphone]").setValue(t.getAt(0).get("reportCellphone")),i.down("textfield[name=reportTelphone]").setValue(t.getAt(0).get("reportTelphone")),i.down("textfield[name=reportZipCode]").setValue(t.getAt(0).get("reportZipCode")),i.down("textfield[name=reportFax]").setValue(t.getAt(0).get("reportFax")),i.down("textfield[name=reportEmail]").setValue(t.getAt(0).get("reportEmail")),i.down("textfield[name=reportDepartment]").setValue(t.getAt(0).get("reportDepartment")),i.searchDivision(i,t.getAt(0).get("id"))):Ext.MessageBox.alert("提示","不存在您负责的航次报告，如有疑问请联系系统工作人员，谢谢！",function(){},this)}}))},searchDivision:function(e,t){var i=e.down("#division").getStore();i.getProxy().setExtraParam("reportID",t),i.load(function(){e.down("#division").select(i.getAt(0)),console.log(e.down("#division")),e.down("textfield[name=divisionChargerName]").setValue(i.getAt(0).get("divisionChargerName")),e.down("textfield[name=divisionAddress]").setValue(i.getAt(0).get("divisionAddress")),e.down("textfield[name=divisionCellphone]").setValue(i.getAt(0).get("divisionCellphone")),e.down("textfield[name=devisionTelphone]").setValue(i.getAt(0).get("divisionTelphone")),e.down("textfield[name=divisionZipCode]").setValue(i.getAt(0).get("divisionZipCode")),e.down("textfield[name=divisionDepartment]").setValue(i.getAt(0).get("divisionDepartment")),e.down("textfield[name=divisionFax]").setValue(i.getAt(0).get("divisionFax")),e.down("textfield[name=divisionEmail]").setValue(i.getAt(0).get("divisionEmail"))})}});Ext.define("Soims.view.application.new.V1BasicInfo",{itemId:"applicationNewV1BasicInfo",extend:"Ext.form.Panel",alias:"widget.v1basicinfo",title:"申请基本信息",requires:["Soims.view.application.common.V1BasicInfoPanel"],padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v1basicinfopanel",applicationID:this.applicationID,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.applicationAuditing.common.ReportManagerAuditForm",{extend:"Ext.form.Panel",alias:"widget.reportmanagerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次报告牵头负责人意见",initComponent:function(){var t=!this.isAudit||Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:t,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(t){var e=t.up("reportmanagerauditform").down("textareafield");e.setValue(t.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"reportmanager",anchor:"100%",width:600,height:150,readOnly:t},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!t,height:20}],this.callParent()},listeners:{afterrender:function(){var t=this,e=t.initStore();e.load(function(){0!=e.getCount()?t.setItemValues(e.getAt(0)):"VRC"==Soims.currentUser.currentRoleCode?t.down("label").hide():t.hide()})}},initStore:function(){var t=this,e=this.isAudit?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.ReportManagerAudit.value,ApplicationID:t.applicationID,Action:e};return i.setExtraParams(a),i},setItemValues:function(t){this.down("textareafield").setValue(t.get("auditContent")),this.down("label").setText("负责人: "+t.get("auditerName")+" "+Ext.Date.format(t.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:t.get("contentType")})}});Ext.define("Soims.view.applicationAccept.V1Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv1tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V1BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.applicationAuditing.common.ReportManagerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v1basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"reportmanagerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:this.isAudit}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.application.new.V1BasicInfo",{extend:"Ext.app.Controller",views:["application.new.V1BasicInfo"],refs:[{ref:"v1BasicInfo",selector:"v1basicinfo",autoCreate:!0,xtype:"v1basicinfo"}],init:function(){this.control()},getCon:function(n){var i=this.application;return i.getController(n)}});Ext.define("Soims.controller.applicationAccept.V1Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V1Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv1tab",selector:"acceptv1tab",autoCreate:!0,xtype:"acceptv1tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.new.V1BasicInfo"),this.control({acceptv1tab:{render:function(t){if(1==t.isEdit||1==t.isShow){var e=t.down("v1basicinfopanel"),o=(t.down("testdatainfo"),e.down("#report")),i=o.getStore(),c=e.down("#division"),n=c.getStore(),a=Ext.create("Soims.store.application.show.V1Detail");a.getProxy().setExtraParam("ID",t.applicationID),a.load(function(){0!=a.getCount()&&i.load(function(){console.log(a.getAt(0).get("reportName")),e.loadRecord(a.getAt(0));var i=Ext.create("Soims.model.application.new.Division",{id:a.getAt(0).get("divisionID"),name:a.getAt(0).get("divisionName")});o.setValue(a.getAt(0).get("reportName")),n.getProxy().setExtraParam("reportID",a.getAt(0).get("reportID")),t.down("#applicationCommonSampleInfo").applicationID=a.getAt(0).get("id"),n.load(function(){c.setValue(i)})})})}}},"acceptv1tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,o){var i=t.up("panel"),c=i.applicationID,n=i.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:c,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),i.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.new.V2BasicInfo",{itemId:"applicationNewV2BasicInfo",extend:"Ext.form.Panel",alias:"widget.v2basicinfo",requires:["Soims.view.application.common.B2BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b2basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V2Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv2tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V2BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.ElectronicDocument","Soims.model.application.common.SampleApplicationType","Soims.view.applicationAuditing.common.ProjectChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v2basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"projectchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:this.isAudit}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.V2Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V2Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv2tab",selector:"acceptv2tab",autoCreate:!0,xtype:"acceptv2tab"}],init:function(){this.getController("application.common.SampleInfo"),this.control({acceptv2tab:{afterrender:function(t){if(1==t.isShow){var e=t.down("b2basicinfopanel"),c=(t.down("testdatainfo"),e.down("#subject"),Ext.create("Soims.store.application.show.V2Detail"));c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){e.loadRecord(c.getAt(0));{Ext.create("Soims.model.application.new.Subject",{id:c.getAt(0).get("topicID"),topicName:c.getAt(0).get("topicName")})}}})}}},"acceptv2tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,c){var o=t.up("panel"),i=o.applicationID,n=o.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+c+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),o.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V3BasicInfoPanel",{itemId:"applicationCommonV3BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v3basicinfopanel",title:"承担任务信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){console.log(this.isShow);var e=Ext.create("Soims.store.application.new.NoOceanTopic");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"fieldset",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{margin:"10 0",xtype:"combobox",itemId:"noOceanTopic",name:"noOceanTopic",labelWidth:150,width:400,fieldLabel:"非大洋课题名称",store:e,displayField:"topicName",valueField:"topicID",readOnly:1==this.isShow?!0:!1,allowBlank:!1},{fieldLabel:"课题编号",labelWidth:150,width:400,xtype:"textfield",name:"topicNumber",itemId:"topicNumber",allowBlank:!1},{fieldLabel:"课题来源与下达部门",xtype:"textfield",labelWidth:150,width:500,name:"topicSource",itemId:"topicSource",allowBlank:!1}]},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"非大洋课题负责人",xtype:"textfield",name:"chargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]}]}]},this.callParent()}});Ext.define("Soims.view.application.new.V3BasicInfo",{itemId:"applicationNewV3BasicInfo",extend:"Ext.form.Panel",itemId:"applicationNewV3BasicInfo",alias:"widget.v3basicinfo",requires:["Soims.view.application.common.V3BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v3basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V3Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv3tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V3BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.ElectronicDocument","Soims.model.application.common.SampleApplicationType"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v3basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.V3Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V3Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv3tab",selector:"acceptv3tab",autoCreate:!0,xtype:"acceptv3tab"}],init:function(){this.getController("application.common.SampleInfo"),this.control({acceptv3tab:{afterrender:this.afterTabRender},"acceptv3tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},afterTabRender:function(t){if(1==t.isShow){var e=t.down("v3basicinfopanel"),c=(t.down("testdatainfo"),e.down("#noOceanTopic"),Ext.create("Soims.store.application.show.V3Detail"));c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){e.loadRecord(c.getAt(0));{Ext.create("Soims.model.application.new.NoOceanTopic",{topicID:c.getAt(0).get("topicID"),topicName:c.getAt(0).get("topicName")})}}})}},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,c){var o=t.up("panel"),i=o.applicationID,n=o.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+c+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),o.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V4BasicInfoPanel",{itemId:"applicationCommonV4BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v4basicinfopanel",title:"公益事业信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.application.new.Activity");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"fieldset",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{margin:"10 0",xtype:"combobox",itemId:"activity",name:"activity",labelWidth:150,width:400,fieldLabel:"项目/活动名称",store:e,displayField:"activityName",forbidBlankAndShowStar:!0,valueField:"activityID",readOnly:1==this.isShow?!0:!1,allowBlank:!1},{fieldLabel:"活动举办地",labelWidth:150,width:400,xtype:"textfield",name:"activityPlace",itemId:"activityPlace",forbidBlankAndShowStar:!0,readOnly:this.isShow,allowBlank:!1},{fieldLabel:"课题来源与下达部门",xtype:"textfield",labelWidth:150,width:500,readOnly:this.isShow,name:"activityDepartment",itemId:"activityDepartment",forbidBlankAndShowStar:!0,allowBlank:!1}]},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"负责人",xtype:"textfield",name:"chargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]}]}]},this.callParent()}});Ext.define("Soims.view.application.new.V4BasicInfo",{extend:"Ext.form.Panel",alias:"widget.v4basicinfo",itemId:"applicationNewV4BasicInfo",requires:["Soims.view.application.common.V4BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v4basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V4Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv4tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V4BasicInfo","Soims.view.application.common.SampleInfo","Soims.model.application.common.SampleApplicationType"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){Soims.model.application.common.SampleApplicationType;this.items=[{xtype:"v4basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.view.application.common.V4Sample",{itemId:"applicationCommonV4Sample",extend:"Ext.form.Panel",requires:["Ext.ux.form.TreeField"],alias:"widget.v4sample",title:"拟申请样品信息",padding:2,AutoScroll:!0,overflowY:"auto",autoShow:!0,autoHeight:!0,style:"background-color: #dfe8f5;",initComponent:function(){this.deleteid="";var e=Ext.create("Soims.store.tree.Tree");this.store=Ext.create("Soims.store.application.common.Sample"),this.isDiscussion&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.tree.UsePurpose");this.borrowStore=Ext.create("Soims.store.application.common.BorrowOrUse"),this.columns=[{xtype:"rownumberer"},{header:"ID",dataIndex:"id",hidden:!0},{header:"样品类型",dataIndex:"sampleTypeID",flex:1,editor:{xtype:"treefield",disabled:this.isShow,singleChecked:!0,pickerTitle:"选择样品类型",store:e},renderer:function(t,i,o){if(t){var l=t.split(","),a=!0,d="";return Ext.Array.each(l,function(t){if(""!==t){var i=t.split("|"),o=e.getNodeById(i[0]),l=document.getElementById("textBox"+i[0]);o?d=l?d+"["+l.value+"]":d+"["+o.get("text")+"]":a=!1}}),a?d:o.get("sampleType")}}},{header:"使用/借用",dataIndex:"borrowOrUser",flex:1,editor:{xtype:"combobox",store:this.borrowStore,disabled:this.isShow,queryMode:"local",editable:!1,displayField:"name",valueField:"name",allowBlank:!1}},{header:"样品量",dataIndex:"sampleTotalNumber",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:"申请样品用途及目的",dataIndex:"usePurposeID",flex:1,editor:{xtype:"treefield",disabled:this.isShow,pickerTitle:"选择使用目的",store:t},renderer:function(e,i,o){if(e){console.log(e),console.log(o);var l=e.split(","),a=!0,d="";return Ext.Array.each(l,function(e){if(""!==e){var i=e.split("|"),o=t.getNodeById(i[0]),l=document.getElementById("textBox"+i[0]);console.log(o),o?d=l?d+"["+l.value+"]":d+"["+o.get("text")+"]":a=!1}}),a?d:o.get("usePurpose")}}}];var i={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSample",iconCls:"Add"},{text:"删除",itemId:"deleteSample",xtype:"button",disabled:!0,iconCls:"Delete"}]};this.items=[{xtype:"gridpanel",title:"样品列表",alias:"widget.v4samplegrid",itemId:"applicationCommonV4SampleGrid",store:this.store,columns:this.columns,selType:"rowmodel",emptyText:"没有满足条件的样品",height:200,style:"background-color: #dfe8f5;",plugins:[{ptype:"cellediting",clicksToEdit:1}],tbar:i,listeners:{selectionchange:function(e,t){this.down("#deleteSample").setDisabled(0!=t.length?!1:!0)}}},{xtype:"fieldset",title:"基本信息",hidden:this.isDiscussion,collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",layout:"column",padding:"10 10 10 10",height:85,items:[{columnWidth:.4,layout:"column",bodyStyle:"background-color: #dfe8f5;",border:0,items:{xtype:"datefield",name:"activityStartTime",itemId:"activityStartTime",fieldLabel:"样品借用开始时间",readOnly:this.isShow}},{columnWidth:.4,layout:"column",bodyStyle:"background-color: #dfe8f5;",border:0,items:{xtype:"datefield",itemId:"activityEndTime",name:"activityEndTime",fieldLabel:"结束时间",readOnly:this.isShow}}]}],this.callParent()}});Ext.define("Soims.controller.application.common.V4Sample",{extend:"Ext.app.Controller",views:["application.common.V4Sample"],refs:[{ref:"v4sample",selector:"v4sample",autoCreate:!0,xtype:"v4sample"},{ref:"v4samplegrid",selector:"v4samplegrid",autoCreate:!0,xtype:"v4samplegrid"}],init:function(){this.control({"v4sample button[itemId=v4SampleSave]":{click:function(e){var t=e.up("#applicationCommonV4Sample"),a=t.applicationID;return a?void this.saveAction(a,t,!0):void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this)}},"v4sample button[itemId=addSample]":{click:function(e){var t=e.up("#applicationCommonV4Sample");if(void 0==t.applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this);var a=Ext.create("Soims.model.application.common.Sample");t.down("#applicationCommonV4SampleGrid").getStore().insert(0,a),t.down("#applicationCommonV4SampleGrid").getView().refresh()}},"v4sample button[itemId=deleteSample]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此样品？点击保存按钮生效。",function(t){if("yes"==t){var a=e.up("#applicationCommonV4Sample"),i=e.up("#applicationCommonV4SampleGrid"),o=i.getSelectionModel(),n=o.getSelection()[0];a.deleteid=a.deleteid+","+n.get("id"),i.getStore().remove(n)}},this)}},v4sample:{afterrender:function(e){var t=e.applicationID;if(t){var a=e.down("#applicationCommonV4SampleGrid").getStore();a.getProxy().setExtraParam("applicationID",t),a.load()}}}})},getCon:function(e){var t=this.application;return t.getController(e)},saveAction:function(e,t,a){this.sampleDelete(t.deleteid),this.sampleSave(e,t,a),this.commitResultSave(e,t),t.deleteid=""},sampleDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Delete",params:t,async:!1,success:function(){}})},sampleSave:function(e,t,a){var i=t.down("#applicationCommonV4SampleGrid"),o=i.getStore();o.each(function(t){t.set("sampleApplication",e),""==t.get("sampleTypeID")&&t.set("sampleTypeID",t.get("sampleType")),""==t.get("usePurposeID")&&t.set("usePurposeID",t.get("usePurpose")),Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Save",params:t.data,async:!1,success:function(e){var a=e.responseText.split(",");t.set("id",a[0]),t.set("sampleAreaAndCountID",a[1])}}),a&&Ext.MessageBox.alert("成功","信息保存成功！",function(){},this),o.getProxy().setExtraParam("applicationID",e),o.load()})},commitResultSave:function(e,t){var a=t.down("textfield[name=activityStartTime]").getValue(),i=t.down("textfield[name=activityEndTime]").getValue(),o={applicationID:e,activityStartTime:a,activityEndTime:i};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ActivityTimeSave",params:o,success:function(){}})}});Ext.define("Soims.controller.applicationAccept.V4Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V4Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv4tab",selector:"acceptv4tab",autoCreate:!0,xtype:"acceptv4tab"}],init:function(){this.getController("application.common.V4Sample"),this.control({acceptv4tab:{render:function(t){if(1==t.isEdit||1==t.isShow){var e=t.down("v4basicinfopanel"),i=e.down("#activity"),c=i.getStore(),o=Ext.create("Soims.store.application.show.V4Detail");o.getProxy().setExtraParam("ID",t.applicationID),o.load(function(){0!=o.getCount()&&c.load(function(){var c=Ext.create("Soims.model.application.new.Activity",{activityID:o.getAt(0).get("activityID"),activityName:o.getAt(0).get("activityName")});i.setValue(c),e.loadRecord(o.getAt(0));var a=t.down("#applicationCommonV4Sample");a.applicationID=o.getAt(0).get("id"),a.down("datefield[itemId=activityStartTime]").setValue(o.getAt(0).get("activityStartTime")),a.down("datefield[itemId=activityEndTime]").setValue(o.getAt(0).get("activityEndTime"))})})}}},"acceptv4tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,i){var c=t.up("panel"),o=c.applicationID,a=c.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+i+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:a,Action:e,ApplicationID:o,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.controller.applicationAccept.AcceptApplicationGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AcceptApplicationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType","Soims.controller.applicationAccept.B1Tab","Soims.controller.applicationAccept.B2Tab","Soims.controller.applicationAccept.V1Tab","Soims.controller.applicationAccept.V2Tab","Soims.controller.applicationAccept.V3Tab","Soims.controller.applicationAccept.V4Tab"],refs:[{ref:"acceptapplicationgrid",selector:"acceptapplicationgrid",autoCreate:!0,xtype:"acceptapplicationgrid"}],init:function(){this.control({"acceptapplicationgrid  button[action=accept]":{click:this.onClickAppAcceptBtn},acceptapplicationgrid:{itemclick:function(e,i){console.log("Hello"),this.showHistoryState(i)},selectionchange:function(e,i){var t=this.getAcceptapplicationgrid();t.down("#accept").setDisabled(i.length>0?!1:!0)}}})},showHistoryState:function(e){var i=e.get("id"),t=this.getAcceptapplicationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(i),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:i},method:"POST",scope:this,success:function(i){console.log(i.responseText);var p=Ext.JSON.decode(i.responseText);t.refresh(p,e.get("type"))}})},showTab:function(e,i,t,p,c){var a=this.getCon("mainFrame.Main"),o=a.existInstance(e);if(o)return o;var n=Ext.create(t,{id:e,title:i,applicationID:p,isShow:!0,isAccept:!0,appType:c,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return a.addTab(n),n},show:function(){var e=this.getAcceptapplicationgrid(),i=this.getCon("mainFrame.Main");i.addTab(e)},refreshGrid:function(){this.show(),this.getAcceptapplicationgrid().getStore().reload(),this.getAcceptapplicationgrid().getSelectionModel().deselectAll()},getCon:function(e){var i=this.application;return i.getController(e)},onClickAppAcceptBtn:function(e){{var i=e.up("grid"),t=i.getSelectionModel().getSelection()[0],p=t.get("type"),c=this.getViewFnByApp("applicationAccept",p,"Tab");this.showTab("Accept"+p+t.get("id"),"受理"+t.get("name"),c,t.get("id"))}},getViewFnByApp:function(e,i,t){var p=null,c=this.getCon(e+"."+i+t);switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:p=c.getApplicationAcceptB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:p=c.getApplicationAcceptB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:p=c.getApplicationAcceptV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:p=c.getApplicationAcceptV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:p=c.getApplicationAcceptV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:p=c.getApplicationAcceptV4TabView()}return p}});Ext.define("Soims.model.applicationAccept.Accept",{extend:"Ext.data.Model",fields:[{name:"acceptID",type:"int",mapping:"AcceptID"},{name:"acceptAction",mapping:"AcceptAction"},{name:"acceptContent",mapping:"AcceptContent"},{name:"acceptTime",mapping:"AcceptTime"},{name:"applicationID",type:"int",mapping:"ID"},{name:"name",mapping:"Name"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"type",mapping:"Type"},{name:"applyTime",mapping:"ApplyTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.store.applicationAccept.AcceptComplete",{extend:"Ext.data.Store",model:"Soims.model.applicationAccept.Accept",autoLoad:!1,proxy:{type:"ajax",url:Soims.service.ApplicationAccepts.AcceptService+"/QueryAcceptCompleteByUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.applicationAccept.AcceptCompleteGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.applicationAccept.AcceptAction","Soims.store.applicationAccept.AcceptComplete"],alias:"widget.acceptcompletegrid",title:"待分配申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AcceptComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"acceptID",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"申请书编号",dataIndex:"applicationNumber",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"受理日期",dataIndex:"acceptTime",flex:1}],this.tbar=[{text:"查看",xtype:"button",itemId:"show",action:"show",disabled:!0,iconCls:"Information"},{text:"导出现场申请Excel",xtype:"button",itemId:"exportSiteApplication",iconCls:"DiskDownload"},{text:"导出室内申请Excel",xtype:"button",itemId:"exportIndoorApplication",iconCls:"DiskDownload"},{text:"导入现场分配建议Excel",xtype:"button",itemId:"importSiteExcel",iconCls:"DiskUpload"},{text:"导入室内分配建议Excel",xtype:"button",itemId:"importIndoorExcel",iconCls:"DiskUpload"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.AcceptCompleteGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AcceptCompleteGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"acceptcompletegrid",selector:"acceptcompletegrid",autoCreate:!0,xtype:"acceptcompletegrid"}],init:function(){this.control({"acceptcompletegrid  button[action=show]":{click:this.onClickAppShowBtn},"acceptcompletegrid  button[itemId=exportSiteApplication]":{click:this.onExportSiteApplication},"acceptcompletegrid  button[itemId=exportIndoorApplication]":{click:this.onExportIndoorApplication},"acceptcompletegrid  button[itemId=importSiteExcel]":{click:this.onImportSiteApplication},"acceptcompletegrid  button[itemId=importIndoorExcel]":{click:this.onImportIndoorApplication},acceptcompletegrid:{itemclick:function(e,t){console.log("Hello"),this.showHistoryState(t)},selectionchange:function(e,t){var o=this.getAcceptcompletegrid();o.down("#show").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(e){console.log(e);var t=e.get("applicationID"),o=this.getAcceptcompletegrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var i=Ext.JSON.decode(t.responseText);o.refresh(i,e.get("type"))}})},showTab:function(e,t,o,i,p){var c=this.getCon("mainFrame.Main"),n=c.existInstance(e);if(n)return n;var a=Ext.create(o,{id:e,title:t,applicationID:i,isShow:!0,isAccept:!1,appType:p,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return c.addTab(a),a},show:function(){var e=this.getAcceptcompletegrid(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},onClickAppShowBtn:function(e){{var t=e.up("grid"),o=t.getSelectionModel().getSelection()[0],i=o.get("type"),p=this.getViewFnByApp("applicationAccept",i,"Tab");this.showTab("ShowAccept"+i+o.get("id"),"查看"+o.get("name"),p,o.get("applicationID"),i)}},getViewFnByApp:function(e,t,o){var i=null,p=this.getCon(e+"."+t+o);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:i=p.getApplicationAcceptB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:i=p.getApplicationAcceptB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:i=p.getApplicationAcceptV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:i=p.getApplicationAcceptV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:i=p.getApplicationAcceptV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:i=p.getApplicationAcceptV4TabView()}return i},onExportIndoorApplication:function(){var e=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportIndoorAppToXlsExcel?isIE="+e},onExportSiteApplication:function(){var e=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportSiteAppToXlsExcel?isIE="+e},onImportSiteApplication:function(){var e=this.getCon("applicationAccept.DocumentUploadWin");e.show("/ImportSiteAppExcel")},onImportIndoorApplication:function(){var e=this.getCon("applicationAccept.DocumentUploadWin");e.show("/ImportIndoorAppExcel")}});Ext.define("Soims.view.applicationAccept.AllocationGrid",{extend:"Ext.grid.Panel",requires:"Soims.model.applicationAccept.AcceptAction",alias:"widget.allocationgrid",title:"已分配申请书列表",iconCls:"ApplicationViewColumns",closable:!0,features:[{ftype:"grouping",groupHeaderTpl:'<span style="font-size:12px">{[values.rows[0].data.name]}</span>'}],selModel:{mode:"MULTI"},selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AllocationComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"acceptID",flex:1,hidden:!0},{header:"样品类型",dataIndex:"sampleType",flex:1},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"申请书编号",dataIndex:"applicationNumber",flex:1},{header:"填写人",dataIndex:"applicantName",hidden:!0,flex:1},{header:"负责人",dataIndex:"charger",hidden:!0,flex:1},{header:"本任务既往使用样品情况",dataIndex:"taskPreviousUsage",flex:1},{header:"申请人既往使用样品情况",dataIndex:"supplierPreviousUsage",flex:1},{header:"样品现场使用意见",dataIndex:"suggestion",flex:1},{header:"取用次序",dataIndex:"order",flex:1}],this.tbar=[{text:"收缩所有分组",xtype:"button",iconCls:"Refresh",tooltip:"<b>收缩分组</b><br/>收缩所有分组",handler:function(){var e=this.up("grid"),t=e.getView().getFeature(0);t.collapseAll()}},{text:"展开所有分组",xtype:"button",iconCls:"Refresh",tooltip:"<b>展开分组</b><br/>展开所有分组",handler:function(){var e=this.up("grid"),t=e.getView().getFeature(0);t.expandAll()}},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()},listeners:{groupclick:function(e,t,a,i){var l=i.getTarget(".grpBtn");l&&alert("hello")}}});Ext.define("Soims.controller.applicationAccept.AllocationGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AllocationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"allocationgrid",selector:"allocationgrid",autoCreate:!0,xtype:"allocationgrid"}],init:function(){this.control({allocationgrid:{itemclick:function(o,i){console.log("Hello"),this.showHistoryState(i)}}})},showHistoryState:function(o){var i=o.get("applicationID"),t=this.getAllocationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(i),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:i},method:"POST",scope:this,success:function(i){console.log(i.responseText);var e=Ext.JSON.decode(i.responseText);t.refresh(e,o.get("type"))}})},showTab:function(o,i,t,e,n){var a=this.getCon("mainFrame.Main"),p=a.existInstance(o);if(p)return p;var c=Ext.create(t,{id:o,title:i,applicationID:e,isShow:!0,isAccept:!1,appType:n,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return a.addTab(c),c},show:function(){var o=this.getAllocationgrid(),i=this.getCon("mainFrame.Main");i.addTab(o)},getCon:function(o){var i=this.application;return i.getController(o)},onExportIndoorApplication:function(){var o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportIndoorAppToXlsExcel?isIE="+o},onExportSiteApplication:function(){var o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportSiteAppToXlsExcel?isIE="+o},onImportSiteApplication:function(){var o=this.getCon("applicationAccept.DocumentUploadWin");o.show("/ImportSiteAppExcel")},onImportIndoorApplication:function(){var o=this.getCon("applicationAccept.DocumentUploadWin");o.show("/ImportIndoorAppExcel")}});Ext.define("Soims.model.user.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"department",type:"int",mapping:"Department"},{name:"departmentName",type:"string",mapping:"DepartmentName"},{name:"roleIds",type:"string",mapping:"RoleIds"},{name:"roles",type:"string",mapping:"Roles"}]});Ext.define("Soims.store.user.User",{extend:"Ext.data.Store",model:"Soims.model.user.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.controller.user.User",{extend:"Ext.app.Controller",stores:["user.User"],views:["user.User"],refs:[{ref:"user",selector:"user",autoCreate:!0,xtype:"user"}],init:function(){this.control({"user  button[itemId=add]":{click:function(){var e=this.getCon("user.UserWin");e.show()}},"user  button[itemId=modify]":{click:function(e){var t=this.getCon("user.UserWin"),s=e.up("panel"),i=s.getSelectionModel(),o=i.getSelection()[0];t.getUserwin().down("panel").loadRecord(o)}},"user  button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","您确定要删除此用户么，用户所有信息都将丢失？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"user  button[itemId=manageRole]":{click:function(e){var t=this.getCon("user.RoleWin"),s=e.up("panel"),i=s.getSelectionModel(),o=i.getSelection()[0];t.show(o.get("roleIds"))}},"user  button[itemId=resetPd]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要重置该用户密码么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/ResetPd",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","重置完成！",function(){},this)}})},this)}},"user  button[itemId=frozenUser]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要冻结该用户么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/FrozenUser",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","冻结完成！",function(){},this)}})},this)}},"user  button[itemId=thawUser]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要解冻该用户么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/ThawUser",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","解冻完成！",function(){},this)}})},this)}},"user  button[itemId=refreshTbarUser]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},user:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getUser().down("#modify").setDisabled(!1),this.getUser().down("#delete").setDisabled(""==t[0].get("roleIds")?!1:!1),this.getUser().down("#manageRole").setDisabled(!1),this.getUser().down("#resetPd").setDisabled(!1),this.getUser().down("#frozenUser").setDisabled(!1),this.getUser().down("#thawUser").setDisabled(!1)):(this.getUser().down("#modify").setDisabled(!0),this.getUser().down("#delete").setDisabled(!0),this.getUser().down("#manageRole").setDisabled(!0),this.getUser().down("#resetPd").setDisabled(!0),this.getUser().down("#frozenUser").setDisabled(!0),this.getUser().down("#thawUser").setDisabled(!0))}}})},show:function(){var e=this.getUser(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.Ajax.request({url:Soims.service.users.UserService+"/Delete",method:"POST",scope:this,params:{id:o},success:function(){this.getUserUserStore().reload()}})}});Ext.define("Soims.view.user.User",{extend:"Ext.grid.Panel",alias:"widget.user",title:"用户列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"User",closable:!0,store:"user.User",selType:"rowmodel",initComponent:function(){this.columns=[{header:"用户姓名",dataIndex:"name",flex:.1},{header:"单位",dataIndex:"departmentName",flex:.1},{header:"角色",dataIndex:"roles",flex:.8}],this.tbar=[{text:"添加用户",xtype:"button",iconCls:"Add",itemId:"add",disabled:!1},{text:"修改用户",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"删除用户",xtype:"button",itemId:"delete",iconCls:"Delete",disabled:!0},{text:"角色分配",xtype:"button",iconCls:"GroupEdit",itemId:"manageRole",disabled:!0},{text:"密码重置",xtype:"button",iconCls:"Key",itemId:"resetPd",disabled:!0},{text:"冻结用户",xtype:"button",iconCls:"Cancel",itemId:"frozenUser",disabled:!0},{text:"解冻用户",xtype:"button",iconCls:"ArrowUp",itemId:"thawUser",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarUser",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.store.user.Role",{extend:"Ext.data.Store",model:"Soims.model.user.Role",proxy:{type:"ajax",url:Soims.service.users.RoleService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.user.Role",{extend:"Ext.grid.Panel",alias:"widget.role",title:"角色列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Group",closable:!0,store:"user.Role",selType:"rowmodel",initComponent:function(){this.columns=[{header:"角色",dataIndex:"rolename",flex:1},{header:"角色代码",dataIndex:"code",flex:1}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",itemId:"add",disabled:!1},{text:"权限分配",xtype:"button",itemId:"manageRight",disabled:!0},{text:"查看权限",xtype:"button",itemId:"showRight",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarRole",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.Role",{extend:"Ext.app.Controller",stores:["user.Role"],views:["user.Role"],refs:[{ref:"role",selector:"role",autoCreate:!0,xtype:"role"}],init:function(){this.control({"role  button[itemId=add]":{click:function(){}},"role  button[itemId=manageRight]":{click:function(){}},"role  button[itemId=showRight]":{click:function(){}},"role  button[itemId=refreshTbarRole]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},role:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getRole().down("#manageRight").setDisabled(!1),this.getRole().down("#showRight").setDisabled(!1)):(this.getRole().down("#manageRight").setDisabled(!0),this.getRole().down("#showRight").setDisabled(!0))}}})},show:function(){var e=this.getRole();this.getUserRoleStore().load();var t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)}});Ext.define("Soims.model.user.WaitAuditUser",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"nameSpell",type:"string",mapping:"NameSpell"},{name:"email",type:"string",mapping:"Email"},{name:"department",type:"string",mapping:"Department"},{name:"departmentID",type:"int",mapping:"DepartmentID"},{name:"remark",type:"string",mapping:"Remark"}]});Ext.define("Soims.store.user.WaitAuditUser",{extend:"Ext.data.Store",model:"Soims.model.user.WaitAuditUser",proxy:{type:"ajax",url:Soims.service.users.PersonService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.user.Role",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"rolename",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"}]});Ext.define("Soims.view.user.WaitAuditUser",{extend:"Ext.grid.Panel",alias:"widget.waitAuditUser",title:"待激活的用户列表",iconCls:"User",viewConfig:{emptyText:"没有满足条件的项目"},closable:!0,store:"user.WaitAuditUser",selType:"checkboxmodel",initComponent:function(){this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"单位",dataIndex:"department",flex:1}],this.tbar=[{text:"通过",xtype:"button",iconCls:"Accept",itemId:"pass",disabled:!0},{text:"驳回",xtype:"button",iconCls:"ArrowUndo",itemId:"reject",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarAudit",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.WaitAuditUser",{extend:"Ext.app.Controller",stores:["user.WaitAuditUser"],views:["user.WaitAuditUser"],refs:[{ref:"waitAuditUser",selector:"waitAuditUser",autoCreate:!0,xtype:"waitAuditUser"}],init:function(){this.control({"waitAuditUser  button[itemId=pass]":{click:function(e){this.saveAsUser(e)}},"waitAuditUser  button[itemId=reject]":{click:function(e){this.deleteDataBase(e)}},"waitAuditUser  button[itemId=refreshTbarAudit]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},waitAuditUser:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getWaitAuditUser().down("#pass").setDisabled(!1),this.getWaitAuditUser().down("#reject").setDisabled(!1)):(this.getWaitAuditUser().down("#pass").setDisabled(!0),this.getWaitAuditUser().down("#reject").setDisabled(!0))}}})},show:function(){var e=this.getWaitAuditUser(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),i=t.getSelectionModel(),s=i.getSelection(),r="";Ext.Array.each(s,function(e){e.get("id")&&(r=r+e.get("id")+",")}),Ext.Ajax.request({url:Soims.service.users.PersonService+"/DeletePersonByIds",method:"POST",scope:this,params:{ids:r},success:function(){this.getUserWaitAuditUserStore().reload()}})},saveAsUser:function(e){var t=e.up("panel"),i=t.getSelectionModel(),s=i.getSelection(),r="";Ext.Array.each(s,function(e){e.get("id")&&(r=r+e.get("id")+",")}),Ext.Ajax.request({url:Soims.service.users.UserService+"/SaveAuditUserByIds",method:"POST",scope:this,params:{ids:r},success:function(){this.getUserWaitAuditUserStore().reload()}})}});Ext.define("Soims.model.department.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"address",type:"string",mapping:"Address"},{name:"type",type:"string",mapping:"Type"},{name:"test",type:"string",mapping:"Test"}]});Ext.define("Soims.store.department.Department",{extend:"Ext.data.Store",model:"Soims.model.department.Department",autoLoad:!0,proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Query",reader:{type:"xml",root:"List",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.department.Department",{extend:"Ext.grid.Panel",alias:"widget.department",title:"单位列表",iconCls:"Group",pageSize:10,closable:!0,store:"department.Department",selType:"rowmodel",initComponent:function(){this.columns=[{header:"单位名称",dataIndex:"name",flex:1},{header:"单位地址",dataIndex:"address",flex:1},{header:"单位类型",dataIndex:"type",flex:1}],this.tbar=[{text:"添加",iconCls:"Add",xtype:"button",itemId:"add"},{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarDep",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.department.Department",{extend:"Ext.app.Controller",stores:["department.Department"],views:["department.Department"],refs:[{ref:"department",selector:"department",autoCreate:!0,xtype:"department"}],init:function(){this.control({"department  button[itemId=add]":{click:function(){var e=this.getCon("department.DepartmentWin");e.show()}},"department  button[itemId=modify]":{click:function(e){var t=this.getCon("department.DepartmentWin"),n=e.up("panel"),a=n.getSelectionModel(),i=a.getSelection()[0];t.getDepartmentWin().down("panel").loadRecord(i)}},"department  button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","您确定要删除此单位么？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"department  button[itemId=refreshTbarDep]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},department:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getDepartment().down("#delete").setDisabled(!1),this.getDepartment().down("#modify").setDisabled(!1)):(this.getDepartment().down("#delete").setDisabled(!0),this.getDepartment().down("#modify").setDisabled(!0))}}})},show:function(){var e=this.getDepartment(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),n=t.getSelectionModel(),a=n.getSelection()[0],i=a.get("id");Ext.Ajax.request({url:Soims.service.departments.DepartmentService+"/Delete",method:"POST",scope:this,params:{id:i},success:function(){this.getDepartmentDepartmentStore().reload()}})}});Ext.define("Soims.model.project.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"departmentName",type:"string",mapping:"Department"},{name:"address",type:"string",mapping:"Address"},{name:"cellphone",type:"string",mapping:"Cellphone"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"zipCode",type:"string",mapping:"ZipCode"},{name:"fax",type:"string",mapping:"Fax"}]});Ext.define("Soims.store.project.User",{extend:"Ext.data.Store",model:"Soims.model.project.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.voyage.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"}]});Ext.define("Soims.store.voyage.Department",{extend:"Ext.data.Store",model:"Soims.model.voyage.Department",proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageBasic",{extend:"Ext.form.Panel",alias:"widget.voyagebasic",requires:["Soims.store.project.User","Soims.store.voyage.Department","Ext.ux.form.SearchComboBox"],title:"航次基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User"),t=Ext.create("Soims.store.voyage.Department");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,padding:"10 0 10 10",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"textfield",name:"name",forbidBlankAndShowStar:!0,readOnly:this.isShow,itemId:"name",fieldLabel:"航次名称"},{xtype:"textfield",name:"number",itemId:"number",forbidBlankAndShowStar:!0,regex:1==Soims.component.voyageBasicStartTimeHidden?void 0:/DY(\d*)-\d\d$/,regexText:"请输入正确格式，例如：DY125-05",readOnly:this.isShow,allowBlank:!1,fieldLabel:"航次代码"},{xtype:"searchcombo",name:"chargerId",itemId:"chargerId",showStar:!0,fieldLabel:"航次首席科学家",readOnly:this.isShow,store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationDepartId",readOnly:this.isShow,showStar:!0,itemId:"organizationDepartId",readOnly:this.isShow,fieldLabel:"实施单位",store:t,valueField:"id",displayField:"name"},{xtype:"datefield",name:"beginTime",itemId:"beginTime",forbidBlankAndShowStar:!0,fieldLabel:"开始时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#stopTime");a.setMinValue(t)}}},{xtype:"datefield",name:"stopTime",itemId:"stopTime",forbidBlankAndShowStar:!0,fieldLabel:"结束时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#beginTime");a.setMaxValue(t)}}}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationId",readOnly:this.isShow,showStar:!0,itemId:"organizationId",fieldLabel:"实施单位联系人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},{xtype:"datefield",name:"startTime",itemId:"startTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"开放申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicStartTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),i=e.up("panel").down("#endTime");i.setMinValue(t);for(var o=0;o<a.getCount();o++){var n=a.getAt(o);n.set("startApplyTime",t)}}}},{xtype:"datefield",name:"endTime",itemId:"endTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"结束申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicEndTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").down("#startTime");a.setMaxValue(t);for(var i=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),o=0;o<i.getCount();o++){var n=i.getAt(o);n.set("endApplyTime",t)}}}}]}],this.callParent()}});Ext.define("Soims.model.voyage.Leg",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"voyageId",type:"int",mapping:"VoyageId"},{name:"name",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"sampleAreas",type:"string",mapping:"SampleAreas"},{name:"sampleAreaIds",type:"string",mapping:"SampleAreaIds"},{name:"startTime",type:"date",mapping:"StartTime"},{name:"endTime",type:"date",mapping:"EndTime"},{name:"startApplyTime",type:"date",mapping:"StartApplyTime"},{name:"endApplyTime",type:"date",mapping:"EndApplyTime"}]});Ext.define("Soims.store.voyage.Leg",{extend:"Ext.data.Store",model:"Soims.model.voyage.Leg",proxy:{type:"ajax",url:Soims.service.voyages.LegService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.LegGrid",{extend:"Ext.grid.Panel",alias:"widget.leggrid",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Ext.ux.form.TreeField"],title:"航段列表",viewConfig:{emptyText:"没有满足条件的航段"},height:400,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.Leg"),void 0!==this.voyageId&&this.initStore();var t=Ext.create("Soims.store.tree.SampleAreaAll");this.tree=t,this.store=this.vStore,this.columns=[{header:'<span>航段编号<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段代码<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"code",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段首席科学家<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,a){if(t){var o=e.findRecord("id",t);return null===o?a.get("chargerName"):o.get("name")}}},{header:'<span>采样区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAreaIds",flex:1,editor:{xtype:"treefield",pickerTitle:"航段所在采样区域",disabled:this.isShow,onlyCheckChild:!0,store:t},renderer:function(e,i,a){if(e){var o=e.split(","),d=!0,n="";return Ext.Array.each(o,function(e){if(""!==e){var i=e.split("|"),a=t.getNodeById(i[0]),o=document.getElementById("textBox"+i[0]);a?n=o?n+"["+o.value+"]":n+"["+a.get("text")+"]":d=!1}}),d?n:a.get("sampleAreas")}}},{header:'<span>开始时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"startTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>结束时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"endTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>开放申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"startApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,allowBlank:Soims.component.voyageBasicStartTimeHidden}},{header:'<span>结束申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"endApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,name:"endApplyTime",allowBlank:Soims.component.voyageBasicStartTimeHidden}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarlg",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},reloadTree:function(){this.tree.reload();var e=this.tree.getRootNode();e.eachChild(function(e){e.data.leaf||this.tree.load({node:e})},this)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageLeg",{extend:"Ext.form.Panel",alias:"widget.editvoyageleg",title:"航次航段",buttonAlign:"center",requires:["Soims.view.voyage.VoyageBasic","Soims.view.voyage.LegGrid"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagebasic",voyageId:this.voyageId,isShow:this.isShow},{xtype:"leggrid",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"保存",xtype:"button",hidden:this.isShow,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.model.voyage.VoyageTask",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"voyageTaskLegIds",type:"string",mapping:"VoyageTaskLegIds"},{name:"voyageTaskLegNames",type:"string",mapping:"VoyageTaskLegNames"}]});Ext.define("Soims.store.voyage.VoyageTask",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageTask",proxy:{type:"ajax",url:Soims.service.voyages.VoyageTaskService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.voyage.VoyageTask",{extend:"Ext.grid.Panel",alias:"widget.voyagetask",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Soims.store.voyage.VoyageTask"],viewConfig:{emptyText:"没有满足条件的航次任务"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.legStore=Ext.create("Soims.store.voyage.Leg"),this.vStore=Ext.create("Soims.store.voyage.VoyageTask"),void 0!==this.voyageId&&(this.initStore(),this.vStore.load()),this.store=this.vStore,this.columns=[{header:'<span>任务名称<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>任务负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,o,i){if(t){var a=e.findRecord("id",t);return null===a?i.get("chargerName"):a.get("name")}}},{header:'<span>所在航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"voyageTaskLegNames",flex:1,editor:{xtype:"combo",store:this.legStore,multiSelect:!0,editable:!1,disabled:this.isShow,valueField:"name",allowBlank:!1,displayField:"name"}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarEq",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.legStore.getProxy().setExtraParam("voyageId",this.voyageId),this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var o=e.getEditor(t.record,t.column);o.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageTask",{extend:"Ext.form.Panel",alias:"widget.editvoyagetask",title:"航次任务",buttonAlign:"center",requires:["Soims.view.voyage.VoyageTask"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagetask",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.VoyageReportBasic",{extend:"Ext.form.Panel",alias:"widget.voyagereportbasic",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox"],title:"航次报告基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,margin:"5 5 5 5",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"textfield",name:"name",allowBlank:!1,readOnly:this.isShow,forbidBlankAndShowStar:!0,itemId:"name",fieldLabel:"航次报告名称"}]},{xtype:"panel",border:!1,layout:"form",margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"searchcombo",name:"chargerId",readOnly:this.isShow,showStar:!0,itemId:"chargerId",fieldLabel:"报告牵头负责人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]}],this.callParent()}});Ext.define("Soims.model.voyage.VoyageReportDetail",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"discipline",type:"string",mapping:"Discipline"}]});Ext.define("Soims.store.voyage.VoyageReportDetail",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageReportDetail",proxy:{type:"ajax",url:Soims.service.voyages.VoyageReportDetailService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageReportDetail",{extend:"Ext.grid.Panel",alias:"widget.voyagereportdetail",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.VoyageReportDetail"],viewConfig:{emptyText:"没有满足条件的航次任务"},title:"航次报告分工信息",plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.VoyageReportDetail"),void 0!==this.voyageId&&this.initStore(),this.store=this.vStore,this.columns=[{header:'<span>分工负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,o){if(t){var a=e.findRecord("id",t);return null===a?o.get("chargerName"):a.get("name")}}},{header:'<span>负责学科和调查区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"discipline",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbardl",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageReport",{extend:"Ext.form.Panel",alias:"widget.editvoyagereport",title:"航次报告",buttonAlign:"center",requires:["Soims.view.voyage.VoyageReportBasic","Soims.view.voyage.VoyageReportDetail"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagereportbasic",isShow:this.isShow,voyageId:this.voyageId},{xtype:"voyagereportdetail",isShow:this.isShow,voyageId:this.voyageId}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"完成",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"complete"}],this.callParent()},lock:function(){this.down("#complete").setDisabled(!0),this.down("#save").setDisabled(!0)},unlock:function(){this.down("#complete").setDisabled(!1),this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.BoardPeoplePanel",{extend:"Ext.grid.Panel",alias:"widget.boardpeoplepanel",title:"上船人员列表",viewConfig:{emptyText:"没有满足条件的项目"},closable:!1,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.BoardPeople"),this.voyageId&&this.initStore(),this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"身份证号",dataIndex:"identityNumber",flex:1},{header:"性别",dataIndex:"sex",flex:1},{header:"单位",dataIndex:"userCompany",flex:1},{header:"职务",dataIndex:"position",flex:1},{header:"岗位职责",dataIndex:"duty",flex:1},{header:"出生日期",dataIndex:"birthday",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"地址",dataIndex:"address",flex:1},{header:"联系电话",dataIndex:"tellPhone",flex:1},{header:"移动电话",dataIndex:"cellPhone",flex:1}],this.tbar=[{text:"添加",xtype:"button",hidden:this.isShow,iconCls:"Add",itemId:"add",disabled:void 0==this.voyageId?!0:!1},{text:"修改",xtype:"button",iconCls:"Disk",hidden:this.isShow,itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",hidden:this.isShow,xtype:"button",disabled:!0},{text:"导入单位信息Excel",hidden:this.isShow,itemId:"boardingPeopleDepartment",iconCls:"Disk",xtype:"button"},{text:"导入上船人员名单Excel",hidden:this.isShow,itemId:"boardingPeople",iconCls:"Disk",xtype:"button"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){0!=t.length?this.down("#modify").setDisabled(!1):(this.down("#delete").setDisabled(!0),this.down("#modify").setDisabled(!0))},initStore:function(){this.store.getProxy().setExtraParam("voyageId",this.voyageId)},lock:function(){this.down("#add").setDisabled(!0)},unlock:function(){this.down("#add").setDisabled(!1)}});Ext.define("Soims.view.voyage.EditVoyageTag",{extend:"Ext.tab.Panel",alias:"widget.editvoyagetag",title:"航次任务样品申请",closable:!0,iconCls:"Project",requires:["Soims.view.voyage.EditVoyageLeg","Soims.view.voyage.EditVoyageTask","Soims.view.voyage.EditVoyageReport","Soims.view.voyage.BoardPeoplePanel"],initComponent:function(){this.items=[{xtype:"editvoyageleg",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagetask",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagereport",isShow:this.isShow,voyageId:this.voyageId},{xtype:"boardpeoplepanel",isShow:this.isShow,voyageId:this.voyageId}],this.callParent()}});Ext.define("Soims.controller.voyage.EditVoyageTag",{extend:"Ext.app.Controller",views:["voyage.EditVoyageTag"],refs:[{ref:"editvoyagetag",selector:"editvoyagetag",autoCreate:!0,xtype:"editvoyagetag"}],init:function(){this.getCon("voyage.EditVoyageLeg"),this.getCon("voyage.EditVoyageTask"),this.getCon("voyage.EditVoyageReport"),this.getCon("voyage.BoardPeople"),this.control({})},show:function(){{var e=this.getVoyageEditVoyageTagView(),o=this.getCon("voyage.Voyage");o.showTab("newVoyage","新建航次航段",!1,e,void 0)}},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.view.voyage.Voyage",{extend:"Ext.grid.Panel",alias:"widget.voyage",title:"航次列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Project",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.Voyage"),this.columns=[{header:"航次代码",dataIndex:"name",flex:1},{header:"航次编号",dataIndex:"number",flex:1},{header:"航次首席科学家",dataIndex:"chargerName",flex:1},{header:"航次组织实施单位联系人",dataIndex:"organizationName",flex:1},{header:"航次组织实施单位",dataIndex:"organizationDepartName",flex:1},{header:"开始申请时间",dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1},{header:"结束申请时间",dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1}],this.tbar=[{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"查看",xtype:"button",iconCls:"Information",itemId:"show",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.voyage.Voyage",{extend:"Ext.app.Controller",views:["voyage.Voyage"],refs:[{ref:"voyage",selector:"voyage",autoCreate:!0,xtype:"voyage"}],init:function(){this.control({"voyage  button[itemId=modify]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("EditVoyage"+o.get("id"),o.get("name"),!1,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},"voyage  button[itemId=show]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("ShowVoyage"+o.get("id"),o.get("name"),!0,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},voyage:{selectionchange:function(e,o){0!=o.length?(this.getVoyage().down("#modify").setDisabled(!1),this.getVoyage().down("#show").setDisabled(!1)):(this.getVoyage().down("#modify").setDisabled(!0),this.getVoyage().down("#show").setDisabled(!0))}}})},showTab:function(e,o,t,a,g){var i=this.getCon("mainFrame.Main"),n=i.existInstance(e);if(n)return n;var d=Ext.create(a,{id:e,title:o,isShow:t,voyageId:g});return i.addTab(d),d},show:function(){var e=this.getVoyage(),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.model.notification.NotificationList",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"sender",type:"string",mapping:"Sender"},{name:"senderID",type:"int",mapping:"SenderID"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"},{name:"state",type:"string",mapping:"State"}]});Ext.define("Soims.store.notification.NotificationList",{extend:"Ext.data.Store",model:"Soims.model.notification.NotificationList",autoLoad:!0,pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetNotifications",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.model.notification.Notification",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"}]});Ext.define("Soims.store.notification.Notification",{extend:"Ext.data.Store",model:"Soims.model.notification.Notification",pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetAvailable",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total",id:"ID"}},autoLoad:!0});Ext.define("Soims.view.notification.ShowNotificationBasic",{extend:"Ext.form.Panel",alias:"widget.shownotificationbasic",autoShow:!0,initComponent:function(){this.items=[{xtype:"htmleditor",width:590,height:50,name:"title",itemId:"title",readOnly:!0,hidden:!1},{xtype:"htmleditor",height:525,width:590,name:"content",itemId:"content",readOnly:!0,hidden:!1}],this.callParent()}});Ext.define("Soims.view.notification.ShowNotification",{extend:"Ext.window.Window",alias:"widget.shownotification",closable:!0,iconCls:"  ",requires:["Soims.view.notification.ShowNotificationBasic"],width:600,height:500,autoShow:!0,initComponent:function(){this.items=[{xtype:"shownotificationbasic",isShow:this.isShow}],this.buttons=[{text:"确定",xtype:"button",itemId:"Ok",action:"Ok"}],this.callParent()}});Ext.define("Soims.view.notification.NotificationList",{extend:"Ext.grid.Panel",alias:"widget.notificationlist",title:"公告",iconCls:"Notification",closable:!0,store:"notification.NotificationList",selType:"rowmodel",initComponent:function(){this.columns=[{header:"标题",dataIndex:"title",flex:1},{header:"发信人",dataIndex:"sender",flex:1},{header:"发送时间",dataIndex:"dateTime",flex:1},{header:"状态",dataIndex:"state",flex:1}],this.tbar=[{text:"发布公告",xtype:"button",action:"sendNotification",name:"sendNotification",itemId:"sendNotification",iconCls:"NotificationSend"},{text:"查看",xtype:"button",action:"checkNotification",name:"checkNotification",itemId:"checkNotification",iconCls:"NotificationCheck",hidden:!0},{text:"删除",name:"deleteNotification",action:"deleteNotification",itemId:"deleteNotification",iconCls:"NotificationDelete",xtype:"button",hidden:!0},{text:"置顶",name:"top",action:"top",itemId:"top",xtype:"button",iconCls:"NotificationTop",hidden:!0},{text:"取消置顶",name:"cancelTop",action:"cancelTop",itemId:"cancelTop",xtype:"button",iconCls:"NotificationCancel",hidden:!0},{text:"过期",name:"overdue",action:"overdue",itemId:"overdue",xtype:"button",iconCls:"NotificationOverdue",hidden:!0},{text:"取消过期",name:"cancelOverdue",action:"cancelOverdue",itemId:"cancelOverdue",iconCls:"NotificationCancelOverdue",xtype:"button",hidden:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.notification.ShowNotification",{extend:"Ext.app.Controller",stores:["notification.Notification"],views:["notification.ShowNotification"],refs:[{ref:"shownotification",selector:"shownotification",autoCreate:!0,xtype:"shownotification"}],init:function(){this.control({"shownotification  button[itemId=Ok]":{click:function(o){o.up("window").close()}}})},getCon:function(o){var i=this.application;return i.getController(o)},showWindow:function(){var o=this.getShownotification();return o}});Ext.define("Soims.view.application.ApplicationPanel",{extend:"Ext.form.Panel",alias:"widget.applicationpanel",iconCls:"ApplicationSideList",closable:!0,initComponent:function(){this.items=[{xtype:"applicationhistorypanel"},{xtype:this.grid}],this.title=this.title,this.callParent()}});Ext.define("Soims.controller.notification.NotificationList",{extend:"Ext.app.Controller",stores:["notification.NotificationList"],views:["notification.NotificationList"],refs:[{ref:"notificationlist",selector:"notificationlist",autoCreate:!0,xtype:"notificationlist"}],init:function(){this.control({"notificationlist  button[itemId=sendNotification]":{click:function(){var t=this.getCon("notification.SendNotification");t.showWindow()}},"notificationlist  button[itemId=checkNotification]":{click:function(t){var i=this.getCon("notification.ShowNotification"),e=t.up("panel"),o=e.getSelectionModel(),n=o.getSelection()[0];i.getShownotification().down("#title").getToolbar().hide(),i.getShownotification().down("#content").getToolbar().hide();var s=this.application;s.getController("notification.ShowNotification").showWindow();s.getController("notification.ShowNotification").showWindow();i.getShownotification().down("panel").loadRecord(n)}},"notificationlist  button[itemId=deleteNotification]":{click:function(t){Ext.Tools.Confirm("确认","您确定要删除该条目？",function(i){"yes"==i&&this.deleteDataBase(t)},this)}},"notificationlist  button[itemId=top]":{click:function(t){this.top(t)}},"notificationlist  button[itemId=cancelTop]":{click:function(t){this.cancelTop(t)}},"notificationlist  button[itemId=overdue]":{click:function(t){this.overdue(t)}},"notificationlist  button[itemId=cancelOverdue]":{click:function(t){this.cancelOverdue(t)}},"notificationlist  button[itemId=refreshTbar]":{click:function(t){t.up("panel").getStore().reload(),t.up("panel").getSelectionModel().deselectAll()}},notificationlist:{itemdblclick:function(){},selectionchange:function(t,i){0!=i.length?"置顶"==i[0].get("state")?(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!0),this.getNotificationlist().down("#overdue").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1)):"普通"==i[0].get("state")?(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!0),this.getNotificationlist().down("#overdue").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1)):"过期"==i[0].get("state")&&(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!0),this.getNotificationlist().down("#cancelOverdue").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#overdue").setVisible(!1)):(this.getNotificationlist().down("#checkNotification").setVisible(!1),this.getNotificationlist().down("#deleteNotification").setVisible(!1),this.getNotificationlist().down("#top").setVisible(!1),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#overdue").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1))}}})},getCon:function(t){var i=this.application;return i.getController(t)},showNotificationList:function(){var t=this.getNotificationlist(),i=this.getCon("mainFrame.Main");i.addTab(t)},top:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Top",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},cancelTop:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/CancelTop",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},overdue:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Overdue",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},cancelOverdue:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/CancelOverdue",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},deleteDataBase:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Delete",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})}});Ext.define("Soims.view.application.ApplicationHistoryPanel",{itemId:"applicationApplicationHistoryPanel",extend:"Ext.form.Panel",alias:"widget.applicationhistorypanel",title:"申请历史流程",padding:2,bodyStyle:"background-color:#dfe8f5;",height:115,autoShow:!0,bodyPadding:"15 0 0 0",initComponent:function(){this.items={xtype:"label"},this.on("afterrender",this.showDefaultHistoryState),this.callParent()},refresh:function(t,i){switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:this.showB1(t);break;case Soims.model.application.common.SampleApplicationType.B2.value:this.showB2(t);break;case Soims.model.application.common.SampleApplicationType.V1.value:this.showV1(t);break;case Soims.model.application.common.SampleApplicationType.V2.value:this.showV2(t);break;case Soims.model.application.common.SampleApplicationType.V3.value:this.showV3(t);break;case Soims.model.application.common.SampleApplicationType.V4.value:this.showV4(t)}},showB1:function(t){var i=void 0==t.VODCSubmit?"Application/common/resources/images/appState/a_0.png":t.VODCSubmit.url,e=void 0==t.VODCSubmit?"":t.VODCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>航次组织实施单位审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showB2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showV1:function(t){var i=void 0==t.VRCSubmit?"Application/common/resources/images/appState/a_0.png":t.VRCSubmit.url,e=void 0==t.VRCSubmit?"":t.VRCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>任务牵头负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV3:function(t){var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showV4:function(t){console.log(t);var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showBeginHtml:function(t){var i=void 0==t.UnSubmit?"Application/common/resources/images/appState/a_1.png":t.UnSubmit.url,e=void 0==t.UnSubmit?"":t.UnSubmit.tip,o=void 0==t.Submit?"Application/common/resources/images/appState/a_2.png":t.Submit.url,a=void 0==t.Submit?"":t.Submit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>新建申请</div>';return l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>提交</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>'},showEndHtml:function(t){var i=void 0==t.AdminAccept?"Application/common/resources/images/appState/a_3.png":t.AdminAccept.url,e=void 0==t.AdminAccept?"":t.AdminAccept.tip,o=void 0==t.AdminAllot?"Application/common/resources/images/appState/a_4.png":t.AdminAllot.url,a=void 0==t.AdminAllot?"":t.AdminAllot.tip,l=void 0==t.SMESubmit?"Application/common/resources/images/appState/a_5.png":t.SMESubmit.url,n=void 0==t.SMESubmit?"":t.SMESubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,s='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>申请受理</div>';return s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>分配方案编制</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+n+'" src="'+l+'" height="24" width="24"><br>申请审议</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+p+'" src="'+m+'" height="24" width="24"><br>申请审批</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s+='<div style="text-align:center; width: 80px; float:left;"><img title="" src= "Application/common/resources/images/appState/a_7.png" " height="24" width="24"><br>样品清点与出库</div>'},showDefaultHistoryState:function(){var t={},i='<div style="text-align:center; width: 80px; float:left;"><img title="" src="Application/common/resources/images/appState/a_0.png" height="24" width="24"><br>申请审核</div>';i+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var e=this.showBeginHtml(t)+i+this.showEndHtml(t);this.down("label").setText(e,!1)}});Ext.define("Soims.model.application.common.SampleApplicationType",{statics:{B1:{value:"B1",name:"b1申请书"},B2:{value:"B2",name:"b2申请书"},V1:{value:"V1",name:"v1申请书"},V2:{value:"V2",name:"v2申请书"},V3:{value:"V3",name:"v3申请书"},V4:{value:"V4",name:"v4申请书"}}});Ext.define("Soims.controller.application.ApplicationPanel",{extend:"Ext.app.Controller",views:["application.ApplicationPanel"],refs:[{ref:"applicationpanel",selector:"applicationpanel",autoCreate:!0,xtype:"applicationpanel"}],init:function(){this.control({applicationpanel:{resize:function(i,t,a){var n=i.down("grid");n.setHeight(a-120)}}})},showTab:function(i,t,a,n,e,o){var p=this.getCon("mainFrame.Main"),l=p.existInstance(i);if(l)return l;var r=Ext.create(a,{id:i,title:t,application:this.application,applicationID:n,isShow:e,isEdit:o});return p.addTab(r),r},show:function(i,t){this.getCon(i),this.getController("application.ApplicationHistoryPanel");var a=i.split(".")[1].toLowerCase(),n=this.getView("application.ApplicationPanel"),e=Ext.create(n,{id:a,grid:a,title:t}),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.controller.application.ApplicationHistoryPanel",{extend:"Ext.app.Controller",views:["application.ApplicationHistoryPanel"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationhistorypanel",selector:"applicationhistorypanel",autoCreate:!0,xtype:"applicationhistorypanel"}],init:function(){this.control({})},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.model.application.common.ApplicationState",{statics:{Unknown:{value:"Unknown",name:"未知类型"},Cancel:{value:"Cancel",name:"已撤回"},Deleted:{value:"Deleted",name:"已删除"},UnSubmit:{value:"UnSubmit",name:"未提交"},Submit:{value:"Submit",name:"已提交"},VODCAudit:{value:"VODCAudit",name:"航次组织实施单位审核"},VODCSubmit:{value:"VODCSubmit",name:"组织实施单位已审核"},LSAudit:{value:"LSAudit",name:"航段首席科学家审核"},LSSubmit:{value:"LSSubmit",name:"航段首席科学家已审核"},VSAudit:{value:"VSAudit",name:"航次首席科学家审核"},VSSubmit:{value:"VSSubmit",name:"航次首席科学家已审核"},PCAudit:{value:"PCAudit",name:"项目负责人审核"},PCSubmit:{value:"PCSubmit",name:"项目负责人已审核"},VRCAudit:{value:"VRCAudit",name:"航次报告牵头负责人审核"},VRCSubmit:{value:"VRCSubmit",name:"航次报告牵头负责人已审核"},AdminAccept:{value:"AdminAccept",name:"大洋馆受理"},AdminAllot:{value:"AdminAllot",name:"大洋馆已分配"},AdminReject:{value:"AdminReject",name:"大洋馆驳回"},AdminDeny:{value:"AdminDeny",name:"大洋馆否决"},SMEAudit:{value:"SMEAudit",name:"样品管理专家委员会审议"},SMESubmit:{value:"SMESubmit",name:"样品管理专家委员会已审议"},OIAudit:{value:"OIAudit",name:"大洋协会联系人审批"},OISubmit:{value:"OISubmit",name:"大洋协会联系人已审批"},OIReject:{value:"OIReject",name:"大洋协会联系人驳回"}}});Ext.define("Soims.model.application.Application",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"name",mapping:"Name"},{name:"discussionTime",mapping:"DiscussionTime"},{name:"approvalTime",mapping:"ApprovalTime"},{name:"applicantID",mapping:"ApplicantID"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"chargerID",mapping:"ChargerID"},{name:"leg",mapping:"Leg"},{name:"voyage",mapping:"Voyage"},{name:"legID",mapping:"LegID"},{name:"type",mapping:"Type"},{name:"taskName",mapping:"TaskName"},{name:"topicID",mapping:"TopicID"},{name:"bearVoyageTaskID",mapping:"BearVoyageTaskID"},{name:"voyageReportID",mapping:"VoyageReportID"},{name:"noOceanTopicID",mapping:"NoOceanTopicID"},{name:"activityID",mapping:"ActivityID"},{name:"activityStartTime",mapping:"ActivityStartTime"},{name:"activityEndTime",mapping:"ActivityEndTime"},{name:"usingNecessity",mapping:"UsingNecessity"},{name:"repatriaionNecessity",mapping:"RepatriaionNecessity"},{name:"commitResultTime",mapping:"CommitResultTime"},{name:"commitResultForm",mapping:"CommitResultForm"},{name:"commitResultAmount",mapping:"CommitResultAmount"},{name:"applyTime",mapping:"ApplyTime"},{name:"createTime",mapping:"CreateTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.store.applicationAccept.AcceptApplication",{extend:"Ext.data.Store",model:"Soims.model.application.Application",autoLoad:!1,proxy:{type:"ajax",url:Soims.service.applications.ApplicationsService+"/QueryAcceptByUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.applicationAccept.AcceptApplicationGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.application.common.ApplicationState","Soims.store.applicationAccept.AcceptApplication"],alias:"widget.acceptapplicationgrid",title:"待受理申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AcceptApplication"),this.store.load(),this.columns=[{header:"申请书编号",dataIndex:"applicationNumber",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"申请书状态",dataIndex:"state",flex:1,renderer:function(e){return Soims.model.application.common.ApplicationState[e].name}},{header:"提交日期",dataIndex:"applyTime",flex:1}],this.tbar=[{text:"受理",xtype:"button",action:"accept",name:"accept",itemId:"accept",disabled:!0,iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.model.application.SamplePanelType",{statics:{AuditShow:{value:"AuditShow",name:"显示审核意见"},AuditEdit:{value:"AuditEdit",name:"编辑审核意见"},AllocationIndoorShow:{value:"AllocationIndoorShow",name:"显示到入馆分配建议"},AllocationIndoorEdit:{value:"AllocationIndoorEdit",name:"编辑入馆分配建议"},AllocationOutdoorShow:{value:"AllocationOutdoorShow",name:"显示到现场分配建议"},AllocationOutdoorEdit:{value:"AllocationOutdoorEdit",name:"编辑现场分配建议"},DiscussionIndoorShow:{value:"DiscussionIndoorShow",name:"显示到入馆审议意见"},DiscussionIndoorEdit:{value:"DiscussionIndoorEdit",name:"编辑入馆审议意见"},DiscussionOutShow:{value:"DiscussionOutShow",name:"显示到现场审议意见"},DiscussionOutEdit:{value:"DiscussionOutEdit",name:"编辑现场审议意见"},getByAppType:function(o,i,t){var n,s=/^b[12]$/gi;return n=s.test(o)?t?i?this.DiscussionOutEdit.value:this.DiscussionOutShow.value:i?this.AllocationOutdoorEdit.value:this.AllocationOutdoorShow.value:t?i?this.DiscussionIndoorEdit.value:this.DiscussionIndoorShow.value:i?this.AllocationIndoorEdit.value:this.AllocationIndoorShow.value}}});Ext.define("Soims.view.application.common.B1BasicInfoPanel",{itemId:"applicationCommonB1BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.b1basicinfopanel",title:"航次任务基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=this,a=Ext.create("Soims.store.voyage.VoyageByTime"),t=Ext.create("Soims.store.project.User"),l=Ext.create("Soims.store.application.new.VoyageTask"),i=Ext.create("Soims.store.application.common.VoyageTaskLeg");this.items=[{xtype:"fieldset",title:"航次任务信息",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300},items:[{xtype:"combobox",itemId:"voyage",name:"voyage",fieldLabel:"航次",store:a,forbidBlankAndShowStar:!0,queryMode:"local",displayField:"name",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1,listeners:{select:function(e){this.voyage=e.getValue(),l.getProxy().setExtraParam("voyageID",this.voyage),i.getProxy().setExtraParam("voyageID",this.voyage),e.up("b1basicinfopanel").down("#legs").clearValue(),e.up("b1basicinfopanel").down("#voyageTask").clearValue()}}},{fieldLabel:"航次任务名称",xtype:"combobox",itemId:"voyageTask",name:"voyageTask",forbidBlankAndShowStar:!0,store:l,displayField:"name",valueField:"id",readOnly:1==this.isShow?!0:!1,listeners:{expand:function(){e.expendVoyageTask()},select:function(e,a){e.up("b1basicinfopanel").down("#legs").setValue(a[0].get("legs"))}}}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300},items:[{fieldLabel:"负责人姓名",itemId:"chargerName",xtype:"searchcombo",name:"chargerID",store:t,readOnly:this.isShow,valueField:"id",forbidBlankAndShowStar:!0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>"),listeners:{select:function(e,a){this.userID=e.getValue(),l.getProxy().setExtraParam("userID",this.userID),e.up("b1basicinfopanel").down("#legs").clearValue(),e.up("b1basicinfopanel").down("#voyageTask").clearValue(),e.up("b1basicinfopanel").loadRecord(a[0])}}},{fieldLabel:"航次任务所在航段",itemId:"legs",xtype:"combobox",name:"legs",forbidBlankAndShowStar:!0,multiSelect:!0,store:i,displayField:"name",queryMode:"local",valueField:"name",readOnly:1==this.isShow?!0:!1,editable:!1,listeners:{expand:function(){e.expendLegs()}}}]}]},{xtype:"fieldset",title:"负责人详细信息",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"}]}]}],this.callParent()},expendVoyageTask:function(){var e=this.down("#voyageTask").getStore();e.load()},expendLegs:function(){var e=this.down("#legs").getStore();e.load()}});Ext.define("Soims.view.application.new.B1BasicInfo",{itemId:"applicationNewB1BasicInfo",extend:"Ext.form.Panel",alias:"widget.b1basicinfo",title:"申请基本信息",requires:["Soims.view.application.common.B1BasicInfoPanel"],padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b1basicinfopanel",applicationID:this.applicationID,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleGrid",{extend:"Ext.grid.Panel",alias:"widget.samplegrid",title:"样品列表",viewConfig:{emptyText:"没有满足条件的拟申请样品"},minHeight:200,padding:"2 2 2 2",selModel:{mode:"MULTI"},hidden:1==this.isShow,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.application.common.Sample"),("V1"==this.type||"B1"==this.type||"B2"==this.type)&&(this.features=[{ftype:"grouping"}]),this.leg="",this.legID="",this.deleteid="",this.columns=[{xtype:"rownumberer"},{text:"样品类型",locked:!0,width:150,sortable:!1,dataIndex:"sampleType"},{text:"所在航段",locked:!0,width:100,sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"使用目的",lockable:!1,width:100,sortable:!0,dataIndex:"usePurpose"},{text:"涉及学科",width:100,sortable:!1,dataIndex:"involvedSubject"},{text:"岩心分取方案",width:200,sortable:!0,dataIndex:"samplingMethod"},{text:"制样方案",width:100,sortable:!0,dataIndex:"samplePreparation"},{text:"分析测试项目、指标",width:230,sortable:!0,dataIndex:"anlyseTestProject"},{text:"采样区域",width:220,sortable:!0,dataIndex:"samplingArea"},{text:"站位数",width:100,sortable:!0,dataIndex:"stationDigit"},{text:"各站样品数",width:100,sortable:!0,dataIndex:"stationSampleNumber"},{text:"总样品件数",width:100,sortable:!0,dataIndex:"sampleTotalNumber"},{text:"单件样品量",width:100,sortable:!0,dataIndex:"oneSampleAmount"},{text:"其它",width:100,sortable:!0,dataIndex:"otherRequirements"}],this.tbar={hidden:this.isShow,items:[{text:"添加样品",xtype:"button",itemId:"sampleAdd",iconCls:"Add"},{text:"修改",itemId:"sampleModify",disabled:!0,xtype:"button",iconCls:"Disk"},{text:"删除",itemId:"sampleDelete",disabled:!0,xtype:"button",iconCls:"Delete"},{text:"样品克隆",itemId:"sampleClone",xtype:"button",disabled:!0,iconCls:"Add",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"(复制选中样品到指定航段)",xtype:"label",style:"font-size:12px;color:#FF0000",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"整航段样品克隆",itemId:"sampleLegClone",xtype:"button",disabled:!1,iconCls:"Add",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1}]},this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(t,e){e.length>0?(this.down("#sampleClone").setDisabled(!1),this.down("#sampleDelete").setDisabled(!1),this.down("#sampleModify").setDisabled(!1),e.length>1&&(this.down("#sampleModify").setDisabled(!0),this.down("#sampleDelete").setDisabled(!1),this.down("#sampleClone").setDisabled(!1))):(this.down("#sampleClone").setDisabled(!0),this.down("#sampleModify").setDisabled(!0),this.down("#sampleDelete").setDisabled(!0))}});Ext.define("Soims.view.application.common.SampleGridShow",{extend:"Ext.grid.Panel",alias:"widget.samplegridshow",requires:["Ext.ux.grid.AssociationRowExpander","Soims.model.applicationDiscussion.DiscussType","Soims.model.applicationAuditing.ContentType","Soims.model.applicationAuditing.AuditType","Soims.model.application.SamplePanelType"],viewConfig:{emptyText:"没有满足条件的拟申请样品"},minHeight:200,padding:"2 2 2 2",selType:"rowmodel",plugins:[{ptype:"associationrowexpander",pluginId:"sampleGridExpander",selectRowOnExpand:!0,rowBodyTpl:new Ext.XTemplate('<tpl for=".">','<table width="700"  style="margin-left:30px;line-height:20px" frame=below>','<tr><td width="300"><b>样品类型:&nbsp;&nbsp;</b>{data.sampleType}</td><td><b>所在航段:&nbsp;&nbsp;</b>{data.leg}</td></tr>',"</table><br>",'<table width="700"  style="margin-left:30px;line-height:20px" frame=below>',"<tr><td><b>使用目的:&nbsp;&nbsp;</b>{data.usePurpose}</td></tr>","<tr><td><b>涉及学科:&nbsp;&nbsp;</b>{data.involvedSubject}</td></tr>","<tr><td><b>岩心分取方案:&nbsp;&nbsp;</b>{data.samplingMethod}</td></tr>","<tr><td><b>制样方案:&nbsp;&nbsp;</b>{data.samplePreparation}</td></tr>","<tr><td><b>分析测试项目、指标:&nbsp;&nbsp;</b>{data.sampleType}</td></tr>","</table><br>",'<table width="700"   style="padding-left:30px;line-height:20px">',"<tr><td><b>采样区域:&nbsp;&nbsp;</b>{data.samplingArea}</td></tr>",'<tr><td width="300"><b>站位数:&nbsp;&nbsp;</b>{data.stationDigit}</td><td><b>各站样品数:&nbsp;&nbsp;</b>{data.stationSampleNumber}</td></tr>','<tr><td width="300"><b>总样品件数:&nbsp;&nbsp;</b>{data.sampleTotalNumber}</td><td><b>单件样品量:&nbsp;&nbsp;</b>{data.oneSampleAmount}</td></tr>',"<tr><td><b>其它:&nbsp;&nbsp;</b>{data.otherRequirements}</td></tr>","</table><br>",'<div id="dataTest{data.id}" style="padding-left:30px;line-height:20px"><b>拟提交测试数据</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>分析测试指标</th><th>拟提交测试数据</th><th>拟提交时间</th></tr>",'<tpl for="AnlysesStore">',"<tr><td><span >{data.anlyseTestProject}</span></td><td>{data.intendCommitTestData}</td><td>{data.commitTestDataTime}</td></tr>","</tpl>","</table><br>",'<div id="auditList{data.id}" style="padding-left:30px;line-height:20px"><b>审核记录</b></div>','<tpl for="getSampleAuditsStore">','<tpl if="this.colorChange(data.auditerID,data.auditType)">','<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","<tpl else>",'<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.AuditButtonShow()">','<p style="text-align: center;"><button  id="sampleagree{data.id}">同意</button>   <button  id="sampleunagree{data.id}">拟同意</button>   <button  id="sampledisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>",'<tpl if="this.AllocationIndoorEdit()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700" id="allocationTb{data.id}"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">','<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td><b><textarea id="allocationTd{data.id}" type="text" style="height:100%;width:100%;resize:none">{data.oiSuggestion}</textarea></b></td><td></td></tr>',"</tpl>","</table><br>",'<p style="text-align: center;"><button  id="saveAllocation{data.id}">保存</button></p>',"</tpl>",'<tpl if="this.AllocationOutdoorEdit()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700" id="allocationTb{data.id}"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>取用次序</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">','<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.useOrder}</td><td><b><textarea id="allocationTd{data.id}" type="text" style="height:100%;width:100%;resize:none">{data.oiSuggestion}</textarea></b></td><td></td></tr>',"</tpl>","</table><br>",'<p style="text-align: center;"><button  id="saveAllocation{data.id}">保存</button></p>',"</tpl>",'<tpl if="this.AllocationOutdoorShow()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>取用次序</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">',"<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.useOrder}</td><td>{data.oiSuggestion}</td><td></td></tr>","</tpl>","</table><br>","</tpl>",'<tpl if="this.AllocationIndoorShow()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">',"<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.oiSuggestion}</td><td></td></tr>","</tpl>","</table><br>","</tpl>",'<tpl if="this.DiscussionsShow()">','<div id="discussionList{data.id}" style="padding-left:30px;line-height:20px"><b>审议记录</b></div>','<tpl for="DiscussionsStore">','<tpl if="this.colorChange(data.auditerID)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.discussType}" sampleID="{[values.getSample().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.discussType}" sampleID="{[values.getSample().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.DiscussionButtonsShow()">','<p style="text-align: center;"><button  id="dicussionagree{data.id}">同意</button>   <button  id="dicussionunagree{data.id}">拟同意</button>   <button  id="dicussiondisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>","</tpl>","</tpl>",{colorChange:function(t,e){var a=Soims.currentUser.id,i=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode);return t==a&&e==i.value?!1:!0},formatChange:function(t){var e=Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,a=Soims.model.applicationAuditing.AuditType.LegChargerAudit.value;return t==e||t==a?!0:!1},AllocationIndoorEdit:function(){return this.tplParam==Soims.model.application.SamplePanelType.AllocationIndoorEdit.value?!0:!1},AllocationOutdoorEdit:function(){return this.tplParam==Soims.model.application.SamplePanelType.AllocationOutdoorEdit.value?!0:!1},AllocationOutdoorShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutShow.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value||this.tplParam==Soims.model.application.SamplePanelType.AllocationOutdoorShow.value?!0:!1},AllocationIndoorShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorShow.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.AllocationIndoorShow.value?!0:!1},AuditButtonShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!0:!1},DiscussionsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditShow.value||this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!1:!0},DiscussionButtonsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value?!0:!1}})}],initComponent:function(){this.getPlugin("sampleGridExpander").setXTemplateParams(this.panelType),this.store=Ext.create("Soims.store.application.common.Sample"),this.leg="",this.legID="",this.deleteid="",this.title=this.isAudit?'<span>样品列表</span><span style="font-size:12px;color:#FF0000">[请逐条样品进行审核]</span>':"样品列表",this.columns=[{xtype:"rownumberer"},{text:"样品类型",width:100,sortable:!1,dataIndex:"sampleType"},{text:"所在航段",width:100,sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"使用目的",width:150,sortable:!0,dataIndex:"usePurpose"},{text:"分析测试项目、指标",width:290,sortable:!0,dataIndex:"anlyseTestProject"},{text:"采样区域",width:220,sortable:!0,dataIndex:"samplingArea"}],this.on("selectionchange",this.selectionChange),this.callParent()},selectionChange:function(t,e){var a=Ext.get("sampleagree"+e[0].get("id")),i=Ext.get("sampleunagree"+e[0].get("id")),n=Ext.get("sampledisagree"+e[0].get("id")),s=Ext.get("dicussionagree"+e[0].get("id")),p=Ext.get("dicussionunagree"+e[0].get("id")),d=Ext.get("dicussiondisagree"+e[0].get("id")),o=Ext.get("saveAllocation"+e[0].get("id")),l=this;void 0!=a&&(a.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Agree,e[0].get("id"))}),i.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Doubt,e[0].get("id"))}),n.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Reject,e[0].get("id"))})),void 0!=s&&(s.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Agree,e[0].get("id"))}),p.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Doubt,e[0].get("id"))}),d.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Reject,e[0].get("id"))})),void 0!=o&&o.on("click",function(){var t=arguments[1].id.toString().replace(/saveAllocation/gi,"");l.onSaveClick(t)})},onAuditClick:function(t,e,a){var i=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),a=t.get("id");Ext.Ajax.request({url:Soims.service.ApplicationAuditings.SampleAuditService+"/Auditing",params:{ContentType:e.value,AuditType:i.value,SampleID:a},scope:this,success:function(){Ext.Tools.Msg("审核完成",0),this.auditRowBodyChange(e,a)}})},onDiscussClick:function(t,e,a){var a=t.get("id"),i=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode);Ext.Ajax.request({url:Soims.service.discussion.SampleDiscussionService+"/Discussing",params:{ContentType:e.value,DiscussType:i.value,SampleID:a},scope:this,success:function(){Ext.Tools.Msg("审议完成",0),this.discussRowBodyChange(e,a)}})},onSaveClick:function(t){var e,a=document.getElementById("allocationTb"+t).getElementsByTagName("textarea")[0];void 0!=a&&(e=a.id.toString().replace(/allocationTd/gi,""),Ext.Ajax.request({url:Soims.service.samples.SampleAllocationService+"/Save",params:{id:e,suggestion:a.value},scope:this,success:function(){Ext.Tools.Msg("修改完成",0)}}))},auditRowBodyChange:function(t,e){var a=this,i=(a.getView().el,Soims.currentUser.id),n=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),s="span[auditor='"+i+"'][auditType="+n.value+"][sampleID="+e+"]",p=Ext.query(s),d=this.getAuditInfo();if(void 0==p[0]){var o=new Date,l=Ext.get("auditList"+e),r="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+i+"' auditType='"+n.value+"' sampleID='"+e+"'>"+d+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+t.name+"</span><br/>";Ext.DomHelper.insertAfter(l,r)}else{var o=new Date,u=Ext.get(p[0]),c=d+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+t.name;Ext.DomHelper.overwrite(u,c),Ext.DomHelper.applyStyles(u,"color:red;")}a.getView().refreshSize()},getAuditInfo:function(){var t=Soims.currentUser.currentRoleCode,e=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode).name+"&nbsp;&nbsp;&nbsp;&nbsp;";return e+="VS"==t||"LS"==t?Soims.currentUser.name:Soims.currentUser.department},discussRowBodyChange:function(t,e){var a=this,i=(a.getView().el,Soims.currentUser.id),n=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode),s="span[auditor='"+i+"'][auditType="+n.value+"][sampleID="+e+"]",p=Ext.query(s);if(void 0==p[0]){var d=new Date,o=Ext.get("discussionList"+e),l="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+i+"' auditType='"+n.value+"' sampleID='"+e+"'>"+n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+t.name+"</span><br/>";Ext.DomHelper.insertAfter(o,l)}else{var d=new Date,r=Ext.get(p[0]),u=n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+t.name;Ext.DomHelper.overwrite(r,u),Ext.DomHelper.applyStyles(r,"color:red;")}a.getView().refreshSize()}});Ext.define("Soims.view.application.common.SampleInfo",{itemId:"applicationCommonSampleInfo",extend:"Ext.form.Panel",alias:"widget.sampleinfo",padding:2,title:"拟申请样品信息",AutoScroll:!0,overflowY:"auto",autoShow:!0,autoHeight:!0,requires:["Soims.view.application.Common.SampleGrid","Soims.view.application.Common.SampleGridShow"],initComponent:function(){this.items=this.isShow?[{xtype:"samplegridshow",applicationID:this.applicationID,isShow:this.isShow,panelType:this.panelType,type:this.type}]:[{xtype:"samplegrid",applicationID:this.applicationID,isShow:this.isShow,isAudit:this.isAudit,type:this.type},{xtype:"testdatainfo",applicationID:this.applicationID,isShow:this.isShow,isAudit:this.isAudit,type:this.type}],this.callParent()}});Ext.define("Soims.view.application.common.BoardingUserGrid",{itemId:"applicationCommonBoardingUserGrid",extend:"Ext.grid.Panel",alias:"widget.boardinguser",requires:["Ext.ux.form.SearchComboBox"],title:"样品现场使用人",selType:"rowmodel",emptyText:"没有满足条件的人员",height:200,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){var e=this;console.log(this.applicationID),this.store=Ext.create("Soims.store.application.common.SampleSiteUser"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.application.common.BoardingUser"),a=Ext.create("Soims.store.application.common.SampleLeg");this.columns=[{xtype:"rownumberer"},{header:"ID",dataIndex:"id",hidden:!0},{header:'<span>姓名<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:1==this.isShow?null:{itemId:"boardingUserName",xtype:"searchcombo",store:t,valueField:"name",forbidBlankAndShowStar:!0,allowBlank:!1,enableKeyEvents:!0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {department}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>"),listeners:{keyup:function(t){e.searchBoardingUserName(t)}}}},{header:"所在单位",dataIndex:"department",flex:1},{header:"手机",dataIndex:"cellphone",flex:1},{header:"联系电话",dataIndex:"telphone",flex:1},{header:'<span>拟参加航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"legs",flex:1,editor:{xtype:"combobox",itemId:"legs",forbidBlankAndShowStar:!0,multiSelect:!0,store:a,displayField:"leg",queryMode:"local",valueField:"leg",disabled:1==this.isShow?!0:!1,editable:!1,listeners:{expand:function(){e.expendLegs()}}}}],this.tbar={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSiteUser",iconCls:"Add"},{text:"删除",itemId:"deleteSiteUser",xtype:"button",disabled:!0,iconCls:"Delete"}]},this.on("selectionchange",this.selectChange),this.callParent()},selectChange:function(e,t){this.down("#deleteSiteUser").setDisabled(0!=t.length?!1:!0)},expendLegs:function(){var e=this.down("#legs").getStore();e.getProxy().setExtraParam("applicationID",this.up("samplesiteuse").applicationID),e.load()},searchBoardingUserName:function(e){var t=e.getValue(),a=this.up("samplesiteuse").voyageID,i=this.down("#boardingUserName");i.getStore().getProxy().setExtraParam("value",t),i.getStore().getProxy().setExtraParam("voyageID",a),i.getStore().getProxy().setExtraParam("applicationID",this.up("samplesiteuse").applicationID)},listeners:{validateedit:function(e,t){var a=e.getEditor(t.record,t.column);a.revertInvalid=!1}}});Ext.define("Soims.view.application.common.SampleSiteUseNecessityForm",{extend:"Ext.form.Panel",alias:"widget.samplesiteusenecessityform",bodyPadding:2,title:"样品现场使用必要性说明",initComponent:function(){this.items=[{xtype:"textareafield",grow:!0,itemId:"sampleSiteUseNecessityTextArea",width:600,height:150,readOnly:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleSiteUse",{itemId:"applicationCommonSampleSiteUse",extend:"Ext.form.Panel",alias:"widget.samplesiteuse",requires:["Soims.view.application.common.BoardingUserGrid","Soims.view.application.common.SampleSiteUseNecessityForm"],padding:2,title:"样品现场使用信息",autoShow:!0,initComponent:function(){this.items=[{xtype:"boardinguser",applicationID:this.applicationID,isShow:this.isShow},{xtype:"samplesiteusenecessityform",applicationID:this.applicationID,margin:"3 0 0 0",isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleBackCountryNecessityForm",{extend:"Ext.form.Panel",alias:"widget.samplebackcountrynecessityform",bodyPadding:2,title:"样品先行运送回国必要性说明",initComponent:function(){this.items=[{xtype:"textareafield",grow:!0,itemId:"sampleBackCountryNecessityTextArea",width:600,height:150,readOnly:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleBackCountryGrid",{itemId:"applicationCommonSampleBackCountryGrid",extend:"Ext.grid.Panel",alias:"widget.samplebackcountrygrid",autoHeight:!0,title:"提前样品运送回国列表",emptyText:"没有满足条件的样品",height:200,selType:"rowmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){var e=this;console.log(this.applicationID),this.store=Ext.create("Soims.store.application.common.SampleBackCountry"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.application.common.SampleType");this.columns=[{xtype:"rownumberer"},{header:'<span>样品类型<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleType",flex:1,allowBlank:!1,editor:{itemId:"sampleType",name:"sampleType",xtype:"combobox",valueField:"sampleType",showStar:!0,queryMode:"local",store:t,editable:!1,disabled:1==this.isShow?!0:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{sampleType} - {legID}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{sampleType}","</tpl>"),listeners:{expand:function(){e.expendSampleType()}}}},{header:"所在航段",dataIndex:"sampleLeg",flex:1},{header:'<span>样品数<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleNumber",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>样品量<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAmount",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>保存条件<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"preservationCondition",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>拟运出时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"backTime",flex:1,xtype:"datecolumn",format:"Y-m-d",editor:{xtype:"datefield",disabled:1==this.isShow?!0:!1,value:new Date}},{header:"其他要求",dataIndex:"otherNeed",flex:1,editor:{xtype:"textfield",disabled:1==this.isShow?!0:!1,allowBlank:!0}}],this.tbar={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSample",iconCls:"Add"},{text:"删除",xtype:"button",itemId:"deleteSample",disabled:!0,iconCls:"Delete"}]},this.on("selectionchange",this.selectChange),this.callParent()},expendSampleType:function(){var e=this.up("samplebackcountry").applicationID;console.log(e);var t=this.down("#sampleType").getStore();t.getProxy().setExtraParam("applicationID",e),t.load()},selectChange:function(e,t){this.down("#deleteSample").setDisabled(0!=t.length?!1:!0)},listeners:{validateedit:function(e,t){var a=e.getEditor(t.record,t.column);a.revertInvalid=!1}}});Ext.define("Soims.model.applicationDiscussion.DiscussType",{statics:{SmeDiscuss:{value:"SmeDiscuss",name:"专家委员会委员审议",roleCode:"SME"},SmecDiscuss:{value:"SmecDiscuss",name:"专家委员会主任审议",roleCode:"SMEC"},getDiscussTypeByUserRole:function(s){var e={};for(var i in this)if(this[i].roleCode===s){e=this[i];break}return e}}});Ext.define("Soims.view.application.common.SampleBackCountryGridShow",{itemId:"applicationCommonSampleBackCountryGrid",extend:"Ext.grid.Panel",alias:"widget.samplebackcountrygridshow",autoHeight:!0,requires:"Soims.model.applicationDiscussion.DiscussType",emptyText:"没有满足条件的样品",minHeight:200,selType:"rowmodel",plugins:[{ptype:"associationrowexpander",pluginId:"backCountryGridExpander",selectRowOnExpand:!0,rowBodyTpl:new Ext.XTemplate('<tpl for=".">','<p style="margin-left:30px;line-height:20px"><b>样品类型:&nbsp;&nbsp;</b>{data.sampleType}</p>','<p style="margin-left:30px;line-height:20px"><b>所在航段:&nbsp;&nbsp;</b>{data.sampleLeg}</p>','<p style="margin-left:30px;line-height:20px"><b>样品数:&nbsp;&nbsp;</b>{data.sampleNumber}</p>','<p style="margin-left:30px;line-height:20px"><b>样品量:&nbsp;&nbsp;</b>{data.sampleAmount}</p>','<p style="margin-left:30px;line-height:20px"><b>保存条件:&nbsp;&nbsp;</b>{data.preservationCondition}</p>','<p style="margin-left:30px;line-height:20px"><b>拟运出时间:&nbsp;&nbsp;</b>{data.backTime:date("Y/m/d")}</p>','<p style="margin-left:30px;line-height:20px"><b>先行运送回国必要性说明:&nbsp;&nbsp;</b>{data.repatriaionNecessity}</p>','<p style="margin-left:30px;line-height:20px"><b>其他要求:&nbsp;&nbsp;</b>{data.otherNeed}</p><br>','<div id="backCountryList{data.id}" style="padding-left:30px;line-height:20px"><b>审核记录</b></div>','<tpl for="getSampleRepatriationAuditsStore">','<tpl if="this.colorChange(data.auditerID,data.auditType)">','<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:30px;line-height:20px"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:30px;line-height:20px"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","<tpl else>",'<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:30px;line-height:20px;color:red"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:30px;line-height:20px;color:red"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.AuditButtonShow()">','<p style="text-align: center;"><button  id="repatriationagree{data.id}">同意</button>   <button  id="repatriationunagree{data.id}">拟同意</button>   <button  id="repatriationdisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>",'<tpl if="this.DiscussionsShow()">','<div id="backCountryDiscussionList{data.id}" style="padding-left:30px;line-height:20px"><b>审议记录</b></div>','<tpl for="SampleRepatriationDiscussionsStore">','<tpl if="this.colorChange(data.auditerID)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.discussType}" repatriationID="{[values.getSampleBackCountry().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.discussType}" repatriationID="{[values.getSampleBackCountry().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.DiscussionButtonsShow()">','<p style="text-align: center;"><button  id="dicussionagree{data.id}">同意</button>   <button  id="dicussionunagree{data.id}">拟同意</button>   <button  id="dicussiondisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>","</tpl>","</tpl>",{colorChange:function(e,t){var i=Soims.currentUser.id,a=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode);return e==i&&t==a.value?!1:!0},formatChange:function(e){var t=Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,i=Soims.model.applicationAuditing.AuditType.LegChargerAudit.value;return e==t||e==i?!0:!1},AuditButtonShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!0:!1},DiscussionsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditShow.value||this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!1:!0},DiscussionButtonsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value?!0:!1}})}],initComponent:function(){this.getPlugin("backCountryGridExpander").setXTemplateParams(this.panelType);var e=this;this.store=Ext.create("Soims.store.application.common.SampleBackCountry"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load(function(){for(var t=e.getPlugin("backCountryGridExpander"),i=0;i<e.store.getCount();i++)t.toggleRow(i,e.store.getAt(i))})),this.title=this.isAudit?'<span>提前样品运送回国列表</span><span style="font-size:12px;color:#FF0000">[请逐条样品进行审核]</span>':"提前样品运送回国列表";Ext.create("Soims.store.application.common.SampleType");this.columns=[{xtype:"rownumberer"},{header:"样品类型",dataIndex:"sampleType",flex:1,allowBlank:!1},{header:"所在航段",dataIndex:"sampleLeg",flex:1},{header:"样品数",dataIndex:"sampleNumber",flex:1},{header:"样品量",dataIndex:"sampleAmount",flex:1},{header:"保存条件",dataIndex:"preservationCondition",flex:1},{header:"拟运出时间",dataIndex:"backTime",flex:1,xtype:"datecolumn",format:"Y-m-d"},{header:"其他要求",dataIndex:"otherNeed",flex:1}],this.on("selectionchange",this.selectChange),this.callParent()},expendSampleType:function(){var e=this.up("samplebackcountry").applicationID,t=this.down("#sampleType").getStore();t.getProxy().setExtraParam("applicationID",e),t.load()},selectChange:function(e,t){var i=Ext.get("repatriationagree"+t[0].get("id")),a=Ext.get("repatriationunagree"+t[0].get("id")),n=Ext.get("repatriationdisagree"+t[0].get("id")),p=Ext.get("dicussionagree"+t[0].get("id")),s=Ext.get("dicussionunagree"+t[0].get("id")),o=Ext.get("dicussiondisagree"+t[0].get("id")),d=this;void 0!=i&&(i.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Agree,t[0].get("id"))}),a.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Doubt,t[0].get("id"))}),n.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Reject,t[0].get("id"))})),void 0!=p&&(p.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Agree,t[0].get("id"))}),s.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Doubt,t[0].get("id"))}),o.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Reject,t[0].get("id"))}))},onAuditClick:function(e,t,i){var a=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),n=e.get("id");Ext.Ajax.request({url:Soims.service.ApplicationAuditings.SampleRepatriationAuditService+"/Auditing",params:{ContentType:t.value,AuditType:a.value,RepatriationID:n},scope:this,success:function(){Ext.Tools.Msg("审核完成",0),this.rowBodyChange(t,i)}})},onDiscussClick:function(e,t,i){var a=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode);Ext.Ajax.request({url:Soims.service.discussion.SampleRepatriationDiscussionService+"/Discussing",params:{ContentType:t.value,DiscussType:a.value,RepatriationID:i},scope:this,success:function(){Ext.Tools.Msg("审议完成",0),this.discussRowBodyChange(t,i)}})},rowBodyChange:function(e,t){var i=this,a=(i.getView().el,Soims.currentUser.id),n=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),p="span[auditor='"+a+"'][auditType="+n.value+"][repatriationID="+t+"]",s=Ext.query(p),o=this.getAuditInfo();if(void 0==s[0]){var d=new Date,r=Ext.get("backCountryList"+t),l="<span style='padding-left:30px;line-height:20px;color:red' auditor='"+a+"' auditType='"+n.value+"' repatriationID='"+t+"'>"+o+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+e.name+"</span><br/>";Ext.DomHelper.insertAfter(r,l)}else{var d=new Date,u=Ext.get(s[0]),c=o+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+e.name;Ext.DomHelper.overwrite(u,c),Ext.DomHelper.applyStyles(u,"color:red;")}i.getView().refreshSize()},getAuditInfo:function(){var e=Soims.currentUser.currentRoleCode,t=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode).name+"&nbsp;&nbsp;&nbsp;&nbsp;";return t+="VS"==e||"LS"==e?Soims.currentUser.name:Soims.currentUser.department},discussRowBodyChange:function(e,t){var i=this,a=(i.getView().el,Soims.currentUser.id),n=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode),p="span[auditor='"+a+"'][auditType="+n.value+"][repatriationID="+t+"]",s=Ext.query(p);if(void 0==s[0]){var o=new Date,d=Ext.get("backCountryDiscussionList"+t),r="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+a+"' auditType='"+n.value+"' repatriationID='"+t+"'>"+n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+e.name+"</span><br/>";Ext.DomHelper.insertAfter(d,r)}else{var o=new Date,l=Ext.get(s[0]),u=n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+e.name;Ext.DomHelper.overwrite(l,u),Ext.DomHelper.applyStyles(l,"color:red;")}i.getView().refreshSize()}});Ext.define("Soims.view.application.common.SampleBackCountry",{extend:"Ext.form.Panel",alias:"widget.samplebackcountry",requires:["Soims.view.application.common.SampleBackCountryNecessityForm","Soims.view.application.common.SampleBackCountryGrid","Soims.view.application.common.SampleBackCountryGridShow"],padding:2,title:"样品回国信息",autoShow:!0,initComponent:function(){this.items=this.isShow?[{xtype:"samplebackcountrygridshow",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow,panelType:this.panelType}]:[{xtype:"samplebackcountrygrid",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow},{xtype:"samplebackcountrynecessityform",margin:"3 0 0 0",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.ElectronicDocumentGrid",{itemId:"applicationCommonElectronicDocumentGrid",extend:"Ext.grid.Panel",title:"证明材料电子资料",alias:"widget.electronicdocumentgrid",autoHeight:!0,emptyText:"没有满足条件的电子资料",height:200,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){this.store=Ext.create("Soims.store.application.common.ElectronicDocument"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load()),this.columns=[{xtype:"rownumberer"},{header:"文档名称",dataIndex:"name",flex:1},{header:"文档大小",dataIndex:"length",flex:1},{header:"备注",dataIndex:"remark",flex:1,editor:{xtype:"textfield",disabled:1==this.isShow?!0:!1}}],this.tbar={items:[{text:"添加",xtype:"button",itemId:"add",hidden:this.isShow,iconCls:"Add"},{text:"删除",itemId:"delete",xtype:"button",hidden:this.isShow,disabled:!0,iconCls:"Delete"},{text:"下载",itemId:"download",xtype:"button",disabled:!0,iconCls:"DiskDownload"}]},this.on("selectionchange",this.selectChange),this.callParent()},selectChange:function(t,e){0!=e.length?(this.down("#delete").setDisabled(!1),this.down("#download").setDisabled(!1)):(this.down("#delete").setDisabled(!0),this.down("#download").setDisabled(!0))}});Ext.define("Soims.view.application.common.ElectronicDocument",{name:"applicationCommonElectronicDocument",extend:"Ext.form.Panel",alias:"widget.electronicdocument",requires:["Soims.view.application.common.ElectronicDocumentGrid"],padding:2,title:"电子资料提交",autoShow:!0,initComponent:function(){this.items=[{xtype:"electronicdocumentgrid",applicationID:this.applicationID,isShow:this.isShow,type:this.type}],this.callParent()}});Ext.define("Soims.model.applicationAuditing.AuditType",{statics:{OrganizeContractorAudit:{value:"OrganizeContractorAudit",name:"组织实施单位审核",roleCode:"VODC",formType:"organizecontractorauditform"},VoyageChargerAudit:{value:"VoyageChargerAudit",name:"航次首席科学家审核",roleCode:"VS",formType:"voyagechargerauditform"},LegChargerAudit:{value:"LegChargerAudit",name:"航段首席科学家审核",roleCode:"LS",formType:"legchargerauditform"},ProjectChargerAudit:{value:"ProjectChargerAudit",name:"项目负责人审核",roleCode:"PC",formType:"projectchargerauditform"},ReportManagerAudit:{value:"ReportManagerAudit",name:"航次报告牵头负责人审核",roleCode:"VRC",formType:"reportmanagerauditform"},getAuditTypeByUserRole:function(e){var r={};for(var a in this)if(this[a].roleCode===e){r=this[a];break}return r}}});Ext.define("Soims.model.applicationAuditing.ContentType",{statics:{Agree:{value:"Agree",name:"同意"},Reject:{value:"Reject",name:"不同意"},Doubt:{value:"Doubt",name:"拟同意"}}});Ext.define("Soims.view.applicationAuditing.common.OrganizeContractorAuditForm",{extend:"Ext.form.Panel",alias:"widget.organizecontractorauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次组织实施单位意见",initComponent:function(){var t=!this.isAudit||Soims.component.applicationAuditingCommonOrganizeContractorAuditFormOrganizeContractorReadOnly;this.hidden=Soims.component.applicationAuditingCommonOrganizeContractorAuditFormOrganizeContractorHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:t,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(t){var e=t.up("organizecontractorauditform").down("textareafield");e.setValue(t.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"organizeContractor",anchor:"100%",width:600,height:150,readOnly:t},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!t,height:20}],this.callParent()},listeners:{afterrender:function(){var t=this,e=t.initStore();e.load(function(){0!=e.getCount()?t.setItemValues(e.getAt(0)):"VODC"==Soims.currentUser.currentRoleCode?t.down("label").hide():t.hide()})}},initStore:function(){var t=this,e=this.isAudit&&"VODC"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),n={AuditType:Soims.model.applicationAuditing.AuditType.OrganizeContractorAudit.value,ApplicationID:t.applicationID,Action:e};return i.setExtraParams(n),i},setItemValues:function(t){this.down("textareafield").setValue(t.get("auditContent")),this.down("label").setText("负责人: "+t.get("auditerName")+" "+Ext.Date.format(t.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:t.get("contentType")})}});Ext.define("Soims.view.applicationAuditing.common.VoyageChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.voyagechargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次首席科学家意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonVoyageChargerAuditFormVoyageChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonVoyageChargerAuditFormVoyageChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("voyagechargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"voyageCharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"VS"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e=this,t=this.isAudit&&"VS"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,ApplicationID:e.applicationID,Action:t};return i.setExtraParams(a),i},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAuditing.common.LegChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.legchargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航段首席科学家意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("legchargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"legCharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"LS"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e=this,t=this.isAudit&&"LS"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.LegChargerAudit.value,ApplicationID:e.applicationID,Action:t};return i.setExtraParams(a),i},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAccept.B1Tab",{extend:"Ext.form.Panel",alias:"widget.acceptb1tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.B1BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.SampleSiteUse","Soims.view.application.common.SampleBackCountry","Soims.view.application.common.ElectronicDocument","Soims.view.applicationAuditing.common.OrganizeContractorAuditForm","Soims.view.applicationAuditing.common.VoyageChargerAuditForm","Soims.view.applicationAuditing.common.LegChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"b1basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"samplesiteuse",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"samplebackcountry",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"organizecontractorauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"voyagechargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"legchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.model.applicationAuditing.AuditState",{statics:{Save:{value:"Save",name:"保存审核意见"},Submit:{value:"Submit",name:"提交审核意见"}}});Ext.define("Soims.model.applicationAccept.AcceptAction",{statics:{Agree:{value:"Agree",name:"通过"},Reject:{value:"Reject",name:"驳回"},Veto:{value:"Veto",name:"否决"}}});Ext.define("Soims.view.application.common.TestDataGrid",{extend:"Ext.grid.Panel",alias:"widget.testdatagrid",header:!1,viewConfig:{emptyText:"没有满足条件的测试数据"},height:200,frame:!1,closable:!1,collapsible:!1,titleCollapse:!1,plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){("V1"==this.type||"B1"==this.type||"B2"==this.type)&&(this.features=[{ftype:"grouping"}]),this.store=Ext.create("Soims.store.application.common.TestData"),this.applicationID="",this.deleteid="",this.columns=[{xtype:"rownumberer"},{text:"样品类型",sortable:!1,dataIndex:"sampleType"},{text:"使用目的",lockable:!1,sortable:!0,dataIndex:"usePurpose"},{text:"航段",sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"分析测试项目、指标",sortable:!0,dataIndex:"anlyseTestProject"},{text:"拟提交测试数据",sortable:!0,dataIndex:"intendCommitTestData",editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!0}},{text:"拟提交时间",sortable:!0,renderer:Ext.util.Format.dateRenderer("Y-m-d"),dataIndex:"commitTestDataTime",editor:{allowBlank:!1,xtype:"datefield",disabled:this.isShow,format:"Y-m-d"}}],this.tbar={hidden:this.isShow,items:[{text:"删除",name:"testDelete",action:"testDelete",itemId:"testDelete",xtype:"button",iconCls:"Delete",disabled:!0}]},this.callParent()}});Ext.define("Soims.controller.application.common.SampleInfo",{extend:"Ext.app.Controller",views:["application.common.SampleInfo","application.common.TestDataGrid"],refs:[{ref:"sampleinfo",selector:"sampleinfo",autoCreate:!0,xtype:"sampleinfo"}],init:function(){this.control({"sampleinfo button[itemId=samplePage2Save]":{click:function(e){var t=e.up("#applicationCommonSampleInfo"),a=t.applicationID;return a?void this.saveAction(a,t,!0):void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this)}}}),this.getCon("application.common.SampleGrid"),this.getCon("application.common.SampleGridShow"),this.getCon("application.common.TestDataGrid")},getCon:function(e){var t=this.application;return t.getController(e)},saveAction:function(e,t,a){this.sampleDelete(t.down("samplegrid").deleteid),this.testDataDelete(t.down("testdatagrid").deleteid),this.sampleSave(e,t,a),t.down("samplegrid").deleteid="",t.down("testdatagrid").deleteid=""},commitResultSave:function(e,t){var a=t.down("testdatainfo");console.log(a);var i=a.down("textfield[name=commitResultAmount]").getValue(),s=a.down("textfield[name=commitResultForm]").getValue(),o=a.down("textfield[name=commitResultTime]").getValue(),n={applicationID:e,commitResultAmount:i,commitResultForm:s,commitResultTime:o};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/CommitResultSave",params:n,success:function(e){e.responseText}})},testDataSave:function(e,t,a,i){var s=a.down("testdatagrid"),o=s.getStore();if(o.each(function(a){a.get("legID")==e.legID&&a.get("sampleType")==e.sampleType&&(a.set("sampleID",t),Ext.Ajax.request({async:!1,url:Soims.service.samples.TestDataService+"/Save",params:a.data,success:function(e){a.set("id",e.responseText)}}))}),i){Ext.MessageBox.alert("成功","信息保存成功！",function(){},this);var n=a.applicationID,l=a.down("samplegrid"),r=l.getStore();r.getProxy().setExtraParam("applicationID",n),r.reload(),o.getProxy().setExtraParam("applicationID",n),o.reload()}},sampleDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Delete",params:t,async:!1,success:function(){}})},testDataDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.TestDataService+"/Delete",params:t,async:!1,success:function(){}})},sampleSave:function(e,t,a){var i=t.down("samplegrid"),s=i.getStore(),o=s.getCount(),n=0,l=this,r=!1;s.each(function(i){i.set("sampleApplication",e),Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Save",params:i.data,async:!1,success:function(e){var s=e.responseText.split(",");i.set("id",s[0]),i.set("sampleAreaAndCountID",s[1]),n++,o==n&&1==a&&(r=!0),l.testDataSave(i.data,s[0],t,r)}})})},showTab:function(e,t,a,i){var s=this.getCon("application.new.B1Tab"),o=s.existInstance(e);if(o)return o;var n=Ext.create(a,{id:e,isShow:t,applicationID:i});return s.addTab(n),n}});Ext.define("Soims.model.application.common.BoardingUser",{extend:"Ext.data.Model",fields:[{name:"id",mapping:"ID"},{name:"name",mapping:"Name"},{name:"department",mapping:"Department"},{name:"cellphone",mapping:"CellPhone"},{name:"telphone",mapping:"TelPhone"},{name:"legs",mapping:"Legs"},{name:"legIDs",mapping:"LegIDs"},{name:"userDetail",mapping:"UserDetail"}]});Ext.define("Soims.store.application.common.BoardingUser",{extend:"Ext.data.Store",model:"Soims.model.application.common.BoardingUser",proxy:{type:"ajax",url:Soims.service.applications.BoardingUserService+"/QueryBoardingUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"},listeners:{exception:function(e,o){console.log(o),Ext.MessageBox.alert("提示","请先保存样品信息")}}}});Ext.define("Soims.controller.application.common.BoardingUser",{extend:"Ext.app.Controller",stores:["application.common.BoardingUser"],views:["application.common.SampleSiteUse","application.common.BoardingUserGrid","application.common.SampleSiteUseNecessityForm"],refs:[{ref:"samplesiteuse",selector:"samplesiteuse",autoCreate:!0,xtype:"samplesiteuse"},{ref:"boardingUser",selector:"boardinguser",autoCreate:!0,xtype:"boardinguser"},{ref:"sampleSiteUseNecessityForm",selector:"samplesiteusenecessityform",autoCreate:!0,xtype:"samplesiteusenecessityform"}],init:function(){this.control({boardinguser:{},"boardinguser button[itemId=addSiteUser]":{click:function(e){var t=e.up("#applicationCommonBoardingUserGrid");return void 0==t.up("samplesiteuse").applicationID?void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("samplesiteuse").up("tabpanel");t.setActiveTab(0)},this):(t.getStore().insert(0,Ext.create("Soims.model.application.common.BoardingUser")),void t.getView().refresh())}},"boardinguser button[itemId=deleteSiteUser]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此人员？点击保存按钮生效。",function(t){if("yes"==t){var o=e.up("#applicationCommonBoardingUserGrid"),i=o.getSelectionModel(),n=i.getSelection();this.getBoardingUser().getStore().remove(n),this.getBoardingUser().getView().refresh()}},this)}},"boardinguser searchcombo[itemId=boardingUserName]":{select:function(e,t){var o=e.up("#applicationCommonBoardingUserGrid").getSelectionModel().getSelection()[0];o.set("id",t[0].get("id")),o.set("name",t[0].get("name")),o.set("department",t[0].get("department")),o.set("cellphone",t[0].get("cellphone")),o.set("telphone",t[0].get("telphone"))}},"boardinguser combobox[itemId=legs]":{select:function(e,t){for(var o=e.up("#applicationCommonBoardingUserGrid").getSelectionModel().getSelection()[0],i="",n=0;n<t.length;n++)i+=t[n].get("id")+",";""!=i&&(i=i.substring(0,i.length-1)),o.set("legIDs",i),console.log(i)}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,o,i){var n=this.getCon("application.new.B1Tab"),r=n.existInstance(e);if(r)return r;var s=Ext.create(o,{id:e,isShow:t,applicationID:i});return n.addTab(s),s}});Ext.define("Soims.controller.application.common.SampleBackCountry",{extend:"Ext.app.Controller",views:["application.common.SampleBackCountry","application.common.SampleBackCountryGrid","application.common.SampleBackCountryNecessityForm"],refs:[{ref:"samplebackcountry",selector:"samplebackcountry",autoCreate:!0,xtype:"samplebackcountry"},{ref:"sampleBackCountryGrid",selector:"samplebackcountrygrid",autoCreate:!0,xtype:"samplebackcountrygrid"},{ref:"sampleBackCountryNecessityform",selector:"samplebackcountrynecessityform",autoCreate:!0,xtype:"samplebackcountrynecessityform"}],init:function(){this.control({"samplebackcountrygrid combobox[itemId=sampleType]":{select:function(e,t){var a=e.up("#applicationCommonSampleBackCountryGrid").getSelectionModel().getSelection()[0];a.set("sampleLeg",t[0].get("legID")),a.set("sampleID",t[0].get("id"))}},"samplebackcountrygrid button[itemId=addSample]":{click:function(e){var t=e.up("#applicationCommonSampleBackCountryGrid");if(void 0==t.up("samplebackcountry").applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("samplebackcountry").up("tabpanel");t.setActiveTab(0)},this);var a=Ext.create("Soims.model.application.common.SampleBackCountry");t.getStore().insert(0,a),t.getView().refresh()}},"samplebackcountrygrid button[itemId=deleteSample]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此样品？点击保存按钮生效。",function(t){if("yes"==t){var a=e.up("#applicationCommonSampleBackCountryGrid"),o=a.getSelectionModel(),n=o.getSelection();a.getStore().remove(n),a.getView().refresh()}},this)}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,a,o){var n=this.getCon("application.new.B1Tab"),c=n.existInstance(e);if(c)return c;var r=Ext.create(a,{id:e,isShow:t,applicationID:o});return n.addTab(r),r}});Ext.define("Soims.model.application.common.ElectronicDocument",{extend:"Ext.data.Model",fields:[{name:"id",mapping:"ID"},{name:"resourceID",mapping:"ResourceID"},{name:"name",mapping:"Name"},{name:"length",mapping:"Length"},{name:"remark",mapping:"Remark"}]});Ext.define("Soims.store.application.common.ElectronicDocument",{extend:"Ext.data.Store",model:"Soims.model.application.common.ElectronicDocument",proxy:{type:"ajax",url:Soims.service.applications.ElectronicDocument+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.controller.application.common.ElectronicDocument",{extend:"Ext.app.Controller",stores:["application.common.ElectronicDocument"],views:["application.common.ElectronicDocument","application.common.ElectronicDocumentGrid"],refs:[{ref:"electronicDocument",selector:"electronicdocument",autoCreate:!0,xtype:"electronicdocument"},{ref:"electronicDocumentGrid",selector:"electronicdocumentgrid",autoCreate:!0,xtype:"electronicdocumentgrid"}],init:function(){this.control({electronicdocumentgrid:{itemdblclick:function(){console.log("Double Click.")}},"electronicdocumentgrid button[itemId=add]":{click:function(e){if(void 0==e.up("electronicdocument").applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("electronicdocument").up("tabpanel");t.setActiveTab(0)},this);var t=this.getCon("application.common.ElectronicDocumentWin");t.show(e.up("#applicationCommonElectronicDocumentGrid"),e.up("electronicdocument").type)}},"electronicdocumentgrid button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此文件？点击保存按钮生效。",function(t){if("yes"==t){var o=e.up("#applicationCommonElectronicDocumentGrid"),c=o.getSelectionModel(),n=c.getSelection();this.getElectronicDocumentGrid().getStore().remove(n),this.getElectronicDocumentGrid().getView().refresh()}},this)}},"electronicdocumentgrid button[itemId=download]":{click:function(e){var t=e.up("#applicationCommonElectronicDocumentGrid"),o=t.getSelectionModel(),c=o.getSelection()[0];console.log(c);var n=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ResourceService+"/DownloadByResourceID?ResourceID="+c.get("resourceID")+"&Name="+c.get("name")+"&isIE="+n}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,o,c){var n=this.getCon("application.new.B1Tab"),i=n.existInstance(e);if(i)return i;var r=Ext.create(o,{id:e,isShow:t,applicationID:c});return n.addTab(r),r}});Ext.define("Soims.controller.applicationAccept.B1Tab",{extend:"Ext.app.Controller",views:["applicationAccept.B1Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptb1tab",selector:"acceptb1tab",autoCreate:!0,xtype:"acceptb1tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.common.BoardingUser"),this.getController("application.common.SampleBackCountry"),this.getController("application.common.ElectronicDocument"),this.control({acceptb1tab:{afterrender:this.afterB1TabRender},"acceptb1tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},afterB1TabRender:function(t){var e=t.down("b1basicinfopanel"),o=(t.down("testdatainfo"),t.down("samplesiteusenecessityform").down("textareafield")),c=Ext.create("Soims.store.application.show.B1Detail");c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){0!=c.getCount()&&(e.loadRecord(c.getAt(0)),o.setValue(c.getAt(0).get("usingNecessity")))})},accept:function(t,e,o){var c=t.up("panel"),i=c.applicationID;Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Action:e,ApplicationID:i,Competence:"AcceptB1"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.B2BasicInfoPanel",{extend:"Ext.form.Panel",alias:"widget.b2basicinfopanel",title:"大洋课题基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){{var e=Ext.create("Soims.store.application.new.Subject");Ext.create("Soims.store.application.new.Voyage")}this.items={xtype:"panel",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{xtype:"combobox",itemId:"subject",name:"topicName",fieldLabel:"课题名称",store:e,queryMode:"local",displayField:"topicName",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1},{fieldLabel:"负责人姓名",xtype:"textfield",itemId:"subjectchargerName",name:"topicChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",itemId:"subjectaddress",name:"topicAddress"},{fieldLabel:"联系电话",xtype:"textfield",itemId:"subjectcellphone",name:"topicCellphone"},{fieldLabel:"手机",xtype:"textfield",itemId:"subjecttelphone",name:"topicTelphone"},{xtype:"textfield",name:"projectName",itemId:"project",fieldLabel:"项目名称",margin:"20 0 5 0"},{fieldLabel:"负责人姓名",xtype:"textfield",itemId:"projectchargerName",name:"projectChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",itemId:"projectaddress",name:"projectAddress"},{fieldLabel:"联系电话",xtype:"textfield",itemId:"projectcellphone",name:"projectCellphone"},{fieldLabel:"手机",xtype:"textfield",itemId:"projecttelphone",name:"projectTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"课题编号",xtype:"textfield",itemId:"subjectnumber",name:"topicNumber"},{fieldLabel:"所在单位",xtype:"textfield",itemId:"subjectdepartment",name:"topicDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",itemId:"subjectzipCode",name:"topicZipCode"},{fieldLabel:"传真",xtype:"textfield",itemId:"subjectfax",name:"topicFax"},{fieldLabel:"邮箱",xtype:"textfield",itemId:"subjectemail",name:"topicEmail"},{fieldLabel:"项目编号",xtype:"textfield",name:"projectNumber",itemId:"projectnumber",margin:"20 0 5 0"},{fieldLabel:"所在单位",xtype:"textfield",itemId:"projectdepartment",name:"projectDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",itemId:"projectzipCode",name:"projectZipCode"},{fieldLabel:"传真",xtype:"textfield",itemId:"projectfax",name:"projectFax"},{fieldLabel:"邮箱",xtype:"textfield",itemId:"projectemail",name:"projectEmail"}]}]},this.callParent()},searchSubject:function(e){var t=e.getStore(),i=this.up("#applicationCommonB2BasicInfoPanel");1!=i.isShow&&(t.load(),t.on({load:function(){0!=t.getCount()?i.down("#subject").select(t.getAt(0)):Ext.MessageBox.alert("提示","不存在可用于申请样品的航次任务，如有疑问请联系系统工作人员，谢谢！",function(){i.up("tabpanel").close()},this)}}))}});Ext.define("Soims.view.application.new.B2BasicInfo",{itemId:"applicationNewB2BasicInfo",extend:"Ext.form.Panel",alias:"widget.b2basicinfo",requires:["Soims.view.application.common.B2BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b2basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!1}],this.callParent()}});Ext.define("Soims.view.applicationAuditing.common.ProjectChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.projectchargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.application.common.SampleApplicationType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"项目负责人意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonProjectChargerAuditFormProjectChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonProjectChargerAuditFormProjectChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("projectchargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"projectcharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"PC"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e,t=this,i=Soims.model.applicationAuditing.AuditState.Submit.value,o=Ext.create("Soims.store.applicationAuditing.Audit");return(t.appType==Soims.model.application.common.SampleApplicationType.V2.value||t.appType==Soims.model.application.common.SampleApplicationType.B2.value&&"PC"==Soims.currentUser.currentRoleCode&&t.isAudit)&&(i=Soims.model.applicationAuditing.AuditState.Save.value),e={AuditType:Soims.model.applicationAuditing.AuditType.ProjectChargerAudit.value,ApplicationID:t.applicationID,Action:i},o.setExtraParams(e),o},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAccept.B2Tab",{extend:"Ext.form.Panel",alias:"widget.acceptb2tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.B2BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.SampleSiteUse","Soims.view.application.common.SampleBackCountry","Soims.view.application.common.ElectronicDocument","Soims.view.applicationAuditing.common.ProjectChargerAuditForm","Soims.view.applicationAuditing.common.VoyageChargerAuditForm","Soims.view.applicationAuditing.common.LegChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"b2basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"samplesiteuse",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"samplebackcountry",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"projectchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1,appType:this.appType},{xtype:"voyagechargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"legchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.B2Tab",{extend:"Ext.app.Controller",views:["applicationAccept.B2Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptb2tab",selector:"acceptb2tab",autoCreate:!0,xtype:"acceptb2tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.common.BoardingUser"),this.getController("application.common.SampleBackCountry"),this.getController("application.common.ElectronicDocument"),this.control({acceptb2tab:{afterrender:this.afterB2TabRender},"acceptb2tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},afterB2TabRender:function(t){var e=t.down("b2basicinfopanel"),o=(t.down("testdatainfo"),t.down("samplesiteusenecessityform").down("textareafield")),c=Ext.create("Soims.store.application.show.B2Detail");c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){var t=c.getAt(0);e.loadRecord(t),o.setValue(t.get("usingNecessity"))}})},accept:function(t,e,o){var c=t.up("panel"),i=c.applicationID,n=c.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V1BasicInfoPanel",{itemId:"applicationCommonV1BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v1basicinfopanel",title:"承担任务信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=this,t=Ext.create("Soims.store.application.new.Report"),i=Ext.create("Soims.store.application.new.Division");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"combobox",itemId:"report",name:"report",labelWidth:100,width:300,editable:!1,fieldLabel:"航次报告名称",padding:"10 0 0 25",store:t,queryMode:"local",displayField:"name",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1,listeners:{beforerender:e.searchReport,select:function(t,i){e.loadRecord(i[0]);var o=this.up("#applicationCommonV1BasicInfoPanel"),d=o.down("#division").getStore(),a=this.getValue();a?(d.getProxy().setExtraParam("reportID",a),d.load(),d.on({load:function(){0!=d.getCount()&&o.down("#division").select(d.getAt(0))}})):Ext.Tools.Msg("请先选择航次报告！",9)}}},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"航次报告编写牵头负责人",xtype:"textfield",name:"reportChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"reportAddress"},{fieldLabel:"联系电话",xtype:"textfield",name:"reportCellphone"},{fieldLabel:"手机",xtype:"textfield",name:"reportTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"reportDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",name:"reportZipCode"},{fieldLabel:"传真",xtype:"textfield",name:"reportFax"},{fieldLabel:"邮箱",xtype:"textfield",name:"reportEmail"}]}]},{xtype:"combobox",itemId:"division",name:"division",editable:!1,fieldLabel:"分工负责学科、调查区域",store:i,labelWidth:100,width:300,padding:"10 0 0 25",queryMode:"local",displayField:"name",valueField:"id",readOnly:1==this.isShow?!0:!1,listeners:{select:function(t,i){e.loadRecord(i[0])}}},{xtype:"fieldset",itemId:"divisionInfoForm",name:"divisionInfoForm",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",layout:"column",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"航次报告编写分工负责人",xtype:"textfield",name:"divisionChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"divisionAddress"},{fieldLabel:"联系电话",xtype:"textfield",name:"divisionCellphone"},{fieldLabel:"手机",xtype:"textfield",name:"devisionTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"divisionDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",name:"divisionZipCode"},{fieldLabel:"传真",xtype:"textfield",name:"divisionFax"},{fieldLabel:"邮箱",xtype:"textfield",name:"divisionEmail"}]}]}]},this.callParent()},searchReport:function(e){var t=e.getStore(),i=this.up("#applicationCommonV1BasicInfoPanel"),o=this.up("#applicationNewV1BasicInfo");1!=o.isEdit&&1!=o.isShow&&(t.load(),t.on({load:function(){0!=t.getCount()?(i.down("#report").select(t.getAt(0)),i.down("textfield[name=reportChargerName]").setValue(t.getAt(0).get("reportChargerName")),i.down("textfield[name=reportAddress]").setValue(t.getAt(0).get("reportAddress")),i.down("textfield[name=reportCellphone]").setValue(t.getAt(0).get("reportCellphone")),i.down("textfield[name=reportTelphone]").setValue(t.getAt(0).get("reportTelphone")),i.down("textfield[name=reportZipCode]").setValue(t.getAt(0).get("reportZipCode")),i.down("textfield[name=reportFax]").setValue(t.getAt(0).get("reportFax")),i.down("textfield[name=reportEmail]").setValue(t.getAt(0).get("reportEmail")),i.down("textfield[name=reportDepartment]").setValue(t.getAt(0).get("reportDepartment")),i.searchDivision(i,t.getAt(0).get("id"))):Ext.MessageBox.alert("提示","不存在您负责的航次报告，如有疑问请联系系统工作人员，谢谢！",function(){},this)}}))},searchDivision:function(e,t){var i=e.down("#division").getStore();i.getProxy().setExtraParam("reportID",t),i.load(function(){e.down("#division").select(i.getAt(0)),console.log(e.down("#division")),e.down("textfield[name=divisionChargerName]").setValue(i.getAt(0).get("divisionChargerName")),e.down("textfield[name=divisionAddress]").setValue(i.getAt(0).get("divisionAddress")),e.down("textfield[name=divisionCellphone]").setValue(i.getAt(0).get("divisionCellphone")),e.down("textfield[name=devisionTelphone]").setValue(i.getAt(0).get("divisionTelphone")),e.down("textfield[name=divisionZipCode]").setValue(i.getAt(0).get("divisionZipCode")),e.down("textfield[name=divisionDepartment]").setValue(i.getAt(0).get("divisionDepartment")),e.down("textfield[name=divisionFax]").setValue(i.getAt(0).get("divisionFax")),e.down("textfield[name=divisionEmail]").setValue(i.getAt(0).get("divisionEmail"))})}});Ext.define("Soims.view.application.new.V1BasicInfo",{itemId:"applicationNewV1BasicInfo",extend:"Ext.form.Panel",alias:"widget.v1basicinfo",title:"申请基本信息",requires:["Soims.view.application.common.V1BasicInfoPanel"],padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v1basicinfopanel",applicationID:this.applicationID,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.applicationAuditing.common.ReportManagerAuditForm",{extend:"Ext.form.Panel",alias:"widget.reportmanagerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次报告牵头负责人意见",initComponent:function(){var t=!this.isAudit||Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:t,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(t){var e=t.up("reportmanagerauditform").down("textareafield");e.setValue(t.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"reportmanager",anchor:"100%",width:600,height:150,readOnly:t},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!t,height:20}],this.callParent()},listeners:{afterrender:function(){var t=this,e=t.initStore();e.load(function(){0!=e.getCount()?t.setItemValues(e.getAt(0)):"VRC"==Soims.currentUser.currentRoleCode?t.down("label").hide():t.hide()})}},initStore:function(){var t=this,e=this.isAudit?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.ReportManagerAudit.value,ApplicationID:t.applicationID,Action:e};return i.setExtraParams(a),i},setItemValues:function(t){this.down("textareafield").setValue(t.get("auditContent")),this.down("label").setText("负责人: "+t.get("auditerName")+" "+Ext.Date.format(t.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:t.get("contentType")})}});Ext.define("Soims.view.applicationAccept.V1Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv1tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V1BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.applicationAuditing.common.ReportManagerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v1basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"reportmanagerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:this.isAudit}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.application.new.V1BasicInfo",{extend:"Ext.app.Controller",views:["application.new.V1BasicInfo"],refs:[{ref:"v1BasicInfo",selector:"v1basicinfo",autoCreate:!0,xtype:"v1basicinfo"}],init:function(){this.control()},getCon:function(n){var i=this.application;return i.getController(n)}});Ext.define("Soims.controller.applicationAccept.V1Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V1Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv1tab",selector:"acceptv1tab",autoCreate:!0,xtype:"acceptv1tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.new.V1BasicInfo"),this.control({acceptv1tab:{render:function(t){if(1==t.isEdit||1==t.isShow){var e=t.down("v1basicinfopanel"),o=(t.down("testdatainfo"),e.down("#report")),i=o.getStore(),c=e.down("#division"),n=c.getStore(),a=Ext.create("Soims.store.application.show.V1Detail");a.getProxy().setExtraParam("ID",t.applicationID),a.load(function(){0!=a.getCount()&&i.load(function(){console.log(a.getAt(0).get("reportName")),e.loadRecord(a.getAt(0));var i=Ext.create("Soims.model.application.new.Division",{id:a.getAt(0).get("divisionID"),name:a.getAt(0).get("divisionName")});o.setValue(a.getAt(0).get("reportName")),n.getProxy().setExtraParam("reportID",a.getAt(0).get("reportID")),t.down("#applicationCommonSampleInfo").applicationID=a.getAt(0).get("id"),n.load(function(){c.setValue(i)})})})}}},"acceptv1tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,o){var i=t.up("panel"),c=i.applicationID,n=i.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:c,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),i.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.new.V2BasicInfo",{itemId:"applicationNewV2BasicInfo",extend:"Ext.form.Panel",alias:"widget.v2basicinfo",requires:["Soims.view.application.common.B2BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b2basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V2Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv2tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V2BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.ElectronicDocument","Soims.model.application.common.SampleApplicationType","Soims.view.applicationAuditing.common.ProjectChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v2basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"projectchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:this.isAudit}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.V2Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V2Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv2tab",selector:"acceptv2tab",autoCreate:!0,xtype:"acceptv2tab"}],init:function(){this.getController("application.common.SampleInfo"),this.control({acceptv2tab:{afterrender:function(t){if(1==t.isShow){var e=t.down("b2basicinfopanel"),c=(t.down("testdatainfo"),e.down("#subject"),Ext.create("Soims.store.application.show.V2Detail"));c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){e.loadRecord(c.getAt(0));{Ext.create("Soims.model.application.new.Subject",{id:c.getAt(0).get("topicID"),topicName:c.getAt(0).get("topicName")})}}})}}},"acceptv2tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,c){var o=t.up("panel"),i=o.applicationID,n=o.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+c+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),o.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V3BasicInfoPanel",{itemId:"applicationCommonV3BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v3basicinfopanel",title:"承担任务信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){console.log(this.isShow);var e=Ext.create("Soims.store.application.new.NoOceanTopic");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"fieldset",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{margin:"10 0",xtype:"combobox",itemId:"noOceanTopic",name:"noOceanTopic",labelWidth:150,width:400,fieldLabel:"非大洋课题名称",store:e,displayField:"topicName",valueField:"topicID",readOnly:1==this.isShow?!0:!1,allowBlank:!1},{fieldLabel:"课题编号",labelWidth:150,width:400,xtype:"textfield",name:"topicNumber",itemId:"topicNumber",allowBlank:!1},{fieldLabel:"课题来源与下达部门",xtype:"textfield",labelWidth:150,width:500,name:"topicSource",itemId:"topicSource",allowBlank:!1}]},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"非大洋课题负责人",xtype:"textfield",name:"chargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]}]}]},this.callParent()}});Ext.define("Soims.view.applicationAccept.V3Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv3tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V3BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.ElectronicDocument","Soims.model.application.common.SampleApplicationType"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v3basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.V3Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V3Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv3tab",selector:"acceptv3tab",autoCreate:!0,xtype:"acceptv3tab"}],init:function(){this.getController("application.common.SampleInfo"),this.control({acceptv3tab:{afterrender:this.afterTabRender},"acceptv3tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},afterTabRender:function(t){if(1==t.isShow){var e=t.down("v3basicinfopanel"),c=(t.down("testdatainfo"),e.down("#noOceanTopic"),Ext.create("Soims.store.application.show.V3Detail"));c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){e.loadRecord(c.getAt(0));{Ext.create("Soims.model.application.new.NoOceanTopic",{topicID:c.getAt(0).get("topicID"),topicName:c.getAt(0).get("topicName")})}}})}},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,c){var o=t.up("panel"),i=o.applicationID,n=o.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+c+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),o.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.new.V3BasicInfo",{itemId:"applicationNewV3BasicInfo",extend:"Ext.form.Panel",itemId:"applicationNewV3BasicInfo",alias:"widget.v3basicinfo",requires:["Soims.view.application.common.V3BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v3basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.application.common.V4BasicInfoPanel",{itemId:"applicationCommonV4BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v4basicinfopanel",title:"公益事业信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.application.new.Activity");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"fieldset",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{margin:"10 0",xtype:"combobox",itemId:"activity",name:"activity",labelWidth:150,width:400,fieldLabel:"项目/活动名称",store:e,displayField:"activityName",forbidBlankAndShowStar:!0,valueField:"activityID",readOnly:1==this.isShow?!0:!1,allowBlank:!1},{fieldLabel:"活动举办地",labelWidth:150,width:400,xtype:"textfield",name:"activityPlace",itemId:"activityPlace",forbidBlankAndShowStar:!0,readOnly:this.isShow,allowBlank:!1},{fieldLabel:"课题来源与下达部门",xtype:"textfield",labelWidth:150,width:500,readOnly:this.isShow,name:"activityDepartment",itemId:"activityDepartment",forbidBlankAndShowStar:!0,allowBlank:!1}]},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"负责人",xtype:"textfield",name:"chargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]}]}]},this.callParent()}});Ext.define("Soims.view.application.new.V4BasicInfo",{extend:"Ext.form.Panel",alias:"widget.v4basicinfo",itemId:"applicationNewV4BasicInfo",requires:["Soims.view.application.common.V4BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v4basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V4Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv4tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V4BasicInfo","Soims.view.application.common.SampleInfo","Soims.model.application.common.SampleApplicationType"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){Soims.model.application.common.SampleApplicationType;this.items=[{xtype:"v4basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.view.application.common.V4Sample",{itemId:"applicationCommonV4Sample",extend:"Ext.form.Panel",requires:["Ext.ux.form.TreeField"],alias:"widget.v4sample",title:"拟申请样品信息",padding:2,AutoScroll:!0,overflowY:"auto",autoShow:!0,autoHeight:!0,style:"background-color: #dfe8f5;",initComponent:function(){this.deleteid="";var e=Ext.create("Soims.store.tree.Tree");this.store=Ext.create("Soims.store.application.common.Sample"),this.isDiscussion&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.tree.UsePurpose");this.borrowStore=Ext.create("Soims.store.application.common.BorrowOrUse"),this.columns=[{xtype:"rownumberer"},{header:"ID",dataIndex:"id",hidden:!0},{header:"样品类型",dataIndex:"sampleTypeID",flex:1,editor:{xtype:"treefield",disabled:this.isShow,singleChecked:!0,pickerTitle:"选择样品类型",store:e},renderer:function(t,i,o){if(t){var l=t.split(","),a=!0,d="";return Ext.Array.each(l,function(t){if(""!==t){var i=t.split("|"),o=e.getNodeById(i[0]),l=document.getElementById("textBox"+i[0]);o?d=l?d+"["+l.value+"]":d+"["+o.get("text")+"]":a=!1}}),a?d:o.get("sampleType")}}},{header:"使用/借用",dataIndex:"borrowOrUser",flex:1,editor:{xtype:"combobox",store:this.borrowStore,disabled:this.isShow,queryMode:"local",editable:!1,displayField:"name",valueField:"name",allowBlank:!1}},{header:"样品量",dataIndex:"sampleTotalNumber",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:"申请样品用途及目的",dataIndex:"usePurposeID",flex:1,editor:{xtype:"treefield",disabled:this.isShow,pickerTitle:"选择使用目的",store:t},renderer:function(e,i,o){if(e){console.log(e),console.log(o);var l=e.split(","),a=!0,d="";return Ext.Array.each(l,function(e){if(""!==e){var i=e.split("|"),o=t.getNodeById(i[0]),l=document.getElementById("textBox"+i[0]);console.log(o),o?d=l?d+"["+l.value+"]":d+"["+o.get("text")+"]":a=!1}}),a?d:o.get("usePurpose")}}}];var i={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSample",iconCls:"Add"},{text:"删除",itemId:"deleteSample",xtype:"button",disabled:!0,iconCls:"Delete"}]};this.items=[{xtype:"gridpanel",title:"样品列表",alias:"widget.v4samplegrid",itemId:"applicationCommonV4SampleGrid",store:this.store,columns:this.columns,selType:"rowmodel",emptyText:"没有满足条件的样品",height:200,style:"background-color: #dfe8f5;",plugins:[{ptype:"cellediting",clicksToEdit:1}],tbar:i,listeners:{selectionchange:function(e,t){this.down("#deleteSample").setDisabled(0!=t.length?!1:!0)}}},{xtype:"fieldset",title:"基本信息",hidden:this.isDiscussion,collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",layout:"column",padding:"10 10 10 10",height:85,items:[{columnWidth:.4,layout:"column",bodyStyle:"background-color: #dfe8f5;",border:0,items:{xtype:"datefield",name:"activityStartTime",itemId:"activityStartTime",fieldLabel:"样品借用开始时间",readOnly:this.isShow}},{columnWidth:.4,layout:"column",bodyStyle:"background-color: #dfe8f5;",border:0,items:{xtype:"datefield",itemId:"activityEndTime",name:"activityEndTime",fieldLabel:"结束时间",readOnly:this.isShow}}]}],this.callParent()}});Ext.define("Soims.controller.application.common.V4Sample",{extend:"Ext.app.Controller",views:["application.common.V4Sample"],refs:[{ref:"v4sample",selector:"v4sample",autoCreate:!0,xtype:"v4sample"},{ref:"v4samplegrid",selector:"v4samplegrid",autoCreate:!0,xtype:"v4samplegrid"}],init:function(){this.control({"v4sample button[itemId=v4SampleSave]":{click:function(e){var t=e.up("#applicationCommonV4Sample"),a=t.applicationID;return a?void this.saveAction(a,t,!0):void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this)}},"v4sample button[itemId=addSample]":{click:function(e){var t=e.up("#applicationCommonV4Sample");if(void 0==t.applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this);var a=Ext.create("Soims.model.application.common.Sample");t.down("#applicationCommonV4SampleGrid").getStore().insert(0,a),t.down("#applicationCommonV4SampleGrid").getView().refresh()}},"v4sample button[itemId=deleteSample]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此样品？点击保存按钮生效。",function(t){if("yes"==t){var a=e.up("#applicationCommonV4Sample"),i=e.up("#applicationCommonV4SampleGrid"),o=i.getSelectionModel(),n=o.getSelection()[0];a.deleteid=a.deleteid+","+n.get("id"),i.getStore().remove(n)}},this)}},v4sample:{afterrender:function(e){var t=e.applicationID;if(t){var a=e.down("#applicationCommonV4SampleGrid").getStore();a.getProxy().setExtraParam("applicationID",t),a.load()}}}})},getCon:function(e){var t=this.application;return t.getController(e)},saveAction:function(e,t,a){this.sampleDelete(t.deleteid),this.sampleSave(e,t,a),this.commitResultSave(e,t),t.deleteid=""},sampleDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Delete",params:t,async:!1,success:function(){}})},sampleSave:function(e,t,a){var i=t.down("#applicationCommonV4SampleGrid"),o=i.getStore();o.each(function(t){t.set("sampleApplication",e),""==t.get("sampleTypeID")&&t.set("sampleTypeID",t.get("sampleType")),""==t.get("usePurposeID")&&t.set("usePurposeID",t.get("usePurpose")),Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Save",params:t.data,async:!1,success:function(e){var a=e.responseText.split(",");t.set("id",a[0]),t.set("sampleAreaAndCountID",a[1])}}),a&&Ext.MessageBox.alert("成功","信息保存成功！",function(){},this),o.getProxy().setExtraParam("applicationID",e),o.load()})},commitResultSave:function(e,t){var a=t.down("textfield[name=activityStartTime]").getValue(),i=t.down("textfield[name=activityEndTime]").getValue(),o={applicationID:e,activityStartTime:a,activityEndTime:i};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ActivityTimeSave",params:o,success:function(){}})}});Ext.define("Soims.controller.applicationAccept.V4Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V4Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv4tab",selector:"acceptv4tab",autoCreate:!0,xtype:"acceptv4tab"}],init:function(){this.getController("application.common.V4Sample"),this.control({acceptv4tab:{render:function(t){if(1==t.isEdit||1==t.isShow){var e=t.down("v4basicinfopanel"),i=e.down("#activity"),c=i.getStore(),o=Ext.create("Soims.store.application.show.V4Detail");o.getProxy().setExtraParam("ID",t.applicationID),o.load(function(){0!=o.getCount()&&c.load(function(){var c=Ext.create("Soims.model.application.new.Activity",{activityID:o.getAt(0).get("activityID"),activityName:o.getAt(0).get("activityName")});i.setValue(c),e.loadRecord(o.getAt(0));var a=t.down("#applicationCommonV4Sample");a.applicationID=o.getAt(0).get("id"),a.down("datefield[itemId=activityStartTime]").setValue(o.getAt(0).get("activityStartTime")),a.down("datefield[itemId=activityEndTime]").setValue(o.getAt(0).get("activityEndTime"))})})}}},"acceptv4tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,i){var c=t.up("panel"),o=c.applicationID,a=c.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+i+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:a,Action:e,ApplicationID:o,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.controller.applicationAccept.AcceptApplicationGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AcceptApplicationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType","Soims.controller.applicationAccept.B1Tab","Soims.controller.applicationAccept.B2Tab","Soims.controller.applicationAccept.V1Tab","Soims.controller.applicationAccept.V2Tab","Soims.controller.applicationAccept.V3Tab","Soims.controller.applicationAccept.V4Tab"],refs:[{ref:"acceptapplicationgrid",selector:"acceptapplicationgrid",autoCreate:!0,xtype:"acceptapplicationgrid"}],init:function(){this.control({"acceptapplicationgrid  button[action=accept]":{click:this.onClickAppAcceptBtn},acceptapplicationgrid:{itemclick:function(e,i){console.log("Hello"),this.showHistoryState(i)},selectionchange:function(e,i){var t=this.getAcceptapplicationgrid();t.down("#accept").setDisabled(i.length>0?!1:!0)}}})},showHistoryState:function(e){var i=e.get("id"),t=this.getAcceptapplicationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(i),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:i},method:"POST",scope:this,success:function(i){console.log(i.responseText);var p=Ext.JSON.decode(i.responseText);t.refresh(p,e.get("type"))}})},showTab:function(e,i,t,p,c){var a=this.getCon("mainFrame.Main"),o=a.existInstance(e);if(o)return o;var n=Ext.create(t,{id:e,title:i,applicationID:p,isShow:!0,isAccept:!0,appType:c,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return a.addTab(n),n},show:function(){var e=this.getAcceptapplicationgrid(),i=this.getCon("mainFrame.Main");i.addTab(e)},refreshGrid:function(){this.show(),this.getAcceptapplicationgrid().getStore().reload(),this.getAcceptapplicationgrid().getSelectionModel().deselectAll()},getCon:function(e){var i=this.application;return i.getController(e)},onClickAppAcceptBtn:function(e){{var i=e.up("grid"),t=i.getSelectionModel().getSelection()[0],p=t.get("type"),c=this.getViewFnByApp("applicationAccept",p,"Tab");this.showTab("Accept"+p+t.get("id"),"受理"+t.get("name"),c,t.get("id"))}},getViewFnByApp:function(e,i,t){var p=null,c=this.getCon(e+"."+i+t);switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:p=c.getApplicationAcceptB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:p=c.getApplicationAcceptB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:p=c.getApplicationAcceptV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:p=c.getApplicationAcceptV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:p=c.getApplicationAcceptV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:p=c.getApplicationAcceptV4TabView()}return p}});Ext.define("Soims.model.applicationAccept.Accept",{extend:"Ext.data.Model",fields:[{name:"acceptID",type:"int",mapping:"AcceptID"},{name:"acceptAction",mapping:"AcceptAction"},{name:"acceptContent",mapping:"AcceptContent"},{name:"acceptTime",mapping:"AcceptTime"},{name:"applicationID",type:"int",mapping:"ID"},{name:"name",mapping:"Name"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"type",mapping:"Type"},{name:"applyTime",mapping:"ApplyTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.store.applicationAccept.AcceptComplete",{extend:"Ext.data.Store",model:"Soims.model.applicationAccept.Accept",autoLoad:!1,proxy:{type:"ajax",url:Soims.service.ApplicationAccepts.AcceptService+"/QueryAcceptCompleteByUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.applicationAccept.AcceptCompleteGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.applicationAccept.AcceptAction","Soims.store.applicationAccept.AcceptComplete"],alias:"widget.acceptcompletegrid",title:"待分配申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AcceptComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"acceptID",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"申请书编号",dataIndex:"applicationNumber",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"受理日期",dataIndex:"acceptTime",flex:1}],this.tbar=[{text:"查看",xtype:"button",itemId:"show",action:"show",disabled:!0,iconCls:"Information"},{text:"导出现场申请Excel",xtype:"button",itemId:"exportSiteApplication",iconCls:"DiskDownload"},{text:"导出室内申请Excel",xtype:"button",itemId:"exportIndoorApplication",iconCls:"DiskDownload"},{text:"导入现场分配建议Excel",xtype:"button",itemId:"importSiteExcel",iconCls:"DiskUpload"},{text:"导入室内分配建议Excel",xtype:"button",itemId:"importIndoorExcel",iconCls:"DiskUpload"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.AcceptCompleteGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AcceptCompleteGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"acceptcompletegrid",selector:"acceptcompletegrid",autoCreate:!0,xtype:"acceptcompletegrid"}],init:function(){this.control({"acceptcompletegrid  button[action=show]":{click:this.onClickAppShowBtn},"acceptcompletegrid  button[itemId=exportSiteApplication]":{click:this.onExportSiteApplication},"acceptcompletegrid  button[itemId=exportIndoorApplication]":{click:this.onExportIndoorApplication},"acceptcompletegrid  button[itemId=importSiteExcel]":{click:this.onImportSiteApplication},"acceptcompletegrid  button[itemId=importIndoorExcel]":{click:this.onImportIndoorApplication},acceptcompletegrid:{itemclick:function(e,t){console.log("Hello"),this.showHistoryState(t)},selectionchange:function(e,t){var o=this.getAcceptcompletegrid();o.down("#show").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(e){console.log(e);var t=e.get("applicationID"),o=this.getAcceptcompletegrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var i=Ext.JSON.decode(t.responseText);o.refresh(i,e.get("type"))}})},showTab:function(e,t,o,i,p){var c=this.getCon("mainFrame.Main"),n=c.existInstance(e);if(n)return n;var a=Ext.create(o,{id:e,title:t,applicationID:i,isShow:!0,isAccept:!1,appType:p,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return c.addTab(a),a},show:function(){var e=this.getAcceptcompletegrid(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},onClickAppShowBtn:function(e){{var t=e.up("grid"),o=t.getSelectionModel().getSelection()[0],i=o.get("type"),p=this.getViewFnByApp("applicationAccept",i,"Tab");this.showTab("ShowAccept"+i+o.get("id"),"查看"+o.get("name"),p,o.get("applicationID"),i)}},getViewFnByApp:function(e,t,o){var i=null,p=this.getCon(e+"."+t+o);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:i=p.getApplicationAcceptB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:i=p.getApplicationAcceptB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:i=p.getApplicationAcceptV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:i=p.getApplicationAcceptV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:i=p.getApplicationAcceptV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:i=p.getApplicationAcceptV4TabView()}return i},onExportIndoorApplication:function(){var e=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportIndoorAppToXlsExcel?isIE="+e},onExportSiteApplication:function(){var e=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportSiteAppToXlsExcel?isIE="+e},onImportSiteApplication:function(){var e=this.getCon("applicationAccept.DocumentUploadWin");e.show("/ImportSiteAppExcel")},onImportIndoorApplication:function(){var e=this.getCon("applicationAccept.DocumentUploadWin");e.show("/ImportIndoorAppExcel")}});Ext.define("Soims.view.applicationAccept.AllocationGrid",{extend:"Ext.grid.Panel",requires:"Soims.model.applicationAccept.AcceptAction",alias:"widget.allocationgrid",title:"已分配申请书列表",iconCls:"ApplicationViewColumns",closable:!0,features:[{ftype:"grouping",groupHeaderTpl:'<span style="font-size:12px">{[values.rows[0].data.name]}</span>'}],selModel:{mode:"MULTI"},selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AllocationComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"acceptID",flex:1,hidden:!0},{header:"样品类型",dataIndex:"sampleType",flex:1},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"申请书编号",dataIndex:"applicationNumber",flex:1},{header:"填写人",dataIndex:"applicantName",hidden:!0,flex:1},{header:"负责人",dataIndex:"charger",hidden:!0,flex:1},{header:"本任务既往使用样品情况",dataIndex:"taskPreviousUsage",flex:1},{header:"申请人既往使用样品情况",dataIndex:"supplierPreviousUsage",flex:1},{header:"样品现场使用意见",dataIndex:"suggestion",flex:1},{header:"取用次序",dataIndex:"order",flex:1}],this.tbar=[{text:"收缩所有分组",xtype:"button",iconCls:"Refresh",tooltip:"<b>收缩分组</b><br/>收缩所有分组",handler:function(){var e=this.up("grid"),t=e.getView().getFeature(0);t.collapseAll()}},{text:"展开所有分组",xtype:"button",iconCls:"Refresh",tooltip:"<b>展开分组</b><br/>展开所有分组",handler:function(){var e=this.up("grid"),t=e.getView().getFeature(0);t.expandAll()}},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()},listeners:{groupclick:function(e,t,a,i){var l=i.getTarget(".grpBtn");l&&alert("hello")}}});Ext.define("Soims.controller.applicationAccept.AllocationGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AllocationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"allocationgrid",selector:"allocationgrid",autoCreate:!0,xtype:"allocationgrid"}],init:function(){this.control({allocationgrid:{itemclick:function(o,i){console.log("Hello"),this.showHistoryState(i)}}})},showHistoryState:function(o){var i=o.get("applicationID"),t=this.getAllocationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(i),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:i},method:"POST",scope:this,success:function(i){console.log(i.responseText);var e=Ext.JSON.decode(i.responseText);t.refresh(e,o.get("type"))}})},showTab:function(o,i,t,e,n){var a=this.getCon("mainFrame.Main"),p=a.existInstance(o);if(p)return p;var c=Ext.create(t,{id:o,title:i,applicationID:e,isShow:!0,isAccept:!1,appType:n,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return a.addTab(c),c},show:function(){var o=this.getAllocationgrid(),i=this.getCon("mainFrame.Main");i.addTab(o)},getCon:function(o){var i=this.application;return i.getController(o)},onExportIndoorApplication:function(){var o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportIndoorAppToXlsExcel?isIE="+o},onExportSiteApplication:function(){var o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportSiteAppToXlsExcel?isIE="+o},onImportSiteApplication:function(){var o=this.getCon("applicationAccept.DocumentUploadWin");o.show("/ImportSiteAppExcel")},onImportIndoorApplication:function(){var o=this.getCon("applicationAccept.DocumentUploadWin");o.show("/ImportIndoorAppExcel")}});Ext.define("Soims.controller.user.User",{extend:"Ext.app.Controller",stores:["user.User"],views:["user.User"],refs:[{ref:"user",selector:"user",autoCreate:!0,xtype:"user"}],init:function(){this.control({"user  button[itemId=add]":{click:function(){var e=this.getCon("user.UserWin");e.show()}},"user  button[itemId=modify]":{click:function(e){var t=this.getCon("user.UserWin"),s=e.up("panel"),i=s.getSelectionModel(),o=i.getSelection()[0];t.getUserwin().down("panel").loadRecord(o)}},"user  button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","您确定要删除此用户么，用户所有信息都将丢失？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"user  button[itemId=manageRole]":{click:function(e){var t=this.getCon("user.RoleWin"),s=e.up("panel"),i=s.getSelectionModel(),o=i.getSelection()[0];t.show(o.get("roleIds"))}},"user  button[itemId=resetPd]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要重置该用户密码么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/ResetPd",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","重置完成！",function(){},this)}})},this)}},"user  button[itemId=frozenUser]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要冻结该用户么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/FrozenUser",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","冻结完成！",function(){},this)}})},this)}},"user  button[itemId=thawUser]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要解冻该用户么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/ThawUser",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","解冻完成！",function(){},this)}})},this)}},"user  button[itemId=refreshTbarUser]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},user:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getUser().down("#modify").setDisabled(!1),this.getUser().down("#delete").setDisabled(""==t[0].get("roleIds")?!1:!1),this.getUser().down("#manageRole").setDisabled(!1),this.getUser().down("#resetPd").setDisabled(!1),this.getUser().down("#frozenUser").setDisabled(!1),this.getUser().down("#thawUser").setDisabled(!1)):(this.getUser().down("#modify").setDisabled(!0),this.getUser().down("#delete").setDisabled(!0),this.getUser().down("#manageRole").setDisabled(!0),this.getUser().down("#resetPd").setDisabled(!0),this.getUser().down("#frozenUser").setDisabled(!0),this.getUser().down("#thawUser").setDisabled(!0))}}})},show:function(){var e=this.getUser(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.Ajax.request({url:Soims.service.users.UserService+"/Delete",method:"POST",scope:this,params:{id:o},success:function(){this.getUserUserStore().reload()}})}});Ext.define("Soims.model.user.Role",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"rolename",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"}]});Ext.define("Soims.store.user.Role",{extend:"Ext.data.Store",model:"Soims.model.user.Role",proxy:{type:"ajax",url:Soims.service.users.RoleService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.model.user.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"department",type:"int",mapping:"Department"},{name:"departmentName",type:"string",mapping:"DepartmentName"},{name:"roleIds",type:"string",mapping:"RoleIds"},{name:"roles",type:"string",mapping:"Roles"}]});Ext.define("Soims.view.user.User",{extend:"Ext.grid.Panel",alias:"widget.user",title:"用户列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"User",closable:!0,store:"user.User",selType:"rowmodel",initComponent:function(){this.columns=[{header:"用户姓名",dataIndex:"name",flex:.1},{header:"单位",dataIndex:"departmentName",flex:.1},{header:"角色",dataIndex:"roles",flex:.8}],this.tbar=[{text:"添加用户",xtype:"button",iconCls:"Add",itemId:"add",disabled:!1},{text:"修改用户",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"删除用户",xtype:"button",itemId:"delete",iconCls:"Delete",disabled:!0},{text:"角色分配",xtype:"button",iconCls:"GroupEdit",itemId:"manageRole",disabled:!0},{text:"密码重置",xtype:"button",iconCls:"Key",itemId:"resetPd",disabled:!0},{text:"冻结用户",xtype:"button",iconCls:"Cancel",itemId:"frozenUser",disabled:!0},{text:"解冻用户",xtype:"button",iconCls:"ArrowUp",itemId:"thawUser",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarUser",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.view.user.Role",{extend:"Ext.grid.Panel",alias:"widget.role",title:"角色列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Group",closable:!0,store:"user.Role",selType:"rowmodel",initComponent:function(){this.columns=[{header:"角色",dataIndex:"rolename",flex:1},{header:"角色代码",dataIndex:"code",flex:1}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",itemId:"add",disabled:!1},{text:"权限分配",xtype:"button",itemId:"manageRight",disabled:!0},{text:"查看权限",xtype:"button",itemId:"showRight",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarRole",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.Role",{extend:"Ext.app.Controller",stores:["user.Role"],views:["user.Role"],refs:[{ref:"role",selector:"role",autoCreate:!0,xtype:"role"}],init:function(){this.control({"role  button[itemId=add]":{click:function(){}},"role  button[itemId=manageRight]":{click:function(){}},"role  button[itemId=showRight]":{click:function(){}},"role  button[itemId=refreshTbarRole]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},role:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getRole().down("#manageRight").setDisabled(!1),this.getRole().down("#showRight").setDisabled(!1)):(this.getRole().down("#manageRight").setDisabled(!0),this.getRole().down("#showRight").setDisabled(!0))}}})},show:function(){var e=this.getRole();this.getUserRoleStore().load();var t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)}});Ext.define("Soims.store.user.User",{extend:"Ext.data.Store",model:"Soims.model.user.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.user.WaitAuditUser",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"nameSpell",type:"string",mapping:"NameSpell"},{name:"email",type:"string",mapping:"Email"},{name:"department",type:"string",mapping:"Department"},{name:"departmentID",type:"int",mapping:"DepartmentID"},{name:"remark",type:"string",mapping:"Remark"}]});Ext.define("Soims.store.user.WaitAuditUser",{extend:"Ext.data.Store",model:"Soims.model.user.WaitAuditUser",proxy:{type:"ajax",url:Soims.service.users.PersonService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.user.WaitAuditUser",{extend:"Ext.grid.Panel",alias:"widget.waitAuditUser",title:"待激活的用户列表",iconCls:"User",viewConfig:{emptyText:"没有满足条件的项目"},closable:!0,store:"user.WaitAuditUser",selType:"checkboxmodel",initComponent:function(){this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"单位",dataIndex:"department",flex:1}],this.tbar=[{text:"通过",xtype:"button",iconCls:"Accept",itemId:"pass",disabled:!0},{text:"驳回",xtype:"button",iconCls:"ArrowUndo",itemId:"reject",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarAudit",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.WaitAuditUser",{extend:"Ext.app.Controller",stores:["user.WaitAuditUser"],views:["user.WaitAuditUser"],refs:[{ref:"waitAuditUser",selector:"waitAuditUser",autoCreate:!0,xtype:"waitAuditUser"}],init:function(){this.control({"waitAuditUser  button[itemId=pass]":{click:function(e){this.saveAsUser(e)}},"waitAuditUser  button[itemId=reject]":{click:function(e){this.deleteDataBase(e)}},"waitAuditUser  button[itemId=refreshTbarAudit]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},waitAuditUser:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getWaitAuditUser().down("#pass").setDisabled(!1),this.getWaitAuditUser().down("#reject").setDisabled(!1)):(this.getWaitAuditUser().down("#pass").setDisabled(!0),this.getWaitAuditUser().down("#reject").setDisabled(!0))}}})},show:function(){var e=this.getWaitAuditUser(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),i=t.getSelectionModel(),s=i.getSelection(),r="";Ext.Array.each(s,function(e){e.get("id")&&(r=r+e.get("id")+",")}),Ext.Ajax.request({url:Soims.service.users.PersonService+"/DeletePersonByIds",method:"POST",scope:this,params:{ids:r},success:function(){this.getUserWaitAuditUserStore().reload()}})},saveAsUser:function(e){var t=e.up("panel"),i=t.getSelectionModel(),s=i.getSelection(),r="";Ext.Array.each(s,function(e){e.get("id")&&(r=r+e.get("id")+",")}),Ext.Ajax.request({url:Soims.service.users.UserService+"/SaveAuditUserByIds",method:"POST",scope:this,params:{ids:r},success:function(){this.getUserWaitAuditUserStore().reload()}})}});Ext.define("Soims.model.voyage.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"}]});Ext.define("Soims.model.department.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"address",type:"string",mapping:"Address"},{name:"type",type:"string",mapping:"Type"},{name:"test",type:"string",mapping:"Test"}]});Ext.define("Soims.view.department.Department",{extend:"Ext.grid.Panel",alias:"widget.department",title:"单位列表",iconCls:"Group",pageSize:10,closable:!0,store:"department.Department",selType:"rowmodel",initComponent:function(){this.columns=[{header:"单位名称",dataIndex:"name",flex:1},{header:"单位地址",dataIndex:"address",flex:1},{header:"单位类型",dataIndex:"type",flex:1}],this.tbar=[{text:"添加",iconCls:"Add",xtype:"button",itemId:"add"},{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarDep",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.department.Department",{extend:"Ext.app.Controller",stores:["department.Department"],views:["department.Department"],refs:[{ref:"department",selector:"department",autoCreate:!0,xtype:"department"}],init:function(){this.control({"department  button[itemId=add]":{click:function(){var e=this.getCon("department.DepartmentWin");e.show()}},"department  button[itemId=modify]":{click:function(e){var t=this.getCon("department.DepartmentWin"),n=e.up("panel"),a=n.getSelectionModel(),i=a.getSelection()[0];t.getDepartmentWin().down("panel").loadRecord(i)}},"department  button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","您确定要删除此单位么？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"department  button[itemId=refreshTbarDep]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},department:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getDepartment().down("#delete").setDisabled(!1),this.getDepartment().down("#modify").setDisabled(!1)):(this.getDepartment().down("#delete").setDisabled(!0),this.getDepartment().down("#modify").setDisabled(!0))}}})},show:function(){var e=this.getDepartment(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),n=t.getSelectionModel(),a=n.getSelection()[0],i=a.get("id");Ext.Ajax.request({url:Soims.service.departments.DepartmentService+"/Delete",method:"POST",scope:this,params:{id:i},success:function(){this.getDepartmentDepartmentStore().reload()}})}});Ext.define("Soims.view.voyage.VoyageBasic",{extend:"Ext.form.Panel",alias:"widget.voyagebasic",requires:["Soims.store.project.User","Soims.store.voyage.Department","Ext.ux.form.SearchComboBox"],title:"航次基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User"),t=Ext.create("Soims.store.voyage.Department");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,padding:"10 0 10 10",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"textfield",name:"name",forbidBlankAndShowStar:!0,readOnly:this.isShow,itemId:"name",fieldLabel:"航次名称"},{xtype:"textfield",name:"number",itemId:"number",forbidBlankAndShowStar:!0,regex:1==Soims.component.voyageBasicStartTimeHidden?void 0:/DY(\d*)-\d\d$/,regexText:"请输入正确格式，例如：DY125-05",readOnly:this.isShow,allowBlank:!1,fieldLabel:"航次代码"},{xtype:"searchcombo",name:"chargerId",itemId:"chargerId",showStar:!0,fieldLabel:"航次首席科学家",readOnly:this.isShow,store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationDepartId",readOnly:this.isShow,showStar:!0,itemId:"organizationDepartId",readOnly:this.isShow,fieldLabel:"实施单位",store:t,valueField:"id",displayField:"name"},{xtype:"datefield",name:"beginTime",itemId:"beginTime",forbidBlankAndShowStar:!0,fieldLabel:"开始时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#stopTime");a.setMinValue(t)}}},{xtype:"datefield",name:"stopTime",itemId:"stopTime",forbidBlankAndShowStar:!0,fieldLabel:"结束时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#beginTime");a.setMaxValue(t)}}}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationId",readOnly:this.isShow,showStar:!0,itemId:"organizationId",fieldLabel:"实施单位联系人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},{xtype:"datefield",name:"startTime",itemId:"startTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"开放申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicStartTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),i=e.up("panel").down("#endTime");i.setMinValue(t);for(var o=0;o<a.getCount();o++){var n=a.getAt(o);n.set("startApplyTime",t)}}}},{xtype:"datefield",name:"endTime",itemId:"endTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"结束申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicEndTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").down("#startTime");a.setMaxValue(t);for(var i=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),o=0;o<i.getCount();o++){var n=i.getAt(o);n.set("endApplyTime",t)}}}}]}],this.callParent()}});Ext.define("Soims.view.voyage.LegGrid",{extend:"Ext.grid.Panel",alias:"widget.leggrid",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Ext.ux.form.TreeField"],title:"航段列表",viewConfig:{emptyText:"没有满足条件的航段"},height:400,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.Leg"),void 0!==this.voyageId&&this.initStore();var t=Ext.create("Soims.store.tree.SampleAreaAll");this.tree=t,this.store=this.vStore,this.columns=[{header:'<span>航段编号<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段代码<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"code",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段首席科学家<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,a){if(t){var o=e.findRecord("id",t);return null===o?a.get("chargerName"):o.get("name")}}},{header:'<span>采样区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAreaIds",flex:1,editor:{xtype:"treefield",pickerTitle:"航段所在采样区域",disabled:this.isShow,onlyCheckChild:!0,store:t},renderer:function(e,i,a){if(e){var o=e.split(","),d=!0,n="";return Ext.Array.each(o,function(e){if(""!==e){var i=e.split("|"),a=t.getNodeById(i[0]),o=document.getElementById("textBox"+i[0]);a?n=o?n+"["+o.value+"]":n+"["+a.get("text")+"]":d=!1}}),d?n:a.get("sampleAreas")}}},{header:'<span>开始时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"startTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>结束时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"endTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>开放申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"startApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,allowBlank:Soims.component.voyageBasicStartTimeHidden}},{header:'<span>结束申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"endApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,name:"endApplyTime",allowBlank:Soims.component.voyageBasicStartTimeHidden}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarlg",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},reloadTree:function(){this.tree.reload();var e=this.tree.getRootNode();e.eachChild(function(e){e.data.leaf||this.tree.load({node:e})},this)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageLeg",{extend:"Ext.form.Panel",alias:"widget.editvoyageleg",title:"航次航段",buttonAlign:"center",requires:["Soims.view.voyage.VoyageBasic","Soims.view.voyage.LegGrid"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagebasic",voyageId:this.voyageId,isShow:this.isShow},{xtype:"leggrid",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"保存",xtype:"button",hidden:this.isShow,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.model.voyage.Leg",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"voyageId",type:"int",mapping:"VoyageId"},{name:"name",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"sampleAreas",type:"string",mapping:"SampleAreas"},{name:"sampleAreaIds",type:"string",mapping:"SampleAreaIds"},{name:"startTime",type:"date",mapping:"StartTime"},{name:"endTime",type:"date",mapping:"EndTime"},{name:"startApplyTime",type:"date",mapping:"StartApplyTime"},{name:"endApplyTime",type:"date",mapping:"EndApplyTime"}]});Ext.define("Soims.store.voyage.VoyageTask",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageTask",proxy:{type:"ajax",url:Soims.service.voyages.VoyageTaskService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.store.voyage.Leg",{extend:"Ext.data.Store",model:"Soims.model.voyage.Leg",proxy:{type:"ajax",url:Soims.service.voyages.LegService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageTask",{extend:"Ext.grid.Panel",alias:"widget.voyagetask",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Soims.store.voyage.VoyageTask"],viewConfig:{emptyText:"没有满足条件的航次任务"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.legStore=Ext.create("Soims.store.voyage.Leg"),this.vStore=Ext.create("Soims.store.voyage.VoyageTask"),void 0!==this.voyageId&&(this.initStore(),this.vStore.load()),this.store=this.vStore,this.columns=[{header:'<span>任务名称<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>任务负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,o,i){if(t){var a=e.findRecord("id",t);return null===a?i.get("chargerName"):a.get("name")}}},{header:'<span>所在航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"voyageTaskLegNames",flex:1,editor:{xtype:"combo",store:this.legStore,multiSelect:!0,editable:!1,disabled:this.isShow,valueField:"name",allowBlank:!1,displayField:"name"}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarEq",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.legStore.getProxy().setExtraParam("voyageId",this.voyageId),this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var o=e.getEditor(t.record,t.column);o.revertInvalid=!1}}});Ext.define("Soims.model.project.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"departmentName",type:"string",mapping:"Department"},{name:"address",type:"string",mapping:"Address"},{name:"cellphone",type:"string",mapping:"Cellphone"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"zipCode",type:"string",mapping:"ZipCode"},{name:"fax",type:"string",mapping:"Fax"}]});Ext.define("Soims.store.project.User",{extend:"Ext.data.Store",model:"Soims.model.project.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.store.voyage.Department",{extend:"Ext.data.Store",model:"Soims.model.voyage.Department",proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.voyage.VoyageTask",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"voyageTaskLegIds",type:"string",mapping:"VoyageTaskLegIds"},{name:"voyageTaskLegNames",type:"string",mapping:"VoyageTaskLegNames"}]});Ext.define("Soims.view.voyage.EditVoyageTask",{extend:"Ext.form.Panel",alias:"widget.editvoyagetask",title:"航次任务",buttonAlign:"center",requires:["Soims.view.voyage.VoyageTask"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagetask",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.store.department.Department",{extend:"Ext.data.Store",model:"Soims.model.department.Department",autoLoad:!0,proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Query",reader:{type:"xml",root:"List",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.voyage.VoyageReportBasic",{extend:"Ext.form.Panel",alias:"widget.voyagereportbasic",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox"],title:"航次报告基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,margin:"5 5 5 5",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"textfield",name:"name",allowBlank:!1,readOnly:this.isShow,forbidBlankAndShowStar:!0,itemId:"name",fieldLabel:"航次报告名称"}]},{xtype:"panel",border:!1,layout:"form",margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"searchcombo",name:"chargerId",readOnly:this.isShow,showStar:!0,itemId:"chargerId",fieldLabel:"报告牵头负责人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]}],this.callParent()}});Ext.define("Soims.model.voyage.VoyageReportDetail",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"discipline",type:"string",mapping:"Discipline"}]});Ext.define("Soims.store.voyage.VoyageReportDetail",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageReportDetail",proxy:{type:"ajax",url:Soims.service.voyages.VoyageReportDetailService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageReportDetail",{extend:"Ext.grid.Panel",alias:"widget.voyagereportdetail",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.VoyageReportDetail"],viewConfig:{emptyText:"没有满足条件的航次任务"},title:"航次报告分工信息",plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.VoyageReportDetail"),void 0!==this.voyageId&&this.initStore(),this.store=this.vStore,this.columns=[{header:'<span>分工负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,o){if(t){var a=e.findRecord("id",t);return null===a?o.get("chargerName"):a.get("name")}}},{header:'<span>负责学科和调查区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"discipline",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbardl",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageReport",{extend:"Ext.form.Panel",alias:"widget.editvoyagereport",title:"航次报告",buttonAlign:"center",requires:["Soims.view.voyage.VoyageReportBasic","Soims.view.voyage.VoyageReportDetail"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagereportbasic",isShow:this.isShow,voyageId:this.voyageId},{xtype:"voyagereportdetail",isShow:this.isShow,voyageId:this.voyageId}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"完成",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"complete"}],this.callParent()},lock:function(){this.down("#complete").setDisabled(!0),this.down("#save").setDisabled(!0)},unlock:function(){this.down("#complete").setDisabled(!1),this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.BoardPeoplePanel",{extend:"Ext.grid.Panel",alias:"widget.boardpeoplepanel",title:"上船人员列表",viewConfig:{emptyText:"没有满足条件的项目"},closable:!1,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.BoardPeople"),this.voyageId&&this.initStore(),this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"身份证号",dataIndex:"identityNumber",flex:1},{header:"性别",dataIndex:"sex",flex:1},{header:"单位",dataIndex:"userCompany",flex:1},{header:"职务",dataIndex:"position",flex:1},{header:"岗位职责",dataIndex:"duty",flex:1},{header:"出生日期",dataIndex:"birthday",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"地址",dataIndex:"address",flex:1},{header:"联系电话",dataIndex:"tellPhone",flex:1},{header:"移动电话",dataIndex:"cellPhone",flex:1}],this.tbar=[{text:"添加",xtype:"button",hidden:this.isShow,iconCls:"Add",itemId:"add",disabled:void 0==this.voyageId?!0:!1},{text:"修改",xtype:"button",iconCls:"Disk",hidden:this.isShow,itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",hidden:this.isShow,xtype:"button",disabled:!0},{text:"导入单位信息Excel",hidden:this.isShow,itemId:"boardingPeopleDepartment",iconCls:"Disk",xtype:"button"},{text:"导入上船人员名单Excel",hidden:this.isShow,itemId:"boardingPeople",iconCls:"Disk",xtype:"button"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){0!=t.length?this.down("#modify").setDisabled(!1):(this.down("#delete").setDisabled(!0),this.down("#modify").setDisabled(!0))},initStore:function(){this.store.getProxy().setExtraParam("voyageId",this.voyageId)},lock:function(){this.down("#add").setDisabled(!0)},unlock:function(){this.down("#add").setDisabled(!1)}});Ext.define("Soims.view.voyage.EditVoyageTag",{extend:"Ext.tab.Panel",alias:"widget.editvoyagetag",title:"航次任务样品申请",closable:!0,iconCls:"Project",requires:["Soims.view.voyage.EditVoyageLeg","Soims.view.voyage.EditVoyageTask","Soims.view.voyage.EditVoyageReport","Soims.view.voyage.BoardPeoplePanel"],initComponent:function(){this.items=[{xtype:"editvoyageleg",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagetask",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagereport",isShow:this.isShow,voyageId:this.voyageId},{xtype:"boardpeoplepanel",isShow:this.isShow,voyageId:this.voyageId}],this.callParent()}});Ext.define("Soims.controller.voyage.EditVoyageTag",{extend:"Ext.app.Controller",views:["voyage.EditVoyageTag"],refs:[{ref:"editvoyagetag",selector:"editvoyagetag",autoCreate:!0,xtype:"editvoyagetag"}],init:function(){this.getCon("voyage.EditVoyageLeg"),this.getCon("voyage.EditVoyageTask"),this.getCon("voyage.EditVoyageReport"),this.getCon("voyage.BoardPeople"),this.control({})},show:function(){{var e=this.getVoyageEditVoyageTagView(),o=this.getCon("voyage.Voyage");o.showTab("newVoyage","新建航次航段",!1,e,void 0)}},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.view.voyage.Voyage",{extend:"Ext.grid.Panel",alias:"widget.voyage",title:"航次列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Project",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.Voyage"),this.columns=[{header:"航次代码",dataIndex:"name",flex:1},{header:"航次编号",dataIndex:"number",flex:1},{header:"航次首席科学家",dataIndex:"chargerName",flex:1},{header:"航次组织实施单位联系人",dataIndex:"organizationName",flex:1},{header:"航次组织实施单位",dataIndex:"organizationDepartName",flex:1},{header:"开始申请时间",dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1},{header:"结束申请时间",dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1}],this.tbar=[{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"查看",xtype:"button",iconCls:"Information",itemId:"show",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.voyage.Voyage",{extend:"Ext.app.Controller",views:["voyage.Voyage"],refs:[{ref:"voyage",selector:"voyage",autoCreate:!0,xtype:"voyage"}],init:function(){this.control({"voyage  button[itemId=modify]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("EditVoyage"+o.get("id"),o.get("name"),!1,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},"voyage  button[itemId=show]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("ShowVoyage"+o.get("id"),o.get("name"),!0,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},voyage:{selectionchange:function(e,o){0!=o.length?(this.getVoyage().down("#modify").setDisabled(!1),this.getVoyage().down("#show").setDisabled(!1)):(this.getVoyage().down("#modify").setDisabled(!0),this.getVoyage().down("#show").setDisabled(!0))}}})},showTab:function(e,o,t,a,g){var i=this.getCon("mainFrame.Main"),n=i.existInstance(e);if(n)return n;var d=Ext.create(a,{id:e,title:o,isShow:t,voyageId:g});return i.addTab(d),d},show:function(){var e=this.getVoyage(),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.model.notification.NotificationList",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"sender",type:"string",mapping:"Sender"},{name:"senderID",type:"int",mapping:"SenderID"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"},{name:"state",type:"string",mapping:"State"}]});Ext.define("Soims.store.notification.NotificationList",{extend:"Ext.data.Store",model:"Soims.model.notification.NotificationList",autoLoad:!0,pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetNotifications",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.notification.NotificationList",{extend:"Ext.grid.Panel",alias:"widget.notificationlist",title:"公告",iconCls:"Notification",closable:!0,store:"notification.NotificationList",selType:"rowmodel",initComponent:function(){this.columns=[{header:"标题",dataIndex:"title",flex:1},{header:"发信人",dataIndex:"sender",flex:1},{header:"发送时间",dataIndex:"dateTime",flex:1},{header:"状态",dataIndex:"state",flex:1}],this.tbar=[{text:"发布公告",xtype:"button",action:"sendNotification",name:"sendNotification",itemId:"sendNotification",iconCls:"NotificationSend"},{text:"查看",xtype:"button",action:"checkNotification",name:"checkNotification",itemId:"checkNotification",iconCls:"NotificationCheck",hidden:!0},{text:"删除",name:"deleteNotification",action:"deleteNotification",itemId:"deleteNotification",iconCls:"NotificationDelete",xtype:"button",hidden:!0},{text:"置顶",name:"top",action:"top",itemId:"top",xtype:"button",iconCls:"NotificationTop",hidden:!0},{text:"取消置顶",name:"cancelTop",action:"cancelTop",itemId:"cancelTop",xtype:"button",iconCls:"NotificationCancel",hidden:!0},{text:"过期",name:"overdue",action:"overdue",itemId:"overdue",xtype:"button",iconCls:"NotificationOverdue",hidden:!0},{text:"取消过期",name:"cancelOverdue",action:"cancelOverdue",itemId:"cancelOverdue",iconCls:"NotificationCancelOverdue",xtype:"button",hidden:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.model.notification.Notification",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"}]});Ext.define("Soims.store.notification.Notification",{extend:"Ext.data.Store",model:"Soims.model.notification.Notification",pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetAvailable",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total",id:"ID"}},autoLoad:!0});Ext.define("Soims.view.notification.ShowNotificationBasic",{extend:"Ext.form.Panel",alias:"widget.shownotificationbasic",autoShow:!0,initComponent:function(){this.items=[{xtype:"htmleditor",width:590,height:50,name:"title",itemId:"title",readOnly:!0,hidden:!1},{xtype:"htmleditor",height:525,width:590,name:"content",itemId:"content",readOnly:!0,hidden:!1}],this.callParent()}});Ext.define("Soims.view.notification.ShowNotification",{extend:"Ext.window.Window",alias:"widget.shownotification",closable:!0,iconCls:"  ",requires:["Soims.view.notification.ShowNotificationBasic"],width:600,height:500,autoShow:!0,initComponent:function(){this.items=[{xtype:"shownotificationbasic",isShow:this.isShow}],this.buttons=[{text:"确定",xtype:"button",itemId:"Ok",action:"Ok"}],this.callParent()}});Ext.define("Soims.controller.notification.NotificationList",{extend:"Ext.app.Controller",stores:["notification.NotificationList"],views:["notification.NotificationList"],refs:[{ref:"notificationlist",selector:"notificationlist",autoCreate:!0,xtype:"notificationlist"}],init:function(){this.control({"notificationlist  button[itemId=sendNotification]":{click:function(){var t=this.getCon("notification.SendNotification");t.showWindow()}},"notificationlist  button[itemId=checkNotification]":{click:function(t){var i=this.getCon("notification.ShowNotification"),e=t.up("panel"),o=e.getSelectionModel(),n=o.getSelection()[0];i.getShownotification().down("#title").getToolbar().hide(),i.getShownotification().down("#content").getToolbar().hide();var s=this.application;s.getController("notification.ShowNotification").showWindow();s.getController("notification.ShowNotification").showWindow();i.getShownotification().down("panel").loadRecord(n)}},"notificationlist  button[itemId=deleteNotification]":{click:function(t){Ext.Tools.Confirm("确认","您确定要删除该条目？",function(i){"yes"==i&&this.deleteDataBase(t)},this)}},"notificationlist  button[itemId=top]":{click:function(t){this.top(t)}},"notificationlist  button[itemId=cancelTop]":{click:function(t){this.cancelTop(t)}},"notificationlist  button[itemId=overdue]":{click:function(t){this.overdue(t)}},"notificationlist  button[itemId=cancelOverdue]":{click:function(t){this.cancelOverdue(t)}},"notificationlist  button[itemId=refreshTbar]":{click:function(t){t.up("panel").getStore().reload(),t.up("panel").getSelectionModel().deselectAll()}},notificationlist:{itemdblclick:function(){},selectionchange:function(t,i){0!=i.length?"置顶"==i[0].get("state")?(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!0),this.getNotificationlist().down("#overdue").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1)):"普通"==i[0].get("state")?(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!0),this.getNotificationlist().down("#overdue").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1)):"过期"==i[0].get("state")&&(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!0),this.getNotificationlist().down("#cancelOverdue").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#overdue").setVisible(!1)):(this.getNotificationlist().down("#checkNotification").setVisible(!1),this.getNotificationlist().down("#deleteNotification").setVisible(!1),this.getNotificationlist().down("#top").setVisible(!1),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#overdue").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1))}}})},getCon:function(t){var i=this.application;return i.getController(t)},showNotificationList:function(){var t=this.getNotificationlist(),i=this.getCon("mainFrame.Main");i.addTab(t)},top:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Top",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},cancelTop:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/CancelTop",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},overdue:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Overdue",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},cancelOverdue:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/CancelOverdue",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},deleteDataBase:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Delete",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})}});Ext.define("Soims.controller.notification.ShowNotification",{extend:"Ext.app.Controller",stores:["notification.Notification"],views:["notification.ShowNotification"],refs:[{ref:"shownotification",selector:"shownotification",autoCreate:!0,xtype:"shownotification"}],init:function(){this.control({"shownotification  button[itemId=Ok]":{click:function(o){o.up("window").close()}}})},getCon:function(o){var i=this.application;return i.getController(o)},showWindow:function(){var o=this.getShownotification();return o}});Ext.define("Soims.view.application.ApplicationPanel",{extend:"Ext.form.Panel",alias:"widget.applicationpanel",iconCls:"ApplicationSideList",closable:!0,initComponent:function(){this.items=[{xtype:"applicationhistorypanel"},{xtype:this.grid}],this.title=this.title,this.callParent()}});Ext.define("Soims.view.application.ApplicationHistoryPanel",{itemId:"applicationApplicationHistoryPanel",extend:"Ext.form.Panel",alias:"widget.applicationhistorypanel",title:"申请历史流程",padding:2,bodyStyle:"background-color:#dfe8f5;",height:115,autoShow:!0,bodyPadding:"15 0 0 0",initComponent:function(){this.items={xtype:"label"},this.on("afterrender",this.showDefaultHistoryState),this.callParent()},refresh:function(t,i){switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:this.showB1(t);break;case Soims.model.application.common.SampleApplicationType.B2.value:this.showB2(t);break;case Soims.model.application.common.SampleApplicationType.V1.value:this.showV1(t);break;case Soims.model.application.common.SampleApplicationType.V2.value:this.showV2(t);break;case Soims.model.application.common.SampleApplicationType.V3.value:this.showV3(t);break;case Soims.model.application.common.SampleApplicationType.V4.value:this.showV4(t)}},showB1:function(t){var i=void 0==t.VODCSubmit?"Application/common/resources/images/appState/a_0.png":t.VODCSubmit.url,e=void 0==t.VODCSubmit?"":t.VODCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>航次组织实施单位审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showB2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showV1:function(t){var i=void 0==t.VRCSubmit?"Application/common/resources/images/appState/a_0.png":t.VRCSubmit.url,e=void 0==t.VRCSubmit?"":t.VRCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>任务牵头负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV3:function(t){var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showV4:function(t){console.log(t);var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showBeginHtml:function(t){var i=void 0==t.UnSubmit?"Application/common/resources/images/appState/a_1.png":t.UnSubmit.url,e=void 0==t.UnSubmit?"":t.UnSubmit.tip,o=void 0==t.Submit?"Application/common/resources/images/appState/a_2.png":t.Submit.url,a=void 0==t.Submit?"":t.Submit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>新建申请</div>';return l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>提交</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>'},showEndHtml:function(t){var i=void 0==t.AdminAccept?"Application/common/resources/images/appState/a_3.png":t.AdminAccept.url,e=void 0==t.AdminAccept?"":t.AdminAccept.tip,o=void 0==t.AdminAllot?"Application/common/resources/images/appState/a_4.png":t.AdminAllot.url,a=void 0==t.AdminAllot?"":t.AdminAllot.tip,l=void 0==t.SMESubmit?"Application/common/resources/images/appState/a_5.png":t.SMESubmit.url,n=void 0==t.SMESubmit?"":t.SMESubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,s='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>申请受理</div>';return s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>分配方案编制</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+n+'" src="'+l+'" height="24" width="24"><br>申请审议</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+p+'" src="'+m+'" height="24" width="24"><br>申请审批</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s+='<div style="text-align:center; width: 80px; float:left;"><img title="" src= "Application/common/resources/images/appState/a_7.png" " height="24" width="24"><br>样品清点与出库</div>'},showDefaultHistoryState:function(){var t={},i='<div style="text-align:center; width: 80px; float:left;"><img title="" src="Application/common/resources/images/appState/a_0.png" height="24" width="24"><br>申请审核</div>';i+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var e=this.showBeginHtml(t)+i+this.showEndHtml(t);this.down("label").setText(e,!1)}});Ext.define("Soims.model.application.common.SampleApplicationType",{statics:{B1:{value:"B1",name:"b1申请书"},B2:{value:"B2",name:"b2申请书"},V1:{value:"V1",name:"v1申请书"},V2:{value:"V2",name:"v2申请书"},V3:{value:"V3",name:"v3申请书"},V4:{value:"V4",name:"v4申请书"}}});Ext.define("Soims.controller.application.ApplicationHistoryPanel",{extend:"Ext.app.Controller",views:["application.ApplicationHistoryPanel"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationhistorypanel",selector:"applicationhistorypanel",autoCreate:!0,xtype:"applicationhistorypanel"}],init:function(){this.control({})},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.controller.application.ApplicationPanel",{extend:"Ext.app.Controller",views:["application.ApplicationPanel"],refs:[{ref:"applicationpanel",selector:"applicationpanel",autoCreate:!0,xtype:"applicationpanel"}],init:function(){this.control({applicationpanel:{resize:function(i,t,a){var n=i.down("grid");n.setHeight(a-120)}}})},showTab:function(i,t,a,n,e,o){var p=this.getCon("mainFrame.Main"),l=p.existInstance(i);if(l)return l;var r=Ext.create(a,{id:i,title:t,application:this.application,applicationID:n,isShow:e,isEdit:o});return p.addTab(r),r},show:function(i,t){this.getCon(i),this.getController("application.ApplicationHistoryPanel");var a=i.split(".")[1].toLowerCase(),n=this.getView("application.ApplicationPanel"),e=Ext.create(n,{id:a,grid:a,title:t}),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.model.application.common.ApplicationState",{statics:{Unknown:{value:"Unknown",name:"未知类型"},Cancel:{value:"Cancel",name:"已撤回"},Deleted:{value:"Deleted",name:"已删除"},UnSubmit:{value:"UnSubmit",name:"未提交"},Submit:{value:"Submit",name:"已提交"},VODCAudit:{value:"VODCAudit",name:"航次组织实施单位审核"},VODCSubmit:{value:"VODCSubmit",name:"组织实施单位已审核"},LSAudit:{value:"LSAudit",name:"航段首席科学家审核"},LSSubmit:{value:"LSSubmit",name:"航段首席科学家已审核"},VSAudit:{value:"VSAudit",name:"航次首席科学家审核"},VSSubmit:{value:"VSSubmit",name:"航次首席科学家已审核"},PCAudit:{value:"PCAudit",name:"项目负责人审核"},PCSubmit:{value:"PCSubmit",name:"项目负责人已审核"},VRCAudit:{value:"VRCAudit",name:"航次报告牵头负责人审核"},VRCSubmit:{value:"VRCSubmit",name:"航次报告牵头负责人已审核"},AdminAccept:{value:"AdminAccept",name:"大洋馆受理"},AdminAllot:{value:"AdminAllot",name:"大洋馆已分配"},AdminReject:{value:"AdminReject",name:"大洋馆驳回"},AdminDeny:{value:"AdminDeny",name:"大洋馆否决"},SMEAudit:{value:"SMEAudit",name:"样品管理专家委员会审议"},SMESubmit:{value:"SMESubmit",name:"样品管理专家委员会已审议"},OIAudit:{value:"OIAudit",name:"大洋协会联系人审批"},OISubmit:{value:"OISubmit",name:"大洋协会联系人已审批"},OIReject:{value:"OIReject",name:"大洋协会联系人驳回"}}});Ext.define("Soims.model.application.Application",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"name",mapping:"Name"},{name:"discussionTime",mapping:"DiscussionTime"},{name:"approvalTime",mapping:"ApprovalTime"},{name:"applicantID",mapping:"ApplicantID"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"chargerID",mapping:"ChargerID"},{name:"leg",mapping:"Leg"},{name:"voyage",mapping:"Voyage"},{name:"legID",mapping:"LegID"},{name:"type",mapping:"Type"},{name:"taskName",mapping:"TaskName"},{name:"topicID",mapping:"TopicID"},{name:"bearVoyageTaskID",mapping:"BearVoyageTaskID"},{name:"voyageReportID",mapping:"VoyageReportID"},{name:"noOceanTopicID",mapping:"NoOceanTopicID"},{name:"activityID",mapping:"ActivityID"},{name:"activityStartTime",mapping:"ActivityStartTime"},{name:"activityEndTime",mapping:"ActivityEndTime"},{name:"usingNecessity",mapping:"UsingNecessity"},{name:"repatriaionNecessity",mapping:"RepatriaionNecessity"},{name:"commitResultTime",mapping:"CommitResultTime"},{name:"commitResultForm",mapping:"CommitResultForm"},{name:"commitResultAmount",mapping:"CommitResultAmount"},{name:"applyTime",mapping:"ApplyTime"},{name:"createTime",mapping:"CreateTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.store.applicationAccept.AcceptApplication",{extend:"Ext.data.Store",model:"Soims.model.application.Application",autoLoad:!1,proxy:{type:"ajax",url:Soims.service.applications.ApplicationsService+"/QueryAcceptByUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.applicationAccept.AcceptApplicationGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.application.common.ApplicationState","Soims.store.applicationAccept.AcceptApplication"],alias:"widget.acceptapplicationgrid",title:"待受理申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AcceptApplication"),this.store.load(),this.columns=[{header:"申请书编号",dataIndex:"applicationNumber",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"申请书状态",dataIndex:"state",flex:1,renderer:function(e){return Soims.model.application.common.ApplicationState[e].name}},{header:"提交日期",dataIndex:"applyTime",flex:1}],this.tbar=[{text:"受理",xtype:"button",action:"accept",name:"accept",itemId:"accept",disabled:!0,iconCls:"Information"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.model.application.SamplePanelType",{statics:{AuditShow:{value:"AuditShow",name:"显示审核意见"},AuditEdit:{value:"AuditEdit",name:"编辑审核意见"},AllocationIndoorShow:{value:"AllocationIndoorShow",name:"显示到入馆分配建议"},AllocationIndoorEdit:{value:"AllocationIndoorEdit",name:"编辑入馆分配建议"},AllocationOutdoorShow:{value:"AllocationOutdoorShow",name:"显示到现场分配建议"},AllocationOutdoorEdit:{value:"AllocationOutdoorEdit",name:"编辑现场分配建议"},DiscussionIndoorShow:{value:"DiscussionIndoorShow",name:"显示到入馆审议意见"},DiscussionIndoorEdit:{value:"DiscussionIndoorEdit",name:"编辑入馆审议意见"},DiscussionOutShow:{value:"DiscussionOutShow",name:"显示到现场审议意见"},DiscussionOutEdit:{value:"DiscussionOutEdit",name:"编辑现场审议意见"},getByAppType:function(o,i,t){var n,s=/^b[12]$/gi;return n=s.test(o)?t?i?this.DiscussionOutEdit.value:this.DiscussionOutShow.value:i?this.AllocationOutdoorEdit.value:this.AllocationOutdoorShow.value:t?i?this.DiscussionIndoorEdit.value:this.DiscussionIndoorShow.value:i?this.AllocationIndoorEdit.value:this.AllocationIndoorShow.value}}});Ext.define("Soims.view.application.common.B1BasicInfoPanel",{itemId:"applicationCommonB1BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.b1basicinfopanel",title:"航次任务基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=this,a=Ext.create("Soims.store.voyage.VoyageByTime"),t=Ext.create("Soims.store.project.User"),l=Ext.create("Soims.store.application.new.VoyageTask"),i=Ext.create("Soims.store.application.common.VoyageTaskLeg");this.items=[{xtype:"fieldset",title:"航次任务信息",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300},items:[{xtype:"combobox",itemId:"voyage",name:"voyage",fieldLabel:"航次",store:a,forbidBlankAndShowStar:!0,queryMode:"local",displayField:"name",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1,listeners:{select:function(e){this.voyage=e.getValue(),l.getProxy().setExtraParam("voyageID",this.voyage),i.getProxy().setExtraParam("voyageID",this.voyage),e.up("b1basicinfopanel").down("#legs").clearValue(),e.up("b1basicinfopanel").down("#voyageTask").clearValue()}}},{fieldLabel:"航次任务名称",xtype:"combobox",itemId:"voyageTask",name:"voyageTask",forbidBlankAndShowStar:!0,store:l,displayField:"name",valueField:"id",readOnly:1==this.isShow?!0:!1,listeners:{expand:function(){e.expendVoyageTask()},select:function(e,a){e.up("b1basicinfopanel").down("#legs").setValue(a[0].get("legs"))}}}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300},items:[{fieldLabel:"负责人姓名",itemId:"chargerName",xtype:"searchcombo",name:"chargerID",store:t,readOnly:this.isShow,valueField:"id",forbidBlankAndShowStar:!0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>"),listeners:{select:function(e,a){this.userID=e.getValue(),l.getProxy().setExtraParam("userID",this.userID),e.up("b1basicinfopanel").down("#legs").clearValue(),e.up("b1basicinfopanel").down("#voyageTask").clearValue(),e.up("b1basicinfopanel").loadRecord(a[0])}}},{fieldLabel:"航次任务所在航段",itemId:"legs",xtype:"combobox",name:"legs",forbidBlankAndShowStar:!0,multiSelect:!0,store:i,displayField:"name",queryMode:"local",valueField:"name",readOnly:1==this.isShow?!0:!1,editable:!1,listeners:{expand:function(){e.expendLegs()}}}]}]},{xtype:"fieldset",title:"负责人详细信息",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"}]}]}],this.callParent()},expendVoyageTask:function(){var e=this.down("#voyageTask").getStore();e.load()},expendLegs:function(){var e=this.down("#legs").getStore();e.load()}});Ext.define("Soims.view.application.new.B1BasicInfo",{itemId:"applicationNewB1BasicInfo",extend:"Ext.form.Panel",alias:"widget.b1basicinfo",title:"申请基本信息",requires:["Soims.view.application.common.B1BasicInfoPanel"],padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b1basicinfopanel",applicationID:this.applicationID,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleGrid",{extend:"Ext.grid.Panel",alias:"widget.samplegrid",title:"样品列表",viewConfig:{emptyText:"没有满足条件的拟申请样品"},minHeight:200,padding:"2 2 2 2",selModel:{mode:"MULTI"},hidden:1==this.isShow,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.application.common.Sample"),("V1"==this.type||"B1"==this.type||"B2"==this.type)&&(this.features=[{ftype:"grouping"}]),this.leg="",this.legID="",this.deleteid="",this.columns=[{xtype:"rownumberer"},{text:"样品类型",locked:!0,width:150,sortable:!1,dataIndex:"sampleType"},{text:"所在航段",locked:!0,width:100,sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"使用目的",lockable:!1,width:100,sortable:!0,dataIndex:"usePurpose"},{text:"涉及学科",width:100,sortable:!1,dataIndex:"involvedSubject"},{text:"岩心分取方案",width:200,sortable:!0,dataIndex:"samplingMethod"},{text:"制样方案",width:100,sortable:!0,dataIndex:"samplePreparation"},{text:"分析测试项目、指标",width:230,sortable:!0,dataIndex:"anlyseTestProject"},{text:"采样区域",width:220,sortable:!0,dataIndex:"samplingArea"},{text:"站位数",width:100,sortable:!0,dataIndex:"stationDigit"},{text:"各站样品数",width:100,sortable:!0,dataIndex:"stationSampleNumber"},{text:"总样品件数",width:100,sortable:!0,dataIndex:"sampleTotalNumber"},{text:"单件样品量",width:100,sortable:!0,dataIndex:"oneSampleAmount"},{text:"其它",width:100,sortable:!0,dataIndex:"otherRequirements"}],this.tbar={hidden:this.isShow,items:[{text:"添加样品",xtype:"button",itemId:"sampleAdd",iconCls:"Add"},{text:"修改",itemId:"sampleModify",disabled:!0,xtype:"button",iconCls:"Disk"},{text:"删除",itemId:"sampleDelete",disabled:!0,xtype:"button",iconCls:"Delete"},{text:"样品克隆",itemId:"sampleClone",xtype:"button",disabled:!0,iconCls:"Add",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"(复制选中样品到指定航段)",xtype:"label",style:"font-size:12px;color:#FF0000",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"整航段样品克隆",itemId:"sampleLegClone",xtype:"button",disabled:!1,iconCls:"Add",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1}]},this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(t,e){e.length>0?(this.down("#sampleClone").setDisabled(!1),this.down("#sampleDelete").setDisabled(!1),this.down("#sampleModify").setDisabled(!1),e.length>1&&(this.down("#sampleModify").setDisabled(!0),this.down("#sampleDelete").setDisabled(!1),this.down("#sampleClone").setDisabled(!1))):(this.down("#sampleClone").setDisabled(!0),this.down("#sampleModify").setDisabled(!0),this.down("#sampleDelete").setDisabled(!0))}});Ext.define("Soims.view.application.common.SampleGridShow",{extend:"Ext.grid.Panel",alias:"widget.samplegridshow",requires:["Ext.ux.grid.AssociationRowExpander","Soims.model.applicationDiscussion.DiscussType","Soims.model.applicationAuditing.ContentType","Soims.model.applicationAuditing.AuditType","Soims.model.application.SamplePanelType"],viewConfig:{emptyText:"没有满足条件的拟申请样品"},minHeight:200,padding:"2 2 2 2",selType:"rowmodel",plugins:[{ptype:"associationrowexpander",pluginId:"sampleGridExpander",selectRowOnExpand:!0,rowBodyTpl:new Ext.XTemplate('<tpl for=".">','<table width="700"  style="margin-left:30px;line-height:20px" frame=below>','<tr><td width="300"><b>样品类型:&nbsp;&nbsp;</b>{data.sampleType}</td><td><b>所在航段:&nbsp;&nbsp;</b>{data.leg}</td></tr>',"</table><br>",'<table width="700"  style="margin-left:30px;line-height:20px" frame=below>',"<tr><td><b>使用目的:&nbsp;&nbsp;</b>{data.usePurpose}</td></tr>","<tr><td><b>涉及学科:&nbsp;&nbsp;</b>{data.involvedSubject}</td></tr>","<tr><td><b>岩心分取方案:&nbsp;&nbsp;</b>{data.samplingMethod}</td></tr>","<tr><td><b>制样方案:&nbsp;&nbsp;</b>{data.samplePreparation}</td></tr>","<tr><td><b>分析测试项目、指标:&nbsp;&nbsp;</b>{data.sampleType}</td></tr>","</table><br>",'<table width="700"   style="padding-left:30px;line-height:20px">',"<tr><td><b>采样区域:&nbsp;&nbsp;</b>{data.samplingArea}</td></tr>",'<tr><td width="300"><b>站位数:&nbsp;&nbsp;</b>{data.stationDigit}</td><td><b>各站样品数:&nbsp;&nbsp;</b>{data.stationSampleNumber}</td></tr>','<tr><td width="300"><b>总样品件数:&nbsp;&nbsp;</b>{data.sampleTotalNumber}</td><td><b>单件样品量:&nbsp;&nbsp;</b>{data.oneSampleAmount}</td></tr>',"<tr><td><b>其它:&nbsp;&nbsp;</b>{data.otherRequirements}</td></tr>","</table><br>",'<div id="dataTest{data.id}" style="padding-left:30px;line-height:20px"><b>拟提交测试数据</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>分析测试指标</th><th>拟提交测试数据</th><th>拟提交时间</th></tr>",'<tpl for="AnlysesStore">',"<tr><td><span >{data.anlyseTestProject}</span></td><td>{data.intendCommitTestData}</td><td>{data.commitTestDataTime}</td></tr>","</tpl>","</table><br>",'<div id="auditList{data.id}" style="padding-left:30px;line-height:20px"><b>审核记录</b></div>','<tpl for="getSampleAuditsStore">','<tpl if="this.colorChange(data.auditerID,data.auditType)">','<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","<tpl else>",'<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.auditType}" sampleID="{[values.getSample().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.AuditButtonShow()">','<p style="text-align: center;"><button  id="sampleagree{data.id}">同意</button>   <button  id="sampleunagree{data.id}">拟同意</button>   <button  id="sampledisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>",'<tpl if="this.AllocationIndoorEdit()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700" id="allocationTb{data.id}"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">','<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td><b><textarea id="allocationTd{data.id}" type="text" style="height:100%;width:100%;resize:none">{data.oiSuggestion}</textarea></b></td><td></td></tr>',"</tpl>","</table><br>",'<p style="text-align: center;"><button  id="saveAllocation{data.id}">保存</button></p>',"</tpl>",'<tpl if="this.AllocationOutdoorEdit()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700" id="allocationTb{data.id}"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>取用次序</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">','<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.useOrder}</td><td><b><textarea id="allocationTd{data.id}" type="text" style="height:100%;width:100%;resize:none">{data.oiSuggestion}</textarea></b></td><td></td></tr>',"</tpl>","</table><br>",'<p style="text-align: center;"><button  id="saveAllocation{data.id}">保存</button></p>',"</tpl>",'<tpl if="this.AllocationOutdoorShow()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>取用次序</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">',"<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.useOrder}</td><td>{data.oiSuggestion}</td><td></td></tr>","</tpl>","</table><br>","</tpl>",'<tpl if="this.AllocationIndoorShow()">','<div id="allocationInfor{data.id}" style="padding-left:30px;line-height:20px"><b>分配建议</b></div>','<table width="700"  border="1" cellspacing="0px" style="margin-left:50px;line-height:20px;border-collapse:collapse">',"<tr><th>本任务既往使用样品情况</th><th>申请人既往样品使用情况</th><th>分配建议</th><th>大洋协会分配建议</th><th>备注</th></tr>",'<tpl for="AllocationsStore">',"<tr><td><span >{data.taskPreviousUsage}</span></td><td>{data.supplierPreviousUsage}</td><td>{data.suggestion}</td><td>{data.oiSuggestion}</td><td></td></tr>","</tpl>","</table><br>","</tpl>",'<tpl if="this.DiscussionsShow()">','<div id="discussionList{data.id}" style="padding-left:30px;line-height:20px"><b>审议记录</b></div>','<tpl for="DiscussionsStore">','<tpl if="this.colorChange(data.auditerID)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.discussType}" sampleID="{[values.getSample().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.discussType}" sampleID="{[values.getSample().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.DiscussionButtonsShow()">','<p style="text-align: center;"><button  id="dicussionagree{data.id}">同意</button>   <button  id="dicussionunagree{data.id}">拟同意</button>   <button  id="dicussiondisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>","</tpl>","</tpl>",{colorChange:function(t,e){var a=Soims.currentUser.id,i=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode);return t==a&&e==i.value?!1:!0},formatChange:function(t){var e=Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,a=Soims.model.applicationAuditing.AuditType.LegChargerAudit.value;return t==e||t==a?!0:!1},AllocationIndoorEdit:function(){return this.tplParam==Soims.model.application.SamplePanelType.AllocationIndoorEdit.value?!0:!1},AllocationOutdoorEdit:function(){return this.tplParam==Soims.model.application.SamplePanelType.AllocationOutdoorEdit.value?!0:!1},AllocationOutdoorShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutShow.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value||this.tplParam==Soims.model.application.SamplePanelType.AllocationOutdoorShow.value?!0:!1},AllocationIndoorShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorShow.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.AllocationIndoorShow.value?!0:!1},AuditButtonShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!0:!1},DiscussionsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditShow.value||this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!1:!0},DiscussionButtonsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value?!0:!1}})}],initComponent:function(){this.getPlugin("sampleGridExpander").setXTemplateParams(this.panelType),this.store=Ext.create("Soims.store.application.common.Sample"),this.leg="",this.legID="",this.deleteid="",this.title=this.isAudit?'<span>样品列表</span><span style="font-size:12px;color:#FF0000">[请逐条样品进行审核]</span>':"样品列表",this.columns=[{xtype:"rownumberer"},{text:"样品类型",width:100,sortable:!1,dataIndex:"sampleType"},{text:"所在航段",width:100,sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"使用目的",width:150,sortable:!0,dataIndex:"usePurpose"},{text:"分析测试项目、指标",width:290,sortable:!0,dataIndex:"anlyseTestProject"},{text:"采样区域",width:220,sortable:!0,dataIndex:"samplingArea"}],this.on("selectionchange",this.selectionChange),this.callParent()},selectionChange:function(t,e){var a=Ext.get("sampleagree"+e[0].get("id")),i=Ext.get("sampleunagree"+e[0].get("id")),n=Ext.get("sampledisagree"+e[0].get("id")),s=Ext.get("dicussionagree"+e[0].get("id")),p=Ext.get("dicussionunagree"+e[0].get("id")),d=Ext.get("dicussiondisagree"+e[0].get("id")),o=Ext.get("saveAllocation"+e[0].get("id")),l=this;void 0!=a&&(a.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Agree,e[0].get("id"))}),i.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Doubt,e[0].get("id"))}),n.on("click",function(){l.onAuditClick(e[0],Soims.model.applicationAuditing.ContentType.Reject,e[0].get("id"))})),void 0!=s&&(s.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Agree,e[0].get("id"))}),p.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Doubt,e[0].get("id"))}),d.on("click",function(){l.onDiscussClick(e[0],Soims.model.applicationAuditing.ContentType.Reject,e[0].get("id"))})),void 0!=o&&o.on("click",function(){var t=arguments[1].id.toString().replace(/saveAllocation/gi,"");l.onSaveClick(t)})},onAuditClick:function(t,e,a){var i=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),a=t.get("id");Ext.Ajax.request({url:Soims.service.ApplicationAuditings.SampleAuditService+"/Auditing",params:{ContentType:e.value,AuditType:i.value,SampleID:a},scope:this,success:function(){Ext.Tools.Msg("审核完成",0),this.auditRowBodyChange(e,a)}})},onDiscussClick:function(t,e,a){var a=t.get("id"),i=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode);Ext.Ajax.request({url:Soims.service.discussion.SampleDiscussionService+"/Discussing",params:{ContentType:e.value,DiscussType:i.value,SampleID:a},scope:this,success:function(){Ext.Tools.Msg("审议完成",0),this.discussRowBodyChange(e,a)}})},onSaveClick:function(t){var e,a=document.getElementById("allocationTb"+t).getElementsByTagName("textarea")[0];void 0!=a&&(e=a.id.toString().replace(/allocationTd/gi,""),Ext.Ajax.request({url:Soims.service.samples.SampleAllocationService+"/Save",params:{id:e,suggestion:a.value},scope:this,success:function(){Ext.Tools.Msg("修改完成",0)}}))},auditRowBodyChange:function(t,e){var a=this,i=(a.getView().el,Soims.currentUser.id),n=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),s="span[auditor='"+i+"'][auditType="+n.value+"][sampleID="+e+"]",p=Ext.query(s),d=this.getAuditInfo();if(void 0==p[0]){var o=new Date,l=Ext.get("auditList"+e),r="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+i+"' auditType='"+n.value+"' sampleID='"+e+"'>"+d+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+t.name+"</span><br/>";Ext.DomHelper.insertAfter(l,r)}else{var o=new Date,u=Ext.get(p[0]),c=d+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+t.name;Ext.DomHelper.overwrite(u,c),Ext.DomHelper.applyStyles(u,"color:red;")}a.getView().refreshSize()},getAuditInfo:function(){var t=Soims.currentUser.currentRoleCode,e=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode).name+"&nbsp;&nbsp;&nbsp;&nbsp;";return e+="VS"==t||"LS"==t?Soims.currentUser.name:Soims.currentUser.department},discussRowBodyChange:function(t,e){var a=this,i=(a.getView().el,Soims.currentUser.id),n=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode),s="span[auditor='"+i+"'][auditType="+n.value+"][sampleID="+e+"]",p=Ext.query(s);if(void 0==p[0]){var d=new Date,o=Ext.get("discussionList"+e),l="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+i+"' auditType='"+n.value+"' sampleID='"+e+"'>"+n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+t.name+"</span><br/>";Ext.DomHelper.insertAfter(o,l)}else{var d=new Date,r=Ext.get(p[0]),u=n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+t.name;Ext.DomHelper.overwrite(r,u),Ext.DomHelper.applyStyles(r,"color:red;")}a.getView().refreshSize()}});Ext.define("Soims.view.application.common.SampleInfo",{itemId:"applicationCommonSampleInfo",extend:"Ext.form.Panel",alias:"widget.sampleinfo",padding:2,title:"拟申请样品信息",AutoScroll:!0,overflowY:"auto",autoShow:!0,autoHeight:!0,requires:["Soims.view.application.Common.SampleGrid","Soims.view.application.Common.SampleGridShow"],initComponent:function(){this.items=this.isShow?[{xtype:"samplegridshow",applicationID:this.applicationID,isShow:this.isShow,panelType:this.panelType,type:this.type}]:[{xtype:"samplegrid",applicationID:this.applicationID,isShow:this.isShow,isAudit:this.isAudit,type:this.type},{xtype:"testdatainfo",applicationID:this.applicationID,isShow:this.isShow,isAudit:this.isAudit,type:this.type}],this.callParent()}});Ext.define("Soims.view.application.common.BoardingUserGrid",{itemId:"applicationCommonBoardingUserGrid",extend:"Ext.grid.Panel",alias:"widget.boardinguser",requires:["Ext.ux.form.SearchComboBox"],title:"样品现场使用人",selType:"rowmodel",emptyText:"没有满足条件的人员",height:200,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){var e=this;console.log(this.applicationID),this.store=Ext.create("Soims.store.application.common.SampleSiteUser"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.application.common.BoardingUser"),a=Ext.create("Soims.store.application.common.SampleLeg");this.columns=[{xtype:"rownumberer"},{header:"ID",dataIndex:"id",hidden:!0},{header:'<span>姓名<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:1==this.isShow?null:{itemId:"boardingUserName",xtype:"searchcombo",store:t,valueField:"name",forbidBlankAndShowStar:!0,allowBlank:!1,enableKeyEvents:!0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {department}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>"),listeners:{keyup:function(t){e.searchBoardingUserName(t)}}}},{header:"所在单位",dataIndex:"department",flex:1},{header:"手机",dataIndex:"cellphone",flex:1},{header:"联系电话",dataIndex:"telphone",flex:1},{header:'<span>拟参加航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"legs",flex:1,editor:{xtype:"combobox",itemId:"legs",forbidBlankAndShowStar:!0,multiSelect:!0,store:a,displayField:"leg",queryMode:"local",valueField:"leg",disabled:1==this.isShow?!0:!1,editable:!1,listeners:{expand:function(){e.expendLegs()}}}}],this.tbar={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSiteUser",iconCls:"Add"},{text:"删除",itemId:"deleteSiteUser",xtype:"button",disabled:!0,iconCls:"Delete"}]},this.on("selectionchange",this.selectChange),this.callParent()},selectChange:function(e,t){this.down("#deleteSiteUser").setDisabled(0!=t.length?!1:!0)},expendLegs:function(){var e=this.down("#legs").getStore();e.getProxy().setExtraParam("applicationID",this.up("samplesiteuse").applicationID),e.load()},searchBoardingUserName:function(e){var t=e.getValue(),a=this.up("samplesiteuse").voyageID,i=this.down("#boardingUserName");i.getStore().getProxy().setExtraParam("value",t),i.getStore().getProxy().setExtraParam("voyageID",a),i.getStore().getProxy().setExtraParam("applicationID",this.up("samplesiteuse").applicationID)},listeners:{validateedit:function(e,t){var a=e.getEditor(t.record,t.column);a.revertInvalid=!1}}});Ext.define("Soims.view.application.common.SampleSiteUseNecessityForm",{extend:"Ext.form.Panel",alias:"widget.samplesiteusenecessityform",bodyPadding:2,title:"样品现场使用必要性说明",initComponent:function(){this.items=[{xtype:"textareafield",grow:!0,itemId:"sampleSiteUseNecessityTextArea",width:600,height:150,readOnly:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleSiteUse",{itemId:"applicationCommonSampleSiteUse",extend:"Ext.form.Panel",alias:"widget.samplesiteuse",requires:["Soims.view.application.common.BoardingUserGrid","Soims.view.application.common.SampleSiteUseNecessityForm"],padding:2,title:"样品现场使用信息",autoShow:!0,initComponent:function(){this.items=[{xtype:"boardinguser",applicationID:this.applicationID,isShow:this.isShow},{xtype:"samplesiteusenecessityform",applicationID:this.applicationID,margin:"3 0 0 0",isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleBackCountryNecessityForm",{extend:"Ext.form.Panel",alias:"widget.samplebackcountrynecessityform",bodyPadding:2,title:"样品先行运送回国必要性说明",initComponent:function(){this.items=[{xtype:"textareafield",grow:!0,itemId:"sampleBackCountryNecessityTextArea",width:600,height:150,readOnly:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.SampleBackCountryGrid",{itemId:"applicationCommonSampleBackCountryGrid",extend:"Ext.grid.Panel",alias:"widget.samplebackcountrygrid",autoHeight:!0,title:"提前样品运送回国列表",emptyText:"没有满足条件的样品",height:200,selType:"rowmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){var e=this;console.log(this.applicationID),this.store=Ext.create("Soims.store.application.common.SampleBackCountry"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.application.common.SampleType");this.columns=[{xtype:"rownumberer"},{header:'<span>样品类型<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleType",flex:1,allowBlank:!1,editor:{itemId:"sampleType",name:"sampleType",xtype:"combobox",valueField:"sampleType",showStar:!0,queryMode:"local",store:t,editable:!1,disabled:1==this.isShow?!0:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{sampleType} - {legID}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{sampleType}","</tpl>"),listeners:{expand:function(){e.expendSampleType()}}}},{header:"所在航段",dataIndex:"sampleLeg",flex:1},{header:'<span>样品数<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleNumber",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>样品量<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAmount",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>保存条件<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"preservationCondition",flex:1,editor:{xtype:"textfield",forbidBlankAndShowStar:!0,disabled:1==this.isShow?!0:!1,allowBlank:!1}},{header:'<span>拟运出时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"backTime",flex:1,xtype:"datecolumn",format:"Y-m-d",editor:{xtype:"datefield",disabled:1==this.isShow?!0:!1,value:new Date}},{header:"其他要求",dataIndex:"otherNeed",flex:1,editor:{xtype:"textfield",disabled:1==this.isShow?!0:!1,allowBlank:!0}}],this.tbar={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSample",iconCls:"Add"},{text:"删除",xtype:"button",itemId:"deleteSample",disabled:!0,iconCls:"Delete"}]},this.on("selectionchange",this.selectChange),this.callParent()},expendSampleType:function(){var e=this.up("samplebackcountry").applicationID;console.log(e);var t=this.down("#sampleType").getStore();t.getProxy().setExtraParam("applicationID",e),t.load()},selectChange:function(e,t){this.down("#deleteSample").setDisabled(0!=t.length?!1:!0)},listeners:{validateedit:function(e,t){var a=e.getEditor(t.record,t.column);a.revertInvalid=!1}}});Ext.define("Soims.model.applicationDiscussion.DiscussType",{statics:{SmeDiscuss:{value:"SmeDiscuss",name:"专家委员会委员审议",roleCode:"SME"},SmecDiscuss:{value:"SmecDiscuss",name:"专家委员会主任审议",roleCode:"SMEC"},getDiscussTypeByUserRole:function(s){var e={};for(var i in this)if(this[i].roleCode===s){e=this[i];break}return e}}});Ext.define("Soims.view.application.common.SampleBackCountryGridShow",{itemId:"applicationCommonSampleBackCountryGrid",extend:"Ext.grid.Panel",alias:"widget.samplebackcountrygridshow",autoHeight:!0,requires:"Soims.model.applicationDiscussion.DiscussType",emptyText:"没有满足条件的样品",minHeight:200,selType:"rowmodel",plugins:[{ptype:"associationrowexpander",pluginId:"backCountryGridExpander",selectRowOnExpand:!0,rowBodyTpl:new Ext.XTemplate('<tpl for=".">','<p style="margin-left:30px;line-height:20px"><b>样品类型:&nbsp;&nbsp;</b>{data.sampleType}</p>','<p style="margin-left:30px;line-height:20px"><b>所在航段:&nbsp;&nbsp;</b>{data.sampleLeg}</p>','<p style="margin-left:30px;line-height:20px"><b>样品数:&nbsp;&nbsp;</b>{data.sampleNumber}</p>','<p style="margin-left:30px;line-height:20px"><b>样品量:&nbsp;&nbsp;</b>{data.sampleAmount}</p>','<p style="margin-left:30px;line-height:20px"><b>保存条件:&nbsp;&nbsp;</b>{data.preservationCondition}</p>','<p style="margin-left:30px;line-height:20px"><b>拟运出时间:&nbsp;&nbsp;</b>{data.backTime:date("Y/m/d")}</p>','<p style="margin-left:30px;line-height:20px"><b>先行运送回国必要性说明:&nbsp;&nbsp;</b>{data.repatriaionNecessity}</p>','<p style="margin-left:30px;line-height:20px"><b>其他要求:&nbsp;&nbsp;</b>{data.otherNeed}</p><br>','<div id="backCountryList{data.id}" style="padding-left:30px;line-height:20px"><b>审核记录</b></div>','<tpl for="getSampleRepatriationAuditsStore">','<tpl if="this.colorChange(data.auditerID,data.auditType)">','<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:30px;line-height:20px"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:30px;line-height:20px"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","<tpl else>",'<tpl if="this.formatChange(data.auditType)">','<span style="padding-left:30px;line-height:20px;color:red"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.auditerName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:30px;line-height:20px;color:red"','auditor="{data.auditerID}" auditType="{data.auditType}" repatriationID="{[values.getSampleBackCountry().data.id]}">{[Soims.model.applicationAuditing.AuditType[values.data.auditType].name]}&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审核{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.AuditButtonShow()">','<p style="text-align: center;"><button  id="repatriationagree{data.id}">同意</button>   <button  id="repatriationunagree{data.id}">拟同意</button>   <button  id="repatriationdisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>",'<tpl if="this.DiscussionsShow()">','<div id="backCountryDiscussionList{data.id}" style="padding-left:30px;line-height:20px"><b>审议记录</b></div>','<tpl for="SampleRepatriationDiscussionsStore">','<tpl if="this.colorChange(data.auditerID)">','<span style="padding-left:50px;line-height:20px"  auditor="{data.auditerID}" auditType="{data.discussType}" repatriationID="{[values.getSampleBackCountry().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"<tpl else>",'<span style="padding-left:50px;line-height:20px;color:red"  auditor="{data.auditerID}" auditType="{data.discussType}" repatriationID="{[values.getSampleBackCountry().data.id]}">',"<tpl if=\"data.discussType == 'SmeDiscuss'\">","专家委员会委员审议","<tpl else>","专家委员会主任审议","</tpl>",'&nbsp;&nbsp;&nbsp;&nbsp;{data.companyName}&nbsp;&nbsp;&nbsp;&nbsp;{data.createTime:date("Y/m/d")}&nbsp;&nbsp;&nbsp;&nbsp;审议{[Soims.model.applicationAuditing.ContentType[values.data.contentType].name]}</span><br/>',"</tpl>","</tpl>",'<hr align="left" style="margin-left:30px" width="700"></hr>','<tpl if="this.DiscussionButtonsShow()">','<p style="text-align: center;"><button  id="dicussionagree{data.id}">同意</button>   <button  id="dicussionunagree{data.id}">拟同意</button>   <button  id="dicussiondisagree{data.id}">不同意</button></p>',"</tpl>","<p>&nbsp;</p>","</tpl>","</tpl>",{colorChange:function(e,t){var i=Soims.currentUser.id,a=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode);return e==i&&t==a.value?!1:!0},formatChange:function(e){var t=Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,i=Soims.model.applicationAuditing.AuditType.LegChargerAudit.value;return e==t||e==i?!0:!1},AuditButtonShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!0:!1},DiscussionsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.AuditShow.value||this.tplParam==Soims.model.application.SamplePanelType.AuditEdit.value?!1:!0},DiscussionButtonsShow:function(){return this.tplParam==Soims.model.application.SamplePanelType.DiscussionIndoorEdit.value||this.tplParam==Soims.model.application.SamplePanelType.DiscussionOutEdit.value?!0:!1}})}],initComponent:function(){this.getPlugin("backCountryGridExpander").setXTemplateParams(this.panelType);var e=this;this.store=Ext.create("Soims.store.application.common.SampleBackCountry"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load(function(){for(var t=e.getPlugin("backCountryGridExpander"),i=0;i<e.store.getCount();i++)t.toggleRow(i,e.store.getAt(i))})),this.title=this.isAudit?'<span>提前样品运送回国列表</span><span style="font-size:12px;color:#FF0000">[请逐条样品进行审核]</span>':"提前样品运送回国列表";Ext.create("Soims.store.application.common.SampleType");this.columns=[{xtype:"rownumberer"},{header:"样品类型",dataIndex:"sampleType",flex:1,allowBlank:!1},{header:"所在航段",dataIndex:"sampleLeg",flex:1},{header:"样品数",dataIndex:"sampleNumber",flex:1},{header:"样品量",dataIndex:"sampleAmount",flex:1},{header:"保存条件",dataIndex:"preservationCondition",flex:1},{header:"拟运出时间",dataIndex:"backTime",flex:1,xtype:"datecolumn",format:"Y-m-d"},{header:"其他要求",dataIndex:"otherNeed",flex:1}],this.on("selectionchange",this.selectChange),this.callParent()},expendSampleType:function(){var e=this.up("samplebackcountry").applicationID,t=this.down("#sampleType").getStore();t.getProxy().setExtraParam("applicationID",e),t.load()},selectChange:function(e,t){var i=Ext.get("repatriationagree"+t[0].get("id")),a=Ext.get("repatriationunagree"+t[0].get("id")),n=Ext.get("repatriationdisagree"+t[0].get("id")),p=Ext.get("dicussionagree"+t[0].get("id")),s=Ext.get("dicussionunagree"+t[0].get("id")),o=Ext.get("dicussiondisagree"+t[0].get("id")),d=this;void 0!=i&&(i.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Agree,t[0].get("id"))}),a.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Doubt,t[0].get("id"))}),n.on("click",function(){d.onAuditClick(t[0],Soims.model.applicationAuditing.ContentType.Reject,t[0].get("id"))})),void 0!=p&&(p.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Agree,t[0].get("id"))}),s.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Doubt,t[0].get("id"))}),o.on("click",function(){d.onDiscussClick(t[0],Soims.model.applicationAuditing.ContentType.Reject,t[0].get("id"))}))},onAuditClick:function(e,t,i){var a=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),n=e.get("id");Ext.Ajax.request({url:Soims.service.ApplicationAuditings.SampleRepatriationAuditService+"/Auditing",params:{ContentType:t.value,AuditType:a.value,RepatriationID:n},scope:this,success:function(){Ext.Tools.Msg("审核完成",0),this.rowBodyChange(t,i)}})},onDiscussClick:function(e,t,i){var a=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode);Ext.Ajax.request({url:Soims.service.discussion.SampleRepatriationDiscussionService+"/Discussing",params:{ContentType:t.value,DiscussType:a.value,RepatriationID:i},scope:this,success:function(){Ext.Tools.Msg("审议完成",0),this.discussRowBodyChange(t,i)}})},rowBodyChange:function(e,t){var i=this,a=(i.getView().el,Soims.currentUser.id),n=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode),p="span[auditor='"+a+"'][auditType="+n.value+"][repatriationID="+t+"]",s=Ext.query(p),o=this.getAuditInfo();if(void 0==s[0]){var d=new Date,r=Ext.get("backCountryList"+t),l="<span style='padding-left:30px;line-height:20px;color:red' auditor='"+a+"' auditType='"+n.value+"' repatriationID='"+t+"'>"+o+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+e.name+"</span><br/>";Ext.DomHelper.insertAfter(r,l)}else{var d=new Date,u=Ext.get(s[0]),c=o+"&nbsp;&nbsp;&nbsp;&nbsp;"+d.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审核"+e.name;Ext.DomHelper.overwrite(u,c),Ext.DomHelper.applyStyles(u,"color:red;")}i.getView().refreshSize()},getAuditInfo:function(){var e=Soims.currentUser.currentRoleCode,t=Soims.model.applicationAuditing.AuditType.getAuditTypeByUserRole(Soims.currentUser.currentRoleCode).name+"&nbsp;&nbsp;&nbsp;&nbsp;";return t+="VS"==e||"LS"==e?Soims.currentUser.name:Soims.currentUser.department},discussRowBodyChange:function(e,t){var i=this,a=(i.getView().el,Soims.currentUser.id),n=Soims.model.applicationDiscussion.DiscussType.getDiscussTypeByUserRole(Soims.currentUser.currentRoleCode),p="span[auditor='"+a+"'][auditType="+n.value+"][repatriationID="+t+"]",s=Ext.query(p);if(void 0==s[0]){var o=new Date,d=Ext.get("backCountryDiscussionList"+t),r="<span style='padding-left:50px;line-height:20px;color:red' auditor='"+a+"' auditType='"+n.value+"' repatriationID='"+t+"'>"+n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+e.name+"</span><br/>";Ext.DomHelper.insertAfter(d,r)}else{var o=new Date,l=Ext.get(s[0]),u=n.name+"&nbsp;&nbsp;&nbsp;&nbsp;"+Soims.currentUser.department+"&nbsp;&nbsp;&nbsp;&nbsp;"+o.toLocaleDateString()+"&nbsp;&nbsp;&nbsp;&nbsp;审议"+e.name;Ext.DomHelper.overwrite(l,u),Ext.DomHelper.applyStyles(l,"color:red;")}i.getView().refreshSize()}});Ext.define("Soims.view.application.common.SampleBackCountry",{extend:"Ext.form.Panel",alias:"widget.samplebackcountry",requires:["Soims.view.application.common.SampleBackCountryNecessityForm","Soims.view.application.common.SampleBackCountryGrid","Soims.view.application.common.SampleBackCountryGridShow"],padding:2,title:"样品回国信息",autoShow:!0,initComponent:function(){this.items=this.isShow?[{xtype:"samplebackcountrygridshow",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow,panelType:this.panelType}]:[{xtype:"samplebackcountrygrid",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow},{xtype:"samplebackcountrynecessityform",margin:"3 0 0 0",applicationID:this.applicationID,isAudit:this.isAudit,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.application.common.ElectronicDocumentGrid",{itemId:"applicationCommonElectronicDocumentGrid",extend:"Ext.grid.Panel",title:"证明材料电子资料",alias:"widget.electronicdocumentgrid",autoHeight:!0,emptyText:"没有满足条件的电子资料",height:200,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],initComponent:function(){this.store=Ext.create("Soims.store.application.common.ElectronicDocument"),void 0!=this.applicationID&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load()),this.columns=[{xtype:"rownumberer"},{header:"文档名称",dataIndex:"name",flex:1},{header:"文档大小",dataIndex:"length",flex:1},{header:"备注",dataIndex:"remark",flex:1,editor:{xtype:"textfield",disabled:1==this.isShow?!0:!1}}],this.tbar={items:[{text:"添加",xtype:"button",itemId:"add",hidden:this.isShow,iconCls:"Add"},{text:"删除",itemId:"delete",xtype:"button",hidden:this.isShow,disabled:!0,iconCls:"Delete"},{text:"下载",itemId:"download",xtype:"button",disabled:!0,iconCls:"DiskDownload"}]},this.on("selectionchange",this.selectChange),this.callParent()},selectChange:function(t,e){0!=e.length?(this.down("#delete").setDisabled(!1),this.down("#download").setDisabled(!1)):(this.down("#delete").setDisabled(!0),this.down("#download").setDisabled(!0))}});Ext.define("Soims.view.application.common.ElectronicDocument",{name:"applicationCommonElectronicDocument",extend:"Ext.form.Panel",alias:"widget.electronicdocument",requires:["Soims.view.application.common.ElectronicDocumentGrid"],padding:2,title:"电子资料提交",autoShow:!0,initComponent:function(){this.items=[{xtype:"electronicdocumentgrid",applicationID:this.applicationID,isShow:this.isShow,type:this.type}],this.callParent()}});Ext.define("Soims.model.applicationAuditing.AuditType",{statics:{OrganizeContractorAudit:{value:"OrganizeContractorAudit",name:"组织实施单位审核",roleCode:"VODC",formType:"organizecontractorauditform"},VoyageChargerAudit:{value:"VoyageChargerAudit",name:"航次首席科学家审核",roleCode:"VS",formType:"voyagechargerauditform"},LegChargerAudit:{value:"LegChargerAudit",name:"航段首席科学家审核",roleCode:"LS",formType:"legchargerauditform"},ProjectChargerAudit:{value:"ProjectChargerAudit",name:"项目负责人审核",roleCode:"PC",formType:"projectchargerauditform"},ReportManagerAudit:{value:"ReportManagerAudit",name:"航次报告牵头负责人审核",roleCode:"VRC",formType:"reportmanagerauditform"},getAuditTypeByUserRole:function(e){var r={};for(var a in this)if(this[a].roleCode===e){r=this[a];break}return r}}});Ext.define("Soims.model.applicationAuditing.ContentType",{statics:{Agree:{value:"Agree",name:"同意"},Reject:{value:"Reject",name:"不同意"},Doubt:{value:"Doubt",name:"拟同意"}}});Ext.define("Soims.view.applicationAuditing.common.OrganizeContractorAuditForm",{extend:"Ext.form.Panel",alias:"widget.organizecontractorauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次组织实施单位意见",initComponent:function(){var t=!this.isAudit||Soims.component.applicationAuditingCommonOrganizeContractorAuditFormOrganizeContractorReadOnly;this.hidden=Soims.component.applicationAuditingCommonOrganizeContractorAuditFormOrganizeContractorHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:t,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(t){var e=t.up("organizecontractorauditform").down("textareafield");e.setValue(t.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"organizeContractor",anchor:"100%",width:600,height:150,readOnly:t},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!t,height:20}],this.callParent()},listeners:{afterrender:function(){var t=this,e=t.initStore();e.load(function(){0!=e.getCount()?t.setItemValues(e.getAt(0)):"VODC"==Soims.currentUser.currentRoleCode?t.down("label").hide():t.hide()})}},initStore:function(){var t=this,e=this.isAudit&&"VODC"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),n={AuditType:Soims.model.applicationAuditing.AuditType.OrganizeContractorAudit.value,ApplicationID:t.applicationID,Action:e};return i.setExtraParams(n),i},setItemValues:function(t){this.down("textareafield").setValue(t.get("auditContent")),this.down("label").setText("负责人: "+t.get("auditerName")+" "+Ext.Date.format(t.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:t.get("contentType")})}});Ext.define("Soims.view.applicationAuditing.common.VoyageChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.voyagechargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次首席科学家意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonVoyageChargerAuditFormVoyageChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonVoyageChargerAuditFormVoyageChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("voyagechargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"voyageCharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"VS"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e=this,t=this.isAudit&&"VS"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.VoyageChargerAudit.value,ApplicationID:e.applicationID,Action:t};return i.setExtraParams(a),i},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAuditing.common.LegChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.legchargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航段首席科学家意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("legchargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"legCharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"LS"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e=this,t=this.isAudit&&"LS"==Soims.currentUser.currentRoleCode?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.LegChargerAudit.value,ApplicationID:e.applicationID,Action:t};return i.setExtraParams(a),i},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAccept.B1Tab",{extend:"Ext.form.Panel",alias:"widget.acceptb1tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.B1BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.SampleSiteUse","Soims.view.application.common.SampleBackCountry","Soims.view.application.common.ElectronicDocument","Soims.view.applicationAuditing.common.OrganizeContractorAuditForm","Soims.view.applicationAuditing.common.VoyageChargerAuditForm","Soims.view.applicationAuditing.common.LegChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"b1basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"samplesiteuse",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"samplebackcountry",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"organizecontractorauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"voyagechargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"legchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.model.applicationAuditing.AuditState",{statics:{Save:{value:"Save",name:"保存审核意见"},Submit:{value:"Submit",name:"提交审核意见"}}});Ext.define("Soims.model.applicationAccept.AcceptAction",{statics:{Agree:{value:"Agree",name:"通过"},Reject:{value:"Reject",name:"驳回"},Veto:{value:"Veto",name:"否决"}}});Ext.define("Soims.view.application.common.TestDataGrid",{extend:"Ext.grid.Panel",alias:"widget.testdatagrid",header:!1,viewConfig:{emptyText:"没有满足条件的测试数据"},height:200,frame:!1,closable:!1,collapsible:!1,titleCollapse:!1,plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){("V1"==this.type||"B1"==this.type||"B2"==this.type)&&(this.features=[{ftype:"grouping"}]),this.store=Ext.create("Soims.store.application.common.TestData"),this.applicationID="",this.deleteid="",this.columns=[{xtype:"rownumberer"},{text:"样品类型",sortable:!1,dataIndex:"sampleType"},{text:"使用目的",lockable:!1,sortable:!0,dataIndex:"usePurpose"},{text:"航段",sortable:!1,dataIndex:"leg",hidden:"V2"==this.type||"V3"==this.type||"V4"==this.type?!0:!1},{text:"分析测试项目、指标",sortable:!0,dataIndex:"anlyseTestProject"},{text:"拟提交测试数据",sortable:!0,dataIndex:"intendCommitTestData",editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!0}},{text:"拟提交时间",sortable:!0,renderer:Ext.util.Format.dateRenderer("Y-m-d"),dataIndex:"commitTestDataTime",editor:{allowBlank:!1,xtype:"datefield",disabled:this.isShow,format:"Y-m-d"}}],this.tbar={hidden:this.isShow,items:[{text:"删除",name:"testDelete",action:"testDelete",itemId:"testDelete",xtype:"button",iconCls:"Delete",disabled:!0}]},this.callParent()}});Ext.define("Soims.controller.application.common.SampleInfo",{extend:"Ext.app.Controller",views:["application.common.SampleInfo","application.common.TestDataGrid"],refs:[{ref:"sampleinfo",selector:"sampleinfo",autoCreate:!0,xtype:"sampleinfo"}],init:function(){this.control({"sampleinfo button[itemId=samplePage2Save]":{click:function(e){var t=e.up("#applicationCommonSampleInfo"),a=t.applicationID;return a?void this.saveAction(a,t,!0):void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this)}}}),this.getCon("application.common.SampleGrid"),this.getCon("application.common.SampleGridShow"),this.getCon("application.common.TestDataGrid")},getCon:function(e){var t=this.application;return t.getController(e)},saveAction:function(e,t,a){this.sampleDelete(t.down("samplegrid").deleteid),this.testDataDelete(t.down("testdatagrid").deleteid),this.sampleSave(e,t,a),t.down("samplegrid").deleteid="",t.down("testdatagrid").deleteid=""},commitResultSave:function(e,t){var a=t.down("testdatainfo");console.log(a);var i=a.down("textfield[name=commitResultAmount]").getValue(),s=a.down("textfield[name=commitResultForm]").getValue(),o=a.down("textfield[name=commitResultTime]").getValue(),n={applicationID:e,commitResultAmount:i,commitResultForm:s,commitResultTime:o};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/CommitResultSave",params:n,success:function(e){e.responseText}})},testDataSave:function(e,t,a,i){var s=a.down("testdatagrid"),o=s.getStore();if(o.each(function(a){a.get("legID")==e.legID&&a.get("sampleType")==e.sampleType&&(a.set("sampleID",t),Ext.Ajax.request({async:!1,url:Soims.service.samples.TestDataService+"/Save",params:a.data,success:function(e){a.set("id",e.responseText)}}))}),i){Ext.MessageBox.alert("成功","信息保存成功！",function(){},this);var n=a.applicationID,l=a.down("samplegrid"),r=l.getStore();r.getProxy().setExtraParam("applicationID",n),r.reload(),o.getProxy().setExtraParam("applicationID",n),o.reload()}},sampleDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Delete",params:t,async:!1,success:function(){}})},testDataDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.TestDataService+"/Delete",params:t,async:!1,success:function(){}})},sampleSave:function(e,t,a){var i=t.down("samplegrid"),s=i.getStore(),o=s.getCount(),n=0,l=this,r=!1;s.each(function(i){i.set("sampleApplication",e),Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Save",params:i.data,async:!1,success:function(e){var s=e.responseText.split(",");i.set("id",s[0]),i.set("sampleAreaAndCountID",s[1]),n++,o==n&&1==a&&(r=!0),l.testDataSave(i.data,s[0],t,r)}})})},showTab:function(e,t,a,i){var s=this.getCon("application.new.B1Tab"),o=s.existInstance(e);if(o)return o;var n=Ext.create(a,{id:e,isShow:t,applicationID:i});return s.addTab(n),n}});Ext.define("Soims.model.application.common.BoardingUser",{extend:"Ext.data.Model",fields:[{name:"id",mapping:"ID"},{name:"name",mapping:"Name"},{name:"department",mapping:"Department"},{name:"cellphone",mapping:"CellPhone"},{name:"telphone",mapping:"TelPhone"},{name:"legs",mapping:"Legs"},{name:"legIDs",mapping:"LegIDs"},{name:"userDetail",mapping:"UserDetail"}]});Ext.define("Soims.store.application.common.BoardingUser",{extend:"Ext.data.Store",model:"Soims.model.application.common.BoardingUser",proxy:{type:"ajax",url:Soims.service.applications.BoardingUserService+"/QueryBoardingUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"},listeners:{exception:function(e,o){console.log(o),Ext.MessageBox.alert("提示","请先保存样品信息")}}}});Ext.define("Soims.controller.application.common.BoardingUser",{extend:"Ext.app.Controller",stores:["application.common.BoardingUser"],views:["application.common.SampleSiteUse","application.common.BoardingUserGrid","application.common.SampleSiteUseNecessityForm"],refs:[{ref:"samplesiteuse",selector:"samplesiteuse",autoCreate:!0,xtype:"samplesiteuse"},{ref:"boardingUser",selector:"boardinguser",autoCreate:!0,xtype:"boardinguser"},{ref:"sampleSiteUseNecessityForm",selector:"samplesiteusenecessityform",autoCreate:!0,xtype:"samplesiteusenecessityform"}],init:function(){this.control({boardinguser:{},"boardinguser button[itemId=addSiteUser]":{click:function(e){var t=e.up("#applicationCommonBoardingUserGrid");return void 0==t.up("samplesiteuse").applicationID?void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("samplesiteuse").up("tabpanel");t.setActiveTab(0)},this):(t.getStore().insert(0,Ext.create("Soims.model.application.common.BoardingUser")),void t.getView().refresh())}},"boardinguser button[itemId=deleteSiteUser]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此人员？点击保存按钮生效。",function(t){if("yes"==t){var o=e.up("#applicationCommonBoardingUserGrid"),i=o.getSelectionModel(),n=i.getSelection();this.getBoardingUser().getStore().remove(n),this.getBoardingUser().getView().refresh()}},this)}},"boardinguser searchcombo[itemId=boardingUserName]":{select:function(e,t){var o=e.up("#applicationCommonBoardingUserGrid").getSelectionModel().getSelection()[0];o.set("id",t[0].get("id")),o.set("name",t[0].get("name")),o.set("department",t[0].get("department")),o.set("cellphone",t[0].get("cellphone")),o.set("telphone",t[0].get("telphone"))}},"boardinguser combobox[itemId=legs]":{select:function(e,t){for(var o=e.up("#applicationCommonBoardingUserGrid").getSelectionModel().getSelection()[0],i="",n=0;n<t.length;n++)i+=t[n].get("id")+",";""!=i&&(i=i.substring(0,i.length-1)),o.set("legIDs",i),console.log(i)}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,o,i){var n=this.getCon("application.new.B1Tab"),r=n.existInstance(e);if(r)return r;var s=Ext.create(o,{id:e,isShow:t,applicationID:i});return n.addTab(s),s}});Ext.define("Soims.controller.application.common.SampleBackCountry",{extend:"Ext.app.Controller",views:["application.common.SampleBackCountry","application.common.SampleBackCountryGrid","application.common.SampleBackCountryNecessityForm"],refs:[{ref:"samplebackcountry",selector:"samplebackcountry",autoCreate:!0,xtype:"samplebackcountry"},{ref:"sampleBackCountryGrid",selector:"samplebackcountrygrid",autoCreate:!0,xtype:"samplebackcountrygrid"},{ref:"sampleBackCountryNecessityform",selector:"samplebackcountrynecessityform",autoCreate:!0,xtype:"samplebackcountrynecessityform"}],init:function(){this.control({"samplebackcountrygrid combobox[itemId=sampleType]":{select:function(e,t){var a=e.up("#applicationCommonSampleBackCountryGrid").getSelectionModel().getSelection()[0];a.set("sampleLeg",t[0].get("legID")),a.set("sampleID",t[0].get("id"))}},"samplebackcountrygrid button[itemId=addSample]":{click:function(e){var t=e.up("#applicationCommonSampleBackCountryGrid");if(void 0==t.up("samplebackcountry").applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("samplebackcountry").up("tabpanel");t.setActiveTab(0)},this);var a=Ext.create("Soims.model.application.common.SampleBackCountry");t.getStore().insert(0,a),t.getView().refresh()}},"samplebackcountrygrid button[itemId=deleteSample]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此样品？点击保存按钮生效。",function(t){if("yes"==t){var a=e.up("#applicationCommonSampleBackCountryGrid"),o=a.getSelectionModel(),n=o.getSelection();a.getStore().remove(n),a.getView().refresh()}},this)}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,a,o){var n=this.getCon("application.new.B1Tab"),c=n.existInstance(e);if(c)return c;var r=Ext.create(a,{id:e,isShow:t,applicationID:o});return n.addTab(r),r}});Ext.define("Soims.model.application.common.ElectronicDocument",{extend:"Ext.data.Model",fields:[{name:"id",mapping:"ID"},{name:"resourceID",mapping:"ResourceID"},{name:"name",mapping:"Name"},{name:"length",mapping:"Length"},{name:"remark",mapping:"Remark"}]});Ext.define("Soims.store.application.common.ElectronicDocument",{extend:"Ext.data.Store",model:"Soims.model.application.common.ElectronicDocument",proxy:{type:"ajax",url:Soims.service.applications.ElectronicDocument+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.controller.application.common.ElectronicDocument",{extend:"Ext.app.Controller",stores:["application.common.ElectronicDocument"],views:["application.common.ElectronicDocument","application.common.ElectronicDocumentGrid"],refs:[{ref:"electronicDocument",selector:"electronicdocument",autoCreate:!0,xtype:"electronicdocument"},{ref:"electronicDocumentGrid",selector:"electronicdocumentgrid",autoCreate:!0,xtype:"electronicdocumentgrid"}],init:function(){this.control({electronicdocumentgrid:{itemdblclick:function(){console.log("Double Click.")}},"electronicdocumentgrid button[itemId=add]":{click:function(e){if(void 0==e.up("electronicdocument").applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var t=e.up("electronicdocument").up("tabpanel");t.setActiveTab(0)},this);var t=this.getCon("application.common.ElectronicDocumentWin");t.show(e.up("#applicationCommonElectronicDocumentGrid"),e.up("electronicdocument").type)}},"electronicdocumentgrid button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此文件？点击保存按钮生效。",function(t){if("yes"==t){var o=e.up("#applicationCommonElectronicDocumentGrid"),c=o.getSelectionModel(),n=c.getSelection();this.getElectronicDocumentGrid().getStore().remove(n),this.getElectronicDocumentGrid().getView().refresh()}},this)}},"electronicdocumentgrid button[itemId=download]":{click:function(e){var t=e.up("#applicationCommonElectronicDocumentGrid"),o=t.getSelectionModel(),c=o.getSelection()[0];console.log(c);var n=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ResourceService+"/DownloadByResourceID?ResourceID="+c.get("resourceID")+"&Name="+c.get("name")+"&isIE="+n}}})},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,o,c){var n=this.getCon("application.new.B1Tab"),i=n.existInstance(e);if(i)return i;var r=Ext.create(o,{id:e,isShow:t,applicationID:c});return n.addTab(r),r}});Ext.define("Soims.controller.applicationAccept.B1Tab",{extend:"Ext.app.Controller",views:["applicationAccept.B1Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptb1tab",selector:"acceptb1tab",autoCreate:!0,xtype:"acceptb1tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.common.BoardingUser"),this.getController("application.common.SampleBackCountry"),this.getController("application.common.ElectronicDocument"),this.control({acceptb1tab:{afterrender:this.afterB1TabRender},"acceptb1tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},afterB1TabRender:function(t){var e=t.down("b1basicinfopanel"),o=(t.down("testdatainfo"),t.down("samplesiteusenecessityform").down("textareafield")),c=Ext.create("Soims.store.application.show.B1Detail");c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){0!=c.getCount()&&(e.loadRecord(c.getAt(0)),o.setValue(c.getAt(0).get("usingNecessity")))})},accept:function(t,e,o){var c=t.up("panel"),i=c.applicationID;Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Action:e,ApplicationID:i,Competence:"AcceptB1"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.B2BasicInfoPanel",{extend:"Ext.form.Panel",alias:"widget.b2basicinfopanel",title:"大洋课题基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){{var e=Ext.create("Soims.store.application.new.Subject");Ext.create("Soims.store.application.new.Voyage")}this.items={xtype:"panel",autoHeight:!0,layout:"column",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{xtype:"combobox",itemId:"subject",name:"topicName",fieldLabel:"课题名称",store:e,queryMode:"local",displayField:"topicName",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1},{fieldLabel:"负责人姓名",xtype:"textfield",itemId:"subjectchargerName",name:"topicChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",itemId:"subjectaddress",name:"topicAddress"},{fieldLabel:"联系电话",xtype:"textfield",itemId:"subjectcellphone",name:"topicCellphone"},{fieldLabel:"手机",xtype:"textfield",itemId:"subjecttelphone",name:"topicTelphone"},{xtype:"textfield",name:"projectName",itemId:"project",fieldLabel:"项目名称",margin:"20 0 5 0"},{fieldLabel:"负责人姓名",xtype:"textfield",itemId:"projectchargerName",name:"projectChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",itemId:"projectaddress",name:"projectAddress"},{fieldLabel:"联系电话",xtype:"textfield",itemId:"projectcellphone",name:"projectCellphone"},{fieldLabel:"手机",xtype:"textfield",itemId:"projecttelphone",name:"projectTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"课题编号",xtype:"textfield",itemId:"subjectnumber",name:"topicNumber"},{fieldLabel:"所在单位",xtype:"textfield",itemId:"subjectdepartment",name:"topicDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",itemId:"subjectzipCode",name:"topicZipCode"},{fieldLabel:"传真",xtype:"textfield",itemId:"subjectfax",name:"topicFax"},{fieldLabel:"邮箱",xtype:"textfield",itemId:"subjectemail",name:"topicEmail"},{fieldLabel:"项目编号",xtype:"textfield",name:"projectNumber",itemId:"projectnumber",margin:"20 0 5 0"},{fieldLabel:"所在单位",xtype:"textfield",itemId:"projectdepartment",name:"projectDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",itemId:"projectzipCode",name:"projectZipCode"},{fieldLabel:"传真",xtype:"textfield",itemId:"projectfax",name:"projectFax"},{fieldLabel:"邮箱",xtype:"textfield",itemId:"projectemail",name:"projectEmail"}]}]},this.callParent()},searchSubject:function(e){var t=e.getStore(),i=this.up("#applicationCommonB2BasicInfoPanel");1!=i.isShow&&(t.load(),t.on({load:function(){0!=t.getCount()?i.down("#subject").select(t.getAt(0)):Ext.MessageBox.alert("提示","不存在可用于申请样品的航次任务，如有疑问请联系系统工作人员，谢谢！",function(){i.up("tabpanel").close()},this)}}))}});Ext.define("Soims.view.application.new.B2BasicInfo",{itemId:"applicationNewB2BasicInfo",extend:"Ext.form.Panel",alias:"widget.b2basicinfo",requires:["Soims.view.application.common.B2BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b2basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!1}],this.callParent()}});Ext.define("Soims.view.applicationAuditing.common.ProjectChargerAuditForm",{extend:"Ext.form.Panel",alias:"widget.projectchargerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.application.common.SampleApplicationType","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"项目负责人意见",initComponent:function(){var e=!this.isAudit||Soims.component.applicationAuditingCommonProjectChargerAuditFormProjectChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonProjectChargerAuditFormProjectChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:e,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(e){var t=e.up("projectchargerauditform").down("textareafield");t.setValue(e.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"projectcharger",anchor:"100%",width:600,height:150,readOnly:e},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!e,height:20}],this.callParent()},listeners:{afterrender:function(){var e=this,t=e.initStore();t.load(function(){0!=t.getCount()?e.setItemValues(t.getAt(0)):"PC"==Soims.currentUser.currentRoleCode?e.down("label").hide():e.hide()})}},initStore:function(){var e,t=this,i=Soims.model.applicationAuditing.AuditState.Submit.value,o=Ext.create("Soims.store.applicationAuditing.Audit");return(t.appType==Soims.model.application.common.SampleApplicationType.V2.value||t.appType==Soims.model.application.common.SampleApplicationType.B2.value&&"PC"==Soims.currentUser.currentRoleCode&&t.isAudit)&&(i=Soims.model.applicationAuditing.AuditState.Save.value),e={AuditType:Soims.model.applicationAuditing.AuditType.ProjectChargerAudit.value,ApplicationID:t.applicationID,Action:i},o.setExtraParams(e),o},setItemValues:function(e){this.down("textareafield").setValue(e.get("auditContent")),this.down("label").setText("负责人: "+e.get("auditerName")+" "+Ext.Date.format(e.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:e.get("contentType")})}});Ext.define("Soims.view.applicationAccept.B2Tab",{extend:"Ext.form.Panel",alias:"widget.acceptb2tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.B2BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.SampleSiteUse","Soims.view.application.common.SampleBackCountry","Soims.view.application.common.ElectronicDocument","Soims.view.applicationAuditing.common.ProjectChargerAuditForm","Soims.view.applicationAuditing.common.VoyageChargerAuditForm","Soims.view.applicationAuditing.common.LegChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"b2basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"samplesiteuse",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"samplebackcountry",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"projectchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1,appType:this.appType},{xtype:"voyagechargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1},{xtype:"legchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:!1}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.B2Tab",{extend:"Ext.app.Controller",views:["applicationAccept.B2Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptb2tab",selector:"acceptb2tab",autoCreate:!0,xtype:"acceptb2tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.common.BoardingUser"),this.getController("application.common.SampleBackCountry"),this.getController("application.common.ElectronicDocument"),this.control({acceptb2tab:{afterrender:this.afterB2TabRender},"acceptb2tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},afterB2TabRender:function(t){var e=t.down("b2basicinfopanel"),o=(t.down("testdatainfo"),t.down("samplesiteusenecessityform").down("textareafield")),c=Ext.create("Soims.store.application.show.B2Detail");c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){var t=c.getAt(0);e.loadRecord(t),o.setValue(t.get("usingNecessity"))}})},accept:function(t,e,o){var c=t.up("panel"),i=c.applicationID,n=c.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V1BasicInfoPanel",{itemId:"applicationCommonV1BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v1basicinfopanel",title:"承担任务信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=this,t=Ext.create("Soims.store.application.new.Report"),i=Ext.create("Soims.store.application.new.Division");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"combobox",itemId:"report",name:"report",labelWidth:100,width:300,editable:!1,fieldLabel:"航次报告名称",padding:"10 0 0 25",store:t,queryMode:"local",displayField:"name",valueField:"id",editable:!1,readOnly:1==this.isShow?!0:!1,listeners:{beforerender:e.searchReport,select:function(t,i){e.loadRecord(i[0]);var o=this.up("#applicationCommonV1BasicInfoPanel"),d=o.down("#division").getStore(),a=this.getValue();a?(d.getProxy().setExtraParam("reportID",a),d.load(),d.on({load:function(){0!=d.getCount()&&o.down("#division").select(d.getAt(0))}})):Ext.Tools.Msg("请先选择航次报告！",9)}}},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"航次报告编写牵头负责人",xtype:"textfield",name:"reportChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"reportAddress"},{fieldLabel:"联系电话",xtype:"textfield",name:"reportCellphone"},{fieldLabel:"手机",xtype:"textfield",name:"reportTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"reportDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",name:"reportZipCode"},{fieldLabel:"传真",xtype:"textfield",name:"reportFax"},{fieldLabel:"邮箱",xtype:"textfield",name:"reportEmail"}]}]},{xtype:"combobox",itemId:"division",name:"division",editable:!1,fieldLabel:"分工负责学科、调查区域",store:i,labelWidth:100,width:300,padding:"10 0 0 25",queryMode:"local",displayField:"name",valueField:"id",readOnly:1==this.isShow?!0:!1,listeners:{select:function(t,i){e.loadRecord(i[0])}}},{xtype:"fieldset",itemId:"divisionInfoForm",name:"divisionInfoForm",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",layout:"column",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"航次报告编写分工负责人",xtype:"textfield",name:"divisionChargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"divisionAddress"},{fieldLabel:"联系电话",xtype:"textfield",name:"divisionCellphone"},{fieldLabel:"手机",xtype:"textfield",name:"devisionTelphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"divisionDepartment"},{fieldLabel:"邮政编码",xtype:"textfield",name:"divisionZipCode"},{fieldLabel:"传真",xtype:"textfield",name:"divisionFax"},{fieldLabel:"邮箱",xtype:"textfield",name:"divisionEmail"}]}]}]},this.callParent()},searchReport:function(e){var t=e.getStore(),i=this.up("#applicationCommonV1BasicInfoPanel"),o=this.up("#applicationNewV1BasicInfo");1!=o.isEdit&&1!=o.isShow&&(t.load(),t.on({load:function(){0!=t.getCount()?(i.down("#report").select(t.getAt(0)),i.down("textfield[name=reportChargerName]").setValue(t.getAt(0).get("reportChargerName")),i.down("textfield[name=reportAddress]").setValue(t.getAt(0).get("reportAddress")),i.down("textfield[name=reportCellphone]").setValue(t.getAt(0).get("reportCellphone")),i.down("textfield[name=reportTelphone]").setValue(t.getAt(0).get("reportTelphone")),i.down("textfield[name=reportZipCode]").setValue(t.getAt(0).get("reportZipCode")),i.down("textfield[name=reportFax]").setValue(t.getAt(0).get("reportFax")),i.down("textfield[name=reportEmail]").setValue(t.getAt(0).get("reportEmail")),i.down("textfield[name=reportDepartment]").setValue(t.getAt(0).get("reportDepartment")),i.searchDivision(i,t.getAt(0).get("id"))):Ext.MessageBox.alert("提示","不存在您负责的航次报告，如有疑问请联系系统工作人员，谢谢！",function(){},this)}}))},searchDivision:function(e,t){var i=e.down("#division").getStore();i.getProxy().setExtraParam("reportID",t),i.load(function(){e.down("#division").select(i.getAt(0)),console.log(e.down("#division")),e.down("textfield[name=divisionChargerName]").setValue(i.getAt(0).get("divisionChargerName")),e.down("textfield[name=divisionAddress]").setValue(i.getAt(0).get("divisionAddress")),e.down("textfield[name=divisionCellphone]").setValue(i.getAt(0).get("divisionCellphone")),e.down("textfield[name=devisionTelphone]").setValue(i.getAt(0).get("divisionTelphone")),e.down("textfield[name=divisionZipCode]").setValue(i.getAt(0).get("divisionZipCode")),e.down("textfield[name=divisionDepartment]").setValue(i.getAt(0).get("divisionDepartment")),e.down("textfield[name=divisionFax]").setValue(i.getAt(0).get("divisionFax")),e.down("textfield[name=divisionEmail]").setValue(i.getAt(0).get("divisionEmail"))})}});Ext.define("Soims.view.application.new.V1BasicInfo",{itemId:"applicationNewV1BasicInfo",extend:"Ext.form.Panel",alias:"widget.v1basicinfo",title:"申请基本信息",requires:["Soims.view.application.common.V1BasicInfoPanel"],padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v1basicinfopanel",applicationID:this.applicationID,isShow:this.isShow}],this.callParent()}});Ext.define("Soims.view.applicationAuditing.common.ReportManagerAuditForm",{extend:"Ext.form.Panel",alias:"widget.reportmanagerauditform",requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAuditing.ContentType"],bodyPadding:2,title:"航次报告牵头负责人意见",initComponent:function(){var t=!this.isAudit||Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerReadOnly;this.hidden=Soims.component.applicationAuditingCommonLegChargerAuditFormLegChargerHidden,this.items=[{xtype:"radiogroup",fieldLabel:"审核意见",labelWidth:70,columns:3,padding:"5 5 0 5",anchor:"40%",vertical:!0,disabled:t,items:[{boxLabel:Soims.model.applicationAuditing.ContentType.Agree.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Agree.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Doubt.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Doubt.value},{boxLabel:Soims.model.applicationAuditing.ContentType.Reject.name,name:"ct",inputValue:Soims.model.applicationAuditing.ContentType.Reject.value}],listeners:{change:function(t){var e=t.up("reportmanagerauditform").down("textareafield");e.setValue(t.getChecked()[0].boxLabel)}}},{xtype:"textareafield",grow:!0,itemId:"reportmanager",anchor:"100%",width:600,height:150,readOnly:t},{xtype:"label",style:{padding:"5 10 0 5","float":"right"},hidden:!t,height:20}],this.callParent()},listeners:{afterrender:function(){var t=this,e=t.initStore();e.load(function(){0!=e.getCount()?t.setItemValues(e.getAt(0)):"VRC"==Soims.currentUser.currentRoleCode?t.down("label").hide():t.hide()})}},initStore:function(){var t=this,e=this.isAudit?Soims.model.applicationAuditing.AuditState.Save.value:Soims.model.applicationAuditing.AuditState.Submit.value,i=Ext.create("Soims.store.applicationAuditing.Audit"),a={AuditType:Soims.model.applicationAuditing.AuditType.ReportManagerAudit.value,ApplicationID:t.applicationID,Action:e};return i.setExtraParams(a),i},setItemValues:function(t){this.down("textareafield").setValue(t.get("auditContent")),this.down("label").setText("负责人: "+t.get("auditerName")+" "+Ext.Date.format(t.get("auditTime"),"Y年m月d日")),this.down("radiogroup").setValue({ct:t.get("contentType")})}});Ext.define("Soims.view.applicationAccept.V1Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv1tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V1BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.applicationAuditing.common.ReportManagerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v1basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"reportmanagerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:this.isAudit}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.application.new.V1BasicInfo",{extend:"Ext.app.Controller",views:["application.new.V1BasicInfo"],refs:[{ref:"v1BasicInfo",selector:"v1basicinfo",autoCreate:!0,xtype:"v1basicinfo"}],init:function(){this.control()},getCon:function(n){var i=this.application;return i.getController(n)}});Ext.define("Soims.controller.applicationAccept.V1Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V1Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv1tab",selector:"acceptv1tab",autoCreate:!0,xtype:"acceptv1tab"}],init:function(){this.getController("application.common.SampleInfo"),this.getController("application.new.V1BasicInfo"),this.control({acceptv1tab:{render:function(t){if(1==t.isEdit||1==t.isShow){var e=t.down("v1basicinfopanel"),o=(t.down("testdatainfo"),e.down("#report")),i=o.getStore(),c=e.down("#division"),n=c.getStore(),a=Ext.create("Soims.store.application.show.V1Detail");a.getProxy().setExtraParam("ID",t.applicationID),a.load(function(){0!=a.getCount()&&i.load(function(){console.log(a.getAt(0).get("reportName")),e.loadRecord(a.getAt(0));var i=Ext.create("Soims.model.application.new.Division",{id:a.getAt(0).get("divisionID"),name:a.getAt(0).get("divisionName")});o.setValue(a.getAt(0).get("reportName")),n.getProxy().setExtraParam("reportID",a.getAt(0).get("reportID")),t.down("#applicationCommonSampleInfo").applicationID=a.getAt(0).get("id"),n.load(function(){c.setValue(i)})})})}}},"acceptv1tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,o){var i=t.up("panel"),c=i.applicationID,n=i.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+o+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:c,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),i.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.new.V2BasicInfo",{itemId:"applicationNewV2BasicInfo",extend:"Ext.form.Panel",alias:"widget.v2basicinfo",requires:["Soims.view.application.common.B2BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"b2basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V2Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv2tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V2BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.ElectronicDocument","Soims.model.application.common.SampleApplicationType","Soims.view.applicationAuditing.common.ProjectChargerAuditForm"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v2basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType},{xtype:"projectchargerauditform",isShow:this.isShow,applicationID:this.applicationID,isAudit:this.isAudit}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.V2Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V2Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv2tab",selector:"acceptv2tab",autoCreate:!0,xtype:"acceptv2tab"}],init:function(){this.getController("application.common.SampleInfo"),this.control({acceptv2tab:{afterrender:function(t){if(1==t.isShow){var e=t.down("b2basicinfopanel"),c=(t.down("testdatainfo"),e.down("#subject"),Ext.create("Soims.store.application.show.V2Detail"));c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){e.loadRecord(c.getAt(0));{Ext.create("Soims.model.application.new.Subject",{id:c.getAt(0).get("topicID"),topicName:c.getAt(0).get("topicName")})}}})}}},"acceptv2tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,c){var o=t.up("panel"),i=o.applicationID,n=o.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+c+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),o.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V3BasicInfoPanel",{itemId:"applicationCommonV3BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v3basicinfopanel",title:"承担任务信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){console.log(this.isShow);var e=Ext.create("Soims.store.application.new.NoOceanTopic");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"fieldset",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{margin:"10 0",xtype:"combobox",itemId:"noOceanTopic",name:"noOceanTopic",labelWidth:150,width:400,fieldLabel:"非大洋课题名称",store:e,displayField:"topicName",valueField:"topicID",readOnly:1==this.isShow?!0:!1,allowBlank:!1},{fieldLabel:"课题编号",labelWidth:150,width:400,xtype:"textfield",name:"topicNumber",itemId:"topicNumber",allowBlank:!1},{fieldLabel:"课题来源与下达部门",xtype:"textfield",labelWidth:150,width:500,name:"topicSource",itemId:"topicSource",allowBlank:!1}]},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"非大洋课题负责人",xtype:"textfield",name:"chargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]}]}]},this.callParent()}});Ext.define("Soims.view.application.new.V3BasicInfo",{itemId:"applicationNewV3BasicInfo",extend:"Ext.form.Panel",itemId:"applicationNewV3BasicInfo",alias:"widget.v3basicinfo",requires:["Soims.view.application.common.V3BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v3basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V3Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv3tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V3BasicInfo","Soims.view.application.common.SampleInfo","Soims.view.application.common.ElectronicDocument","Soims.model.application.common.SampleApplicationType"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){this.items=[{xtype:"v3basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"electronicdocument",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.controller.applicationAccept.V3Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V3Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv3tab",selector:"acceptv3tab",autoCreate:!0,xtype:"acceptv3tab"}],init:function(){this.getController("application.common.SampleInfo"),this.control({acceptv3tab:{afterrender:this.afterTabRender},"acceptv3tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},afterTabRender:function(t){if(1==t.isShow){var e=t.down("v3basicinfopanel"),c=(t.down("testdatainfo"),e.down("#noOceanTopic"),Ext.create("Soims.store.application.show.V3Detail"));c.getProxy().setExtraParam("ID",t.applicationID),c.load(function(){if(0!=c.getCount()){e.loadRecord(c.getAt(0));{Ext.create("Soims.model.application.new.NoOceanTopic",{topicID:c.getAt(0).get("topicID"),topicName:c.getAt(0).get("topicName")})}}})}},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,c){var o=t.up("panel"),i=o.applicationID,n=o.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+c+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:n,Action:e,ApplicationID:i,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),o.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.view.application.common.V4BasicInfoPanel",{itemId:"applicationCommonV4BasicInfoPanel",extend:"Ext.form.Panel",alias:"widget.v4basicinfopanel",title:"公益事业信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.application.new.Activity");this.items={xtype:"panel",autoHeight:!0,items:[{xtype:"fieldset",collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{margin:"10 0",xtype:"combobox",itemId:"activity",name:"activity",labelWidth:150,width:400,fieldLabel:"项目/活动名称",store:e,displayField:"activityName",forbidBlankAndShowStar:!0,valueField:"activityID",readOnly:1==this.isShow?!0:!1,allowBlank:!1},{fieldLabel:"活动举办地",labelWidth:150,width:400,xtype:"textfield",name:"activityPlace",itemId:"activityPlace",forbidBlankAndShowStar:!0,readOnly:this.isShow,allowBlank:!1},{fieldLabel:"课题来源与下达部门",xtype:"textfield",labelWidth:150,width:500,readOnly:this.isShow,name:"activityDepartment",itemId:"activityDepartment",forbidBlankAndShowStar:!0,allowBlank:!1}]},{xtype:"fieldset",itemId:"reportInfoForm",name:"reportInfoForm",collapsible:!1,layout:"column",frame:!0,style:"background-color: #dfe8f5;",margin:"10 10 10 10",items:[{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"负责人",xtype:"textfield",name:"chargerName"},{fieldLabel:"通讯地址",xtype:"textfield",name:"address"},{fieldLabel:"联系电话",xtype:"textfield",name:"cellphone"},{fieldLabel:"手机",xtype:"textfield",name:"telphone"}]},{columnWidth:.5,padding:5,border:!1,bodyStyle:{background:"transparent"},defaults:{labelWidth:100,width:300,readOnly:!0},items:[{fieldLabel:"所在单位",xtype:"textfield",name:"department"},{fieldLabel:"邮政编码",xtype:"textfield",name:"zipCode"},{fieldLabel:"传真",xtype:"textfield",name:"fax"},{fieldLabel:"邮箱",xtype:"textfield",name:"email"}]}]}]},this.callParent()}});Ext.define("Soims.view.application.new.V4BasicInfo",{extend:"Ext.form.Panel",alias:"widget.v4basicinfo",itemId:"applicationNewV4BasicInfo",requires:["Soims.view.application.common.V4BasicInfoPanel"],title:"申请基本信息",padding:2,defaults:{bodyStyle:"background-color:#dfe8f5;"},autoShow:!0,initComponent:function(){this.items=[{xtype:"v4basicinfopanel",applicationID:this.applicationID,isShow:this.isShow,hideVoyage:!0}],this.callParent()}});Ext.define("Soims.view.applicationAccept.V4Tab",{extend:"Ext.form.Panel",alias:"widget.acceptv4tab",closable:!0,iconCls:"Application",buttonAlign:"center",requires:["Soims.view.application.new.V4BasicInfo","Soims.view.application.common.SampleInfo","Soims.model.application.common.SampleApplicationType"],autoShow:!0,autoScroll:!0,bodyStyle:"overflow-x:visible; overflow-y:scroll",initComponent:function(){Soims.model.application.common.SampleApplicationType;this.items=[{xtype:"v4basicinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID},{xtype:"sampleinfo",isShow:this.isShow,header:!1,applicationID:this.applicationID,panelType:this.panelType}],this.buttons=[{text:"受理",xtype:"button",itemId:"agree",hidden:!this.isAccept}],this.callParent()}});Ext.define("Soims.view.application.common.V4Sample",{itemId:"applicationCommonV4Sample",extend:"Ext.form.Panel",requires:["Ext.ux.form.TreeField"],alias:"widget.v4sample",title:"拟申请样品信息",padding:2,AutoScroll:!0,overflowY:"auto",autoShow:!0,autoHeight:!0,style:"background-color: #dfe8f5;",initComponent:function(){this.deleteid="";var e=Ext.create("Soims.store.tree.Tree");this.store=Ext.create("Soims.store.application.common.Sample"),this.isDiscussion&&(this.store.getProxy().setExtraParam("applicationID",this.applicationID),this.store.load());var t=Ext.create("Soims.store.tree.UsePurpose");this.borrowStore=Ext.create("Soims.store.application.common.BorrowOrUse"),this.columns=[{xtype:"rownumberer"},{header:"ID",dataIndex:"id",hidden:!0},{header:"样品类型",dataIndex:"sampleTypeID",flex:1,editor:{xtype:"treefield",disabled:this.isShow,singleChecked:!0,pickerTitle:"选择样品类型",store:e},renderer:function(t,i,o){if(t){var l=t.split(","),a=!0,d="";return Ext.Array.each(l,function(t){if(""!==t){var i=t.split("|"),o=e.getNodeById(i[0]),l=document.getElementById("textBox"+i[0]);o?d=l?d+"["+l.value+"]":d+"["+o.get("text")+"]":a=!1}}),a?d:o.get("sampleType")}}},{header:"使用/借用",dataIndex:"borrowOrUser",flex:1,editor:{xtype:"combobox",store:this.borrowStore,disabled:this.isShow,queryMode:"local",editable:!1,displayField:"name",valueField:"name",allowBlank:!1}},{header:"样品量",dataIndex:"sampleTotalNumber",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:"申请样品用途及目的",dataIndex:"usePurposeID",flex:1,editor:{xtype:"treefield",disabled:this.isShow,pickerTitle:"选择使用目的",store:t},renderer:function(e,i,o){if(e){console.log(e),console.log(o);var l=e.split(","),a=!0,d="";return Ext.Array.each(l,function(e){if(""!==e){var i=e.split("|"),o=t.getNodeById(i[0]),l=document.getElementById("textBox"+i[0]);console.log(o),o?d=l?d+"["+l.value+"]":d+"["+o.get("text")+"]":a=!1}}),a?d:o.get("usePurpose")}}}];var i={hidden:this.isShow,items:[{text:"添加",xtype:"button",itemId:"addSample",iconCls:"Add"},{text:"删除",itemId:"deleteSample",xtype:"button",disabled:!0,iconCls:"Delete"}]};this.items=[{xtype:"gridpanel",title:"样品列表",alias:"widget.v4samplegrid",itemId:"applicationCommonV4SampleGrid",store:this.store,columns:this.columns,selType:"rowmodel",emptyText:"没有满足条件的样品",height:200,style:"background-color: #dfe8f5;",plugins:[{ptype:"cellediting",clicksToEdit:1}],tbar:i,listeners:{selectionchange:function(e,t){this.down("#deleteSample").setDisabled(0!=t.length?!1:!0)}}},{xtype:"fieldset",title:"基本信息",hidden:this.isDiscussion,collapsible:!1,frame:!0,style:"background-color: #dfe8f5;",layout:"column",padding:"10 10 10 10",height:85,items:[{columnWidth:.4,layout:"column",bodyStyle:"background-color: #dfe8f5;",border:0,items:{xtype:"datefield",name:"activityStartTime",itemId:"activityStartTime",fieldLabel:"样品借用开始时间",readOnly:this.isShow}},{columnWidth:.4,layout:"column",bodyStyle:"background-color: #dfe8f5;",border:0,items:{xtype:"datefield",itemId:"activityEndTime",name:"activityEndTime",fieldLabel:"结束时间",readOnly:this.isShow}}]}],this.callParent()}});Ext.define("Soims.controller.application.common.V4Sample",{extend:"Ext.app.Controller",views:["application.common.V4Sample"],refs:[{ref:"v4sample",selector:"v4sample",autoCreate:!0,xtype:"v4sample"},{ref:"v4samplegrid",selector:"v4samplegrid",autoCreate:!0,xtype:"v4samplegrid"}],init:function(){this.control({"v4sample button[itemId=v4SampleSave]":{click:function(e){var t=e.up("#applicationCommonV4Sample"),a=t.applicationID;return a?void this.saveAction(a,t,!0):void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this)}},"v4sample button[itemId=addSample]":{click:function(e){var t=e.up("#applicationCommonV4Sample");if(void 0==t.applicationID)return void Ext.MessageBox.alert("失败","请先保存申请基本信息",function(){var e=t.up("tabpanel");e.setActiveTab(0)},this);var a=Ext.create("Soims.model.application.common.Sample");t.down("#applicationCommonV4SampleGrid").getStore().insert(0,a),t.down("#applicationCommonV4SampleGrid").getView().refresh()}},"v4sample button[itemId=deleteSample]":{click:function(e){Ext.MessageBox.confirm("确认","确认删除此样品？点击保存按钮生效。",function(t){if("yes"==t){var a=e.up("#applicationCommonV4Sample"),i=e.up("#applicationCommonV4SampleGrid"),o=i.getSelectionModel(),n=o.getSelection()[0];a.deleteid=a.deleteid+","+n.get("id"),i.getStore().remove(n)}},this)}},v4sample:{afterrender:function(e){var t=e.applicationID;if(t){var a=e.down("#applicationCommonV4SampleGrid").getStore();a.getProxy().setExtraParam("applicationID",t),a.load()}}}})},getCon:function(e){var t=this.application;return t.getController(e)},saveAction:function(e,t,a){this.sampleDelete(t.deleteid),this.sampleSave(e,t,a),this.commitResultSave(e,t),t.deleteid=""},sampleDelete:function(e){var t={id:e};Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Delete",params:t,async:!1,success:function(){}})},sampleSave:function(e,t,a){var i=t.down("#applicationCommonV4SampleGrid"),o=i.getStore();o.each(function(t){t.set("sampleApplication",e),""==t.get("sampleTypeID")&&t.set("sampleTypeID",t.get("sampleType")),""==t.get("usePurposeID")&&t.set("usePurposeID",t.get("usePurpose")),Ext.Ajax.request({url:Soims.service.samples.SampleService+"/Save",params:t.data,async:!1,success:function(e){var a=e.responseText.split(",");t.set("id",a[0]),t.set("sampleAreaAndCountID",a[1])}}),a&&Ext.MessageBox.alert("成功","信息保存成功！",function(){},this),o.getProxy().setExtraParam("applicationID",e),o.load()})},commitResultSave:function(e,t){var a=t.down("textfield[name=activityStartTime]").getValue(),i=t.down("textfield[name=activityEndTime]").getValue(),o={applicationID:e,activityStartTime:a,activityEndTime:i};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ActivityTimeSave",params:o,success:function(){}})}});Ext.define("Soims.controller.applicationAccept.V4Tab",{extend:"Ext.app.Controller",views:["applicationAccept.V4Tab"],requires:["Soims.model.applicationAuditing.AuditType","Soims.model.applicationAuditing.AuditState","Soims.model.applicationAccept.AcceptAction"],refs:[{ref:"acceptv4tab",selector:"acceptv4tab",autoCreate:!0,xtype:"acceptv4tab"}],init:function(){this.getController("application.common.V4Sample"),this.control({acceptv4tab:{render:function(t){if(1==t.isEdit||1==t.isShow){var e=t.down("v4basicinfopanel"),i=e.down("#activity"),c=i.getStore(),o=Ext.create("Soims.store.application.show.V4Detail");o.getProxy().setExtraParam("ID",t.applicationID),o.load(function(){0!=o.getCount()&&c.load(function(){var c=Ext.create("Soims.model.application.new.Activity",{activityID:o.getAt(0).get("activityID"),activityName:o.getAt(0).get("activityName")});i.setValue(c),e.loadRecord(o.getAt(0));var a=t.down("#applicationCommonV4Sample");a.applicationID=o.getAt(0).get("id"),a.down("datefield[itemId=activityStartTime]").setValue(o.getAt(0).get("activityStartTime")),a.down("datefield[itemId=activityEndTime]").setValue(o.getAt(0).get("activityEndTime"))})})}}},"acceptv4tab button[itemId=agree]":{click:this.onClickAgreeBtn}})},getCon:function(t){var e=this.application;return e.getController(t)},accept:function(t,e,i){var c=t.up("panel"),o=c.applicationID,a=c.down("acceptform").down("textareafield").getValue();Ext.Tools.Confirm("确认","您确定要受理"+i+"吗？ ",function(t){"yes"==t&&Ext.Ajax.request({url:Soims.service.ApplicationAccepts.AcceptService+"/Accepting",params:{Content:a,Action:e,ApplicationID:o,Competence:"AcceptB2"},scope:this,success:function(t){"error"==t.responseText?Ext.Tools.Msg("航次代码或者航段代码格式有问题，请修正！",1):Ext.Tools.Msg("受理完成！",0),c.close();var e=this.getController("applicationAccept.ApplicationGrid");e.refreshGrid()}})},this)},onClickAgreeBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Agree;this.accept(t,e.value,e.name)},onClickRejectBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Reject;this.accept(t,e.value,e.name)},onClickDenyBtn:function(t){var e=Soims.model.applicationAccept.AcceptAction.Veto;this.accept(t,e.value,e.name)},onClickCloseBtn:function(t){t.up("panel").close()}});Ext.define("Soims.controller.applicationAccept.AcceptApplicationGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AcceptApplicationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType","Soims.controller.applicationAccept.B1Tab","Soims.controller.applicationAccept.B2Tab","Soims.controller.applicationAccept.V1Tab","Soims.controller.applicationAccept.V2Tab","Soims.controller.applicationAccept.V3Tab","Soims.controller.applicationAccept.V4Tab"],refs:[{ref:"acceptapplicationgrid",selector:"acceptapplicationgrid",autoCreate:!0,xtype:"acceptapplicationgrid"}],init:function(){this.control({"acceptapplicationgrid  button[action=accept]":{click:this.onClickAppAcceptBtn},acceptapplicationgrid:{itemclick:function(e,i){console.log("Hello"),this.showHistoryState(i)},selectionchange:function(e,i){var t=this.getAcceptapplicationgrid();t.down("#accept").setDisabled(i.length>0?!1:!0)}}})},showHistoryState:function(e){var i=e.get("id"),t=this.getAcceptapplicationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(i),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:i},method:"POST",scope:this,success:function(i){console.log(i.responseText);var p=Ext.JSON.decode(i.responseText);t.refresh(p,e.get("type"))}})},showTab:function(e,i,t,p,c){var a=this.getCon("mainFrame.Main"),o=a.existInstance(e);if(o)return o;var n=Ext.create(t,{id:e,title:i,applicationID:p,isShow:!0,isAccept:!0,appType:c,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return a.addTab(n),n},show:function(){var e=this.getAcceptapplicationgrid(),i=this.getCon("mainFrame.Main");i.addTab(e)},refreshGrid:function(){this.show(),this.getAcceptapplicationgrid().getStore().reload(),this.getAcceptapplicationgrid().getSelectionModel().deselectAll()},getCon:function(e){var i=this.application;return i.getController(e)},onClickAppAcceptBtn:function(e){{var i=e.up("grid"),t=i.getSelectionModel().getSelection()[0],p=t.get("type"),c=this.getViewFnByApp("applicationAccept",p,"Tab");this.showTab("Accept"+p+t.get("id"),"受理"+t.get("name"),c,t.get("id"))}},getViewFnByApp:function(e,i,t){var p=null,c=this.getCon(e+"."+i+t);switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:p=c.getApplicationAcceptB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:p=c.getApplicationAcceptB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:p=c.getApplicationAcceptV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:p=c.getApplicationAcceptV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:p=c.getApplicationAcceptV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:p=c.getApplicationAcceptV4TabView()}return p}});Ext.define("Soims.model.applicationAccept.Accept",{extend:"Ext.data.Model",fields:[{name:"acceptID",type:"int",mapping:"AcceptID"},{name:"acceptAction",mapping:"AcceptAction"},{name:"acceptContent",mapping:"AcceptContent"},{name:"acceptTime",mapping:"AcceptTime"},{name:"applicationID",type:"int",mapping:"ID"},{name:"name",mapping:"Name"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"type",mapping:"Type"},{name:"applyTime",mapping:"ApplyTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.view.applicationAccept.AcceptCompleteGrid",{extend:"Ext.grid.Panel",requires:["Soims.model.applicationAccept.AcceptAction","Soims.store.applicationAccept.AcceptComplete"],alias:"widget.acceptcompletegrid",title:"待分配申请书列表",iconCls:"ApplicationViewColumns",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AcceptComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"acceptID",flex:1,hidden:!0},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"申请书编号",dataIndex:"applicationNumber",flex:1},{header:"填写人",dataIndex:"applicantName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"受理日期",dataIndex:"acceptTime",flex:1}],this.tbar=[{text:"查看",xtype:"button",itemId:"show",action:"show",disabled:!0,iconCls:"Information"},{text:"导出现场申请Excel",xtype:"button",itemId:"exportSiteApplication",iconCls:"DiskDownload"},{text:"导出室内申请Excel",xtype:"button",itemId:"exportIndoorApplication",iconCls:"DiskDownload"},{text:"导入现场分配建议Excel",xtype:"button",itemId:"importSiteExcel",iconCls:"DiskUpload"},{text:"导入室内分配建议Excel",xtype:"button",itemId:"importIndoorExcel",iconCls:"DiskUpload"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.store.applicationAccept.AcceptComplete",{extend:"Ext.data.Store",model:"Soims.model.applicationAccept.Accept",autoLoad:!1,proxy:{type:"ajax",url:Soims.service.ApplicationAccepts.AcceptService+"/QueryAcceptCompleteByUser",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.controller.applicationAccept.AcceptCompleteGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AcceptCompleteGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"acceptcompletegrid",selector:"acceptcompletegrid",autoCreate:!0,xtype:"acceptcompletegrid"}],init:function(){this.control({"acceptcompletegrid  button[action=show]":{click:this.onClickAppShowBtn},"acceptcompletegrid  button[itemId=exportSiteApplication]":{click:this.onExportSiteApplication},"acceptcompletegrid  button[itemId=exportIndoorApplication]":{click:this.onExportIndoorApplication},"acceptcompletegrid  button[itemId=importSiteExcel]":{click:this.onImportSiteApplication},"acceptcompletegrid  button[itemId=importIndoorExcel]":{click:this.onImportIndoorApplication},acceptcompletegrid:{itemclick:function(e,t){console.log("Hello"),this.showHistoryState(t)},selectionchange:function(e,t){var o=this.getAcceptcompletegrid();o.down("#show").setDisabled(t.length>0?!1:!0)}}})},showHistoryState:function(e){console.log(e);var t=e.get("applicationID"),o=this.getAcceptcompletegrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var i=Ext.JSON.decode(t.responseText);o.refresh(i,e.get("type"))}})},showTab:function(e,t,o,i,p){var c=this.getCon("mainFrame.Main"),n=c.existInstance(e);if(n)return n;var a=Ext.create(o,{id:e,title:t,applicationID:i,isShow:!0,isAccept:!1,appType:p,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return c.addTab(a),a},show:function(){var e=this.getAcceptcompletegrid(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},onClickAppShowBtn:function(e){{var t=e.up("grid"),o=t.getSelectionModel().getSelection()[0],i=o.get("type"),p=this.getViewFnByApp("applicationAccept",i,"Tab");this.showTab("ShowAccept"+i+o.get("id"),"查看"+o.get("name"),p,o.get("applicationID"),i)}},getViewFnByApp:function(e,t,o){var i=null,p=this.getCon(e+"."+t+o);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:i=p.getApplicationAcceptB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:i=p.getApplicationAcceptB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:i=p.getApplicationAcceptV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:i=p.getApplicationAcceptV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:i=p.getApplicationAcceptV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:i=p.getApplicationAcceptV4TabView()}return i},onExportIndoorApplication:function(){var e=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportIndoorAppToXlsExcel?isIE="+e},onExportSiteApplication:function(){var e=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportSiteAppToXlsExcel?isIE="+e},onImportSiteApplication:function(){var e=this.getCon("applicationAccept.DocumentUploadWin");e.show("/ImportSiteAppExcel")},onImportIndoorApplication:function(){var e=this.getCon("applicationAccept.DocumentUploadWin");e.show("/ImportIndoorAppExcel")}});Ext.define("Soims.view.applicationAccept.AllocationGrid",{extend:"Ext.grid.Panel",requires:"Soims.model.applicationAccept.AcceptAction",alias:"widget.allocationgrid",title:"已分配申请书列表",iconCls:"ApplicationViewColumns",closable:!0,features:[{ftype:"grouping",groupHeaderTpl:'<span style="font-size:12px">{[values.rows[0].data.name]}</span>'}],selModel:{mode:"MULTI"},selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.applicationAccept.AllocationComplete"),this.store.load(),this.columns=[{header:"id",dataIndex:"acceptID",flex:1,hidden:!0},{header:"样品类型",dataIndex:"sampleType",flex:1},{header:"申请名称",dataIndex:"name",flex:1},{header:"申请书类型",dataIndex:"type",flex:1},{header:"申请书编号",dataIndex:"applicationNumber",flex:1},{header:"填写人",dataIndex:"applicantName",hidden:!0,flex:1},{header:"负责人",dataIndex:"charger",hidden:!0,flex:1},{header:"本任务既往使用样品情况",dataIndex:"taskPreviousUsage",flex:1},{header:"申请人既往使用样品情况",dataIndex:"supplierPreviousUsage",flex:1},{header:"样品现场使用意见",dataIndex:"suggestion",flex:1},{header:"取用次序",dataIndex:"order",flex:1}],this.tbar=[{text:"收缩所有分组",xtype:"button",iconCls:"Refresh",tooltip:"<b>收缩分组</b><br/>收缩所有分组",handler:function(){var e=this.up("grid"),t=e.getView().getFeature(0);t.collapseAll()}},{text:"展开所有分组",xtype:"button",iconCls:"Refresh",tooltip:"<b>展开分组</b><br/>展开所有分组",handler:function(){var e=this.up("grid"),t=e.getView().getFeature(0);t.expandAll()}},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()},listeners:{groupclick:function(e,t,a,i){var l=i.getTarget(".grpBtn");l&&alert("hello")}}});Ext.define("Soims.controller.applicationAccept.AllocationGrid",{extend:"Ext.app.Controller",views:["applicationAccept.AllocationGrid"],requires:["Soims.model.application.common.SampleApplicationType","Soims.model.application.SamplePanelType"],refs:[{ref:"allocationgrid",selector:"allocationgrid",autoCreate:!0,xtype:"allocationgrid"}],init:function(){this.control({allocationgrid:{itemclick:function(o,i){console.log("Hello"),this.showHistoryState(i)}}})},showHistoryState:function(o){var i=o.get("applicationID"),t=this.getAllocationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(i),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:i},method:"POST",scope:this,success:function(i){console.log(i.responseText);var e=Ext.JSON.decode(i.responseText);t.refresh(e,o.get("type"))}})},showTab:function(o,i,t,e,n){var a=this.getCon("mainFrame.Main"),p=a.existInstance(o);if(p)return p;var c=Ext.create(t,{id:o,title:i,applicationID:e,isShow:!0,isAccept:!1,appType:n,panelType:Soims.model.application.SamplePanelType.AuditShow.value});return a.addTab(c),c},show:function(){var o=this.getAllocationgrid(),i=this.getCon("mainFrame.Main");i.addTab(o)},getCon:function(o){var i=this.application;return i.getController(o)},onExportIndoorApplication:function(){var o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportIndoorAppToXlsExcel?isIE="+o},onExportSiteApplication:function(){var o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.ApplicationAccepts.AcceptService+"/ExportSiteAppToXlsExcel?isIE="+o},onImportSiteApplication:function(){var o=this.getCon("applicationAccept.DocumentUploadWin");o.show("/ImportSiteAppExcel")},onImportIndoorApplication:function(){var o=this.getCon("applicationAccept.DocumentUploadWin");o.show("/ImportIndoorAppExcel")}});Ext.define("Soims.model.user.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"department",type:"int",mapping:"Department"},{name:"departmentName",type:"string",mapping:"DepartmentName"},{name:"roleIds",type:"string",mapping:"RoleIds"},{name:"roles",type:"string",mapping:"Roles"}]});Ext.define("Soims.store.user.User",{extend:"Ext.data.Store",model:"Soims.model.user.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.user.User",{extend:"Ext.grid.Panel",alias:"widget.user",title:"用户列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"User",closable:!0,store:"user.User",selType:"rowmodel",initComponent:function(){this.columns=[{header:"用户姓名",dataIndex:"name",flex:.1},{header:"单位",dataIndex:"departmentName",flex:.1},{header:"角色",dataIndex:"roles",flex:.8}],this.tbar=[{text:"添加用户",xtype:"button",iconCls:"Add",itemId:"add",disabled:!1},{text:"修改用户",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"删除用户",xtype:"button",itemId:"delete",iconCls:"Delete",disabled:!0},{text:"角色分配",xtype:"button",iconCls:"GroupEdit",itemId:"manageRole",disabled:!0},{text:"密码重置",xtype:"button",iconCls:"Key",itemId:"resetPd",disabled:!0},{text:"冻结用户",xtype:"button",iconCls:"Cancel",itemId:"frozenUser",disabled:!0},{text:"解冻用户",xtype:"button",iconCls:"ArrowUp",itemId:"thawUser",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarUser",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.User",{extend:"Ext.app.Controller",stores:["user.User"],views:["user.User"],refs:[{ref:"user",selector:"user",autoCreate:!0,xtype:"user"}],init:function(){this.control({"user  button[itemId=add]":{click:function(){var e=this.getCon("user.UserWin");e.show()}},"user  button[itemId=modify]":{click:function(e){var t=this.getCon("user.UserWin"),s=e.up("panel"),i=s.getSelectionModel(),o=i.getSelection()[0];t.getUserwin().down("panel").loadRecord(o)}},"user  button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","您确定要删除此用户么，用户所有信息都将丢失？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"user  button[itemId=manageRole]":{click:function(e){var t=this.getCon("user.RoleWin"),s=e.up("panel"),i=s.getSelectionModel(),o=i.getSelection()[0];t.show(o.get("roleIds"))}},"user  button[itemId=resetPd]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要重置该用户密码么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/ResetPd",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","重置完成！",function(){},this)}})},this)}},"user  button[itemId=frozenUser]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要冻结该用户么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/FrozenUser",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","冻结完成！",function(){},this)}})},this)}},"user  button[itemId=thawUser]":{click:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.MessageBox.confirm("确认","您确定要解冻该用户么？",function(e){"yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/ThawUser",method:"POST",scope:this,params:{id:o},success:function(){Ext.MessageBox.alert("消息","解冻完成！",function(){},this)}})},this)}},"user  button[itemId=refreshTbarUser]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},user:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getUser().down("#modify").setDisabled(!1),this.getUser().down("#delete").setDisabled(""==t[0].get("roleIds")?!1:!1),this.getUser().down("#manageRole").setDisabled(!1),this.getUser().down("#resetPd").setDisabled(!1),this.getUser().down("#frozenUser").setDisabled(!1),this.getUser().down("#thawUser").setDisabled(!1)):(this.getUser().down("#modify").setDisabled(!0),this.getUser().down("#delete").setDisabled(!0),this.getUser().down("#manageRole").setDisabled(!0),this.getUser().down("#resetPd").setDisabled(!0),this.getUser().down("#frozenUser").setDisabled(!0),this.getUser().down("#thawUser").setDisabled(!0))}}})},show:function(){var e=this.getUser(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),s=t.getSelectionModel(),i=s.getSelection(),o=i[0].get("id");Ext.Ajax.request({url:Soims.service.users.UserService+"/Delete",method:"POST",scope:this,params:{id:o},success:function(){this.getUserUserStore().reload()}})}});Ext.define("Soims.model.user.Role",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"rolename",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"}]});Ext.define("Soims.store.user.Role",{extend:"Ext.data.Store",model:"Soims.model.user.Role",proxy:{type:"ajax",url:Soims.service.users.RoleService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.user.Role",{extend:"Ext.grid.Panel",alias:"widget.role",title:"角色列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Group",closable:!0,store:"user.Role",selType:"rowmodel",initComponent:function(){this.columns=[{header:"角色",dataIndex:"rolename",flex:1},{header:"角色代码",dataIndex:"code",flex:1}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",itemId:"add",disabled:!1},{text:"权限分配",xtype:"button",itemId:"manageRight",disabled:!0},{text:"查看权限",xtype:"button",itemId:"showRight",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarRole",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.Role",{extend:"Ext.app.Controller",stores:["user.Role"],views:["user.Role"],refs:[{ref:"role",selector:"role",autoCreate:!0,xtype:"role"}],init:function(){this.control({"role  button[itemId=add]":{click:function(){}},"role  button[itemId=manageRight]":{click:function(){}},"role  button[itemId=showRight]":{click:function(){}},"role  button[itemId=refreshTbarRole]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},role:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getRole().down("#manageRight").setDisabled(!1),this.getRole().down("#showRight").setDisabled(!1)):(this.getRole().down("#manageRight").setDisabled(!0),this.getRole().down("#showRight").setDisabled(!0))}}})},show:function(){var e=this.getRole();this.getUserRoleStore().load();var t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)}});Ext.define("Soims.model.user.WaitAuditUser",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"nameSpell",type:"string",mapping:"NameSpell"},{name:"email",type:"string",mapping:"Email"},{name:"department",type:"string",mapping:"Department"},{name:"departmentID",type:"int",mapping:"DepartmentID"},{name:"remark",type:"string",mapping:"Remark"}]});Ext.define("Soims.store.user.WaitAuditUser",{extend:"Ext.data.Store",model:"Soims.model.user.WaitAuditUser",proxy:{type:"ajax",url:Soims.service.users.PersonService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.user.WaitAuditUser",{extend:"Ext.grid.Panel",alias:"widget.waitAuditUser",title:"待激活的用户列表",iconCls:"User",viewConfig:{emptyText:"没有满足条件的项目"},closable:!0,store:"user.WaitAuditUser",selType:"checkboxmodel",initComponent:function(){this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"单位",dataIndex:"department",flex:1}],this.tbar=[{text:"通过",xtype:"button",iconCls:"Accept",itemId:"pass",disabled:!0},{text:"驳回",xtype:"button",iconCls:"ArrowUndo",itemId:"reject",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarAudit",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.user.WaitAuditUser",{extend:"Ext.app.Controller",stores:["user.WaitAuditUser"],views:["user.WaitAuditUser"],refs:[{ref:"waitAuditUser",selector:"waitAuditUser",autoCreate:!0,xtype:"waitAuditUser"}],init:function(){this.control({"waitAuditUser  button[itemId=pass]":{click:function(e){this.saveAsUser(e)}},"waitAuditUser  button[itemId=reject]":{click:function(e){this.deleteDataBase(e)}},"waitAuditUser  button[itemId=refreshTbarAudit]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},waitAuditUser:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getWaitAuditUser().down("#pass").setDisabled(!1),this.getWaitAuditUser().down("#reject").setDisabled(!1)):(this.getWaitAuditUser().down("#pass").setDisabled(!0),this.getWaitAuditUser().down("#reject").setDisabled(!0))}}})},show:function(){var e=this.getWaitAuditUser(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),i=t.getSelectionModel(),s=i.getSelection(),r="";Ext.Array.each(s,function(e){e.get("id")&&(r=r+e.get("id")+",")}),Ext.Ajax.request({url:Soims.service.users.PersonService+"/DeletePersonByIds",method:"POST",scope:this,params:{ids:r},success:function(){this.getUserWaitAuditUserStore().reload()}})},saveAsUser:function(e){var t=e.up("panel"),i=t.getSelectionModel(),s=i.getSelection(),r="";Ext.Array.each(s,function(e){e.get("id")&&(r=r+e.get("id")+",")}),Ext.Ajax.request({url:Soims.service.users.UserService+"/SaveAuditUserByIds",method:"POST",scope:this,params:{ids:r},success:function(){this.getUserWaitAuditUserStore().reload()}})}});Ext.define("Soims.model.department.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"address",type:"string",mapping:"Address"},{name:"type",type:"string",mapping:"Type"},{name:"test",type:"string",mapping:"Test"}]});Ext.define("Soims.store.department.Department",{extend:"Ext.data.Store",model:"Soims.model.department.Department",autoLoad:!0,proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Query",reader:{type:"xml",root:"List",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.department.Department",{extend:"Ext.grid.Panel",alias:"widget.department",title:"单位列表",iconCls:"Group",pageSize:10,closable:!0,store:"department.Department",selType:"rowmodel",initComponent:function(){this.columns=[{header:"单位名称",dataIndex:"name",flex:1},{header:"单位地址",dataIndex:"address",flex:1},{header:"单位类型",dataIndex:"type",flex:1}],this.tbar=[{text:"添加",iconCls:"Add",xtype:"button",itemId:"add"},{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarDep",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.department.Department",{extend:"Ext.app.Controller",stores:["department.Department"],views:["department.Department"],refs:[{ref:"department",selector:"department",autoCreate:!0,xtype:"department"}],init:function(){this.control({"department  button[itemId=add]":{click:function(){var e=this.getCon("department.DepartmentWin");e.show()}},"department  button[itemId=modify]":{click:function(e){var t=this.getCon("department.DepartmentWin"),n=e.up("panel"),a=n.getSelectionModel(),i=a.getSelection()[0];t.getDepartmentWin().down("panel").loadRecord(i)}},"department  button[itemId=delete]":{click:function(e){Ext.MessageBox.confirm("确认","您确定要删除此单位么？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"department  button[itemId=refreshTbarDep]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},department:{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getDepartment().down("#delete").setDisabled(!1),this.getDepartment().down("#modify").setDisabled(!1)):(this.getDepartment().down("#delete").setDisabled(!0),this.getDepartment().down("#modify").setDisabled(!0))}}})},show:function(){var e=this.getDepartment(),t=this.getCon("mainFrame.Main");t.addTab(e)},getCon:function(e){var t=this.application;return t.getController(e)},deleteDataBase:function(e){var t=e.up("panel"),n=t.getSelectionModel(),a=n.getSelection()[0],i=a.get("id");Ext.Ajax.request({url:Soims.service.departments.DepartmentService+"/Delete",method:"POST",scope:this,params:{id:i},success:function(){this.getDepartmentDepartmentStore().reload()}})}});Ext.define("Soims.model.project.User",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"departmentName",type:"string",mapping:"Department"},{name:"address",type:"string",mapping:"Address"},{name:"cellphone",type:"string",mapping:"Cellphone"},{name:"telphone",type:"string",mapping:"Telphone"},{name:"email",type:"string",mapping:"Email"},{name:"zipCode",type:"string",mapping:"ZipCode"},{name:"fax",type:"string",mapping:"Fax"}]});Ext.define("Soims.model.voyage.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"}]});Ext.define("Soims.store.voyage.Department",{extend:"Ext.data.Store",model:"Soims.model.voyage.Department",proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.store.project.User",{extend:"Ext.data.Store",model:"Soims.model.project.User",proxy:{type:"ajax",url:Soims.service.users.UserService+"/Search",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.model.voyage.Leg",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"voyageId",type:"int",mapping:"VoyageId"},{name:"name",type:"string",mapping:"Name"},{name:"code",type:"string",mapping:"Code"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"sampleAreas",type:"string",mapping:"SampleAreas"},{name:"sampleAreaIds",type:"string",mapping:"SampleAreaIds"},{name:"startTime",type:"date",mapping:"StartTime"},{name:"endTime",type:"date",mapping:"EndTime"},{name:"startApplyTime",type:"date",mapping:"StartApplyTime"},{name:"endApplyTime",type:"date",mapping:"EndApplyTime"}]});Ext.define("Soims.view.voyage.VoyageBasic",{extend:"Ext.form.Panel",alias:"widget.voyagebasic",requires:["Soims.store.project.User","Soims.store.voyage.Department","Ext.ux.form.SearchComboBox"],title:"航次基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User"),t=Ext.create("Soims.store.voyage.Department");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,padding:"10 0 10 10",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"textfield",name:"name",forbidBlankAndShowStar:!0,readOnly:this.isShow,itemId:"name",fieldLabel:"航次名称"},{xtype:"textfield",name:"number",itemId:"number",forbidBlankAndShowStar:!0,regex:1==Soims.component.voyageBasicStartTimeHidden?void 0:/DY(\d*)-\d\d$/,regexText:"请输入正确格式，例如：DY125-05",readOnly:this.isShow,allowBlank:!1,fieldLabel:"航次代码"},{xtype:"searchcombo",name:"chargerId",itemId:"chargerId",showStar:!0,fieldLabel:"航次首席科学家",readOnly:this.isShow,store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationDepartId",readOnly:this.isShow,showStar:!0,itemId:"organizationDepartId",readOnly:this.isShow,fieldLabel:"实施单位",store:t,valueField:"id",displayField:"name"},{xtype:"datefield",name:"beginTime",itemId:"beginTime",forbidBlankAndShowStar:!0,fieldLabel:"开始时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#stopTime");a.setMinValue(t)}}},{xtype:"datefield",name:"stopTime",itemId:"stopTime",forbidBlankAndShowStar:!0,fieldLabel:"结束时间",format:"Y-m-d",readOnly:this.isShow,allowBlank:!1,listeners:{change:function(e,t){var a=e.up("panel").down("#beginTime");a.setMaxValue(t)}}}]},{xtype:"panel",border:!1,layout:"form",padding:"10 0 10 10",bodyStyle:"background-color: #dfe8f5;",columnWidth:.3,items:[{xtype:"searchcombo",name:"organizationId",readOnly:this.isShow,showStar:!0,itemId:"organizationId",fieldLabel:"实施单位联系人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},{xtype:"datefield",name:"startTime",itemId:"startTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"开放申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicStartTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),i=e.up("panel").down("#endTime");i.setMinValue(t);for(var o=0;o<a.getCount();o++){var n=a.getAt(o);n.set("startApplyTime",t)}}}},{xtype:"datefield",name:"endTime",itemId:"endTime",forbidBlankAndShowStar:!Soims.component.voyageBasicStartTimeHidden,fieldLabel:"结束申请时间",format:"Y-m-d",readOnly:this.isShow,hidden:Soims.component.voyageBasicEndTimeHidden,listeners:{change:function(e,t){var a=e.up("panel").down("#startTime");a.setMaxValue(t);for(var i=e.up("panel").up("panel").up("panel").down("leggrid").getStore(),o=0;o<i.getCount();o++){var n=i.getAt(o);n.set("endApplyTime",t)}}}}]}],this.callParent()}});Ext.define("Soims.store.voyage.Leg",{extend:"Ext.data.Store",model:"Soims.model.voyage.Leg",proxy:{type:"ajax",url:Soims.service.voyages.LegService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.LegGrid",{extend:"Ext.grid.Panel",alias:"widget.leggrid",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Ext.ux.form.TreeField"],title:"航段列表",viewConfig:{emptyText:"没有满足条件的航段"},height:400,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.Leg"),void 0!==this.voyageId&&this.initStore();var t=Ext.create("Soims.store.tree.SampleAreaAll");this.tree=t,this.store=this.vStore,this.columns=[{header:'<span>航段编号<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段代码<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"code",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}},{header:'<span>航段首席科学家<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,a){if(t){var o=e.findRecord("id",t);return null===o?a.get("chargerName"):o.get("name")}}},{header:'<span>采样区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"sampleAreaIds",flex:1,editor:{xtype:"treefield",pickerTitle:"航段所在采样区域",disabled:this.isShow,onlyCheckChild:!0,store:t},renderer:function(e,i,a){if(e){var o=e.split(","),d=!0,n="";return Ext.Array.each(o,function(e){if(""!==e){var i=e.split("|"),a=t.getNodeById(i[0]),o=document.getElementById("textBox"+i[0]);a?n=o?n+"["+o.value+"]":n+"["+a.get("text")+"]":d=!1}}),d?n:a.get("sampleAreas")}}},{header:'<span>开始时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"startTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>结束时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",name:"endTime",disabled:this.isShow,allowBlank:!1}},{header:'<span>开放申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"startApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,allowBlank:Soims.component.voyageBasicStartTimeHidden}},{header:'<span>结束申请时间<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',hidden:Soims.component.voyageBasicStartTimeHidden,dataIndex:"endApplyTime",xtype:"datecolumn",format:"Y-m-d",flex:1,editor:{xtype:"datefield",disabled:this.isShow,name:"endApplyTime",allowBlank:Soims.component.voyageBasicStartTimeHidden}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarlg",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},reloadTree:function(){this.tree.reload();var e=this.tree.getRootNode();e.eachChild(function(e){e.data.leaf||this.tree.load({node:e})},this)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageLeg",{extend:"Ext.form.Panel",alias:"widget.editvoyageleg",title:"航次航段",buttonAlign:"center",requires:["Soims.view.voyage.VoyageBasic","Soims.view.voyage.LegGrid"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagebasic",voyageId:this.voyageId,isShow:this.isShow},{xtype:"leggrid",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"保存",xtype:"button",hidden:this.isShow,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.model.voyage.VoyageTask",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"voyageTaskLegIds",type:"string",mapping:"VoyageTaskLegIds"},{name:"voyageTaskLegNames",type:"string",mapping:"VoyageTaskLegNames"}]});Ext.define("Soims.store.voyage.VoyageTask",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageTask",proxy:{type:"ajax",url:Soims.service.voyages.VoyageTaskService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.voyage.VoyageTask",{extend:"Ext.grid.Panel",alias:"widget.voyagetask",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.Leg","Soims.store.voyage.VoyageTask"],viewConfig:{emptyText:"没有满足条件的航次任务"},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,revertInvalid:!1})],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.legStore=Ext.create("Soims.store.voyage.Leg"),this.vStore=Ext.create("Soims.store.voyage.VoyageTask"),void 0!==this.voyageId&&(this.initStore(),this.vStore.load()),this.store=this.vStore,this.columns=[{header:'<span>任务名称<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"name",flex:1,editor:{xtype:"textfield",itemId:"name",disabled:this.isShow,allowBlank:!1}},{header:'<span>任务负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,o,i){if(t){var a=e.findRecord("id",t);return null===a?i.get("chargerName"):a.get("name")}}},{header:'<span>所在航段<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"voyageTaskLegNames",flex:1,editor:{xtype:"combo",store:this.legStore,multiSelect:!0,editable:!1,disabled:this.isShow,valueField:"name",allowBlank:!1,displayField:"name"}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbarEq",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.legStore.getProxy().setExtraParam("voyageId",this.voyageId),this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var o=e.getEditor(t.record,t.column);o.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageTask",{extend:"Ext.form.Panel",alias:"widget.editvoyagetask",title:"航次任务",buttonAlign:"center",requires:["Soims.view.voyage.VoyageTask"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagetask",voyageId:this.voyageId,isShow:this.isShow}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"下一步",xtype:"button",itemId:"next"}],this.callParent()},lock:function(){this.down("#save").setDisabled(!0)},unlock:function(){this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.VoyageReportBasic",{extend:"Ext.form.Panel",alias:"widget.voyagereportbasic",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox"],title:"航次报告基本信息",bodyStyle:"background-color: #dfe8f5;",layout:"column",autoShow:!0,initComponent:function(){var e=Ext.create("Soims.store.project.User");this.items=[{xtype:"textfield",name:"id",itemId:"id",hidden:!0},{xtype:"panel",border:!1,margin:"5 5 5 5",layout:"form",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"textfield",name:"name",allowBlank:!1,readOnly:this.isShow,forbidBlankAndShowStar:!0,itemId:"name",fieldLabel:"航次报告名称"}]},{xtype:"panel",border:!1,layout:"form",margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",columnWidth:.4,items:[{xtype:"searchcombo",name:"chargerId",readOnly:this.isShow,showStar:!0,itemId:"chargerId",fieldLabel:"报告牵头负责人",store:e,valueField:"id",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")}]}],this.callParent()}});Ext.define("Soims.model.voyage.VoyageReportDetail",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"chargerId",type:"int",mapping:"ChargerId"},{name:"chargerName",type:"string",mapping:"ChargerName"},{name:"discipline",type:"string",mapping:"Discipline"}]});Ext.define("Soims.store.voyage.VoyageReportDetail",{extend:"Ext.data.Store",model:"Soims.model.voyage.VoyageReportDetail",proxy:{type:"ajax",url:Soims.service.voyages.VoyageReportDetailService+"/QueryByVoyageId",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}},autoLoad:!0});Ext.define("Soims.view.voyage.VoyageReportDetail",{extend:"Ext.grid.Panel",alias:"widget.voyagereportdetail",requires:["Soims.store.project.User","Ext.ux.form.SearchComboBox","Soims.store.voyage.VoyageReportDetail"],viewConfig:{emptyText:"没有满足条件的航次任务"},title:"航次报告分工信息",plugins:[{ptype:"cellediting",clicksToEdit:1}],selType:"rowmodel",initComponent:function(){var e=Ext.create("Soims.store.project.User");this.deleteIds="",this.vStore=Ext.create("Soims.store.voyage.VoyageReportDetail"),void 0!==this.voyageId&&this.initStore(),this.store=this.vStore,this.columns=[{header:'<span>分工负责人<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"chargerId",flex:1,editor:{xtype:"searchcombo",itemId:"charger",store:e,disabled:this.isShow,valueField:"id",allowBlank:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{name} - {departmentName}</div>',"</tpl>"),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{name}","</tpl>")},renderer:function(t,i,o){if(t){var a=e.findRecord("id",t);return null===a?o.get("chargerName"):a.get("name")}}},{header:'<span>负责学科和调查区域<em style="font-style:normal;font-size:12px;color:#FF0000">（必填）</em></span>',dataIndex:"discipline",flex:1,editor:{xtype:"textfield",disabled:this.isShow,allowBlank:!1}}],this.tbar=[{text:"添加",xtype:"button",iconCls:"Add",hidden:this.isShow,itemId:"add"},{text:"删除",itemId:"delete",xtype:"button",iconCls:"Delete",hidden:this.isShow,disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbardl",iconCls:"ArrowRefresh",xtype:"button"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){this.down("#delete").setDisabled(0!=t.length?!1:!0)},initStore:function(){this.vStore.getProxy().setExtraParam("voyageId",this.voyageId)},listeners:{validateedit:function(e,t){var i=e.getEditor(t.record,t.column);i.revertInvalid=!1}}});Ext.define("Soims.view.voyage.EditVoyageReport",{extend:"Ext.form.Panel",alias:"widget.editvoyagereport",title:"航次报告",buttonAlign:"center",requires:["Soims.view.voyage.VoyageReportBasic","Soims.view.voyage.VoyageReportDetail"],autoShow:!0,initComponent:function(){this.items=[{xtype:"voyagereportbasic",isShow:this.isShow,voyageId:this.voyageId},{xtype:"voyagereportdetail",isShow:this.isShow,voyageId:this.voyageId}],this.buttons=[{text:"上一步",xtype:"button",itemId:"back"},{text:"保存",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"save"},{text:"完成",xtype:"button",hidden:this.isShow,disabled:void 0==this.voyageId?!0:!1,itemId:"complete"}],this.callParent()},lock:function(){this.down("#complete").setDisabled(!0),this.down("#save").setDisabled(!0)},unlock:function(){this.down("#complete").setDisabled(!1),this.down("#save").setDisabled(!1)}});Ext.define("Soims.view.voyage.BoardPeoplePanel",{extend:"Ext.grid.Panel",alias:"widget.boardpeoplepanel",title:"上船人员列表",viewConfig:{emptyText:"没有满足条件的项目"},closable:!1,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.BoardPeople"),this.voyageId&&this.initStore(),this.columns=[{header:"姓名",dataIndex:"name",flex:1},{header:"身份证号",dataIndex:"identityNumber",flex:1},{header:"性别",dataIndex:"sex",flex:1},{header:"单位",dataIndex:"userCompany",flex:1},{header:"职务",dataIndex:"position",flex:1},{header:"岗位职责",dataIndex:"duty",flex:1},{header:"出生日期",dataIndex:"birthday",flex:1},{header:"邮箱",dataIndex:"email",flex:1},{header:"地址",dataIndex:"address",flex:1},{header:"联系电话",dataIndex:"tellPhone",flex:1},{header:"移动电话",dataIndex:"cellPhone",flex:1}],this.tbar=[{text:"添加",xtype:"button",hidden:this.isShow,iconCls:"Add",itemId:"add",disabled:void 0==this.voyageId?!0:!1},{text:"修改",xtype:"button",iconCls:"Disk",hidden:this.isShow,itemId:"modify",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",hidden:this.isShow,xtype:"button",disabled:!0},{text:"导入单位信息Excel",hidden:this.isShow,itemId:"boardingPeopleDepartment",iconCls:"Disk",xtype:"button"},{text:"导入上船人员名单Excel",hidden:this.isShow,itemId:"boardingPeople",iconCls:"Disk",xtype:"button"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.on("selectionchange",this.buttonChange),this.callParent()},buttonChange:function(e,t){0!=t.length?this.down("#modify").setDisabled(!1):(this.down("#delete").setDisabled(!0),this.down("#modify").setDisabled(!0))},initStore:function(){this.store.getProxy().setExtraParam("voyageId",this.voyageId)},lock:function(){this.down("#add").setDisabled(!0)},unlock:function(){this.down("#add").setDisabled(!1)}});Ext.define("Soims.view.voyage.EditVoyageTag",{extend:"Ext.tab.Panel",alias:"widget.editvoyagetag",title:"航次任务样品申请",closable:!0,iconCls:"Project",requires:["Soims.view.voyage.EditVoyageLeg","Soims.view.voyage.EditVoyageTask","Soims.view.voyage.EditVoyageReport","Soims.view.voyage.BoardPeoplePanel"],initComponent:function(){this.items=[{xtype:"editvoyageleg",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagetask",isShow:this.isShow,voyageId:this.voyageId},{xtype:"editvoyagereport",isShow:this.isShow,voyageId:this.voyageId},{xtype:"boardpeoplepanel",isShow:this.isShow,voyageId:this.voyageId}],this.callParent()}});Ext.define("Soims.view.voyage.Voyage",{extend:"Ext.grid.Panel",alias:"widget.voyage",title:"航次列表",viewConfig:{emptyText:"没有满足条件的项目"},iconCls:"Project",closable:!0,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.voyage.Voyage"),this.columns=[{header:"航次代码",dataIndex:"name",flex:1},{header:"航次编号",dataIndex:"number",flex:1},{header:"航次首席科学家",dataIndex:"chargerName",flex:1},{header:"航次组织实施单位联系人",dataIndex:"organizationName",flex:1},{header:"航次组织实施单位",dataIndex:"organizationDepartName",flex:1},{header:"开始申请时间",dataIndex:"startTime",xtype:"datecolumn",format:"Y-m-d",flex:1},{header:"结束申请时间",dataIndex:"endTime",xtype:"datecolumn",format:"Y-m-d",flex:1}],this.tbar=[{text:"修改",xtype:"button",iconCls:"Disk",itemId:"modify",disabled:!0},{text:"查看",xtype:"button",iconCls:"Information",itemId:"show",disabled:!0},{text:"删除",itemId:"delete",iconCls:"Delete",xtype:"button",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.voyage.Voyage",{extend:"Ext.app.Controller",views:["voyage.Voyage"],refs:[{ref:"voyage",selector:"voyage",autoCreate:!0,xtype:"voyage"}],init:function(){this.control({"voyage  button[itemId=modify]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("EditVoyage"+o.get("id"),o.get("name"),!1,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},"voyage  button[itemId=show]":{click:function(e){var o=e.up("panel").getSelectionModel().getSelection()[0],t=this.getCon("voyage.EditVoyageTag").getVoyageEditVoyageTagView(),a=this.showTab("ShowVoyage"+o.get("id"),o.get("name"),!0,t,o.get("id")),g=a.down("editvoyageleg").down("voyagebasic");g.loadRecord(o);var i=a.down("editvoyageleg").down("leggrid");i.getStore().load()}},voyage:{selectionchange:function(e,o){0!=o.length?(this.getVoyage().down("#modify").setDisabled(!1),this.getVoyage().down("#show").setDisabled(!1)):(this.getVoyage().down("#modify").setDisabled(!0),this.getVoyage().down("#show").setDisabled(!0))}}})},showTab:function(e,o,t,a,g){var i=this.getCon("mainFrame.Main"),n=i.existInstance(e);if(n)return n;var d=Ext.create(a,{id:e,title:o,isShow:t,voyageId:g});return i.addTab(d),d},show:function(){var e=this.getVoyage(),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.model.notification.NotificationList",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"sender",type:"string",mapping:"Sender"},{name:"senderID",type:"int",mapping:"SenderID"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"},{name:"state",type:"string",mapping:"State"}]});Ext.define("Soims.store.notification.NotificationList",{extend:"Ext.data.Store",model:"Soims.model.notification.NotificationList",autoLoad:!0,pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetNotifications",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.view.notification.NotificationList",{extend:"Ext.grid.Panel",alias:"widget.notificationlist",title:"公告",iconCls:"Notification",closable:!0,store:"notification.NotificationList",selType:"rowmodel",initComponent:function(){this.columns=[{header:"标题",dataIndex:"title",flex:1},{header:"发信人",dataIndex:"sender",flex:1},{header:"发送时间",dataIndex:"dateTime",flex:1},{header:"状态",dataIndex:"state",flex:1}],this.tbar=[{text:"发布公告",xtype:"button",action:"sendNotification",name:"sendNotification",itemId:"sendNotification",iconCls:"NotificationSend"},{text:"查看",xtype:"button",action:"checkNotification",name:"checkNotification",itemId:"checkNotification",iconCls:"NotificationCheck",hidden:!0},{text:"删除",name:"deleteNotification",action:"deleteNotification",itemId:"deleteNotification",iconCls:"NotificationDelete",xtype:"button",hidden:!0},{text:"置顶",name:"top",action:"top",itemId:"top",xtype:"button",iconCls:"NotificationTop",hidden:!0},{text:"取消置顶",name:"cancelTop",action:"cancelTop",itemId:"cancelTop",xtype:"button",iconCls:"NotificationCancel",hidden:!0},{text:"过期",name:"overdue",action:"overdue",itemId:"overdue",xtype:"button",iconCls:"NotificationOverdue",hidden:!0},{text:"取消过期",name:"cancelOverdue",action:"cancelOverdue",itemId:"cancelOverdue",iconCls:"NotificationCancelOverdue",xtype:"button",hidden:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.controller.voyage.EditVoyageTag",{extend:"Ext.app.Controller",views:["voyage.EditVoyageTag"],refs:[{ref:"editvoyagetag",selector:"editvoyagetag",autoCreate:!0,xtype:"editvoyagetag"}],init:function(){this.getCon("voyage.EditVoyageLeg"),this.getCon("voyage.EditVoyageTask"),this.getCon("voyage.EditVoyageReport"),this.getCon("voyage.BoardPeople"),this.control({})},show:function(){{var e=this.getVoyageEditVoyageTagView(),o=this.getCon("voyage.Voyage");o.showTab("newVoyage","新建航次航段",!1,e,void 0)}},getCon:function(e){var o=this.application;return o.getController(e)}});Ext.define("Soims.model.notification.Notification",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"}]});Ext.define("Soims.store.notification.Notification",{extend:"Ext.data.Store",model:"Soims.model.notification.Notification",pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetAvailable",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total",id:"ID"}},autoLoad:!0});Ext.define("Soims.view.notification.ShowNotificationBasic",{extend:"Ext.form.Panel",alias:"widget.shownotificationbasic",autoShow:!0,initComponent:function(){this.items=[{xtype:"htmleditor",width:590,height:50,name:"title",itemId:"title",readOnly:!0,hidden:!1},{xtype:"htmleditor",height:525,width:590,name:"content",itemId:"content",readOnly:!0,hidden:!1}],this.callParent()}});Ext.define("Soims.view.notification.ShowNotification",{extend:"Ext.window.Window",alias:"widget.shownotification",closable:!0,iconCls:"  ",requires:["Soims.view.notification.ShowNotificationBasic"],width:600,height:500,autoShow:!0,initComponent:function(){this.items=[{xtype:"shownotificationbasic",isShow:this.isShow}],this.buttons=[{text:"确定",xtype:"button",itemId:"Ok",action:"Ok"}],this.callParent()}});Ext.define("Soims.controller.notification.ShowNotification",{extend:"Ext.app.Controller",stores:["notification.Notification"],views:["notification.ShowNotification"],refs:[{ref:"shownotification",selector:"shownotification",autoCreate:!0,xtype:"shownotification"}],init:function(){this.control({"shownotification  button[itemId=Ok]":{click:function(o){o.up("window").close()}}})},getCon:function(o){var i=this.application;return i.getController(o)},showWindow:function(){var o=this.getShownotification();return o}});Ext.define("Soims.controller.notification.NotificationList",{extend:"Ext.app.Controller",stores:["notification.NotificationList"],views:["notification.NotificationList"],refs:[{ref:"notificationlist",selector:"notificationlist",autoCreate:!0,xtype:"notificationlist"}],init:function(){this.control({"notificationlist  button[itemId=sendNotification]":{click:function(){var t=this.getCon("notification.SendNotification");t.showWindow()}},"notificationlist  button[itemId=checkNotification]":{click:function(t){var i=this.getCon("notification.ShowNotification"),e=t.up("panel"),o=e.getSelectionModel(),n=o.getSelection()[0];i.getShownotification().down("#title").getToolbar().hide(),i.getShownotification().down("#content").getToolbar().hide();var s=this.application;s.getController("notification.ShowNotification").showWindow();s.getController("notification.ShowNotification").showWindow();i.getShownotification().down("panel").loadRecord(n)}},"notificationlist  button[itemId=deleteNotification]":{click:function(t){Ext.Tools.Confirm("确认","您确定要删除该条目？",function(i){"yes"==i&&this.deleteDataBase(t)},this)}},"notificationlist  button[itemId=top]":{click:function(t){this.top(t)}},"notificationlist  button[itemId=cancelTop]":{click:function(t){this.cancelTop(t)}},"notificationlist  button[itemId=overdue]":{click:function(t){this.overdue(t)}},"notificationlist  button[itemId=cancelOverdue]":{click:function(t){this.cancelOverdue(t)}},"notificationlist  button[itemId=refreshTbar]":{click:function(t){t.up("panel").getStore().reload(),t.up("panel").getSelectionModel().deselectAll()}},notificationlist:{itemdblclick:function(){},selectionchange:function(t,i){0!=i.length?"置顶"==i[0].get("state")?(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!0),this.getNotificationlist().down("#overdue").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1)):"普通"==i[0].get("state")?(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!0),this.getNotificationlist().down("#overdue").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1)):"过期"==i[0].get("state")&&(this.getNotificationlist().down("#checkNotification").setVisible(!0),this.getNotificationlist().down("#deleteNotification").setVisible(!0),this.getNotificationlist().down("#top").setVisible(!0),this.getNotificationlist().down("#cancelOverdue").setVisible(!0),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#overdue").setVisible(!1)):(this.getNotificationlist().down("#checkNotification").setVisible(!1),this.getNotificationlist().down("#deleteNotification").setVisible(!1),this.getNotificationlist().down("#top").setVisible(!1),this.getNotificationlist().down("#cancelTop").setVisible(!1),this.getNotificationlist().down("#overdue").setVisible(!1),this.getNotificationlist().down("#cancelOverdue").setVisible(!1))}}})},getCon:function(t){var i=this.application;return i.getController(t)},showNotificationList:function(){var t=this.getNotificationlist(),i=this.getCon("mainFrame.Main");i.addTab(t)},top:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Top",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},cancelTop:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/CancelTop",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},overdue:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Overdue",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},cancelOverdue:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/CancelOverdue",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})},deleteDataBase:function(t){var i=t.up("panel"),e=i.getSelectionModel(),o=e.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.NotificationService+"/Delete",method:"POST",scope:this,params:{id:n},success:function(){t.up("panel").getStore().reload()}})}});