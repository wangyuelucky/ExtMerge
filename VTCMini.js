Ext.define("Soims.view.application.ApplicationPanel",{extend:"Ext.form.Panel",alias:"widget.applicationpanel",iconCls:"ApplicationSideList",closable:!0,initComponent:function(){this.items=[{xtype:"applicationhistorypanel"},{xtype:this.grid}],this.title=this.title,this.callParent()}});Ext.define("Soims.view.application.ApplicationHistoryPanel",{itemId:"applicationApplicationHistoryPanel",extend:"Ext.form.Panel",alias:"widget.applicationhistorypanel",title:"申请历史流程",padding:2,bodyStyle:"background-color:#dfe8f5;",height:115,autoShow:!0,bodyPadding:"15 0 0 0",initComponent:function(){this.items={xtype:"label"},this.on("afterrender",this.showDefaultHistoryState),this.callParent()},refresh:function(t,i){switch(i){case Soims.model.application.common.SampleApplicationType.B1.value:this.showB1(t);break;case Soims.model.application.common.SampleApplicationType.B2.value:this.showB2(t);break;case Soims.model.application.common.SampleApplicationType.V1.value:this.showV1(t);break;case Soims.model.application.common.SampleApplicationType.V2.value:this.showV2(t);break;case Soims.model.application.common.SampleApplicationType.V3.value:this.showV3(t);break;case Soims.model.application.common.SampleApplicationType.V4.value:this.showV4(t)}},showB1:function(t){var i=void 0==t.VODCSubmit?"Application/common/resources/images/appState/a_0.png":t.VODCSubmit.url,e=void 0==t.VODCSubmit?"":t.VODCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>航次组织实施单位审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showB2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o=void 0==t.VSSubmit&&void 0==t.LSSubmit?"Application/common/resources/images/appState/a_0.png":void 0==t.VSSubmit?t.LSSubmit.url:t.VSSubmit.url,a=void 0==t.VSSubmit&&void 0==t.LSSubmit?"":void 0==t.VSSubmit?t.LSSubmit.tip:t.VSSubmit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>航次/航段首席科学家审核</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var n=this.showBeginHtml(t)+l+this.showEndHtml(t);this.down("label").setText(n,!1)},showV1:function(t){var i=void 0==t.VRCSubmit?"Application/common/resources/images/appState/a_0.png":t.VRCSubmit.url,e=void 0==t.VRCSubmit?"":t.VRCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>任务牵头负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV2:function(t){var i=void 0==t.PCSubmit?"Application/common/resources/images/appState/a_0.png":t.PCSubmit.url,e=void 0==t.PCSubmit?"":t.PCSubmit.tip,o='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>项目负责人审核</div>';o+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var a=this.showBeginHtml(t)+o+this.showEndHtml(t);this.down("label").setText(a,!1)},showV3:function(t){var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showV4:function(t){console.log(t);var i=this.showBeginHtml(t)+this.showEndHtml(t);this.down("label").setText(i,!1)},showBeginHtml:function(t){var i=void 0==t.UnSubmit?"Application/common/resources/images/appState/a_1.png":t.UnSubmit.url,e=void 0==t.UnSubmit?"":t.UnSubmit.tip,o=void 0==t.Submit?"Application/common/resources/images/appState/a_2.png":t.Submit.url,a=void 0==t.Submit?"":t.Submit.tip,l='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>新建申请</div>';return l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',l=l+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>提交</div>',l+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>'},showEndHtml:function(t){var i=void 0==t.AdminAccept?"Application/common/resources/images/appState/a_3.png":t.AdminAccept.url,e=void 0==t.AdminAccept?"":t.AdminAccept.tip,o=void 0==t.AdminAllot?"Application/common/resources/images/appState/a_4.png":t.AdminAllot.url,a=void 0==t.AdminAllot?"":t.AdminAllot.tip,l=void 0==t.SMESubmit?"Application/common/resources/images/appState/a_5.png":t.SMESubmit.url,n=void 0==t.SMESubmit?"":t.SMESubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,m=void 0==t.OISubmit?"Application/common/resources/images/appState/a_6.png":t.OISubmit.url,p=void 0==t.OISubmit?"":t.OISubmit.tip,s='<div style="text-align:center; width: 80px; float:left;"><img title="'+e+'" src="'+i+'" height="24" width="24"><br>申请受理</div>';return s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+a+'" src="'+o+'" height="24" width="24"><br>分配方案编制</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+n+'" src="'+l+'" height="24" width="24"><br>申请审议</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s=s+'<div style="text-align:center; width: 80px; float:left;"><img title="'+p+'" src="'+m+'" height="24" width="24"><br>申请审批</div>',s+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>',s+='<div style="text-align:center; width: 80px; float:left;"><img title="" src= "Application/common/resources/images/appState/a_7.png" " height="24" width="24"><br>样品清点与出库</div>'},showDefaultHistoryState:function(){var t={},i='<div style="text-align:center; width: 80px; float:left;"><img title="" src="Application/common/resources/images/appState/a_0.png" height="24" width="24"><br>申请审核</div>';i+='<div style="text-align:center; width: 10px; float:left;"><img src="Application/common/resources/images/appState/lianjie.png"></img></div>';var e=this.showBeginHtml(t)+i+this.showEndHtml(t);this.down("label").setText(e,!1)}});Ext.define("Soims.model.application.common.SampleApplicationType",{statics:{B1:{value:"B1",name:"b1申请书"},B2:{value:"B2",name:"b2申请书"},V1:{value:"V1",name:"v1申请书"},V2:{value:"V2",name:"v2申请书"},V3:{value:"V3",name:"v3申请书"},V4:{value:"V4",name:"v4申请书"}}});Ext.define("Soims.controller.application.ApplicationHistoryPanel",{extend:"Ext.app.Controller",views:["application.ApplicationHistoryPanel"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationhistorypanel",selector:"applicationhistorypanel",autoCreate:!0,xtype:"applicationhistorypanel"}],init:function(){this.control({})},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.controller.application.ApplicationPanel",{extend:"Ext.app.Controller",views:["application.ApplicationPanel"],refs:[{ref:"applicationpanel",selector:"applicationpanel",autoCreate:!0,xtype:"applicationpanel"}],init:function(){this.control({applicationpanel:{resize:function(i,t,a){var n=i.down("grid");n.setHeight(a-120)}}})},showTab:function(i,t,a,n,e,o){var p=this.getCon("mainFrame.Main"),l=p.existInstance(i);if(l)return l;var r=Ext.create(a,{id:i,title:t,application:this.application,applicationID:n,isShow:e,isEdit:o});return p.addTab(r),r},show:function(i,t){this.getCon(i),this.getController("application.ApplicationHistoryPanel");var a=i.split(".")[1].toLowerCase(),n=this.getView("application.ApplicationPanel"),e=Ext.create(n,{id:a,grid:a,title:t}),o=this.getCon("mainFrame.Main");o.addTab(e)},getCon:function(i){var t=this.application;return t.getController(i)}});Ext.define("Soims.model.application.Application",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"applicationNumber",mapping:"ApplicationNumber"},{name:"name",mapping:"Name"},{name:"discussionTime",mapping:"DiscussionTime"},{name:"approvalTime",mapping:"ApprovalTime"},{name:"applicantID",mapping:"ApplicantID"},{name:"applicantName",mapping:"ApplicantName"},{name:"charger",mapping:"Charger"},{name:"chargerID",mapping:"ChargerID"},{name:"leg",mapping:"Leg"},{name:"voyage",mapping:"Voyage"},{name:"legID",mapping:"LegID"},{name:"type",mapping:"Type"},{name:"taskName",mapping:"TaskName"},{name:"topicID",mapping:"TopicID"},{name:"bearVoyageTaskID",mapping:"BearVoyageTaskID"},{name:"voyageReportID",mapping:"VoyageReportID"},{name:"noOceanTopicID",mapping:"NoOceanTopicID"},{name:"activityID",mapping:"ActivityID"},{name:"activityStartTime",mapping:"ActivityStartTime"},{name:"activityEndTime",mapping:"ActivityEndTime"},{name:"usingNecessity",mapping:"UsingNecessity"},{name:"repatriaionNecessity",mapping:"RepatriaionNecessity"},{name:"commitResultTime",mapping:"CommitResultTime"},{name:"commitResultForm",mapping:"CommitResultForm"},{name:"commitResultAmount",mapping:"CommitResultAmount"},{name:"applyTime",mapping:"ApplyTime"},{name:"createTime",mapping:"CreateTime"},{name:"state",mapping:"State"}]});Ext.define("Soims.store.application.Application",{extend:"Ext.data.Store",model:"Soims.model.application.Application",pageSize:50,autoLoad:!1,proxy:{type:"ajax",url:Soims.service.applications.ApplicationsService+"/Query",reader:{type:"xml",root:"QueryResult",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.application.ApplicationGrid",{extend:"Ext.grid.Panel",alias:"widget.applicationgrid",title:"申请书列表",iconCls:"ApplicationSideList",closable:!1,padding:2,selType:"rowmodel",initComponent:function(){this.store=Ext.create("Soims.store.application.Application"),this.height=Ext.ComponentQuery.query("center")[0].getHeight()-120,this.columns=[{header:"id",dataIndex:"id",flex:1,hidden:!0},{xtype:"rownumberer"},{header:"申请名称",dataIndex:"name",width:250,flex:1},{header:"承担任务名称",dataIndex:"taskName",flex:1},{header:"负责人",dataIndex:"charger",flex:1},{header:"创建日期",dataIndex:"createTime",flex:1},{header:"提交日期",dataIndex:"applyTime",flex:1},{header:"申请状态",dataIndex:"state",flex:1,renderer:function(e){return Soims.model.application.common.ApplicationState[e].name}},{header:"填写人",dataIndex:"applicantName",flex:1}],this.tbar=[{text:"查看",xtype:"button",action:"appShow",name:"appShow",itemId:"appShow",disabled:!0,iconCls:"Information"},{text:"编辑",xtype:"button",action:"appEdit",name:"appEdit",itemId:"appEdit",disabled:!0,iconCls:"Disk"},{text:"提交",xtype:"button",action:"appSubmit",name:"appSubmit",itemId:"appSubmit",disabled:!0,iconCls:"ArrowUp"},{text:"导出",xtype:"button",action:"export",name:"export",itemId:"export",disabled:!0,iconCls:"DiskDownload"},{text:"删除",xtype:"button",action:"appDelete",name:"appDelete",itemId:"appDelete",disabled:!0,iconCls:"Delete"},{text:"撤回",name:"appCancel",action:"appCancel",itemId:"appCancel",xtype:"button",disabled:!0,iconCls:"ArrowUndo"},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",iconCls:"ArrowRefresh",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.on("selectionchange",this.buttonChange),this.on("itemdblclick",this.showFlawChart),this.callParent()},buttonChange:function(e,t){t.length>0?"UnSubmit"==t[0].get("state")||"AdminReject"==t[0].get("state")||"Cancel"==t[0].get("state")?(this.down("#appShow").setDisabled(!1),this.down("#appEdit").setDisabled(!1),this.down("#appSubmit").setDisabled(!1),this.down("#appDelete").setDisabled(!1),this.down("#appCancel").setDisabled(!0),this.down("#export").setDisabled(!0)):"Deleted"==t[0].get("state")?(this.down("#appCancel").setDisabled(!0),this.down("#appShow").setDisabled(!0),this.down("#appEdit").setDisabled(!0),this.down("#appSubmit").setDisabled(!0),this.down("#appDelete").setDisabled(!0),this.down("#export").setDisabled(!0)):(this.down("#appShow").setDisabled(!1),this.down("#appEdit").setDisabled(!0),this.down("#appSubmit").setDisabled(!0),this.down("#appDelete").setDisabled(!0),this.down("#appCancel").setDisabled(!1),this.down("#export").setDisabled(!1)):(this.down("#appShow").setDisabled(!0),this.down("#appEdit").setDisabled(!0),this.down("#appSubmit").setDisabled(!0),this.down("#appDelete").setDisabled(!0),this.down("#appCancel").setDisabled(!0),this.down("#export").setDisabled(!0))},showFlawChart:function(){}});Ext.define("Soims.view.mainFrame.Center",{extend:"Ext.tab.Panel",alias:"widget.center",region:"center",activeItem:0,plugins:Ext.create("Ext.ux.tabPanel.TabCloseMenu",{pluginId:"TabCloseMenu",closeTabText:"关闭当前页",closeOthersTabsText:"关闭其他页",closeAllTabsText:"关闭所有页"}),items:[{title:"首页",frame:!0,style:"padding:2px;",iconCls:"House",items:{xtype:"messagelist"}}],initComponent:function(){this.callParent()}});Ext.define("Soims.model.mainFrame.RoleMenu",{extend:"Ext.data.Model",fields:["id","text","code","iconCls","checked","config"]});Ext.define("Soims.store.mainFrame.RoleMenu",{extend:"Ext.data.Store",model:"Soims.model.mainFrame.RoleMenu",proxy:{type:"ajax",url:Soims.service.users.RoleService+"/GetRole",reader:{type:"json",root:"root"}},autoLoad:!0});Ext.define("Soims.view.mainFrame.RoleMenu",{extend:"Ext.ux.grid.menu.StoreMenu",alias:"widget.rolemenu",plain:!0,minWidth:30,width:180,requires:["Soims.store.mainFrame.RoleMenu"],initComponent:function(){var e=this,i=Ext.create("Soims.store.mainFrame.RoleMenu");e.store=i,e.callParent()}});Ext.define("Soims.view.mainFrame.North",{extend:"Ext.panel.Panel",alias:"widget.north",region:"north",border:0,requires:["Soims.view.mainFrame.RoleMenu"],tpl:'<div style = "height:93px; padding:50px 60px 0px; background-color:#DFE8F6; background-image:url(Application/common/resources/images/topFinally.jpg); background-repeat:no-repeat;">',fbar:[{tpl:'<div style="font-weight: bold">您好： {userName}！  当前角色是： {roleName} &nbsp;</div></div>',xtype:"label"},{xtype:"tbfill"},{text:"短消息",iconCls:"Email",tooltip:"短消息列表",action:"messageList"},"-",{text:"切换角色",iconCls:"User",tooltip:"切换角色",menu:{xtype:"rolemenu"}},"-",{text:"修改密码",iconCls:"UserKey",tooltip:"修改密码",action:"changePassword"},"-",{text:"个人信息",iconCls:"User",tooltip:"完善个人信息",action:"improveInformation"},"-",{text:"安全退出",iconCls:"ControlPowerBlue",tooltip:"退出系统",action:"logout"}],initComponent:function(){this.callParent()}});Ext.define("Soims.view.mainFrame.West",{extend:"Ext.panel.Panel",alias:"widget.west",region:"west",id:"DivPanelMenu",collapsible:!0,width:200,autoScroll:!0,split:!0,frame:!0,titleCollapse:!0,initComponent:function(){this.callParent()},addItems:function(t){for(var e=this.getMenuItems(t),i=0,l=e.length;l>i;i++)this.add(e[i])},getMenuItems:function(t){for(var e=[],i=(Soims.currentLoginLog.user,0);i<t.length;i++){for(var l='<ul class="">',n=0;n<t[i].Child.length;n++){var a=t[i].Child;l+=Ext.String.format('<li id="MenuBarItem-li-{0}">',a[n].Action),l+=Ext.String.format('<img src="../Application/common/resources/images/s.gif" class="{0}"/>',a[n].IconCls),l+=Ext.String.format('<a id="MenuBarItem-a-{0}" class="" href="#"><span id="{1}">{2}</span></a>',a[n].Action,a[n].PoolSpan,a[n].Title),l+=Ext.String.format("</li>")}l+="</ul>",e[e.length]=new Ext.Panel({frame:!0,title:t[i].Title,collapsible:!0,iconCls:t[i].IconCls,html:l,titleCollapse:!0})}return e}});Ext.define("Soims.view.message.MessageList",{extend:"Ext.grid.Panel",alias:"widget.messagelist",title:"未读短消息",closable:!0,store:"message.MessageList",selType:"rowmodel",initComponent:function(){this.columns=[{header:"标题",dataIndex:"title",flex:1},{header:"发信人",dataIndex:"sender",flex:1},{header:"收信人",dataIndex:"receiver",flex:1},{header:"发送时间",dataIndex:"dateTime",flex:1},{header:"是否已读",dataIndex:"isRead",flex:1}],this.tbar=[{text:"发送短消息",xtype:"button",action:"sendMessage",name:"sendMessage",iconCls:"NotificationSend",itemId:"sendMessage"},{text:"全部标记为已读",name:"markAllAsRead",action:"markAllAsRead",itemId:"markAllAsRead",iconCls:"NotificationAsRead",xtype:"button"},{text:"查看",xtype:"button",action:"check",name:"check",itemId:"check",iconCls:"NotificationEdit",disabled:!0},{text:"删除",name:"delete",action:"delete",itemId:"delete",xtype:"button",iconCls:"NotificationDelete",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.view.mainFrame.Viewport",{extend:"Ext.container.Viewport",requires:["Soims.view.mainFrame.Center","Soims.view.mainFrame.North","Soims.view.mainFrame.West","Soims.view.message.MessageList"],alias:"widget.configviewport",layout:"border",items:[{xtype:"north"},{xtype:"west"},{xtype:"center"}],initComponent:function(){this.callParent()}});Ext.define("Soims.model.message.MessageList",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"receiver",type:"string",mapping:"Receiver"},{name:"receiverID",type:"int",mapping:"ReceiverID"},{name:"sender",type:"string",mapping:"Sender"},{name:"senderID",type:"int",mapping:"SenderID"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"},{name:"isRead",type:"string",mapping:"IsRead",convert:function(e){return"False"==e?"否":"是"}}]});Ext.define("Soims.store.message.MessageList",{extend:"Ext.data.Store",model:"Soims.model.message.MessageList",autoLoad:!0,pageSize:25,proxy:{type:"ajax",url:Soims.service.users.MessageService+"/GetUnReadMessages",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.define("Soims.controller.mainFrame.Main",{extend:"Ext.app.Controller",views:["mainFrame.Viewport"],stores:["message.MessageList"],refs:[{ref:"configviewport",selector:"configviewport",autoCreate:!0,xtype:"configviewport"},{ref:"north",selector:"north",autoCreate:!0,xtype:"configviewport"},{ref:"west",selector:"west",autoCreate:!0,xtype:"west"},{ref:"center",selector:"center",autoCreate:!0,xtype:"center"},{ref:"rolemenu",selector:"rolemenu"},{ref:"messagelist",selector:"messagelist",autoCreate:!0,xtype:"messagelist"}],init:function(){this.control({west:{afterrender:this.afterWestRender},"north button[action=logout]":{click:this.logout},"north button[action=changePassword]":{click:function(){Ext.create("Soims.view.mainFrame.ModifyPdWin").show()}},"north button[action=improveInformation]":{click:function(){var e=Ext.create("Soims.view.mainFrame.ImproveInformation").show(),t=Ext.create("Soims.model.department.Department",{id:Soims.currentUser.departmentId,name:Soims.currentUser.department});e.down("#id").setValue(Soims.currentUser.id),e.down("#department").setValue(t),e.down("#name").setValue(Soims.currentUser.name),e.down("#loginId").setValue(Soims.currentUser.loginId),e.down("#email").setValue(Soims.currentUser.email),e.down("#telphone").setValue(Soims.currentUser.telPhone),e.down("#adress").setValue(Soims.currentUser.address),e.down("#fax").setValue(Soims.currentUser.fax),e.down("#cellphone").setValue(Soims.currentUser.cellPhone),e.down("#zipcode").setValue(Soims.currentUser.zip)}},"north button[action=messageList]":{click:function(){var e=this.getCon("message.AllMessageList");e.showAllMessageList()}},"west panel>a":{click:function(){console.log("menu click..")}},"center button[itemId=sendMessage]":{click:function(){var e=this.getCon("message.SendMessage");e.showWindow(this.getMessagelist())}},"center  button[action=markAllAsRead]":{click:function(e){this.markAllAsRead(e)}},"center button[itemId=check]":{click:function(e){var t=e.up("panel").getSelectionModel().getSelection()[0],s=this.getCon("message.SendMessage").getMessageSendMessageView(),o=Ext.create(s,{id:"ShowMessage"+t.get("id"),title:t.get("name"),isShow:!0});o.down("#content").getToolbar().hide(),o.show();var n=o.down("sendmessagebasic");n.loadRecord(t),this.markAsRead(e)}},"center  button[action=delete]":{click:function(e){Ext.Tools.Confirm("确认","您确定要删除该条目？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"center  button[itemId=refreshTbar]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},"configviewport>center>panel>messagelist":{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getCenter().down("#delete").setDisabled(!1),this.getCenter().down("#check").setDisabled(!1)):(this.getCenter().down("#delete").setDisabled(!0),this.getCenter().down("#check").setDisabled(!0))}},rolemenu:{click:this.onRoleClick}})},afterWestRender:function(){var e=this.getWest().body;e.on("mousedown",this.doAction,this,{delegate:"a"}),e.on("click",Ext.emptyFn,this,{delegate:"a",preventDefault:!0})},doAction:function(e,t){var s=this.getCenter();s.body.mask("数据加载中...");var o,n,r,i=t.childNodes.item(0).innerHTML,a=t.id.replace("MenuBarItem-a-",""),c=this.application;o=a.split("-")[0],n=a.split("-")[1],3==a.split("-").length?(r=c.getController(o),r[n](a.split("-")[2],i)):(r=c.getController(o),r[n]()),s.body.unmask()},logout:function(){Ext.Tools.Confirm("确认","您确定要退出本系统吗？ 退出前请保存好您的重要信息！ ",function(e){if("yes"==e){var t=this.application,s=t.getController("login.Login");s.logout()}},this)},updateUserInfo:function(){var e=this.getNorth().getDockedItems('toolbar[dock="bottom"]')[0].items.items[0];this.getNorth().update({userName:Soims.currentUser.name,roleName:Soims.currentUser.currentRoleName}),e.update({userName:Soims.currentUser.name,roleName:Soims.currentUser.currentRoleName})},onRoleClick:function(e,t){t.id!==Soims.currentUser.currentRoleID?(this.closeAllTabs(),this.changeRole(e,t),Soims.currentUser.currentRoleID=t.id,Soims.currentUser.currentRoleName=t.text,Soims.currentUser.currentRoleCode=t.code,this.updateUserInfo()):Ext.Tools.Alert("警告","当前角色即为："+t.text,"W")},changeRole:function(e,t){Ext.Ajax.request({url:Soims.service.users.RoleService+"/ChangeRole",method:"POST",scope:this,params:{id:t.id},success:this.onChangeRoleSuccess})},onChangeRoleSuccess:function(){this.onGetComponentConfig();var e=this.getWest();e.body.mask("菜单加载中..."),Ext.Ajax.request({url:Soims.service.users.MenuService+"/ShowMenu",method:"POST",scope:e,success:this.onChangeMenuSuccess})},onGetComponentConfig:function(){Ext.Ajax.request({url:Soims.service.users.MenuService+"/GetComponent",method:"POST",scope:this,success:function(e){console.log(e.responseText),Soims.component=Ext.decode(e.responseText)}})},onChangeMenuSuccess:function(e){var t,s=this;e.responseText&&(s.removeAll(),t=Ext.decode(e.responseText),s.addItems(t)),s.body.unmask(),Ext.Tools.Msg("切换角色完成！",0)},closeAllTabs:function(){var e=this.getCenter(),t=e.getPlugin("TabCloseMenu");t.onCloseAll()},existInstance:function(e){var t=this.getCenter(),s=t.queryById(e);return s?(t.setActiveTab(s),s):s},addTab:function(e){var t=this.getCenter(),s=t.queryById(e.getId());s?t.setActiveTab(s):(t.add(e),t.setActiveTab(e))},getCon:function(e){var t=this.application;return t.getController(e)},markAsRead:function(e){var t=e.up("panel"),s=t.getSelectionModel(),o=s.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.MessageService+"/MarkAsRead",method:"POST",scope:this,params:{id:n},success:function(){e.up("panel").getStore().reload()}})},markAllAsRead:function(e){{var t=e.up("panel"),s=t.getSelectionModel();s.getSelection()[0]}Ext.Ajax.request({url:Soims.service.users.MessageService+"/MarkAllAsRead",method:"POST",scope:this,success:function(){e.up("panel").getStore().reload()}})},deleteDataBase:function(e){var t=e.up("panel"),s=t.getSelectionModel(),o=s.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.MessageService+"/Delete",method:"POST",scope:this,params:{id:n},success:function(){e.up("panel").getStore().reload()}})}});Ext.define("Soims.controller.application.ApplicationGrid",{extend:"Ext.app.Controller",stores:["application.Application"],views:["application.ApplicationGrid"],requires:["Soims.model.application.common.SampleApplicationType"],refs:[{ref:"applicationgrid",selector:"applicationgrid",autoCreate:!0,xtype:"applicationgrid"}],init:function(){this.control({"applicationgrid  button[action=appDelete]":{click:this.onClickappDeleteBtn},"applicationgrid  button[action=appCancel]":{click:this.onClickappCancelBtn},"applicationgrid  button[action=appSubmit]":{click:this.onClickappSubmitBtn},"applicationgrid  button[action=appEdit]":{click:this.onClickAppEditBtn},"applicationgrid  button[action=appShow]":{click:this.onClickAppShowBtn},"applicationgrid  button[action=export]":{click:this.onClickAppExportBtn},applicationgrid:{itemclick:function(e,t){console.log("Hello"),this.showHistoryState(t)},beforerender:function(e){var t=e.getStore();t.getProxy().setExtraParam("ApplicantID",Soims.currentUser.id),t.getProxy().setExtraParam("VoyageTaskChargerID",Soims.currentUser.id),t.reload()}}})},onClickAppExportBtn:function(e){var t=e.up("grid"),i=t.getSelectionModel().getSelection()[0],o=window.navigator.userAgent.indexOf("MSIE")>=1;document.location.href=Soims.service.applications.ApplicationsService+"/GetApplicationWordDocument?applicationID="+i.get("id")+"&isIE="+o},showHistoryState:function(e){var t=e.get("id"),i=this.getApplicationgrid().up("applicationpanel").down("applicationhistorypanel");console.log(t),Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/ShowApplicationHistory",params:{applicationID:t},method:"POST",scope:this,success:function(t){console.log(t.responseText);var o=Ext.JSON.decode(t.responseText);i.refresh(o,e.get("type"))}})},submitAction:function(e){var t=e.up("grid"),i=t.getSelectionModel().getSelection()[0],o={applicationID:i.get("id"),type:i.get("type")};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/Submit",params:o,method:"POST",scope:this,success:function(e){var t=Ext.JSON.decode(e.responseText);if("Result"in t)switch(t.Result){case"Success":return void Ext.MessageBox.alert("成功","申请提交成功！",function(){var e=this.application,t=e.getController("application.ApplicationPanel").getApplicationpanel(),i=e.getController("mainFrame.Main");i.addTab(t),t.down("grid").getStore().reload();var o=t.getSelectionModel();o.deselect(o.getSelection()[0],!0),t.down("#appShow").setDisabled(!0),t.down("#appEdit").setDisabled(!0),t.down("#appSubmit").setDisabled(!0),t.down("#appDelete").setDisabled(!0),t.down("#appCancel").setDisabled(!0)},this);case"Failure":Ext.MessageBox.alert("失败","信息保存失败，请核对填写信息。",function(){},this)}}})},onClickappSubmitBtn:function(e){Ext.MessageBox.alert("提示","申请提交之后信息将无法修改，确认提交？",function(t){return"ok"==t?void this.submitAction(e):void 0},this)},DeleteAction:function(e){var t=e.up("grid"),i=t.getSelectionModel().getSelection()[0],o={applicationID:i.get("id")};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/Delete",params:o,method:"POST",scope:this,success:function(e){var t=Ext.JSON.decode(e.responseText);if("Result"in t)switch(t.Result){case"Success":return void Ext.MessageBox.alert("成功","删除成功！",function(){var e=this.application,t=e.getController("application.ApplicationPanel").getApplicationpanel(),i=e.getController("mainFrame.Main");i.addTab(t),t.getStore().reload();var o=t.getSelectionModel();o.deselect(o.getSelection()[0],!0),t.down("#appShow").setDisabled(!0),t.down("#appEdit").setDisabled(!0),t.down("#appSubmit").setDisabled(!0),t.down("#appDelete").setDisabled(!0),t.down("#appCancel").setDisabled(!0)},this);case"Failure":Ext.MessageBox.alert("失败","删除失败。",function(){},this)}}})},onClickappDeleteBtn:function(e){Ext.MessageBox.alert("提示","确认删除？",function(t){return"ok"==t?void this.DeleteAction(e):void 0},this)},CancelAction:function(e){var t=e.up("grid"),i=t.getSelectionModel().getSelection()[0],o={applicationID:i.get("id")};Ext.Ajax.request({url:Soims.service.applications.ApplicationsService+"/Cancel",params:o,method:"POST",scope:this,success:function(e){var t=Ext.JSON.decode(e.responseText);if("Result"in t)switch(t.Result){case"Success":return void Ext.MessageBox.alert("成功","撤回成功！",function(){var e=this.application,t=e.getController("application.ApplicationPanel").getApplicationpanel(),i=e.getController("mainFrame.Main");i.addTab(t),t.getStore().reload();var o=t.getSelectionModel();o.deselect(o.getSelection()[0],!0),t.down("#appShow").setDisabled(!0),t.down("#appEdit").setDisabled(!0),t.down("#appSubmit").setDisabled(!0),t.down("#appDelete").setDisabled(!0),t.down("#appCancel").setDisabled(!0)},this);case"Failure":Ext.MessageBox.alert("失败","撤回失败。",function(){},this)}}})},onClickappCancelBtn:function(e){Ext.MessageBox.alert("提示","确认撤回？",function(t){return"ok"==t?void this.CancelAction(e):void 0},this)},getCon:function(e){var t=this.application;return t.getController(e)},showTab:function(e,t,i,o,a,n){var p=this.getCon("mainFrame.Main"),c=p.existInstance(e);if(c)return c;var l=Ext.create(i,{id:e,title:t,application:this.application,applicationID:o,isShow:a,isEdit:n});return p.addTab(l),l},onClickAppShowBtn:function(e){{var t=e.up("grid"),i=t.getSelectionModel().getSelection()[0],o=i.get("type"),a=this.getViewFnByApp("application.show",o,"Tab",!0);this.showTab("Show"+o+i.get("id"),"查看"+i.get("name"),a,i.get("id"),!0,!1)}},onClickAppEditBtn:function(e){{var t=(this.getCon("application.common.SampleInfo"),this.getCon("application.common.BoardingUser"),this.getCon("application.common.SampleBackCountry"),this.getCon("application.common.ElectronicDocument"),this.getCon("application.common.V4Sample"),e.up("grid")),i=t.getSelectionModel().getSelection()[0],o=i.get("type"),a=this.getViewFnByApp("application.new",o,"Tab",!1);this.showTab("Edit"+o+i.get("id"),"编辑"+i.get("name"),a,i.get("id"),!1,!0)}},getViewFnByApp:function(e,t,i,o){var a=null,n=this.getCon(e+"."+t+i);switch(t){case Soims.model.application.common.SampleApplicationType.B1.value:a=o?n.getApplicationShowB1TabView():n.getApplicationNewB1TabView();break;case Soims.model.application.common.SampleApplicationType.B2.value:a=o?n.getApplicationShowB2TabView():n.getApplicationNewB2TabView();break;case Soims.model.application.common.SampleApplicationType.V1.value:a=o?n.getApplicationShowV1TabView():n.getApplicationNewV1TabView();break;case Soims.model.application.common.SampleApplicationType.V2.value:a=o?n.getApplicationShowV2TabView():n.getApplicationNewV2TabView();break;case Soims.model.application.common.SampleApplicationType.V3.value:a=o?n.getApplicationShowV3TabView():n.getApplicationNewV3TabView();break;case Soims.model.application.common.SampleApplicationType.V4.value:a=o?n.getApplicationShowV4TabView():n.getApplicationNewV4TabView()}return a}});