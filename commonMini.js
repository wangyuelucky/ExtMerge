Ext.override(Ext.form.Basic,{setValues:function(t){function e(t,e){var i=s.findField(t);if(i){if(a){var r=i.disabled;i.disabled=!0,i.setValue(e),i.disabled=r}else i.setValue(e);s.trackResetOnLoad&&i.resetOriginalValue()}}var i,r,n,s=this,a=s.owner.cancelVerify;if(Ext.suspendLayouts(),Ext.isArray(t))for(r=t.length,i=0;r>i;i++)n=t[i],e(n.id,n.value);else Ext.iterate(t,e);return Ext.resumeLayouts(!0),this},hasInvalidField:function(){return!!this.getFields().findBy(function(t){var e,i=t.preventMark;return t.preventMark=!0,e=Ext.grid.CellEditor&&t.ownerCt&&t.ownerCt instanceof Ext.grid.CellEditor?!0:t.isValid(),t.preventMark=i,!e})},isValid:function(){var t,e=this;return Ext.suspendLayouts(),t=e.getFields().filterBy(function(t){return Ext.grid.CellEditor&&t.ownerCt&&t.ownerCt instanceof Ext.grid.CellEditor?!1:!t.validate()}),Ext.resumeLayouts(!0),t.length<1},isDirty:function(){return!!this.getFields().findBy(function(t){return Ext.grid.CellEditor&&t.ownerCt&&t.ownerCt instanceof Ext.grid.CellEditor?!1:t.isDirty()})}});Ext.override(Ext.data.TreeStore,{fillNode:function(e,t){var r,o,i,l,n,d,s=this,a=t?t.length:0,f=s.sorters,h=!1,x=a&&s.sortOnLoad&&!s.remoteSort&&f&&f.items&&f.items.length;for(r=1;a>r&&(i=t[r],l=t[r-1],!(h=i[i.persistenceProperty].index!=l[l.persistenceProperty].index));r++);if(x?(h&&s.sorters.insert(0,s.indexSorter),o=new Ext.util.MixedCollection,o.addAll(t),o.sort(s.sorters.items),t=o.items,s.sorters.remove(s.indexSorter)):h&&Ext.Array.sort(t,s.sortByIndex),e.set("loaded",!0),n=0===s.fillCount,n&&s.fireEvent("beforefill",s,e,t),++s.fillCount,t.length&&(e.appendChild(t,void 0,!0),d=this.getRootNode(),d.raw.loadOnce))for(var p=0;p<t.length;p++){var v=t[p].data.children;v&&v.length&&t[p].appendChild(v,void 0,!0)}return n&&s.fireEvent("fillcomplete",s,e,t),--s.fillCount,t}});Ext.override(Ext.data.Model,{copy:function(e){var t=this,a=new t.self(t.raw,e,null,Ext.apply({},t[t.persistenceProperty]));return this.associations.each(function(e){if("hasMany"==e.type){var t=this[e.name]();t.each(function(t){var n=t.copy();Ext.data.Model.id(n),a[e.name]().add(n)})}else if("hasOne"==e.type){var n=this[e.getterName](),i=n.copy();a[e.setterName](i)}},t),a}});Ext.override(Ext.form.field.Base,{initComponent:function(){var e=this;e.callParent(),e.subTplData=e.subTplData||{},e.addEvents("specialkey","writeablechange"),e.initLabelable(),e.initField(),e.name||(e.name=e.getInputId()),e.readOnly&&e.addCls(e.readOnlyCls),e.forbidBlankAndShowStar&&(e.showStar=!0,e.allowBlank=!1),e.addCls(Ext.baseCSSPrefix+"form-type-"+e.inputType)},onRender:function(){var e=this;if(this.callParent(arguments),e.showStar){var t=document.createElement("span"),a=document.createTextNode("*");t.setAttribute("style","color:red; display: table-cell;vertical-align: middle;"),t.appendChild(a),"x-form-item-input-row"===e.el.dom.childNodes[0].childNodes[0].getAttribute("class")?e.el.dom.childNodes[0].childNodes[0].appendChild(t):e.el.dom.childNodes[0].appendChild(t)}this.renderActiveError()}});Ext.MD5=function(n,r,t,u){function e(n,r){var t=(65535&n)+(65535&r),u=(n>>16)+(r>>16)+(t>>16);return u<<16|65535&t}function o(n,r){return n<<r|n>>>32-r}function f(n,r,t,u,f,c){return e(o(e(e(r,n),e(u,c)),f),t)}function c(n,r,t,u,e,o,c){return f(r&t|~r&u,n,r,e,o,c)}function i(n,r,t,u,e,o,c){return f(r&u|t&~u,n,r,e,o,c)}function a(n,r,t,u,e,o,c){return f(r^t^u,n,r,e,o,c)}function h(n,r,t,u,e,o,c){return f(t^(r|~u),n,r,e,o,c)}function g(n,r){n[r>>5]|=128<<r%32,n[(r+64>>>9<<4)+14]=r;for(var t=1732584193,u=-271733879,o=-1732584194,f=271733878,g=0;g<n.length;g+=16){var l=t,v=u,A=o,C=f;t=c(t,u,o,f,n[g+0],7,-680876936),f=c(f,t,u,o,n[g+1],12,-389564586),o=c(o,f,t,u,n[g+2],17,606105819),u=c(u,o,f,t,n[g+3],22,-1044525330),t=c(t,u,o,f,n[g+4],7,-176418897),f=c(f,t,u,o,n[g+5],12,1200080426),o=c(o,f,t,u,n[g+6],17,-1473231341),u=c(u,o,f,t,n[g+7],22,-45705983),t=c(t,u,o,f,n[g+8],7,1770035416),f=c(f,t,u,o,n[g+9],12,-1958414417),o=c(o,f,t,u,n[g+10],17,-42063),u=c(u,o,f,t,n[g+11],22,-1990404162),t=c(t,u,o,f,n[g+12],7,1804603682),f=c(f,t,u,o,n[g+13],12,-40341101),o=c(o,f,t,u,n[g+14],17,-1502002290),u=c(u,o,f,t,n[g+15],22,1236535329),t=i(t,u,o,f,n[g+1],5,-165796510),f=i(f,t,u,o,n[g+6],9,-1069501632),o=i(o,f,t,u,n[g+11],14,643717713),u=i(u,o,f,t,n[g+0],20,-373897302),t=i(t,u,o,f,n[g+5],5,-701558691),f=i(f,t,u,o,n[g+10],9,38016083),o=i(o,f,t,u,n[g+15],14,-660478335),u=i(u,o,f,t,n[g+4],20,-405537848),t=i(t,u,o,f,n[g+9],5,568446438),f=i(f,t,u,o,n[g+14],9,-1019803690),o=i(o,f,t,u,n[g+3],14,-187363961),u=i(u,o,f,t,n[g+8],20,1163531501),t=i(t,u,o,f,n[g+13],5,-1444681467),f=i(f,t,u,o,n[g+2],9,-51403784),o=i(o,f,t,u,n[g+7],14,1735328473),u=i(u,o,f,t,n[g+12],20,-1926607734),t=a(t,u,o,f,n[g+5],4,-378558),f=a(f,t,u,o,n[g+8],11,-2022574463),o=a(o,f,t,u,n[g+11],16,1839030562),u=a(u,o,f,t,n[g+14],23,-35309556),t=a(t,u,o,f,n[g+1],4,-1530992060),f=a(f,t,u,o,n[g+4],11,1272893353),o=a(o,f,t,u,n[g+7],16,-155497632),u=a(u,o,f,t,n[g+10],23,-1094730640),t=a(t,u,o,f,n[g+13],4,681279174),f=a(f,t,u,o,n[g+0],11,-358537222),o=a(o,f,t,u,n[g+3],16,-722521979),u=a(u,o,f,t,n[g+6],23,76029189),t=a(t,u,o,f,n[g+9],4,-640364487),f=a(f,t,u,o,n[g+12],11,-421815835),o=a(o,f,t,u,n[g+15],16,530742520),u=a(u,o,f,t,n[g+2],23,-995338651),t=h(t,u,o,f,n[g+0],6,-198630844),f=h(f,t,u,o,n[g+7],10,1126891415),o=h(o,f,t,u,n[g+14],15,-1416354905),u=h(u,o,f,t,n[g+5],21,-57434055),t=h(t,u,o,f,n[g+12],6,1700485571),f=h(f,t,u,o,n[g+3],10,-1894986606),o=h(o,f,t,u,n[g+10],15,-1051523),u=h(u,o,f,t,n[g+1],21,-2054922799),t=h(t,u,o,f,n[g+8],6,1873313359),f=h(f,t,u,o,n[g+15],10,-30611744),o=h(o,f,t,u,n[g+6],15,-1560198380),u=h(u,o,f,t,n[g+13],21,1309151649),t=h(t,u,o,f,n[g+4],6,-145523070),f=h(f,t,u,o,n[g+11],10,-1120210379),o=h(o,f,t,u,n[g+2],15,718787259),u=h(u,o,f,t,n[g+9],21,-343485551),t=e(t,l),u=e(u,v),o=e(o,A),f=e(f,C)}return[t,u,o,f]}function l(n){for(var r=[],t=(1<<u)-1,e=0;e<n.length*u;e+=u)r[e>>5]|=(n.charCodeAt(e/u)&t)<<e%32;return r}function v(n){for(var r="",t=(1<<u)-1,e=0;e<32*n.length;e+=u)r+=String.fromCharCode(n[e>>5]>>>e%32&t);return r}function A(n){for(var r=t?"0123456789ABCDEF":"0123456789abcdef",u="",e=0;e<4*n.length;e++)u+=r.charAt(n[e>>2]>>e%4*8+4&15)+r.charAt(n[e>>2]>>e%4*8&15);return u}return r=r||!1,t=t||!1,u=u||8,r?v(g(l(n),n.length*u)):A(g(l(n),n.length*u))};function setIconFieldValue(t,e){cmp=Ext.getCmp(t),cmp.triggerEl.elements[0].removeCls(cmp.getValue()),cmp.setValue(e),cmp.triggerEl.elements[0].addCls(e),Ext.getCmp("Wms_Icon_Win").close()}appUrl="/Application",extLibUrl="/Application",Ext.Loader.setConfig({enabled:!1}),Ext.Loader.setPath("Ext.ux",extLibUrl+"/common/ext/src/ux"),Ext.Loader.setPath("WMC.common",extLibUrl+"/common/src"),Ext.Tools=function(){function MessageBox(t,e,o,n,s,r){var a;"E"==o?a=Ext.MessageBox.ERROR:"I"==o?a=Ext.MessageBox.INFO:"Q"==o?a=Ext.MessageBox.QUESTION:"W"==o&&(a=Ext.MessageBox.WARNING),Ext.MessageBox.show({title:t,msg:e,buttons:r||Ext.MessageBox.OK,fn:n,scope:s,icon:a})}var msgCt;return{Alert:function(t,e,o,n,s,r){MessageBox(t,e,o.toUpperCase(),n,s,r)},Msg:function(t,e){if(void 0!=t){msgCt||(msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},!0)),content="",delayTime=1e3,0==e?content='<div class="msgOk"><h3>完成</h3><p>'+t+"</p></div>":1==e?(delayTime=5e3,content='<div class="msgError"><h3>失败</h3><p>'+t+"</p></div>"):9==e&&(delayTime=5e3,content='<div class="msgException"><h3>警告</h3><p>'+t+"</p></div>");var o=Ext.DomHelper.append(msgCt,content,!0);o.hide(),o.slideIn("t").ghost("t",{delay:delayTime,remove:!0})}},Confirm:function(t,e,o,n){Ext.MessageBox.confirm(t,e,o,n)},FormatDate:function(value){if(null==value)return"";var argv=arguments,argc=argv.length,format=argc>1?argv[1]:"Y-m-d H:i:s";if(value instanceof Date)return Ext.util.Format.date(value,format);if(value.indexOf("Date")<=0)return Ext.util.Format.date(dt,format);var dt=eval("new "+value.substr(1,value.length-2)).toString();return Ext.util.Format.date(dt,format)},CtrlButtonsByPermession:function(t,e,o){Ext.Ajax.request({url:"/Admin/Main/GetModuleButtons",method:"GET",params:{module:t},success:function(t){btns=Ext.JSON.decode(t.responseText),Ext.each(btns,function(t){btn=e.query("button[action="+t.ModuleKey+"]")[0],1==o?btn.hide():btn.setDisabled(!0)})},failure:function(t){Ext.Tools.Msg("请求超时或网络故障,错误编号："+t.status,9)}})},init:function(){msgCt||(msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},!0))}}}(),Ext.onReady(Ext.Tools.init,Ext.Tools),Ext.apply(Ext.form.VTypes,{number:function(t){return/^\d+$/.test(t)},numberText:"只能输入数字",amount:function(t){return/^(([1-9]\d*)|\d)(\.\d{1,2})?$/.test(t)},amountText:"金额格式错误",passwordConfirm:function(t,e){return e.confirmTo instanceof Ext.form.Field||(e.confirmTo=Ext.getCmp(e.confirmTo)),t==e.confirmTo.getValue()},passwordConfirmText:"两次新密码输入不一致"});var Cookies=Ext.create("Ext.state.CookieProvider",{path:"/",expires:new Date((new Date).getTime()+31536e6)});Cookies.getLoginId=function(){return this.get("LoginId")},Cookies.setLoginId=function(e){this.set("LoginId",e)},Cookies.getPassword=function(){return this.get("Password")},Cookies.setPassword=function(e){this.set("Password",e)},Cookies.getIsRememberLogin=function(){return this.get("IsRememberLogin")},Cookies.setIsRememberLogin=function(e){this.set("IsRememberLogin",e)},Cookies.getToken=function(){return this.get("Token")},Cookies.setToken=function(e){this.set("Token",e)},Ext.state.Manager.setProvider(Cookies);Boolean.TrueStringValue="TRUE",Boolean.FalseStringValue="FALSE",Boolean.toBoolean=function(e){return void 0==e||null==e?!1:(e=e.toUpperCase(),e==Boolean.TrueStringValue?!0:!1)},Boolean.toNullEnableBoolean=function(e){return void 0==e||null==e||""==e?null:(e=e.toUpperCase(),e==Boolean.TrueStringValue?!0:!1)},Boolean.render=function(e){return e?"是":"否"},Boolean.nullAbleRender=function(e){return 1==e?"是":0==e?"否":"未知"},Boolean.showAsCheckbox=function(){return"<input type=checkbox />"},Boolean.TureOrFalseToYesOrNo=function(e){return e=e.toUpperCase(),e==Boolean.TrueStringValue?"是":"否"};Ext.define("Ext.ux.form.CheckCode",{extend:"Ext.form.field.Text",alias:"widget.checkcode",codeUrl:Ext.BLANK_IMAGE_URL,isLoader:!0,onRender:function(e){this.callParent(arguments),this.codeEl=e.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL}),this.codeEl.addCls("x-form-code"),this.codeEl.on("click",this.loadCodeImg,this),this.isLoader&&this.loadCodeImg()},aliasErrorIcon:function(){this.errorIcon.alignTo(this.codeEl,"tl-tr",[2,0])},loadCodeImg:function(){this.codeEl.set({src:this.codeUrl+"?id="+Math.random()})}});Ext.define("Ext.ux.tabPanel.TabCloseMenu",{alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:!0,closeOthersTabsText:"Close Other Tabs",showCloseAll:!0,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.addEvents("aftermenu","beforemenu"),this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e,this.tabBar=e.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},onBeforeDestroy:function(){Ext.destroy(this.menu),this.callParent(arguments)},onContextMenu:function(e,t){var s=this,o=s.createMenu(),l=!0,n=!0,a=s.tabBar.getChildByElement(t),i=s.tabBar.items.indexOf(a);s.item=s.tabPanel.getComponent(i),o.child('*[text="'+s.closeTabText+'"]').setDisabled(!s.item.closable),(s.showCloseAll||s.showCloseOthers)&&(s.tabPanel.items.each(function(e){return e.closable&&(l=!1,e!=s.item)?(n=!1,!1):!0}),s.showCloseAll&&o.child('*[text="'+s.closeAllTabsText+'"]').setDisabled(l),s.showCloseOthers&&o.child('*[text="'+s.closeOthersTabsText+'"]').setDisabled(n)),e.preventDefault(),s.fireEvent("beforemenu",o,s.item,s),o.showAt(e.getXY())},createMenu:function(){var e=this;if(!e.menu){var t=[{text:e.closeTabText,scope:e,handler:e.onClose}];(e.showCloseAll||e.showCloseOthers)&&t.push("-"),e.showCloseOthers&&t.push({text:e.closeOthersTabsText,scope:e,handler:e.onCloseOthers}),e.showCloseAll&&t.push({text:e.closeAllTabsText,scope:e,handler:e.onCloseAll}),e.extraItemsHead&&(t=e.extraItemsHead.concat(t)),e.extraItemsTail&&(t=t.concat(e.extraItemsTail)),e.menu=Ext.create("Ext.menu.Menu",{items:t,listeners:{hide:e.onHideMenu,scope:e}})}return e.menu},onHideMenu:function(){var e=this;e.fireEvent("aftermenu",e.menu,e)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(e){var t=[];this.tabPanel.items.each(function(s){s.closable&&(e&&s==this.item||t.push(s))},this),Ext.each(t,function(e){this.tabPanel.remove(e)},this)}});Ext.define("Ext.ux.grid.menu.StoreMenu",{extend:"Ext.menu.Menu",alias:"widget.storemenu",config:{loadingText:"Loading...",offset:0,autoReload:!0,nameField:"text",idField:"id",iconField:"iconCls",codeField:"code",itemsHandler:Ext.emptyFn,configField:"config",menuField:"menu"},store:null,storeMenus:[],loaded:!1,loadMask:null,onMenuLoad:function(){(!this.loaded||this.autoReload)&&this.store.load()},updateMenuItems:function(t,e){for(var s=0;s<this.storeMenus.length;s++)this.remove(this.storeMenus[s]);if(this.storeMenus=[],t){var i=0;this.offset&&(this.storeMenus.push(this.insert(this.offset,{xtype:"menuseparator"})),i=1),Ext.each(e,function(t){var e={};t.data[this.configField]?Ext.apply(e,t.data[this.configField]):e={id:t.data[this.idField],text:t.data[this.nameField],code:t.data[this.codeField],iconCls:t.data[this.iconField],handler:this.itemsHandler},t.data[this.menuField]&&(e.menu={items:[]},Ext.each(t.data[this.menuField],function(s){s.smHandler&&this.smHandlers[s.smHandler]&&e.menu.items.push({id:s[this.idField],text:s[this.nameField],code:t.data[this.codeField],iconCls:s[this.iconField],handler:this.smHandlers[s.smHandler]})},this)),this.storeMenus.push(this.insert(this.offset+i,e)),i++},this)}else this.storeMenus.push(this.insert(this.offset,'<span class="loading-indicator">'+this.loadingText+"</span>"));this.loaded=t},onBeforeLoad:function(){this.updateMenuItems(!1)},onLoad:function(t,e){this.updateMenuItems(!0,e)},setSubMenuHandler:function(t,e){this.smHandlers[t]=e},setParams:function(t){Ext.apply(this.store.getProxy().extraParams,t)},setStore:function(t){this.store=t},smHandlers:{},constructor:function(t){return t.listeners=t.listeners||{},t.listeners.beforeshow=this.onMenuLoad,this.initConfig(t),this.callParent(arguments),this.store||(this.store=Ext.create("Ext.data.Store",{model:this.model,proxy:{type:"ajax",url:this.url,actionMethods:{read:this.method||"POST"},reader:{type:"json",root:this.root||"root"},extraParams:this.params}})),this.store.on("beforeload",this.onBeforeLoad,this),this.store.on("load",this.onLoad,this),this}});Ext.ns("Soims"),Ext.ns("Soims.service"),Ext.ns("Soims.application"),Ext.ns("Soims.service.resources"),Soims.service.ResourceService="/Service/Resource.asmx",Ext.ns("Soims.service.users"),Soims.service.users.UserService="/Service/Users/User.asmx",Soims.service.users.MenuService="/Service/Users/Menu.asmx",Soims.service.users.RoleService="/Service/Users/Role.asmx",Soims.service.users.MessageService="/Service/Users/Message.asmx",Soims.service.users.PersonService="/Service/Users/Person.asmx",Soims.service.users.NotificationService="/Service/Users/Notification.asmx",Ext.ns("Soims.service.samples"),Soims.service.samples.SampleService="/Service/Samples/Sample.asmx",Soims.service.samples.TestDataService="/Service/Samples/TestData.asmx",Soims.service.samples.SampleTypeService="/Service/Samples/SampleType.asmx",Soims.service.samples.UsePurposeService="/Service/Samples/UsePurpose.asmx",Soims.service.samples.InvolvedSubjectService="/Service/Samples/InvolvedSubject.asmx",Soims.service.samples.SamplingAreaService="/Service/Samples/SamplingArea.asmx",Soims.service.samples.SamplePreparationService="/Service/Samples/SamplePreparation.asmx",Soims.service.samples.AnlyseTestProjectService="/Service/Samples/AnlyseTestProject.asmx",Soims.service.samples.SampleAllocationService="/Service/Samples/SampleAllocation.asmx",Soims.service.samples.SampleSamplingMethodService="/Service/Samples/SamplingMethod.asmx",Ext.ns("Soims.service.departments"),Soims.service.departments.DepartmentService="/Service/Departments/Department.asmx",Ext.ns("Soims.service.applications"),Soims.service.applications.ActivityService="/Service/Applications/Activity.asmx",Soims.service.applications.VoyageReport="/Service/Applications/VoyageReport.asmx",Soims.service.applications.VoyageReportDivision="/Service/Applications/VoyageReportDivision.asmx",Soims.service.applications.ApplicationsService="/Service/Applications/Application.asmx",Soims.service.applications.VoyageTaskService="/Service/Applications/VoyageTask.asmx",Soims.service.applications.SubjectService="/Service/Applications/Subject.asmx",Soims.service.applications.VoyageService="/Service/Applications/Voyage.asmx",Soims.service.applications.NoOceanTopicService="/Service/Applications/NoOceanTopic.asmx",Soims.service.applications.BoardingUserService="/Service/Applications/BoardingUser.asmx",Soims.service.applications.SampleBackCountry="/Service/Applications/SampleBackCountry.asmx",Soims.service.applications.ElectronicDocument="/Service/Applications/ElectronicDocument.asmx",Ext.ns("Soims.service.ApplicationAuditings"),Soims.service.ApplicationAuditings.AuditService="/Service/ApplicationAuditings/Audit.asmx",Soims.service.ApplicationAuditings.SampleAuditService="/Service/ApplicationAuditings/SampleAudit.asmx",Soims.service.ApplicationAuditings.SampleRepatriationAuditService="/Service/ApplicationAuditings/SampleRepatriationAudit.asmx",Ext.ns("Soims.service.ApplicationAccepts"),Soims.service.ApplicationAccepts.AcceptService="/Service/ApplicationAccepts/Accept.asmx",Ext.ns("Soims.service.projects"),Soims.service.projects.TopicService="/Service/Topics/Topic.asmx",Soims.service.projects.ProjectService="/Service/Projects/Project.asmx",Ext.ns("Soims.service.voyages"),Soims.service.voyages.LegService="/Service/Legs/Leg.asmx",Soims.service.voyages.VoyageService="/Service/Voyages/Voyage.asmx",Soims.service.voyages.VoyageTaskService="/Service/Voyages/VoyageTask.asmx",Soims.service.voyages.VoyageReportService="/Service/Voyages/VoyageReport.asmx",Soims.service.voyages.VoyageReportDetailService="/Service/Voyages/VoyageReportDetail.asmx",Ext.ns("Soims.service.discussion"),Soims.service.discussion.DistributionDiscussionService="/Service/Discussions/DistributionDiscussion.asmx",Soims.service.discussion.DistributionOperateService="/Service/Discussions/DistributionOperate.asmx",Soims.service.discussion.SampleDiscussionService="/Service/Discussions/SampleDiscussion.asmx",Soims.service.discussion.SampleRepatriationDiscussionService="/Service/Discussions/SampleRepatriationDiscussion.asmx";Ext.define("Soims.model.notification.Notification",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"}]});Ext.define("Soims.store.notification.Notification",{extend:"Ext.data.Store",model:"Soims.model.notification.Notification",pageSize:30,proxy:{type:"ajax",url:Soims.service.users.NotificationService+"/GetAvailable",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total",id:"ID"}},autoLoad:!0});Ext.define("Soims.view.notification.Notification",{extend:"Ext.grid.GridPanel",alias:"widget.notification",title:"公告",width:350,height:420,renderTo:"ExtNotification",selType:"rowmodel",store:"notification.Notification",initComponent:function(){this.columns=[{header:"标题",dataIndex:"title",width:40,flex:1},{header:"发送时间",dataIndex:"dateTime",flex:1}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.view.notification.ShowNotificationBasic",{extend:"Ext.form.Panel",alias:"widget.shownotificationbasic",autoShow:!0,initComponent:function(){this.items=[{xtype:"htmleditor",width:590,height:50,name:"title",itemId:"title",readOnly:!0,hidden:!1},{xtype:"htmleditor",height:525,width:590,name:"content",itemId:"content",readOnly:!0,hidden:!1}],this.callParent()}});Ext.define("Soims.view.notification.ShowNotification",{extend:"Ext.window.Window",alias:"widget.shownotification",closable:!0,iconCls:"  ",requires:["Soims.view.notification.ShowNotificationBasic"],width:600,height:500,autoShow:!0,initComponent:function(){this.items=[{xtype:"shownotificationbasic",isShow:this.isShow}],this.buttons=[{text:"确定",xtype:"button",itemId:"Ok",action:"Ok"}],this.callParent()}});Ext.define("Soims.controller.notification.Notification",{extend:"Ext.app.Controller",stores:["notification.Notification"],views:["notification.Notification"],refs:[{ref:"notification",selector:"notification",autoCreate:!0,xtype:"notification"}],init:function(){this.control({notification:{itemdblclick:function(i,o){var t=this.getCon("notification.ShowNotification");t.getShownotification().down("#title").getToolbar().hide(),t.getShownotification().down("#content").getToolbar().hide();var n=this.application;n.getController("notification.ShowNotification").showWindow();n.getController("notification.ShowNotification").showWindow();t.getShownotification().down("panel").loadRecord(o)}}})},getCon:function(i){var o=this.application;return o.getController(i)},showNotification:function(){this.getNotification()}});Ext.define("Soims.controller.notification.ShowNotification",{extend:"Ext.app.Controller",stores:["notification.Notification"],views:["notification.ShowNotification"],refs:[{ref:"shownotification",selector:"shownotification",autoCreate:!0,xtype:"shownotification"}],init:function(){this.control({"shownotification  button[itemId=Ok]":{click:function(o){o.up("window").close()}}})},getCon:function(o){var i=this.application;return i.getController(o)},showWindow:function(){var o=this.getShownotification();return o}});Ext.define("Soims.view.login.LoginForm",{extend:"Ext.form.Panel",alias:"widget.loginform",renderTo:"ExtLoginForm",title:"用户登陆",frame:!0,bodyStyle:"padding:5px",width:275,iconCls:"User",_isTextFieldLoginIdValid:!1,_isTextFieldPassword:!1,_checkCodeValid:!1,initComponent:function(){var e=Ext.create("Ext.ux.form.CheckCode",{fieldLabel:"验证码",name:"loginCheckcode",id:"loginCheckcode",allowBlank:!1,isLoader:!0,enableKeyEvents:!0,blankText:"验证码不能为空",codeUrl:Soims.service.users.UserService+"/GetVerifyCode",width:130,labelWidth:60});this.items=Ext.widget("form",{items:[{xtype:"fieldset",title:"",collapsible:!1,border:!1,defaultType:"textfield",defaults:{margins:"10 0 0 0"},items:[{name:"username",fieldLabel:"用户名",labelWidth:60,style:"margin-top:10px;",allowBlank:!1,blankText:"请输入您的用户名",msgTarget:"side",emptyText:"登陆名",selectOnFocus:!0,enableKeyEvents:!0},{name:"password",fieldLabel:"密　码",labelWidth:60,allowBlank:!1,blankText:"请输入您的密码",inputType:"password",msgTarget:"side",enableKeyEvents:!0},e]},{xtype:"fieldset",title:"",collapsible:!1,border:!1,layout:"column",items:[{columnWidth:.47,xtype:"checkbox",name:"autoLogin",style:"margin-left:10px;",boxLabel:"下次自动登陆"},{columnWidth:.47,cls:"x-field x-form-item",border:!1,xtype:"component",style:"margin-top:3px;margin-left:40px;",name:"forgetPass",html:"<div><a href='#' title='找回密码'>忘记密码？</a></div>"}]}],buttons:[{itemId:"loginBtn",text:"登录",iconCls:"CssGo",disabled:!0,action:"onLogin"},{itemId:"registBtn",text:"注册",iconCls:"Key",action:"onRegist"}]}),this.callParent(arguments)},showLicence:function(){Ext.Msg.defaultTextHeight=0,Ext.Msg.buttonText.yes="同意",Ext.Msg.buttonText.no="不同意",Ext.Msg.show({title:"用户协议",msg:Ipms.FormLogin.LICENCE,buttons:Ext.Msg.YESNO,width:600,closable:!1,scope:this,fn:this.onShowLicence})},onShowLicence:function(e){var t=this.items[0].dockedItems[0],i=this.items.items[0],s=this.items.items[1];t.setText(" 登 陆 "),t.enable(),Ext.Msg.buttonText.yes="是",Ext.Msg.buttonText.no="否","yes"==e&&Ext.Ajax.request({url:Soims.service.users.UserService+"/AgreeLicence",method:"POST",scope:this,params:{loginId:i.getValue(),password:s.getValue()}})},onLoginFail:function(e){var t=this.down("#loginBtn");t.setText(" 登 陆 "),t.enable(),Ext.Tools.Alert("登陆失败","<br />"+e.stateDescription,"w",this.clearAll,this)},clearAll:function(){var e=this.down("textfield[name=username]"),t=this.down("textfield[name=password]"),i=this.down("checkcode#loginCheckcode").setValue("");e.setValue(""),t.setValue(""),i.setValue(""),e.focus(),i.loadCodeImg(),this._isTextFieldLoginIdValid=!1,this._isTextFieldPassword=!1,this._checkCodeValid=!1}});Ext.define("Soims.model.department.Department",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"name",type:"string",mapping:"Name"},{name:"address",type:"string",mapping:"Address"},{name:"type",type:"string",mapping:"Type"},{name:"test",type:"string",mapping:"Test"}]});Ext.define("Soims.view.login.RegistForm",{extend:"Ext.form.Panel",alias:"widget.registform",requires:["Soims.store.department.Department"],border:!1,bodyStyle:"background-color: #dfe8f5;",width:600,layout:"column",initComponent:function(){var e=Ext.create("Soims.store.department.Department");this.items=[{xtype:"panel",border:!1,margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",layout:"form",columnWidth:.5,items:[{xtype:"combobox",name:"department",itemId:"department",forceSelection:!0,editable:!1,store:e,displayField:"name",valueField:"id",forbidBlankAndShowStar:!0,emptyText:"请选择您的单位",fieldLabel:"单  位"},{xtype:"textfield",name:"loginId",forbidBlankAndShowStar:!0,itemId:"loginId",fieldLabel:"用户名",validateOnChange:!1,validator:this.isLoginIdExist},{xtype:"textfield",name:"email",forbidBlankAndShowStar:!0,vtype:"email",itemId:"email",fieldLabel:"邮  箱",validateOnChange:!1,validator:this.isEmailExist},{xtype:"textfield",name:"telphone",itemId:"telphone",fieldLabel:"联系电话"},{xtype:"textfield",name:"adress",itemId:"adress",fieldLabel:"住  址"},{xtype:"textfield",name:"fax",itemId:"fax",fieldLabel:"传  真"}]},{xtype:"panel",border:!1,layout:"form",margin:"5 5 5 5",bodyStyle:"background-color: #dfe8f5;",columnWidth:.5,items:[{xtype:"textfield",name:"name",forbidBlankAndShowStar:!0,itemId:"name",fieldLabel:"姓 名"},{xtype:"textfield",name:"password",forbidBlankAndShowStar:!0,itemId:"password",inputType:"password",fieldLabel:"密  码"},{xtype:"textfield",name:"confimpassword",forbidBlankAndShowStar:!0,itemId:"confimpassword",inputType:"password",fieldLabel:"确认密码",validateOnChange:!1,validator:this.checkPassWord},{xtype:"textfield",name:"cellphone",itemId:"cellphone",fieldLabel:"移动电话"},{xtype:"textfield",name:"zipcode",itemId:"zipcode",fieldLabel:"邮政编码"}]}],this.callParent()},isLoginIdExist:function(e){var t=!0;return Ext.Ajax.request({async:!1,url:Soims.service.users.PersonService+"/LoginIsExist",method:"POST",scope:this,params:{value:e},success:function(e){t=e.responseText?!0:"该用户名已经被注册了"}}),t},isEmailExist:function(e){var t=!0;return Ext.Ajax.request({async:!1,url:Soims.service.users.PersonService+"/EmailIsExist",method:"POST",scope:this,params:{value:e},success:function(e){t=e.responseText?!0:"该邮箱已经被注册了"}}),t},checkPassWord:function(e){var t=!0,i=this.up("form").down("#password");return e!==i.getValue()&&(t="确认密码与密码不一致"),t}});Ext.define("Soims.store.department.Department",{extend:"Ext.data.Store",model:"Soims.model.department.Department",autoLoad:!0,proxy:{type:"ajax",url:Soims.service.departments.DepartmentService+"/Query",reader:{type:"xml",root:"List",record:"Record",totalProperty:"Total",id:"ID"}}});Ext.define("Soims.view.login.RegistWin",{extend:"Ext.window.Window",alias:"widget.registwin",closable:!0,iconCls:"User",resizable:!1,modal:!0,title:"用户注册",width:625,requires:["Soims.view.login.RegistForm"],items:[{xtype:"registform"}],autoShow:!0,initComponent:function(){this.buttons=[{text:"提交",xtype:"button",iconCls:"ArrowUp",itemId:"submit"},{text:"取消",xtype:"button",iconCls:"Cancel",itemId:"cancel"}],this.callParent()}});Ext.define("Soims.controller.login.Regist",{extend:"Ext.app.Controller",views:["login.RegistWin"],refs:[{ref:"registwin",selector:"registwin",autoCreate:!0,xtype:"registwin"}],init:function(){this.control({"registwin button[itemId=cancel]":{click:function(e){e.up("window").close()}},"registwin button[itemId=submit]":{click:function(e){e.setDisabled(!0),e.up("window").down("panel").isValid()&&Ext.MessageBox.confirm("提示","请确保您的邮箱为您的可用邮箱！此邮箱将用作您账号的激活",function(t){"yes"==t?this.save(e):e.setDisabled(!1)},this)}}})},show:function(){var e=this.getRegistwin();e.show()},onCancelBtnClick:function(){},save:function(e){var t=e.up("window").down("panel"),i=t.getValues(),n=Ext.MD5(i.password);Ext.apply(i,{password:n}),Ext.Ajax.request({url:Soims.service.users.PersonService+"/Save",method:"POST",scope:this,params:i,success:function(t){t.responseText?Ext.MessageBox.alert("警告","您的邮箱已被注册，如有问题，请联系大洋馆！",function(){},this):(Ext.MessageBox.alert("提示","您的注册信息已经提交，一封激活邮件将在十分钟内发至您的邮箱，请点击激活账号",function(){},this),e.up("window").close())}})},getController:function(e){var t=this.application;return t.getController(e)}});Ext.define("Soims.view.mainFrame.Center",{extend:"Ext.tab.Panel",alias:"widget.center",region:"center",activeItem:0,plugins:Ext.create("Ext.ux.tabPanel.TabCloseMenu",{pluginId:"TabCloseMenu",closeTabText:"关闭当前页",closeOthersTabsText:"关闭其他页",closeAllTabsText:"关闭所有页"}),items:[{title:"首页",frame:!0,style:"padding:2px;",iconCls:"House",items:{xtype:"messagelist"}}],initComponent:function(){this.callParent()}});Ext.define("Soims.model.mainFrame.RoleMenu",{extend:"Ext.data.Model",fields:["id","text","code","iconCls","checked","config"]});Ext.define("Soims.store.mainFrame.RoleMenu",{extend:"Ext.data.Store",model:"Soims.model.mainFrame.RoleMenu",proxy:{type:"ajax",url:Soims.service.users.RoleService+"/GetRole",reader:{type:"json",root:"root"}},autoLoad:!0});Ext.define("Soims.view.mainFrame.RoleMenu",{extend:"Ext.ux.grid.menu.StoreMenu",alias:"widget.rolemenu",plain:!0,minWidth:30,width:180,requires:["Soims.store.mainFrame.RoleMenu"],initComponent:function(){var e=this,i=Ext.create("Soims.store.mainFrame.RoleMenu");e.store=i,e.callParent()}});Ext.define("Soims.view.mainFrame.North",{extend:"Ext.panel.Panel",alias:"widget.north",region:"north",border:0,requires:["Soims.view.mainFrame.RoleMenu"],tpl:'<div style = "height:93px; padding:50px 60px 0px; background-color:#DFE8F6; background-image:url(Application/common/resources/images/topFinally.jpg); background-repeat:no-repeat;">',fbar:[{tpl:'<div style="font-weight: bold">您好： {userName}！  当前角色是： {roleName} &nbsp;</div></div>',xtype:"label"},{xtype:"tbfill"},{text:"短消息",iconCls:"Email",tooltip:"短消息列表",action:"messageList"},"-",{text:"切换角色",iconCls:"User",tooltip:"切换角色",menu:{xtype:"rolemenu"}},"-",{text:"修改密码",iconCls:"UserKey",tooltip:"修改密码",action:"changePassword"},"-",{text:"个人信息",iconCls:"User",tooltip:"完善个人信息",action:"improveInformation"},"-",{text:"安全退出",iconCls:"ControlPowerBlue",tooltip:"退出系统",action:"logout"}],initComponent:function(){this.callParent()}});Ext.define("Soims.view.mainFrame.West",{extend:"Ext.panel.Panel",alias:"widget.west",region:"west",id:"DivPanelMenu",collapsible:!0,width:200,autoScroll:!0,split:!0,frame:!0,titleCollapse:!0,initComponent:function(){this.callParent()},addItems:function(t){for(var e=this.getMenuItems(t),i=0,l=e.length;l>i;i++)this.add(e[i])},getMenuItems:function(t){for(var e=[],i=(Soims.currentLoginLog.user,0);i<t.length;i++){for(var l='<ul class="">',n=0;n<t[i].Child.length;n++){var a=t[i].Child;l+=Ext.String.format('<li id="MenuBarItem-li-{0}">',a[n].Action),l+=Ext.String.format('<img src="../Application/common/resources/images/s.gif" class="{0}"/>',a[n].IconCls),l+=Ext.String.format('<a id="MenuBarItem-a-{0}" class="" href="#"><span id="{1}">{2}</span></a>',a[n].Action,a[n].PoolSpan,a[n].Title),l+=Ext.String.format("</li>")}l+="</ul>",e[e.length]=new Ext.Panel({frame:!0,title:t[i].Title,collapsible:!0,iconCls:t[i].IconCls,html:l,titleCollapse:!0})}return e}});Ext.define("Soims.view.message.MessageList",{extend:"Ext.grid.Panel",alias:"widget.messagelist",title:"未读短消息",closable:!0,store:"message.MessageList",selType:"rowmodel",initComponent:function(){this.columns=[{header:"标题",dataIndex:"title",flex:1},{header:"发信人",dataIndex:"sender",flex:1},{header:"收信人",dataIndex:"receiver",flex:1},{header:"发送时间",dataIndex:"dateTime",flex:1},{header:"是否已读",dataIndex:"isRead",flex:1}],this.tbar=[{text:"发送短消息",xtype:"button",action:"sendMessage",name:"sendMessage",iconCls:"NotificationSend",itemId:"sendMessage"},{text:"全部标记为已读",name:"markAllAsRead",action:"markAllAsRead",itemId:"markAllAsRead",iconCls:"NotificationAsRead",xtype:"button"},{text:"查看",xtype:"button",action:"check",name:"check",itemId:"check",iconCls:"NotificationEdit",disabled:!0},{text:"删除",name:"delete",action:"delete",itemId:"delete",xtype:"button",iconCls:"NotificationDelete",disabled:!0},{xtype:"tbfill"},{text:"刷新",itemId:"refreshTbar",xtype:"button"}],this.bbar=[{xtype:"pagingtoolbar",store:this.store,displayInfo:!0,border:!1,displayMsg:"显示第 {0} 条到 {1} 条记录 / 共 {2} 条",emptyMsg:"没有记录"}],this.callParent()}});Ext.define("Soims.view.mainFrame.Viewport",{extend:"Ext.container.Viewport",requires:["Soims.view.mainFrame.Center","Soims.view.mainFrame.North","Soims.view.mainFrame.West","Soims.view.message.MessageList"],alias:"widget.configviewport",layout:"border",items:[{xtype:"north"},{xtype:"west"},{xtype:"center"}],initComponent:function(){this.callParent()}});Ext.define("Soims.model.message.MessageList",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",mapping:"ID"},{name:"title",type:"string",mapping:"Title"},{name:"receiver",type:"string",mapping:"Receiver"},{name:"receiverID",type:"int",mapping:"ReceiverID"},{name:"sender",type:"string",mapping:"Sender"},{name:"senderID",type:"int",mapping:"SenderID"},{name:"content",type:"string",mapping:"Content"},{name:"dateTime",type:"string",mapping:"DateTime"},{name:"isRead",type:"string",mapping:"IsRead",convert:function(e){return"False"==e?"否":"是"}}]});Ext.define("Soims.store.message.MessageList",{extend:"Ext.data.Store",model:"Soims.model.message.MessageList",autoLoad:!0,pageSize:25,proxy:{type:"ajax",url:Soims.service.users.MessageService+"/GetUnReadMessages",reader:{type:"xml",root:"QueryResult",record:"Record",totalRecords:"Total",totalProperty:"Total"}}});Ext.application({name:"Soims",appFolder:appUrl,controllers:["login.Login","notification.Notification"],launch:function(){this.getController("notification.Notification").showNotification(),this.getController("login.Login").tryLoginByToken()}});Ext.define("Soims.controller.login.Login",{extend:"Ext.app.Controller",views:["login.LoginForm"],refs:[{ref:"loginForm",selector:"loginform",autoCreate:!0,xtype:"loginform"}],init:function(){this.control({"loginform button[action=onLogin]":{click:this.onLoginBtnClick},"loginform button[action=onRegist]":{click:this.onRegistBtnClick},"loginform component[name=forgetPass]":{afterrender:function(e){var o=this,t=e.getEl().select("a");t.on("click",o.onForgetPassBtnClick,e)}},"loginform textfield[name=username]":{change:this.onTextFieldLoginIdValid,keypress:this.onTextField_KeyPress},"loginform textfield[name=password]":{change:this.onTextFieldPasswordValid,keypress:this.onTextField_KeyPress},"loginform checkcode#loginCheckcode":{change:this.onTextFieldCheckCodeValid,keypress:this.onTextField_KeyPress}})},getController:function(e){var o=this.application;return o.getController(e)},tryLoginByToken:function(){var e=Cookies.getToken();e?Ext.Ajax.request({url:Soims.service.users.UserService+"/Active",success:this.onTryLoginByToken,method:"GET",scope:this,extraParams:void 0,params:{token:e}}):this.tryLoginByLoginIdAndPassword()},onTryLoginByToken:function(e){var o=this.parseLoginResult(e);o.isSucceed?(this.setCurrentLoginLog(o),this.onLoadMain()):this.tryLoginByLoginIdAndPassword()},tryLoginByLoginIdAndPassword:function(){var e=Cookies.getIsRememberLogin(),o=Cookies.getLoginId(),t=Cookies.getPassword();e&&o&&t?this.loginByDefault(o,t,this.onTryLoginByLoginIdAndPassword):this.loadLoginForm()},onTryLoginByLoginIdAndPassword:function(e){e.isSucceed?this.onLoadMain():this.loadLoginForm()},loadLoginForm:function(){Ext.get("DivLoading").remove();var e=this.getLoginForm();e.down("textfield[name=username]").focus()},onLoginBtnClick:function(e){var o,t,n,s,i=e.up("loginform");o=i.down("checkcode#loginCheckcode").getValue(),t=i.down("textfield[name=username]").getValue(),n=i.down("textfield[name=password]").getValue(),s=Ext.MD5(n),Ext.Ajax.request({url:Soims.service.users.UserService+"/IsUseful",method:"POST",scope:this,params:{loginId:t},success:function(n){n.responseText?Ext.MessageBox.alert("警告","无效用户！如有疑问，请联系大洋馆",function(){},this):(e.setText("正在登陆"),e.disable(),this.login(o,t,s))}})},onRegistBtnClick:function(){var e=this.getController("login.Regist");e.show()},onForgetPassBtnClick:function(e){Ext.Msg.show({title:"找回密码",msg:'<br />您可以发送主题为“索取密码”的邮件至：<a href="mailto:sample_cosr@fio.org.cn" />sample_cosr@fio.org.cn</a> 索取您的密码。邮件中，请注明您的姓名、单位、联系电话。<br /><br />感谢您的支持！<br /><div style="width: 100%; text-align: right">中国大洋样品馆&nbsp;&nbsp;&nbsp;</div>',buttons:Ext.Msg.OK,animEl:e.id,width:400,cls:"forget-password"})},login:function(e,o,t){Ext.Ajax.request({url:Soims.service.users.UserService+"/Login",success:this.onLoginSuccess,method:"POST",scope:this,params:{checkcode:e,loginId:o,password:t}})},loginByDefault:function(e,o){Ext.Ajax.request({url:Soims.service.users.UserService+"/LoginByDefault",success:this.onLoginSuccess,method:"POST",scope:this,params:{loginId:e,password:o}})},onFormLogin:function(e){var o=this.getLoginForm();return e.isSucceed?void this.onFormLoginSuccess(e):"NotAgreeLicence"==e.state?void o.showLicence():void o.onLoginFail(e)},onFormLoginSuccess:function(){var e,o,t,n=this.getLoginForm(),s=n.down("checkbox[name=autoLogin]");s.getValue()&&(e=n.down("textfield[name=username]").getValue(),o=n.down("textfield[name=password]").getValue(),t=Ext.MD5(o),Cookies.setLoginId(e),Cookies.setPassword(t),Cookies.setIsRememberLogin(!0)),this.onLoadMain()},onLoginSuccess:function(e){var o=this.parseLoginResult(e);o.isSucceed&&this.setCurrentLoginLog(o),this.onFormLogin(o)},setCurrentLoginLog:function(e){Cookies.setToken(e.loginLog.token),Soims.currentLoginLog=e.loginLog,Soims.currentUser=e.loginLog.user,Ext.Ajax.extraParams={token:Soims.currentLoginLog.token}},onLoadMain:function(){var e=this;Ext.Ajax.request({url:Soims.service.users.MenuService+"/ShowMenu",method:"POST",scope:e,success:function(o){if(this.onGetComponentConfig(),Ext.TaskManager.start(this.activeTask),o.responseText){var t=Ext.decode(o.responseText);e.loadMain(t)}}})},onGetComponentConfig:function(){Ext.Ajax.request({url:Soims.service.users.MenuService+"/GetComponent",method:"POST",scope:this,success:function(e){console.log(e.responseText),Soims.component=Ext.decode(e.responseText)}})},loadMain:function(e){this.application;window.onresize=Ext.emptyFn;var o=this.getController("mainFrame.Main");Ext.get("MainDiv").remove(),Ext.getBody().setStyle("text-align","left"),o.getConfigviewport().show(),o.updateUserInfo(),o.getWest().addItems(e)},activeTask:{run:function(){var e=Soims.currentLoginLog.token;void 0==e&&(Soims.currentLoginLog.token=Cookies.getToken()),Ext.Ajax.request({url:Soims.service.users.UserService+"/Active",success:this.onActive,method:"POST"})},interval:6e4},onActive:function(e){var o=this.parseLoginResult(e);o.isSucceed||Ext.Msg.show({title:"登陆失效",msg:"您的登录信息已失效，请重新登陆。",buttons:Ext.Msg.OK,fn:function(){window.location.reload(!0)},icon:Ext.MessageBox.WARNING})},logout:function(){Ext.Ajax.request({url:Soims.service.users.UserService+"/Logout",success:this.onLogoutSuccess,method:"GET"})},onLogoutSuccess:function(){Soims.currentLoginLog=void 0,Cookies.setToken(void 0),Cookies.setLoginId(void 0),Cookies.setPassword(void 0),Cookies.setIsRememberLogin(!1),window.location.reload(!0)},parseLoginResult:function(e){var o={};return o.state=Ext.DomQuery.selectValue("/LoginResult/State",e.responseXML),o.stateDescription=this.parseLoginResultState(o.state),o.isSucceed="Succeed"==o.state,o.isSucceed&&(o.loginLog=this.parseLoginLog(Ext.DomQuery.selectNode("/LoginResult/UserLoginLog",e.responseXML))),o},parseLoginLog:function(e){var o={};return o.token=Ext.DomQuery.selectValue("/Token",e),o.user=this.parseUser(Ext.DomQuery.selectNode("/User",e)),o.user.currentRoleID=Ext.DomQuery.selectValue("/CurrentRoleID",e),o.user.currentRoleCode=Ext.DomQuery.selectValue("/CurrentRoleCode",e),o.user.currentRoleName=Ext.DomQuery.selectValue("/CurrentRoleName",e),o},parseUser:function(e){var o={},t=function(e,o){return Boolean.toBoolean(Ext.DomQuery.selectValue(e,o))};return o.id=Ext.DomQuery.selectValue("/ID",e),o.name=Ext.DomQuery.selectValue("/Name",e),o.address=Ext.DomQuery.selectValue("/Address",e),o.loginId=Ext.DomQuery.selectValue("/LoginID",e),o.nameSpell=t("/NameSpell",e),o.passwordChanged=t("/PasswordChanged",e),o.department=Ext.DomQuery.selectValue("/Department",e),o.departmentId=Ext.DomQuery.selectValue("/DepartmentId",e),o.email=Ext.DomQuery.selectValue("/Email",e),o.zip=Ext.DomQuery.selectValue("/Zip",e),o.cellPhone=Ext.DomQuery.selectValue("/CellPhone",e),o.telPhone=Ext.DomQuery.selectValue("/TelPhone",e),o.fax=Ext.DomQuery.selectValue("/Fax",e),o},parseLoginResultState:function(e){switch(e){case"Succeed":return"登陆完成！";case"NullUserName":return"您输入的用户名为空！";case"UserNotFound":return"您输入的用户名不存在！";case"NullPassword":return"您输入的密码不能为空！";case"WrongPassword":return"您输入的密码错误，请重新输入！";case"DenyMultiLogin":return"该用户不允许多人同时登陆！";case"Locked":return"该用户已被锁定！";case"NotAgreeLicence":return"尚未同意用户协议！";case"WrongCheckCode":return"验证码错误，请重新输入！"}},onTextFieldLoginIdValid:function(e){var o=e.up("loginform");o._isTextFieldLoginIdValid=e.isValid(),this.onTextFieldValidChange(o)},onTextFieldPasswordValid:function(e){var o=e.up("loginform");o._isTextFieldPassword=e.isValid(),this.onTextFieldValidChange(o)},onTextFieldCheckCodeValid:function(e){var o=e.up("loginform");o._checkCodeValid=e.isValid(),this.onTextFieldValidChange(o)},onTextFieldValidChange:function(e){var o=e.down("button[action=onLogin]");e._isTextFieldLoginIdValid&&e._isTextFieldPassword&&e._checkCodeValid?o.enable():o.disable()},onTextField_KeyPress:function(e,o){var t=e.up("loginform"),n=t.down("button[action=onLogin]");o.getKey()!=o.ENTER||n.disabled||this.onLoginBtnClick(n)}});Ext.define("Soims.controller.mainFrame.Main",{extend:"Ext.app.Controller",views:["mainFrame.Viewport"],stores:["message.MessageList"],refs:[{ref:"configviewport",selector:"configviewport",autoCreate:!0,xtype:"configviewport"},{ref:"north",selector:"north",autoCreate:!0,xtype:"configviewport"},{ref:"west",selector:"west",autoCreate:!0,xtype:"west"},{ref:"center",selector:"center",autoCreate:!0,xtype:"center"},{ref:"rolemenu",selector:"rolemenu"},{ref:"messagelist",selector:"messagelist",autoCreate:!0,xtype:"messagelist"}],init:function(){this.control({west:{afterrender:this.afterWestRender},"north button[action=logout]":{click:this.logout},"north button[action=changePassword]":{click:function(){Ext.create("Soims.view.mainFrame.ModifyPdWin").show()}},"north button[action=improveInformation]":{click:function(){var e=Ext.create("Soims.view.mainFrame.ImproveInformation").show(),t=Ext.create("Soims.model.department.Department",{id:Soims.currentUser.departmentId,name:Soims.currentUser.department});e.down("#id").setValue(Soims.currentUser.id),e.down("#department").setValue(t),e.down("#name").setValue(Soims.currentUser.name),e.down("#loginId").setValue(Soims.currentUser.loginId),e.down("#email").setValue(Soims.currentUser.email),e.down("#telphone").setValue(Soims.currentUser.telPhone),e.down("#adress").setValue(Soims.currentUser.address),e.down("#fax").setValue(Soims.currentUser.fax),e.down("#cellphone").setValue(Soims.currentUser.cellPhone),e.down("#zipcode").setValue(Soims.currentUser.zip)}},"north button[action=messageList]":{click:function(){var e=this.getCon("message.AllMessageList");e.showAllMessageList()}},"west panel>a":{click:function(){console.log("menu click..")}},"center button[itemId=sendMessage]":{click:function(){var e=this.getCon("message.SendMessage");e.showWindow(this.getMessagelist())}},"center  button[action=markAllAsRead]":{click:function(e){this.markAllAsRead(e)}},"center button[itemId=check]":{click:function(e){var t=e.up("panel").getSelectionModel().getSelection()[0],s=this.getCon("message.SendMessage").getMessageSendMessageView(),o=Ext.create(s,{id:"ShowMessage"+t.get("id"),title:t.get("name"),isShow:!0});o.down("#content").getToolbar().hide(),o.show();var n=o.down("sendmessagebasic");n.loadRecord(t),this.markAsRead(e)}},"center  button[action=delete]":{click:function(e){Ext.Tools.Confirm("确认","您确定要删除该条目？",function(t){"yes"==t&&this.deleteDataBase(e)},this)}},"center  button[itemId=refreshTbar]":{click:function(e){e.up("panel").getStore().reload(),e.up("panel").getSelectionModel().deselectAll()}},"configviewport>center>panel>messagelist":{itemdblclick:function(){},selectionchange:function(e,t){0!=t.length?(this.getCenter().down("#delete").setDisabled(!1),this.getCenter().down("#check").setDisabled(!1)):(this.getCenter().down("#delete").setDisabled(!0),this.getCenter().down("#check").setDisabled(!0))}},rolemenu:{click:this.onRoleClick}})},afterWestRender:function(){var e=this.getWest().body;e.on("mousedown",this.doAction,this,{delegate:"a"}),e.on("click",Ext.emptyFn,this,{delegate:"a",preventDefault:!0})},doAction:function(e,t){var s=this.getCenter();s.body.mask("数据加载中...");var o,n,r,i=t.childNodes.item(0).innerHTML,a=t.id.replace("MenuBarItem-a-",""),c=this.application;o=a.split("-")[0],n=a.split("-")[1],3==a.split("-").length?(r=c.getController(o),r[n](a.split("-")[2],i)):(r=c.getController(o),r[n]()),s.body.unmask()},logout:function(){Ext.Tools.Confirm("确认","您确定要退出本系统吗？ 退出前请保存好您的重要信息！ ",function(e){if("yes"==e){var t=this.application,s=t.getController("login.Login");s.logout()}},this)},updateUserInfo:function(){var e=this.getNorth().getDockedItems('toolbar[dock="bottom"]')[0].items.items[0];this.getNorth().update({userName:Soims.currentUser.name,roleName:Soims.currentUser.currentRoleName}),e.update({userName:Soims.currentUser.name,roleName:Soims.currentUser.currentRoleName})},onRoleClick:function(e,t){t.id!==Soims.currentUser.currentRoleID?(this.closeAllTabs(),this.changeRole(e,t),Soims.currentUser.currentRoleID=t.id,Soims.currentUser.currentRoleName=t.text,Soims.currentUser.currentRoleCode=t.code,this.updateUserInfo()):Ext.Tools.Alert("警告","当前角色即为："+t.text,"W")},changeRole:function(e,t){Ext.Ajax.request({url:Soims.service.users.RoleService+"/ChangeRole",method:"POST",scope:this,params:{id:t.id},success:this.onChangeRoleSuccess})},onChangeRoleSuccess:function(){this.onGetComponentConfig();var e=this.getWest();e.body.mask("菜单加载中..."),Ext.Ajax.request({url:Soims.service.users.MenuService+"/ShowMenu",method:"POST",scope:e,success:this.onChangeMenuSuccess})},onGetComponentConfig:function(){Ext.Ajax.request({url:Soims.service.users.MenuService+"/GetComponent",method:"POST",scope:this,success:function(e){console.log(e.responseText),Soims.component=Ext.decode(e.responseText)}})},onChangeMenuSuccess:function(e){var t,s=this;e.responseText&&(s.removeAll(),t=Ext.decode(e.responseText),s.addItems(t)),s.body.unmask(),Ext.Tools.Msg("切换角色完成！",0)},closeAllTabs:function(){var e=this.getCenter(),t=e.getPlugin("TabCloseMenu");t.onCloseAll()},existInstance:function(e){var t=this.getCenter(),s=t.queryById(e);return s?(t.setActiveTab(s),s):s},addTab:function(e){var t=this.getCenter(),s=t.queryById(e.getId());s?t.setActiveTab(s):(t.add(e),t.setActiveTab(e))},getCon:function(e){var t=this.application;return t.getController(e)},markAsRead:function(e){var t=e.up("panel"),s=t.getSelectionModel(),o=s.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.MessageService+"/MarkAsRead",method:"POST",scope:this,params:{id:n},success:function(){e.up("panel").getStore().reload()}})},markAllAsRead:function(e){{var t=e.up("panel"),s=t.getSelectionModel();s.getSelection()[0]}Ext.Ajax.request({url:Soims.service.users.MessageService+"/MarkAllAsRead",method:"POST",scope:this,success:function(){e.up("panel").getStore().reload()}})},deleteDataBase:function(e){var t=e.up("panel"),s=t.getSelectionModel(),o=s.getSelection()[0],n=o.get("id");Ext.Ajax.request({url:Soims.service.users.MessageService+"/Delete",method:"POST",scope:this,params:{id:n},success:function(){e.up("panel").getStore().reload()}})}});